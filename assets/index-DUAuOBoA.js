import{jsx as t,jsxs as i,Fragment as yt}from"react/jsx-runtime";import oe,{useState as C,useEffect as me,useRef as Qe,useCallback as Xt,useMemo as _e,createContext as wa,useContext as ya}from"react";import{createRoot as Na}from"react-dom/client";import{GoogleGenAI as ka,Modality as Ca}from"@google/genai";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();var b=(e=>(e.CASH="十",e.STRINGS="貫",e.COINS="索",e.TEXTS="文",e))(b||{}),O=(e=>(e.RED="red",e.GREEN="green",e.BLACK="black",e))(O||{}),E=(e=>(e.ZUN="ZUN",e.JIAN="JIAN",e.BAI="BAI",e.JI="JI",e.QING="QING",e))(E||{}),fe=(e=>(e.HUMAN="HUMAN",e.AI="AI",e.NETWORK="NETWORK",e))(fe||{}),Ne=(e=>(e.GOOGLE="google",e.FACEBOOK="facebook",e.WECHAT="wechat",e.DOUYIN="douyin",e))(Ne||{}),ie=(e=>(e.DEALING="DEALING",e.SHUFFLING="SHUFFLING",e.PLAYING="PLAYING",e.KAI_CHONG="KAI_CHONG",e.SCORING="SCORING",e.GAME_OVER="GAME_OVER",e))(ie||{}),Ke=(e=>(e.EASY="EASY",e.MEDIUM="MEDIUM",e.HARD="HARD",e))(Ke||{}),K=(e=>(e.SAFE="SAFE",e.NOTICE="NOTICE",e.WARNING="WARNING",e.PENALTY="PENALTY",e))(K||{}),ee=(e=>(e.ANTI_BANKER="ANTI_BANKER",e.ANTI_BAI_LAO="ANTI_BAI_LAO",e.ANTI_SE_YANG="ANTI_SE_YANG",e))(ee||{});const j=(e,a,r,s,n,o,c)=>({id:c,suit:e,name:a,value:r,color:s,rank:n,description:o}),ge="c_11",pe="c_10",xe="c_9",tt="c_8",Sa="c_1",Ia="s_9",Aa="s_8",Ta="s_6",Ea="s_5",La="s_1",Ra="k_9",Oa="k_1",Ga="t_11",Ma="t_10",Da="t_9",Pa="t_1",Ba=`
你现在是“马吊大师”，一位精通中国古代纸牌游戏“马吊”的智者。
你的目标是用中文教会用户“三防”策略和出牌规则。

**策略：闲家三防 (Three Preventions)**
1. **防庄家 (Prevent the Banker):** 如果庄家出牌可能赢墩，你必须尽全力捉打（Capture）。
2. **防百老 (Prevent the Millionaire):** 持有“百万”的玩家很危险。阻止他赢两墩（正本）。
3. **防色样 (Prevent Patterns):** 如果某人已经打出了3张同色样牌（如3张极/趣），绝不能让他赢第4张！

**出牌规则 (Leading Rules):**
1. **尊张限制:** 在同门的“肩”张出现之前，不要轻易首发“尊”（红）牌。
2. **青张保护:** 如果你持有同门的“极”（绿/趣），不要过早打完手中的青牌（黑）。
3. **十字门限制:** 除非你是“百老”（持有百万），否则避免首发十字门（钱/十）。
4. **两门原则:** 尽量只打你最强的两门花色。不要随意开第三门。
5. **千万禁手:** 永远不要首发“千万”。

请用简洁、古风的中文解释这些规则。警告用户，违反这些规则可能导致“包赔”（Penalty），即一人承担所有输分！
`,Ha=()=>{const e=[];return e.push(j(b.CASH,"萬萬",11,O.RED,E.ZUN,"宋江",ge)),e.push(j(b.CASH,"千萬",10,O.RED,E.JIAN,"武松",pe)),e.push(j(b.CASH,"百萬",9,O.RED,E.BAI,"阮小五",xe)),e.push(j(b.CASH,"九十",8,O.BLACK,E.QING,"阮小七",tt)),e.push(j(b.CASH,"八十",7,O.BLACK,E.QING,"朱仝","c_7")),e.push(j(b.CASH,"七十",6,O.BLACK,E.QING,"孫立","c_6")),e.push(j(b.CASH,"六十",5,O.BLACK,E.QING,"呼延灼","c_5")),e.push(j(b.CASH,"五十",4,O.BLACK,E.QING,"魯智深","c_4")),e.push(j(b.CASH,"四十",3,O.BLACK,E.QING,"李逵","c_3")),e.push(j(b.CASH,"三十",2,O.BLACK,E.QING,"楊志","c_2")),e.push(j(b.CASH,"二十",1,O.GREEN,E.JI,"扈三娘",Sa)),e.push(j(b.STRINGS,"九貫",9,O.RED,E.ZUN,"雷橫",Ia)),e.push(j(b.STRINGS,"八貫",8,O.RED,E.JIAN,"索超",Aa)),e.push(j(b.STRINGS,"七貫",7,O.BLACK,E.QING,"秦明","s_7")),e.push(j(b.STRINGS,"六貫",6,O.BLACK,E.QING,"史進",Ta)),e.push(j(b.STRINGS,"五貫",5,O.BLACK,E.QING,"李俊",Ea)),e.push(j(b.STRINGS,"四貫",4,O.BLACK,E.QING,"柴進","s_4")),e.push(j(b.STRINGS,"三貫",3,O.BLACK,E.QING,"關勝","s_3")),e.push(j(b.STRINGS,"二貫",2,O.BLACK,E.QING,"花榮","s_2")),e.push(j(b.STRINGS,"一貫",1,O.GREEN,E.JI,"燕青",La)),e.push(j(b.COINS,"九索",9,O.RED,E.ZUN,"九條",Ra)),e.push(j(b.COINS,"八索",8,O.RED,E.JIAN,"八條","k_8")),e.push(j(b.COINS,"七索",7,O.BLACK,E.QING,"七條","k_7")),e.push(j(b.COINS,"六索",6,O.BLACK,E.QING,"六條","k_6")),e.push(j(b.COINS,"五索",5,O.BLACK,E.QING,"五條","k_5")),e.push(j(b.COINS,"四索",4,O.BLACK,E.QING,"四條","k_4")),e.push(j(b.COINS,"三索",3,O.BLACK,E.QING,"三條","k_3")),e.push(j(b.COINS,"二索",2,O.BLACK,E.QING,"二條","k_2")),e.push(j(b.COINS,"一索",1,O.GREEN,E.JI,"麼雞",Oa)),e.push(j(b.TEXTS,"空文",11,O.RED,E.ZUN,"王英",Ga)),e.push(j(b.TEXTS,"半文",10,O.RED,E.JIAN,"花束",Ma)),e.push(j(b.TEXTS,"一文",9,O.BLACK,E.QING,"一筒",Da)),e.push(j(b.TEXTS,"二文",8,O.BLACK,E.QING,"二筒","t_8")),e.push(j(b.TEXTS,"三文",7,O.BLACK,E.QING,"三筒","t_7")),e.push(j(b.TEXTS,"四文",6,O.BLACK,E.QING,"四筒","t_6")),e.push(j(b.TEXTS,"五文",5,O.BLACK,E.QING,"五筒","t_5")),e.push(j(b.TEXTS,"六文",4,O.BLACK,E.QING,"六筒","t_4")),e.push(j(b.TEXTS,"七文",3,O.BLACK,E.QING,"七筒","t_3")),e.push(j(b.TEXTS,"八文",2,O.BLACK,E.QING,"八筒","t_2")),e.push(j(b.TEXTS,"九文",1,O.GREEN,E.JI,"九筒",Pa)),e},at={en:{title:"MA DIAO MASTER",subtitle:"ANCIENT CHINESE BRIDGE",enterGame:"ENTER GAME",roundStart:"Hand Start",trick:"Trick",yourTurn:"Your Turn",thinking:"Thinking...",winsTrick:"takes the trick",player:"Player",visibleCards:"Table Cards",diaoPoints:"Diao (Penalty)",kaiZhuPoints:"Open Pot",qiaoMenPoints:"Knock",seYangPoints:"Melds/Patterns",kaiChongPoints:"Breakout",score:"Score",nextRound:"Next Deal",patterns:"Melds:",confirm:"CONFIRM",act_play:"Play Card",ctx_lead:"Lead",ctx_catch:"Capture",ctx_melt:"Discard",act_deal:"Lead",act_catch:"Take",act_melt:"Disc",dir_north:"North",dir_south:"South",dir_east:"East",dir_west:"West",pat_clouds:"Azure Clouds (Ping Bu Qing Yun)",pat_huang_hui_tu:"Imperial Gathering",pat_qian_jun_zhu:"Iron Pillar",pat_hua_du_dou:"Flower Bodice",pat_hua_bi_jian:"Flower Shoulder",pat_qiao_si_shang:"Smart Four Rewards",pat_qiao_si_jian:"Smart Four Shoulders",pat_tian_di_fen:"Heaven & Earth",pat_jian_tian_di:"Shoulder Heaven & Earth",pat_xiao_tian_di:"Lesser Heaven & Earth",pat_bai_duan_jian:"Million Short Shoulder",pat_bai_chang_jian:"Million Long Shoulder",pat_ji_duan_jian:"Extreme Short Shoulder",pat_ji_chang_jian:"Extreme Long Shoulder",pat_bai_ji_si_shang:"Million Extreme Rewards",pat_bai_ji_si_jian:"Million Extreme Shoulders",pat_bai_shang_si_ji:"Million Reward Extremes",pat_bai_jian_si_ji:"Million Shoulder Extremes",pat_jie_jie_gao:"Rising Step by Step",pat_duan_jian:"Short Shoulder",pat_dui_jian:"Pair Shoulder",pat_chang_jian:"Long Shoulder",pat_shang_ji_yu:"Reward Carp Back",pat_jian_ji_yu:"Shoulder Carp Back",pat_bai_ji_yu:"Million Carp Back",pat_six_table:"Six Trick Diao",pat_seven_table:"Seven Trick Diao",pat_eight_table:"Eight Trick Diao",pat_nei_sheng:"Inner Saint Outer King",pat_tian_ran_qu:"Natural Charm",pat_empress:"Empress Ascension",pat_dragon_leap:"Dragon Leap",pat_buddha_pearl:"Buddha Pearl",pat_flower_goddess:"Flower Goddess",pat_butterfly:"Twin Butterflies",pat_three_stack:"Triple Stack",pat_wind_flag:"Wind Flag",pat_mirror_person:"Mirror Image",pat_beauty_med:"Beauty Meditating",pat_borrow_flower:"Borrow Flower",pat_couple_reunion:"Reunion",pat_fairy_son:"Fairy Gift",pat_fo_chi_jiao:"Barefoot Buddha",aiDisabled:"AI Tutor disabled (No API Key).",masterTitle:"Tutor",masterName:"Ma Diao Master",meditating:"Thinking...",chatPlaceholder:"Ask a rule...",chatPlaceholderDisabled:"AI Disabled",soundOn:"Sound On",soundOff:"Mute",diff_easy:"Novice",diff_medium:"Standard",diff_hard:"Expert",quitGame:"Quit",quitConfirm:"Quit current game? Progress will be lost.",cancel:"Cancel",oneClickPlay:"1-Click",riskAlertOn:"Hints: ON",riskAlertOff:"Hints: OFF",risk_safe:"Safe Play",risk_warning:"Strategy Warning",risk_penalty:"GRAND PENALTY",risk_confirm_penalty:"Accept Penalty & Play",risk_confirm_warning:"Ignore Warning",risk_cancel:"Reconsider",warn_title:"Strategy Alert",warn_cash_lead:'Only the "Millionaire" (Bai Lao) should lead Cash. Leading this risks a Penalty.',warn_zun_early:'Leading a "Reward" (Zun) before the "Shoulder" appears is dangerous.',warn_qing_exhaust:"Do not exhaust your Black (Qing) cards while holding the Extreme (Ji).",warn_qian_wan:'Leading "Qian Wan" is a forbidden move.',warn_continue:"Proceed anyway?",phase_kai_chong:"Breakout Phase",flip_card:"Draw",kc_match_success:"Matched!",kc_match_fail:"No Match",kc_turn_pass:"Pass",kc_skip_ineligible:"Skip (Ineligible)",kc_single:"Single",kc_dan_chong:"Single Match (1pt)",kc_brother:"Brother",kc_double:"Twin",kc_triple:"Triplet",kc_seq:"Sequential",kc_gap:"Gap",tab_summary:"Summary",tab_kai_zhu:"Pot / Knock",tab_se_yang:"Melds",tab_kai_chong:"Breakout",tab_kc_se_yang:"BO Melds",pat_kc_shi_hong:"Ten Red Gathering",pat_kc_man_tang_hong:"Full House Red",pat_kc_10_zui:"Drunken Beauty (10)",pat_kc_9_zui:"Drunken Beauty (9)",pat_kc_8_zui:"Drunken Beauty (8)",pat_kc_ju_qing:"All Same Clan",pat_kc_shi_tong:"Ten of a Kind",pat_kc_jiu_tong:"Nine of a Kind",pat_kc_qian_shi_quan:"Full Cash/Texts",pat_kc_guan_suo_quan:"Full Strings/Coins",pat_kc_tai_ji:"Tai Chi (7+1)",pat_kc_yuan_yang:"Mandarin Duck 7",pat_kc_lian_huan:"Chain 7",pat_kc_one_shot_7:"One Shot 7",pat_kc_one_shot_6:"One Shot 6",pat_kc_yin_hua:"Stamp",pat_kc_jin_jue:"Gold Dig",pat_kc_yin_jue:"Silver Dig",pat_kc_shuang_jue:"Double Dig",pat_kc_duo_jin:"Trophy Snatch"},zh_CN:{title:"馬吊大師",subtitle:"古风纸牌游戏",enterGame:"开始游戏",roundStart:"回合开始",trick:"第几墩",yourTurn:"轮到你了",thinking:"思考中...",winsTrick:"赢得此墩",player:"玩家",visibleCards:"得桌",diaoPoints:"吊数",kaiZhuPoints:"开注",qiaoMenPoints:"敲门",seYangPoints:"色样",kaiChongPoints:"开冲",score:"得分",nextRound:"下一局",patterns:"牌型:",confirm:"确认",act_play:"出牌",ctx_lead:"发牌",ctx_catch:"捉牌",ctx_melt:"灭牌",act_deal:"发",act_catch:"捉",act_melt:"灭",dir_north:"北",dir_south:"南",dir_east:"东",dir_west:"西",pat_clouds:"平步青云",pat_huang_hui_tu:"皇会图",pat_qian_jun_zhu:"千均柱",pat_hua_du_dou:"花肚兜",pat_hua_bi_jian:"花比肩",pat_qiao_si_shang:"巧四赏",pat_qiao_si_jian:"巧四肩",pat_tian_di_fen:"天地分",pat_jian_tian_di:"肩天地分",pat_xiao_tian_di:"小天地分",pat_bai_duan_jian:"百短肩",pat_bai_chang_jian:"百长肩",pat_ji_duan_jian:"极短肩",pat_ji_chang_jian:"极长肩",pat_bai_ji_si_shang:"百极四赏",pat_bai_ji_si_jian:"百极四肩",pat_bai_shang_si_ji:"百赏四极",pat_bai_jian_si_ji:"百肩四极",pat_jie_jie_gao:"节节高",pat_duan_jian:"短肩",pat_dui_jian:"对肩",pat_chang_jian:"长肩",pat_shang_ji_yu:"赏鲫鱼背",pat_jian_ji_yu:"肩鲫鱼背",pat_bai_ji_yu:"百鲫鱼背",pat_six_table:"六桌吊",pat_seven_table:"七桌吊",pat_eight_table:"八桌吊",pat_nei_sheng:"内圣外王",pat_tian_ran_qu:"天然趣",pat_empress:"女帝登基",pat_dragon_leap:"龙门跃",pat_buddha_pearl:"佛顶珠",pat_flower_goddess:"散花天女",pat_butterfly:"蝶双飞",pat_three_stack:"三叠趣",pat_wind_flag:"顺风旗",pat_mirror_person:"镜中人",pat_beauty_med:"美女参禅",pat_borrow_flower:"借花献佛",pat_couple_reunion:"夫妻团圆",pat_fairy_son:"天仙送子",pat_fo_chi_jiao:"佛赤脚",aiDisabled:"AI导师已禁用 (未配置API Key)",masterTitle:"导师",masterName:"马吊大师",meditating:"冥想中...",chatPlaceholder:"询问规则...",chatPlaceholderDisabled:"AI已禁用",soundOn:"开启声音",soundOff:"静音",diff_easy:"简单",diff_medium:"中等",diff_hard:"困难",quitGame:"退出游戏",quitConfirm:"确定要退出吗？当前进度将丢失。",cancel:"取消",oneClickPlay:"单击出牌",riskAlertOn:"提示: 开",riskAlertOff:"提示: 关",risk_safe:"安全",risk_warning:"战术警示",risk_penalty:"严重违例 (包赔)",risk_confirm_penalty:"坚持出牌 (承担包赔)",risk_confirm_warning:"忽略警告",risk_cancel:"重新考虑",warn_title:"战术警示",warn_cash_lead:"非“百老”之家不应首发十字门（十、钱）。此举可能导致“包赔”。",warn_zun_early:"同门“肩”张未现身前，首发“赏”（尊）张风险极大。",warn_qing_exhaust:"持有“极”（趣）张时，切勿将同门青张发完。",warn_qian_wan:"首发“千万”属于禁手。",warn_continue:"坚持出牌（可能导致包赔）？",phase_kai_chong:"开冲阶段",flip_card:"翻底牌",kc_match_success:"开冲成功!",kc_match_fail:"无匹配",kc_turn_pass:"过",kc_skip_ineligible:"跳过 (无红/趣)",kc_single:"单冲",kc_dan_chong:"单冲 (1分)",kc_brother:"兄弟冲",kc_double:"双胞胎冲",kc_triple:"三胞胎冲",kc_seq:"顺领冲",kc_gap:"间领冲",tab_summary:"结算",tab_kai_zhu:"开注 / 敲门",tab_se_yang:"色样",tab_kai_chong:"开冲明细",tab_kc_se_yang:"冲成色样",pat_kc_shi_hong:"十红聚会",pat_kc_man_tang_hong:"满堂红",pat_kc_10_zui:"十红醉楊妃",pat_kc_9_zui:"九红醉楊妃",pat_kc_8_zui:"八红醉楊妃",pat_kc_ju_qing:"具庆堂",pat_kc_shi_tong:"十同",pat_kc_jiu_tong:"九同",pat_kc_qian_shi_quan:"钱十全门",pat_kc_guan_suo_quan:"贯索全门",pat_kc_tai_ji:"太极图",pat_kc_yuan_yang:"鸳鸯七同",pat_kc_lian_huan:"连环七同",pat_kc_one_shot_7:"一冲七",pat_kc_one_shot_6:"一冲六",pat_kc_yin_hua:"印花",pat_kc_jin_jue:"金掘藏",pat_kc_yin_jue:"银掘藏",pat_kc_shuang_jue:"双掘藏",pat_kc_duo_jin:"夺锦标"},zh_TW:{title:"馬吊大師",subtitle:"古風紙牌遊戲",enterGame:"進入遊戲",roundStart:"回合開始",trick:"第幾墩",yourTurn:"輪到你了",thinking:"思考中...",winsTrick:"贏得此墩",player:"玩家",visibleCards:"得桌",diaoPoints:"吊數",kaiZhuPoints:"開註",qiaoMenPoints:"敲門",seYangPoints:"色樣",kaiChongPoints:"開衝",score:"得分",nextRound:"下一局",patterns:"牌型:",confirm:"確認",act_play:"出牌",ctx_lead:"發牌",ctx_catch:"捉牌",ctx_melt:"滅牌",act_deal:"發",act_catch:"捉",act_melt:"滅",dir_north:"北",dir_south:"南",dir_east:"東",dir_west:"西",pat_clouds:"平步青雲",pat_huang_hui_tu:"皇會圖",pat_qian_jun_zhu:"千均柱",pat_hua_du_dou:"花肚兜",pat_hua_bi_jian:"花比肩",pat_qiao_si_shang:"巧四賞",pat_qiao_si_jian:"巧四肩",pat_tian_di_fen:"天地分",pat_jian_tian_di:"肩天地分",pat_xiao_tian_di:"小天地分",pat_bai_duan_jian:"百短肩",pat_bai_chang_jian:"百長肩",pat_ji_duan_jian:"極短肩",pat_ji_chang_jian:"極長肩",pat_bai_ji_si_shang:"百極四賞",pat_bai_ji_si_jian:"百極四肩",pat_bai_shang_si_ji:"百賞四極",pat_bai_jian_si_ji:"百肩四極",pat_jie_jie_gao:"節節高",pat_duan_jian:"短肩",pat_dui_jian:"對肩",pat_chang_jian:"長肩",pat_shang_ji_yu:"賞鯽魚背",pat_jian_ji_yu:"肩鯽魚背",pat_bai_ji_yu:"百鯽魚背",pat_six_table:"六桌吊",pat_seven_table:"七桌吊",pat_eight_table:"八桌吊",pat_nei_sheng:"內聖外王",pat_tian_ran_qu:"天然趣",pat_empress:"女帝登基",pat_dragon_leap:"龍門躍",pat_buddha_pearl:"佛頂珠",pat_flower_goddess:"散花天女",pat_butterfly:"蝶雙飛",pat_three_stack:"三疊趣",pat_wind_flag:"順風旗",pat_mirror_person:"鏡中人",pat_beauty_med:"美女參禪",pat_borrow_flower:"借花獻佛",pat_couple_reunion:"夫妻團圓",pat_fairy_son:"天仙送子",pat_fo_chi_jiao:"佛赤腳",aiDisabled:"AI導師已禁用 (未配置API Key)",masterTitle:"導師",masterName:"馬吊大師",meditating:"冥想中...",chatPlaceholder:"詢問規則...",chatPlaceholderDisabled:"AI已禁用",soundOn:"開啟聲音",soundOff:"靜音",diff_easy:"簡單",diff_medium:"中等",diff_hard:"困難",quitGame:"退出遊戲",quitConfirm:"確定要退出嗎？當前進度將丟失。",cancel:"取消",oneClickPlay:"單擊出牌",riskAlertOn:"提示: 開",riskAlertOff:"提示: 關",risk_safe:"安全",risk_warning:"戰術警示",risk_penalty:"嚴重違例 (包賠)",risk_confirm_penalty:"堅持出牌 (承擔包賠)",risk_confirm_warning:"忽略警告",risk_cancel:"重新考慮",warn_title:"戰術警示",warn_cash_lead:"非“百老”之家不應首發十字門（十、錢）。此舉可能導致“包賠”。",warn_zun_early:"同門“肩”張未現身前，首發“賞”（尊）張風險極大。",warn_qing_exhaust:"持有“極”（趣）張時，切勿將同門青張發完。",warn_qian_wan:"首發“千萬”屬於禁手。",warn_continue:"堅持出牌（可能導致包賠）？",phase_kai_chong:"開衝階段",flip_card:"翻底牌",kc_match_success:"開衝成功!",kc_match_fail:"無匹配",kc_turn_pass:"過",kc_skip_ineligible:"跳過 (無紅/趣)",kc_single:"單衝",kc_dan_chong:"單衝 (1分)",kc_brother:"兄弟衝",kc_double:"雙胞胎衝",kc_triple:"三胞胎衝",kc_seq:"順領衝",kc_gap:"間領衝",tab_summary:"結算",tab_kai_zhu:"開註 / 敲門",tab_se_yang:"色樣",tab_kai_chong:"開衝明細",tab_kc_se_yang:"衝成色樣",pat_kc_shi_hong:"十紅聚會",pat_kc_man_tang_hong:"滿堂紅",pat_kc_10_zui:"十紅醉楊妃",pat_kc_9_zui:"九紅醉楊妃",pat_kc_8_zui:"八紅醉楊妃",pat_kc_ju_qing:"具慶堂",pat_kc_shi_tong:"十同",pat_kc_jiu_tong:"九同",pat_kc_qian_shi_quan:"錢十全門",pat_kc_guan_suo_quan:"貫索全門",pat_kc_tai_ji:"太極圖",pat_kc_yuan_yang:"鴛鴦七同",pat_kc_lian_huan:"連環七同",pat_kc_one_shot_7:"一衝七",pat_kc_one_shot_6:"一衝六",pat_kc_yin_hua:"印花",pat_kc_jin_jue:"金掘藏",pat_kc_yin_jue:"銀掘藏",pat_kc_shuang_jue:"雙掘藏",pat_kc_duo_jin:"奪錦標"},ja:{title:"馬吊マスター",subtitle:"古代中国のカードゲーム",enterGame:"ゲーム開始",roundStart:"配牌完了",trick:"トリック",yourTurn:"あなたの番",thinking:"思考中...",winsTrick:"が獲得",player:"プレイヤー",visibleCards:"獲得札",diaoPoints:"吊数",kaiZhuPoints:"開注",qiaoMenPoints:"敲門",seYangPoints:"役 (Se Yang)",kaiChongPoints:"開衝 (ボーナス)",score:"スコア",nextRound:"次の局へ",patterns:"成立役:",confirm:"確認",act_play:"打牌",ctx_lead:"先発 (Lead)",ctx_catch:"奪取 (Take)",ctx_melt:"捨牌 (Discard)",act_deal:"出",act_catch:"奪",act_melt:"捨",dir_north:"北家",dir_south:"南家",dir_east:"東家",dir_west:"西家",pat_clouds:"平步青雲",pat_huang_hui_tu:"皇会図",pat_qian_jun_zhu:"千均柱",pat_nei_sheng:"内聖外王",pat_tian_ran_qu:"天然趣",pat_empress:"女帝登基",pat_dragon_leap:"龍門躍",pat_buddha_pearl:"佛頂珠",pat_flower_goddess:"散花天女",pat_butterfly:"蝶雙飛",pat_three_stack:"三疊趣",pat_wind_flag:"順風旗",pat_mirror_person:"鏡中人",pat_beauty_med:"美女參禪",pat_borrow_flower:"借花献佛",pat_couple_reunion:"夫妻團圓",pat_fairy_son:"天仙送子",pat_fo_chi_jiao:"佛赤脚 (仏の裸足)",aiDisabled:"AI無効",masterTitle:"先生",masterName:"馬吊大師",meditating:"瞑想中...",chatPlaceholder:"ルールを聞く...",chatPlaceholderDisabled:"AI無効",soundOn:"音オン",soundOff:"音オフ",diff_easy:"初級",diff_medium:"中級",diff_hard:"上級",quitGame:"終了",quitConfirm:"終了しますか？進行状況は失われます。",cancel:"キャンセル",oneClickPlay:"1クリック",riskAlertOn:"ヒント: オン",riskAlertOff:"ヒント: オフ",risk_safe:"安全",risk_warning:"戦略警告",risk_penalty:"責任払い (パオ)",risk_confirm_penalty:"続行 (責任払い)",risk_confirm_warning:"警告を無視",risk_cancel:"再考する",warn_title:"戦略警告",warn_cash_lead:"「百老」でない場合、十字門（十、金）を先発してはいけません。責任払いのリスクがあります。",warn_zun_early:"同スートの「肩」が出る前に「賞」（尊）を出すのは危険です。",warn_qing_exhaust:"「極」（趣）を持っている場合、同スートの青牌を使い切ってはいけません。",warn_qian_wan:"「千万」を先発するのは禁止手（チョンボ）です。",warn_continue:"続けますか（責任払いの可能性あり）？",phase_kai_chong:"開衝フェーズ",flip_card:"めくる",kc_match_success:"マッチ!",kc_match_fail:"マッチなし",kc_turn_pass:"パス",kc_skip_ineligible:"スキップ",kc_single:"単衝",kc_dan_chong:"単衝 (1点)",kc_brother:"兄弟衝",kc_double:"双子衝",kc_triple:"三つ子衝",kc_seq:"順領衝",kc_gap:"間領衝",tab_summary:"集計",tab_kai_zhu:"開注 / 敲門",tab_se_yang:"役種",tab_kai_chong:"開衝",tab_kc_se_yang:"衝成役",pat_kc_shi_hong:"十紅聚会",pat_kc_man_tang_hong:"滿堂紅",pat_kc_10_zui:"十紅醉楊妃",pat_kc_9_zui:"九紅醉楊妃",pat_kc_8_zui:"八紅醉楊妃",pat_kc_ju_qing:"具慶堂",pat_kc_shi_tong:"十同",pat_kc_jiu_tong:"九同",pat_kc_qian_shi_quan:"錢十全門",pat_kc_guan_suo_quan:"貫索全門",pat_kc_tai_ji:"太極圖",pat_kc_yuan_yang:"鴛鴦七同",pat_kc_lian_huan:"連環七同",pat_kc_one_shot_7:"一衝七",pat_kc_one_shot_6:"一衝六",pat_kc_yin_hua:"印花",pat_kc_jin_jue:"金掘藏",pat_kc_yin_jue:"銀掘藏",pat_kc_shuang_jue:"雙掘藏",pat_kc_duo_jin:"奪錦標"},ko:{title:"마조 마스터",subtitle:"고대 중국 카드 게임",enterGame:"게임 시작",roundStart:"판 시작",trick:"트릭",yourTurn:"내 차례",thinking:"생각 중...",winsTrick:"획득",player:"플레이어",visibleCards:"획득한 패",diaoPoints:"조",kaiZhuPoints:"개주",qiaoMenPoints:"고문",seYangPoints:"색양 (족보)",kaiChongPoints:"개충",score:"점수",nextRound:"다음 판",patterns:"족보:",confirm:"확인",act_play:"내기",ctx_lead:"선 (Lead)",ctx_catch:"먹기 (Capture)",ctx_melt:"버림 (Discard)",act_deal:"선",act_catch:"먹",act_melt:"버",dir_north:"북",dir_south:"남",dir_east:"동",dir_west:"서",pat_clouds:"평보청운",pat_huang_hui_tu:"황회도",pat_qian_jun_zhu:"천균주",pat_hua_du_dou:"화두두",pat_hua_bi_jian:"화비견",pat_qiao_si_shang:"교사상",pat_qiao_si_jian:"교사견",pat_tian_di_fen:"천지분",pat_jian_tian_di:"견천지분",pat_xiao_tian_di:"소천지분",pat_bai_duan_jian:"백단견",pat_bai_chang_jian:"백장견",pat_ji_duan_jian:"극단견",pat_ji_chang_jian:"극장견",pat_bai_ji_si_shang:"백극사상",pat_bai_ji_si_jian:"백극사견",pat_bai_shang_si_ji:"백상사극",pat_bai_jian_si_ji:"백견사극",pat_jie_jie_gao:"절절고",pat_duan_jian:"단견",pat_dui_jian:"대견",pat_chang_jian:"장견",pat_shang_ji_yu:"상즉어배",pat_jian_ji_yu:"견즉어배",pat_bai_ji_yu:"백즉어배",pat_six_table:"육탁조",pat_seven_table:"칠탁조",pat_eight_table:"팔탁조",pat_nei_sheng:"내성외왕",pat_tian_ran_qu:"천연취",pat_empress:"여제등극",pat_dragon_leap:"용문약",pat_buddha_pearl:"불정주",pat_flower_goddess:"산화천녀",pat_butterfly:"접쌍비",pat_three_stack:"삼첩취",pat_wind_flag:"순풍기",pat_mirror_person:"경중인",pat_beauty_med:"미녀참선",pat_borrow_flower:"차화헌불",pat_couple_reunion:"부처단원",pat_fairy_son:"천선송자",pat_fo_chi_jiao:"불적각 (부처의 맨발)",aiDisabled:"AI 비활성화됨",masterTitle:"스승",masterName:"마조 대사",meditating:"명상 중...",chatPlaceholder:"규칙 물어보기...",chatPlaceholderDisabled:"AI 꺼짐",soundOn:"소리 켜기",soundOff:"소리 끄기",diff_easy:"하수",diff_medium:"중수",diff_hard:"고수",quitGame:"게임 종료",quitConfirm:"정말 종료하시겠습니까? 진행 상황이 손실됩니다.",cancel:"취소",oneClickPlay:"원클릭",riskAlertOn:"알림: 켜짐",riskAlertOff:"알림: 꺼짐",risk_safe:"안전",risk_warning:"전술 경고",risk_penalty:"독박 (벌칙)",risk_confirm_penalty:"독박 감수하고 진행",risk_confirm_warning:"경고 무시",risk_cancel:"다시 생각하기",warn_title:"전술 경고",warn_cash_lead:'백만(Bai Wan)을 가진 "백로"가 아니라면 십(Cash) 무늬를 먼저 내지 마십시오. 독박 위험이 있습니다.',warn_zun_early:'같은 무늬의 "견(Shoulder)" 카드가 나오기 전에 "상(Reward/Zun)" 카드를 먼저 내는 것은 위험합니다.',warn_qing_exhaust:'"극(Extreme/Ji)" 카드를 가지고 있다면, 같은 무늬의 청(Black) 카드를 다 써버리지 마십시오.',warn_qian_wan:'"천만(Qian Wan)"을 먼저 내는 것은 금지된 수입니다.',warn_continue:"계속하시겠습니까 (독박 가능성 있음)?",phase_kai_chong:"개충 단계",flip_card:"뒤집기",kc_match_success:"매치 성공!",kc_match_fail:"매치 없음",kc_turn_pass:"패스",kc_skip_ineligible:"건너뜀",kc_single:"단충",kc_dan_chong:"단충 (1점)",kc_brother:"형제충",kc_double:"쌍포태충",kc_triple:"삼포태충",kc_seq:"순령충",kc_gap:"간령충",tab_summary:"요약",tab_kai_zhu:"개주 / 고문",tab_se_yang:"색양",tab_kai_chong:"개충",tab_kc_se_yang:"개충 색양",pat_kc_shi_hong:"십홍집합",pat_kc_man_tang_hong:"만당홍",pat_kc_10_zui:"십홍취양비",pat_kc_9_zui:"구홍취양비",pat_kc_8_zui:"팔홍취양비",pat_kc_ju_qing:"구경당",pat_kc_shi_tong:"십동",pat_kc_jiu_tong:"구동",pat_kc_qian_shi_quan:"전십전문",pat_kc_guan_suo_quan:"관색전문",pat_kc_tai_ji:"태극도",pat_kc_yuan_yang:"원앙칠동",pat_kc_lian_huan:"연환칠동",pat_kc_one_shot_7:"일충칠",pat_kc_one_shot_6:"일충육",pat_kc_yin_hua:"인화",pat_kc_jin_jue:"금굴장",pat_kc_yin_jue:"은굴장",pat_kc_shuang_jue:"쌍굴장",pat_kc_duo_jin:"탈금표"}},Vt={[b.TEXTS]:{viceShoulderVal:10,viceExtremeVal:1},[b.CASH]:{viceShoulderVal:9,viceExtremeVal:1},[b.STRINGS]:{viceShoulderVal:8,viceExtremeVal:1},[b.COINS]:{viceShoulderVal:8,viceExtremeVal:1}},Dt=e=>[11,10,9,1].includes(e),Ge=e=>e.color===O.RED||e.color===O.GREEN,ht=(e,a,r)=>{if(Math.abs(e-a)===1)return!0;if(r===b.CASH||r===b.TEXTS){if(e===11&&a===1||e===1&&a===11)return!0}else if(e===9&&a===1||e===1&&a===9)return!0;return!1},ft=(e,a)=>{const r=Vt[a];if(!r)return!1;const s=Math.min(r.viceExtremeVal,r.viceShoulderVal),n=Math.max(r.viceExtremeVal,r.viceShoulderVal);return a===b.CASH&&e===8?!1:e>s&&e<n},Me=(e,a,r,s)=>{if(e===a||ht(e,a,r)||r===b.CASH&&(e===9&&a===8||e===8&&a===9))return!0;const n=new Set,o=[e];for(n.add(e);o.length>0;){const c=o.shift();if(ht(c,a,r)||r===b.CASH&&(c===9&&a===8||c===8&&a===9))return!0;for(const l of s)if(!n.has(l)){let u=ht(c,l,r);!u&&r===b.CASH&&(c===9&&l===8||c===8&&l===9)&&(u=!0),u&&(n.add(l),o.push(l))}}return!1},pt=(e,a,r)=>{const s=Vt[a];return s?!!(r.has(s.viceShoulderVal)&&Me(e,s.viceShoulderVal,a,r)||r.has(s.viceExtremeVal)&&Me(e,s.viceExtremeVal,a,r)||a===b.CASH&&r.has(8)&&Me(e,8,a,r)):!1},$a=(e,a)=>{if(e.suit!==b.CASH)return 1;if(e.value===11){if(a.wanCaughtQian&&a.qianCaughtBai)return 3;if(a.wanCaughtQian||a.wanCaughtBai)return 2}else if(e.value===10&&a.qianCaughtBai)return 2;return 1},ja=(e,a,r,s)=>{const n=new Set;r&&r.forEach(f=>{f.playerId===e.id&&n.add(f.matchedCard.id)});const o=new Set;e.capturedCards.forEach(f=>{f.suit===a.suit&&o.add(f.value)}),o.add(a.value);const c=e.capturedCards.filter(f=>f.suit===a.suit&&!n.has(f.id));if(c.length===0)return null;let l=0;const u=[],p=[];let d=999;if(a.suit===b.CASH&&a.value===8){const f=c.find(N=>N.value===9),m=c.find(N=>N.value===7);if(f&&m)return{score:5,matchType:"JIAN_LING",description:"间领冲 (5分): 百万顺冲(2) + 八十逆冲(3)",validCards:[f,m],priority:0}}for(const f of c){let m=0,N="",A=$a(f,s);const h=f.value,x=a.value,w=f.suit;if(f.rank===E.JIAN){const y=w===b.CASH||w===b.TEXTS?11:9;if(!o.has(y))continue}if(w===b.CASH){const y=h===8||x===8,v=h<8&&h>1||x<8&&x>1;if(y&&v&&!o.has(9))continue}if(Ge(f)&&Ge(a))if(w===b.CASH)Dt(h)&&Dt(x)&&(m=5,N="十字互冲 (5分)");else{const y=f.rank,v=a.rank;(y===E.ZUN||y===E.JI)&&v===E.JIAN?(m=2,N="冲肩 (2分)"):y===E.JIAN&&(v===E.ZUN||v===E.JI)?v===E.ZUN?(m=3,N="肩冲赏 (3分)"):v===E.JI&&(m=2,N="肩冲极 (2分)"):y===E.ZUN&&v===E.JI?(m=3,N="赏冲极 (3分)"):y===E.JI&&v===E.ZUN&&(m=3,N="极冲赏 (3分)")}else if(Ge(f)&&!Ge(a)){const y=ft(x,w);let v=!0;y&&!pt(x,w,o)&&(v=!1),v&&(Me(h,x,w,o)?(m=2,N="完整连续 (2分)"):m=0)}else if(!Ge(f)&&Ge(a))w===b.CASH&&h===8&&o.has(9)&&(m=3,N="九十冲百 (3分)");else if(Me(h,x,w,o)){let y=!0;const v=Math.max(h,x),k=Math.min(h,x);if(ft(h,w)||ft(x,w))if(w===b.CASH){const T=Me(v,8,w,o),P=Me(k,2,w,o);!T&&!P&&(y=!1)}else!pt(v,w,o)&&!pt(k,w,o)&&(y=!1);y&&(m=2,N="顺领 (2分)")}if(w===b.COINS&&(h===9&&x===3||h===3&&x===9)&&!o.has(1)&&!o.has(2)&&(m=0),m>0){const y=m*A;l+=y,u.push(f);let v=N;A>1&&(v+=` [x${A}]`),p.push(v);const k=Math.abs(h-x);k<d&&(d=k)}}if(l===0)return null;let g="DAN_CHONG";if(u.length>=3?g="SHUN_LING":u.length===2&&(g="BROTHER"),g==="DAN_CHONG"){const f=u[0],m=f.id===tt;if(!Ge(f)&&!m)return null}const _=Array.from(new Set(p));return{score:l,matchType:g,description:`${Wa(g)}: ${_.join(", ")}`,validCards:u,priority:d}},Wa=e=>({SHUN_LING:"顺领",BROTHER:"兄弟",DAN_CHONG:"单冲",JIAN_LING:"间领",OTHER:"开冲"})[e]||e,Jt=e=>e.color===O.RED,za=e=>e.color===O.GREEN,Fa=e=>({details:[],score:0}),Ua=e=>{const a=[];let r=0;const n=e.filter(c=>Jt(c)),o=n.length;if(o>=10){const c=20+(o-10)*5;a.push({name:`Ten Red Gathering (${o})`,score:c,cards:n,category:"KC_SE_YANG"}),r+=c}return{details:a,score:r}},Ya=({players:e,bankerId:a,lang:r,kaiChongHistory:s,violationLog:n})=>{const o=[];e.forEach(l=>{const u=l.trickPile.filter(v=>v.round<=8&&!v.isKaiChong).length;let p=0,d=0;l.id!==a?u===0?(p=-1,d=-1):u<2?(p=-.5,d=-1):u===2?(p=0,d=0):u===3?(p=.5,d=1):(p=1,d=1):(p=u>=4?1:-1,d=0);const g=s.filter(v=>v.playerId===l.id),_=new Set(g.map(v=>v.matchedCard.id)),f=l.capturedCards.filter(v=>!_.has(v.id)),{details:m,score:N}=Fa(),{details:A,score:h}=Ua(l.capturedCards);let x=0;g.forEach(v=>x+=v.score);const w=n.filter(v=>v.playerId===l.id),y=[...m,...A];o.push({playerId:l.id,trickCount:u,diaoRawValue:p,diaoPointChange:d,kaiZhuPointChange:0,qiaoMenPointChange:0,seYangPointChange:N,kaiChongPointChange:x+h,totalRoundChange:0,patterns:y.map(v=>v.name),patternDetails:y,kaiChongDetails:g,cardsWonCount:f.length,visibleTrickCards:l.trickPile.filter(v=>v.isFaceUp).map(v=>v.card),scoringCards:f.filter(v=>Jt(v)||za(v)),allCapturedCards:f,violations:w})});const c=o.find(l=>l.playerId===a);if(c){let l=0;o.forEach(u=>{u.playerId!==a&&(l-=u.diaoPointChange)}),c.diaoPointChange=l}return o.forEach(l=>{l.totalRoundChange=l.diaoPointChange}),o.forEach(l=>{const u=l.seYangPointChange+l.kaiChongPointChange+l.kaiZhuPointChange+l.qiaoMenPointChange;if(u>0)if(l.totalRoundChange+=u,l.playerId!==a)c&&(c.totalRoundChange-=u);else{const p=o.filter(g=>g.playerId!==a),d=p.length;if(d>0){const g=Math.floor(u/d),_=u%d;p.forEach((f,m)=>{let N=g;m<_&&(N+=1),f.totalRoundChange-=N})}}}),o.forEach(l=>{if(l.violations.some(u=>u.riskLevel==="PENALTY")){l.totalRoundChange-=60,l.penaltyReason="严重违例 (包赔)";const p=o.filter(g=>g.playerId!==l.playerId),d=p.length;if(d>0){const g=60/d;p.forEach(_=>_.totalRoundChange+=g)}}}),o},Ka=({players:e,potCard:a,lang:r,history:s,currentAttempterId:n,specialCaptures:o})=>{const c=e.find(u=>u.id===n);if(!c)return null;const l=ja(c,a,s,o);return l?{playerId:n,matchedCard:a,sourceCards:l.validCards,score:l.score,matchType:l.matchType,priorityScore:l.priority,description:l.description}:null};var ae=(e=>(e.LOU_ZHUANG="LOU_ZHUANG",e.ZONG_ZHUANG="ZONG_ZHUANG",e.JI_ZHUO="JI_ZHUO",e.LEAD_QIAN_WAN="LEAD_QIAN_WAN",e.ZONG_QU_GAME="ZONG_QU",e.FANG_GONG_QIAN="FANG_GONG_QIAN",e.LOU_ZHUANG_FAIL="LOU_ZHUANG_FAIL",e.DAO_LI="DAO_LI",e.BU_LI_WAN="BU_LI_WAN",e.BU_LI_SHANG="BU_LI_SHANG",e.DAO_LI_QIAN_HONG="DAO_LI_QIAN_HONG",e.TI_JIN_QIAN_WANG="TI_JIN_QIAN_WANG",e.WO_DI_BAI_LAO="WO_DI_BAI_LAO",e.WU_SHANG_BAO_BAI="WU_SHANG_BAO_BAI",e.BU_BAO_BAI="BU_BAO_BAI",e.QIAN_SENG_WO_DI="QIAN_SENG_WO_DI",e.JIN_MEN_CI_XU="JIN_MEN_CI_XU",e.WU_ZHUO_TI_WAN="WU_ZHUO_TI_WAN",e.CHUANG_QIAN="CHUANG_QIAN",e))(ae||{});const ea=e=>e.color===O.GREEN,Pt=(e,a,r,s,n)=>{const o=new Set;if(a.forEach(l=>o.add(l.id)),r.forEach(l=>o.add(l.id)),s.forEach(l=>o.add(l.card.id)),n){const l=n.rank===E.QING,u=n.id===tt;l&&!u&&o.add(n.id)}const c=e.suit===b.CASH||e.suit===b.TEXTS?11:9;for(let l=e.value+1;l<=c;l++)if(!(a.some(p=>p.suit===e.suit&&p.value===l)||r.some(p=>p.suit===e.suit&&p.value===l)||s.some(p=>p.card.suit===e.suit&&p.card.value===l)||n&&n.suit===e.suit&&n.value===l&&n.rank===E.QING&&n.id!==tt))return!1;return!0},qa=e=>e.suit===b.TEXTS?e.value>=7:e.value>=6,Za=(e,a,r)=>e.filter(s=>s.suit===a.suit&&s.value>a.value),Qa=(e,a)=>{if((e.capturedCards?e.capturedCards.length:0)>0)return null;const s=e.hand,n=s.some(u=>u.id===ge),o=s.some(u=>u.id===pe),c=s.some(u=>u.id===xe);if(n&&o&&c&&s.length>1&&a.id===pe)return{riskLevel:K.PENALTY,ruleId:ae.TI_JIN_QIAN_WANG,message:"提尽千王：三公在手，手牌>1时不能发千万！",tacticalContext:ee.ANTI_BANKER};if(n&&o&&!c)return a.id===pe?{riskLevel:K.PENALTY,ruleId:ae.DAO_LI_QIAN_HONG,message:"倒立千红：有万无百，首发千万，以急桌论处！",tacticalContext:ee.ANTI_BANKER}:a.id!==ge?{riskLevel:K.PENALTY,ruleId:ae.BU_LI_WAN,message:"不立万：有万无百，必须首发万万！",tacticalContext:ee.ANTI_BANKER}:null;const l=[b.CASH,b.STRINGS,b.COINS,b.TEXTS];for(const u of l){const p=s.filter(_=>_.suit===u),d=p.find(_=>_.rank===E.ZUN),g=p.find(_=>_.rank===E.JIAN);if(d&&g){const _=a.id===d.id||a.id===g.id,f=p.some(m=>m.id===a.id&&(Math.abs(m.value-d.value)===1||Math.abs(m.value-g.value)===1));if(a.suit!==u)return{riskLevel:K.PENALTY,ruleId:ae.BU_LI_SHANG,message:"不立赏：持有同门赏肩，必须优先打出该门！",tacticalContext:ee.ANTI_BANKER};if(!_&&!f)return{riskLevel:K.PENALTY,ruleId:ae.BU_LI_SHANG,message:"不立赏：必须打出赏、肩或其同花顺！",tacticalContext:ee.ANTI_BANKER}}}return null},Xa=(e,a,r)=>{if(e.isDealer)return null;const s=e.hand;if(!s.some(d=>d.id===xe))return null;const o=r.filter(d=>d.suit!==b.CASH);if(!(o.length>0))return null;const l=r.some(d=>d.isBanker);if(l&&a.suit===b.CASH)return{riskLevel:K.PENALTY,ruleId:ae.WO_DI_BAI_LAO,message:"卧底百老：庄家已首发过，百老不可发十字门！",tacticalContext:ee.ANTI_BAI_LAO};const u=new Set(o.map(d=>d.suit));if(u.size>=2&&a.suit===b.CASH)return{riskLevel:K.PENALTY,ruleId:ae.WO_DI_BAI_LAO,message:"卧底百老：两门熟门已定，百老不可发十字门！",tacticalContext:ee.ANTI_BAI_LAO};const p=s.some(d=>d.rank===E.ZUN);return!p&&a.suit===b.CASH?{riskLevel:K.PENALTY,ruleId:ae.WU_SHANG_BAO_BAI,message:"无赏报百：无赏不可发十字门！",tacticalContext:ee.ANTI_BAI_LAO}:!l&&u.size<2&&p&&a.suit!==b.CASH?{riskLevel:K.PENALTY,ruleId:ae.BU_BAO_BAI,message:"不报百：符合条件必须首发十字门！",tacticalContext:ee.ANTI_BAI_LAO}:null},Va=(e,a,r)=>{if(e.isDealer)return null;const s=e.hand,n=new Set(r.filter(d=>d.suit!==b.CASH).map(d=>d.suit)),o=s.filter(d=>d.suit!==b.CASH&&!n.has(d.suit)),c=s.some(d=>d.id===xe),l=s.some(d=>d.id===ge),u=s.some(d=>d.id===pe),p=r.some(d=>d.suit===b.CASH&&d.isBanker);return l&&u&&!c&&a.id===ge?null:!p&&!l&&!u&&c&&s.some(g=>g.suit===b.CASH&&g.rank===E.QING&&g.value>4)&&a.id!==xe?{riskLevel:K.PENALTY,ruleId:ae.QIAN_SENG_WO_DI,message:"千僧卧底：无千万万万，有百及大青，应先发百万！",tacticalContext:ee.ANTI_BANKER}:o.length>0&&a.suit===b.CASH?{riskLevel:K.PENALTY,ruleId:ae.JIN_MEN_CI_XU,message:"禁门次序：应先发三门（未开门/生门），不可发十字门！",tacticalContext:ee.ANTI_BANKER}:null},Ja=(e,a,r)=>{if(e.isDealer)return null;const s=e.hand,n=s.length,o=s.some(d=>d.id===ge),c=s.some(d=>d.id===pe),l=s.some(d=>d.id===xe);if([ge,pe,xe].includes(a.id)&&n===4)return{riskLevel:K.PENALTY,ruleId:ae.WU_ZHUO_TI_WAN,message:"五桌提万：剩4张牌时不可提万！",tacticalContext:ee.ANTI_BANKER};const p=r.some(d=>d.suit===b.CASH&&d.leaderId===e.id);if(o&&c&&n>1){if(l&&a.id===ge)return{riskLevel:K.PENALTY,ruleId:ae.TI_JIN_QIAN_WANG,message:"提尽千王：三公在手首发万万！",tacticalContext:ee.ANTI_BANKER};if(!l){if(p&&a.id===pe)return{riskLevel:K.PENALTY,ruleId:ae.TI_JIN_QIAN_WANG,message:"提尽千王：曾首发万，今发千，违例！",tacticalContext:ee.ANTI_BANKER};if(!p&&a.id===pe)return{riskLevel:K.PENALTY,ruleId:ae.DAO_LI_QIAN_HONG,message:"倒立千红：未发万先发千！",tacticalContext:ee.ANTI_BANKER}}}if(c&&!l&&n>1){if(!o&&a.id===pe)return{riskLevel:K.PENALTY,ruleId:ae.CHUANG_QIAN,message:"闯千：单千无百，首发千违例！",tacticalContext:ee.ANTI_BANKER};if(o&&a.id===pe&&p)return{riskLevel:K.PENALTY,ruleId:ae.CHUANG_QIAN,message:"闯千：有万无百，再次发千违例！",tacticalContext:ee.ANTI_BANKER}}return null},er=(e,a,r,s,n,o,c,l,u)=>{const p=e.id===o,d=e.hand;if(!p&&n.length>0){const g=d.filter(w=>w.suit===r.suit&&w.value>r.value).sort((w,y)=>y.value-w.value),_=g.length>0,f=r.suit===b.CASH,m=e.capturedCards?e.capturedCards.length:0,N=d.some(w=>w.id===ge||w.id===pe),A=d.filter(w=>w.suit!==b.CASH&&w.rank===E.ZUN).length,h=!f&&m===0&&N&&A<2,x=n.some(w=>w.playerId===o);if(_){const w=a.suit===r.suit&&a.value>r.value;if(x){if(s!==o&&w){if(r.suit===b.CASH&&a.suit===b.CASH){const v=r.value===9||r.value===10,k=a.value===10||a.value===11;if(v&&k)return null}if(!ea(r))return{riskLevel:K.PENALTY,ruleId:ae.JI_ZHUO,message:"急捉：庄家已出牌，同伙赢牌中，不可捉打！",tacticalContext:ee.ANTI_SE_YANG}}}else if(h){const y=Pt(a,d,c,n,u),v=a.id===g[0].id,T=Za(d,r).some(P=>P.id===a.id);return w?null:{riskLevel:K.PENALTY,ruleId:ae.LOU_ZHUANG,message:"漏庄：勤王时刻，你有赢牌却未捉打！",tacticalContext:ee.ANTI_BANKER}}else if(!w){const y=Pt(a,d,c,n,u),v=a.id===g[0].id;if(y||v)return{riskLevel:K.PENALTY,ruleId:ae.LOU_ZHUANG_FAIL,message:"漏庄：持有真张或大牌必须捉打！",tacticalContext:ee.ANTI_BANKER}}}}return null},tr=(e,a,r,s,n)=>ea(r)&&e.hand.some(o=>o.suit===r.suit&&o.value>r.value)&&!(a.suit===r.suit&&a.value>r.value)?{riskLevel:K.PENALTY,ruleId:ae.ZONG_QU_GAME,message:"纵趣：趣张称霸，必须捉打！",tacticalContext:ee.ANTI_SE_YANG}:r.id===pe&&e.hand.some(o=>o.id===ge)&&a.id!==ge?{riskLevel:K.PENALTY,ruleId:ae.FANG_GONG_QIAN,message:"放功千：必须用万万捉千万！",tacticalContext:ee.ANTI_BANKER}:null,ta=(e,a,r,s,n,o,c=[],l=null,u=1,p=null,d=null)=>{if(r.length===0){const x=Qa(e,a);if(x)return x;const w=Xa(e,a,c);if(w)return w;const y=Va(e,a,c);if(y)return y;const v=Ja(e,a,c);return v||(a.id===pe&&e.hand.length===8&&!e.isDealer?{riskLevel:K.PENALTY,ruleId:ae.LEAD_QIAN_WAN,message:"首发千万是禁手。",tacticalContext:ee.ANTI_BANKER}:null)}const g=r[0].card.suit;let _=r[0].card,f=r[0].playerId,m=_.value;r.forEach(x=>{x.card.suit===g&&x.card.value>m&&(m=x.card.value,_=x.card,f=x.playerId)});const N=tr(e,a,_);if(N)return N;const A=er(e,a,_,f,r,s,o,l,p);return A||(e.hand.some(x=>x.suit===_.suit&&x.value>_.value)&&f===s&&!e.isDealer&&!(a.suit===_.suit&&a.value>_.value)&&(qa(_)||r.length===3)?{riskLevel:K.PENALTY,ruleId:ae.ZONG_ZHUANG,message:"纵庄：庄家大牌必须捉！",tacticalContext:ee.ANTI_BANKER}:{riskLevel:K.SAFE,ruleId:"SAFE",message:"安全",tacticalContext:ee.ANTI_BANKER})},ar=(e,a,r,s,n,o,c,l)=>{if(a.suit===b.CASH){if(c.has(ge)&&c.has(pe)&&c.has(xe))return"SAFE";const m=e.hand.some(N=>N.id===xe);return e.isDealer?m?"SAFE":"FORBIDDEN":m&&l&&l.id!==ge?"SAFE":"FORBIDDEN"}const u=s.filter(f=>f.suit!==b.CASH),p=new Set;u.forEach(f=>{f.isBanker||p.add(f.suit)});let d=null,g=!1;const _=u.find(f=>f.isBanker);if(_)for(const f of u){if(f.suit===_.suit&&f.isBanker){d=f.suit,g=!0;break}f.isBanker}if(!g){const f=Array.from(p);if(f.length>=2){const m=[b.STRINGS,b.COINS,b.TEXTS],N=new Set([f[0],f[1]]),A=m.find(h=>!N.has(h));A&&(d=A)}}return d&&a.suit===d?"FORBIDDEN":"SAFE"},rr=(e,a,r,s,n,o)=>e.hand,nr={playerId:-1,gamesPlayed:0,winRate:0,aggression:.5,riskTolerance:.3,bluffFrequency:.1,lastRole:"PEASANT",lastResult:"DRAW"},sr="ma_diao_ai_memory_v2_zh",Bt=()=>{try{const e=localStorage.getItem(sr);if(e)return JSON.parse(e)}catch(e){console.warn("读取AI记忆失败",e)}return{}},Nt=(e,a)=>a.aiLearningStates&&a.aiLearningStates[e]?a.aiLearningStates[e]:{...nr,playerId:e},ir=(e,a,r,s)=>{const n={...e};n.gamesPlayed+=1,n.lastRole=r?"BANKER":"PEASANT";const o=a.totalRoundChange>0;n.lastResult=o?"WIN":a.totalRoundChange<0?"LOSS":"DRAW";const c=n.winRate*(n.gamesPlayed-1);if(n.winRate=(c+(o?1:0))/n.gamesPlayed,a.violations&&a.violations.length>0){n.riskTolerance=Math.max(.05,n.riskTolerance-.25);const u=a.violations.some(d=>d.ruleId.includes("JI_ZHUO")||d.ruleId==="JIN_MEN_CI_XU"||d.ruleId==="CHUANG_QIAN"),p=a.violations.some(d=>d.ruleId==="LOU_ZHUANG"||d.ruleId==="ZONG_ZHUANG"||d.ruleId==="ZONG_QU");return u&&(n.aggression=Math.max(.1,n.aggression-.2)),p&&(n.bluffFrequency=Math.max(0,n.bluffFrequency-.1)),n}const l=.05;return o?(n.aggression>.5?n.aggression=Math.min(1,n.aggression+l):n.aggression=Math.max(0,n.aggression-l),n.riskTolerance>.4&&(n.riskTolerance=Math.min(.9,n.riskTolerance+l))):(n.aggression>.6?n.aggression-=l*2:n.aggression<.4&&(n.aggression+=l*2),n.riskTolerance=Math.max(.1,n.riskTolerance-l)),s===Ke.HARD?(n.riskTolerance=Math.max(.2,n.riskTolerance),n.aggression=Math.max(.3,n.aggression)):s===Ke.EASY&&(n.riskTolerance=Math.min(.8,Math.max(.5,n.riskTolerance))),n};let X=null;const rt="ma_diao_supabase_url",nt="ma_diao_supabase_key",Ht="avatars",kt="match_logs",lt="profiles",aa="friendships",Ct="ma_diao_mock_user",Ue="ma_diao_mock_profile",st="ma_diao_mock_friends",we=(e,a)=>Array.from({length:a-e+1},(r,s)=>e+s),or={EAST_ASIA:{regionName:"East Asia",countries:["cn","jp","kr","hk","tw","sg","vn"],names:["Wei","Jie","Ming","Hao","Yi","Long","Chen","Ken","Ryu","Hiro","Satoshi","Takumi","Min-Ho","Ji-Sung","Soo","Jin"],titles:["The Scholar","Master","Sifu","Ronin","Poet","Hand","Fox","Dragon"],maleIds:[...we(0,10),...we(60,65)],femaleIds:[...we(0,10),...we(60,65)]},WESTERN:{regionName:"Western",countries:["us","gb","fr","de","it","ru","au","ca"],names:["John","Arthur","William","James","Leo","Oliver","Harry","Alice","Rose","Clara","Emma","Sofia","Charlotte"],titles:["The Duke","Knight","Ace","Gambler","Baron","Duchess","Queen"],maleIds:[...we(11,40)],femaleIds:[...we(11,40)]},GLOBAL_SOUTH:{regionName:"Global South",countries:["br","mx","in","za","ng","eg","th","ph","sa"],names:["Mateo","Diego","Ravi","Arjun","Malik","Omar","Amir","Luna","Camila","Priya","Zara","Nia","Fatima"],titles:["Traveler","Merchant","Guide","Mystic","Wanderer","Sheikh","Raja"],maleIds:[...we(41,59),...we(66,78)],femaleIds:[...we(41,59),...we(66,78)]}},St=e=>{let a=e;if(!a){const m=Math.random();m<.5?a="EAST_ASIA":m<.8?a="WESTERN":a="GLOBAL_SOUTH"}const r=or[a],s=Math.random()>.5,n=s?"FEMALE":"MALE",o=r.names[Math.floor(Math.random()*r.names.length)],c=r.titles[Math.floor(Math.random()*r.titles.length)],l=r.countries[Math.floor(Math.random()*r.countries.length)],u=s?r.femaleIds:r.maleIds,p=u.length>0?u[Math.floor(Math.random()*u.length)]:Math.floor(Math.random()*50),g=`https://xsgames.co/randomusers/assets/avatars/${s?"female":"male"}/${p}.jpg`,_=Math.random();let f="CENTER";return _<.35?f="LEFT":_<.7&&(f="RIGHT"),{id:`ai_${Date.now()}_${Math.random().toString(36).substring(7)}`,username:`${o} ${c}`,gender:n,age:18+Math.floor(Math.random()*45),country:l,gazeDirection:f,is_looking_for_match:!0,last_active:Date.now(),friends:[],avatar_url:g,location:{lat:30+Math.random()*10,lng:110+Math.random()*20}}},ra=Array.from({length:20}).map(()=>St()),it=(e,a)=>{let r=e||localStorage.getItem(rt),s=a||localStorage.getItem(nt);if(r&&s)try{const n=window.supabase;if(n&&n.createClient)return X=n.createClient(r,s),e&&localStorage.setItem(rt,e),a&&localStorage.setItem(nt,a),console.log("Cloud Service (MemFire/Supabase) initialized."),!0}catch(n){console.error("Failed to init Cloud",n)}return!1},It=()=>({url:localStorage.getItem(rt)||"",key:localStorage.getItem(nt)||""}),lr=()=>{localStorage.removeItem(rt),localStorage.removeItem(nt),X=null},Xe=async()=>{if(X){const{data:{user:a}}=await X.auth.getUser();if(a)return a}const e=localStorage.getItem(Ct);return e?JSON.parse(e):null},cr=async e=>{if(!X)return{error:"CLOUD_NOT_CONFIGURED"};try{const{data:a,error:r}=await X.auth.signInWithOAuth({provider:e,options:{redirectTo:window.location.origin}});return{data:a,error:r}}catch(a){return{error:a}}},dr=async e=>{const a={id:`guest_${Date.now()}_${Math.floor(Math.random()*1e3)}`,email:`${e}_guest@jianghu.com`,app_metadata:{provider:e},user_metadata:{},aud:"authenticated",created_at:new Date().toISOString()};localStorage.setItem(Ct,JSON.stringify(a));const r=St("EAST_ASIA"),n={...{...r,username:`Guest ${r.username.split(" ")[0]}`},id:a.id,is_looking_for_match:!0,last_active:Date.now(),updated_at:new Date,friends:[]};return localStorage.setItem(Ue,JSON.stringify(n)),{user:a,error:null}},ur=async()=>{X&&await X.auth.signOut(),localStorage.removeItem(Ct)},ct=e=>e.startsWith("guest_"),hr=async e=>{const a=await Xe();if(!a)return null;const r={id:a.id,username:e.username||a.email?.split("@")[0]||"Wanderer",avatar_url:e.avatar_url,gender:e.gender,age:e.age,country:e.country||"cn",location:e.location,is_looking_for_match:e.is_looking_for_match,last_active:Date.now(),updated_at:new Date,friends:[]};if(ct(a.id)){const n={...JSON.parse(localStorage.getItem(Ue)||"{}"),...r,...e};return localStorage.setItem(Ue,JSON.stringify(n)),n}else if(X){const{friends:s,...n}=r,{error:o}=await X.from(lt).upsert(n);return o&&localStorage.setItem(Ue,JSON.stringify(r)),r}return null},$t=async e=>{let a=e;if(!a){const s=await Xe();if(!s)return null;a=s.id}if(!a)return null;if(ct(a)){const s=localStorage.getItem(Ue);if(s){const n=JSON.parse(s),o=JSON.parse(localStorage.getItem(st)||"[]");return{...n,friends:o}}return null}if(X){const{data:s,error:n}=await X.from(lt).select("*").eq("id",a).single();if(!n&&s)return s}const r=localStorage.getItem(Ue);return r?JSON.parse(r):null},fr=async e=>{if(X)try{const a=e.name.split(".").pop(),s=`user_avatar/${`${Date.now()}.${a}`}`,{error:n}=await X.storage.from(Ht).upload(s,e);if(!n){const{data:o}=X.storage.from(Ht).getPublicUrl(s);return o.publicUrl}}catch{console.warn("Cloud upload failed, using local URL")}return URL.createObjectURL(e)},jt=async e=>{let a=[];if(X){const n=Date.now()-3e5,{data:o}=await X.from(lt).select("*").neq("id",e.id).eq("is_looking_for_match",!0).gt("last_active",n).limit(20);o&&(a=o)}const r=Array.from({length:5}).map(()=>St(Math.random()>.3?"EAST_ASIA":void 0));return a=[...a,...r],a.map(n=>{let o=0;return e.gender!=="OTHER"&&n.gender!=="OTHER"&&e.gender!==n.gender&&(o+=50),Math.abs(e.age-n.age)<=5&&(o+=20),{profile:n,score:o}}).sort((n,o)=>o.score-n.score).map(n=>n.profile)},pr=async e=>{const a=await Xe();if(!a)return!1;if(ct(a.id)){const r=JSON.parse(localStorage.getItem(st)||"[]");return r.includes(e)||(r.push(e),localStorage.setItem(st,JSON.stringify(r))),!0}if(X){const{error:r}=await X.from(aa).insert([{user_id_1:a.id,user_id_2:e,status:"accepted"}]);return!r}return!1},na=async()=>{const e=await Xe();if(!e)return[];if(ct(e.id)){const a=JSON.parse(localStorage.getItem(st)||"[]");return ra.slice(0,a.length)}if(X){const{data:a}=await X.from(aa).select("*").or(`user_id_1.eq.${e.id},user_id_2.eq.${e.id}`);if(a){const r=a.map(n=>n.user_id_1===e.id?n.user_id_2:n.user_id_1),{data:s}=await X.from(lt).select("*").in("id",r);return s||[]}}return[]},mr=async e=>{X&&e.matchLogs.length>0&&X.from(kt).upsert({id:e.matchLogs[0].id,timestamp:e.matchLogs[0].timestamp,data:e.matchLogs[0]}).then()},gr=async()=>{if(!X)return[];const{data:e}=await X.from(kt).select("*").order("timestamp",{ascending:!1}).limit(50);return e||[]},br=async e=>{if(!X)return!1;const{error:a}=await X.from(kt).delete().eq("id",e);return!a},sa="ma_diao_stats_v1";try{const e=It();e.url&&e.key&&it(e.url,e.key)}catch(e){console.warn("Failed to auto-init cloud service:",e)}const _r=()=>{const e={totalRounds:0,bankerWins:0,peasantWins:0,lastRoundWinnerType:"DRAW",aggressionModifier:0,aiLearningStates:Bt(),matchLogs:[]};try{const a=localStorage.getItem(sa);if(a){const r=JSON.parse(a);return{...e,...r,matchLogs:r.matchLogs||[],aiLearningStates:Bt()}}}catch(a){console.error("Failed to load stats",a)}return e},xr=e=>{try{const{aiLearningStates:a,...r}=e;localStorage.setItem(sa,JSON.stringify(r)),mr(e)}catch(a){console.error("Failed to save stats",a)}};function ia(e){const a=[...e];for(let r=a.length-1;r>0;r--){const s=Math.floor(Math.random()*(r+1));[a[r],a[s]]=[a[s],a[r]]}return a}const Je=e=>{const a=r=>{switch(r){case b.CASH:return 4;case b.STRINGS:return 3;case b.COINS:return 2;case b.TEXTS:return 1;default:return 0}};return[...e].sort((r,s)=>{const n=a(r.suit),o=a(s.suit);return n!==o?o-n:s.value-r.value})},vr=()=>{const e=Ha();return ia(e)},wr=e=>{const[a,r]=C([]),[s,n]=C([]),[o,c]=C([]),[l,u]=C([]),[p,d]=C(0),[g,_]=C(ie.DEALING),[f,m]=C(3),[N,A]=C([]),[h,x]=C(1),[w,y]=C(""),[v,k]=C([]),[T,P]=C(new Set),[S,L]=C([]),[I,B]=C([]),[ce,be]=C(null),[le,G]=C(null),[R,re]=C(()=>_r()),[Te,ve]=C({wanCaughtQian:!1,wanCaughtBai:!1,qianCaughtBai:!1}),[Et,Ee]=C(null),[Le,Be]=C(0),[D,q]=C([]),[H,de]=C(null),[he,ne]=C(null),[He,Re]=C(null),[$e,Oe]=C(null),[je,We]=C(null),Se=(U,Z,F)=>{We({type:U,playerId:Z,context:F,timestamp:Date.now()})},Lt=()=>{u([]),c([]),de(null),A([]),x(1),k([]),P(new Set),B([]),L([]),y(""),q([]),Be(0),ve({wanCaughtQian:!1,wanCaughtBai:!1,qianCaughtBai:!1}),ne(null),Re(null),Oe(null),be(null),G(null)},Rt=(U,Z)=>{_(ie.SHUFFLING),Lt(),setTimeout(()=>{const F=vr();r(F);const Q=[Je(F.slice(0,8)),Je(F.slice(8,16)),Je(F.slice(16,24)),Je(F.slice(24,32))],W=F.slice(32,39).map(V=>({...V,isPot:!0})),z={...F[39],isPot:!0};let Y=[],M=0;if(Z&&Z.length===4)M=(Z.findIndex(V=>V.isDealer)+1)%4,Y=Z.map((V,ue)=>({...V,hand:Q[ue],trickPile:[],capturedCards:[],isDealer:V.id===M,isBaiLaoRevealed:!1,isSuspectedBaiLao:!1}));else{const V=ia([...ra]),ue=Fe=>{const Mt=V.findIndex(ut=>ut.gazeDirection===Fe);if(Mt!==-1){const[ut]=V.splice(Mt,1);return ut}return null},dt=ue("LEFT")||ue("CENTER")||V.pop(),qe=ue("RIGHT")||ue("CENTER")||V.pop(),J=ue("CENTER")||V.pop(),te=Fe=>({id:`bot_${Math.random().toString(36).substring(7)}`,username:Fe,gender:"OTHER",age:30,country:"cn",is_looking_for_match:!1,last_active:Date.now(),friends:[],gazeDirection:"CENTER"}),ze=dt||te("Bot 1"),Ie=J||te("Bot 2"),Ve=qe||te("Bot 3");Y=[{id:0,name:U?.username||"You",type:fe.HUMAN,hand:Q[0],trickPile:[],capturedCards:[],isDealer:!1,position:"Bottom",score:0,profile:U},{id:1,name:ze.username,type:fe.AI,hand:Q[1],trickPile:[],capturedCards:[],isDealer:!1,position:"Right",score:0,profile:ze},{id:2,name:Ie.username,type:fe.AI,hand:Q[2],trickPile:[],capturedCards:[],isDealer:!1,position:"Top",score:0,profile:Ie},{id:3,name:Ve.username,type:fe.AI,hand:Q[3],trickPile:[],capturedCards:[],isDealer:!1,position:"Left",score:0,profile:Ve}],M=Math.floor(Math.random()*4),Y.forEach(Fe=>Fe.isDealer=Fe.id===M)}n(Y),c(W),de(z),m(M);const se=(z.value-1)%4,$=(M+se)%4;d($),_(ie.PLAYING),y($===0?"You Lead First":`Player ${$} Leads`),setTimeout(()=>y(""),3e3),Se("GAME_START",$)},2e3)},_a=()=>{Rt(void 0,s)},xa=()=>{_(ie.DEALING),n([]),Lt()},Ot=U=>{d(U)},Gt=(U,Z)=>{if(!U||U.length===0)return;const F=U[0].card.suit;let Q=U[0].playerId,W=-1,z=null;if(U.forEach(M=>{!M.isFaceDown&&M.card.suit===F&&M.card.value>W&&(W=M.card.value,Q=M.playerId,z=M.card)}),z||(Q=U[0].playerId,z=U[0].card),Ee(Q),z.suit===b.CASH){const M=z.value,se=U.some(V=>V.card.id===pe),$=U.some(V=>V.card.id===xe);ve(V=>{const ue={...V};return M===11?(se&&(ue.wanCaughtQian=!0),$&&(ue.wanCaughtBai=!0)):M===10&&$&&(ue.qianCaughtBai=!0),ue})}const Y=z.rank===E.ZUN||z.rank===E.BAI;Se("TRICK_WIN",Q,{isBig:Y}),setTimeout(()=>{Ee(null),u([]);const M=Z.map(se=>{let $=[...se.trickPile],V=[...se.capturedCards];return se.id===Q&&z&&($.push({card:z,isFaceUp:!0,round:h}),V.push(z)),{...se,trickPile:$,capturedCards:V}});n(M),h===8?(_(ie.KAI_CHONG),y("Kai Chong Phase"),Be(0),d(Q)):(x(h+1),Ot(Q))},1500)},va=async(U,Z,F=!1)=>{const Q=s.find(J=>J.id===U);if(!Q)return;const W=Q.hand.find(J=>J.id===Z);if(!W)return;const z=l.map(J=>({card:J.card,playerId:J.playerId}));if(U===0&&e.isRiskAlertOn&&!F){const J=ta(Q,W,z,f,s,v,I,ce,h,H,le);if(J&&J.riskLevel!==K.SAFE){Re({cardId:Z,assessment:J});return}}Re(null);const Y=l.length>0?l[0].card.suit:null;let M=!1;if(Y)if(W.suit!==Y)M=!0;else{let J=-1;l.forEach(te=>{!te.isFaceDown&&te.card.suit===Y&&te.card.value>J&&(J=te.card.value)}),W.value<=J&&(M=!0)}h===8&&(!Q.capturedCards||Q.capturedCards.length===0)&&(M=!0),M||P(J=>{const te=new Set(J);return te.add(W.id),te});const se=W.id===xe,$=W.id===ge,V=l.length===0&&W.suit===b.CASH,ue=se&&!M,dt=s.some(J=>J.isBaiLaoRevealed);n(J=>J.map(te=>{if(te.id===U){const ze=te.hand.filter(Ve=>Ve.id!==Z);let Ie={...te,hand:ze};return ue?(Ie.isBaiLaoRevealed=!0,Ie.isSuspectedBaiLao=!1):dt||V&&!$&&!M&&(Ie.isSuspectedBaiLao||(Ie.isSuspectedBaiLao=!0)),Ie}return te}));const qe=[...l,{playerId:U,card:W,isFaceDown:M}];if(u(qe),k(J=>[...J,W]),l.length===0&&(be({card:W,playerId:U}),U===f&&!le&&G(W),I.some(te=>te.suit===W.suit)||B(te=>[...te,{suit:W.suit,leaderId:U,isBanker:U===f}])),ne(null),qe.length===4){const J=s.map(te=>te.id===U?{...te,hand:te.hand.filter(ze=>ze.id!==Z)}:te);setTimeout(()=>Gt(qe,J),1e3)}else Ot((p+1)%4)};return me(()=>{h===8&&g===ie.PLAYING&&l.length===0&&(async()=>{y("Bi Zhang");let Z=[],F=[...s];const Q=[0,1,2,3].map(W=>(p+W)%4);for(const W of Q){const z=F.find($=>$.id===W);if(z.hand.length===0)continue;const Y=z.hand[0];let M=!1;if(!z.capturedCards||z.capturedCards.length===0)M=!0;else if(Z.length>0){const $=Z[0].card.suit;if(Y.suit!==$)M=!0;else{let V=-1;Z.forEach(ue=>{!ue.isFaceDown&&ue.card.suit===$&&ue.card.value>V&&(V=ue.card.value)}),Y.value<=V&&(M=!0)}}const se={playerId:W,card:Y,isFaceDown:M};M||P($=>new Set($).add(Y.id)),Z.push(se),F=F.map($=>$.id===W?{...$,hand:[]}:$),n(F),u([...Z]),await new Promise($=>setTimeout($,800))}Gt(Z,F)})()},[h,g]),me(()=>{let U;return g===ie.KAI_CHONG&&(Le<7?U=setTimeout(()=>{const Z=o[Le];if(!Z){Be(z=>z+1);return}const F=[];s.forEach(z=>{const Y=Ka({players:s,potCard:Z,lang:e.language,history:D,currentAttempterId:z.id,specialCaptures:Te});Y&&F.push(Y)});const Q=p;F.sort((z,Y)=>{if(z.priorityScore!==Y.priorityScore)return z.priorityScore-Y.priorityScore;const M=(z.playerId-Q+4)%4,se=(Y.playerId-Q+4)%4;return M-se});const W=F[0];W?(q(z=>[...z,W]),Se("KAI_CHONG_SUCCESS",W.playerId),d(W.playerId),n(z=>z.map(Y=>{if(Y.id===W.playerId){const M=W.sourceCards.filter($=>$.suit===W.matchedCard.suit&&$.value===W.matchedCard.value).map($=>$.id),se=Y.trickPile.map($=>M.includes($.card.id)?{...$,hidden:!0}:$);return se.push({card:W.matchedCard,isFaceUp:!0,round:9,isKaiChong:!0}),{...Y,trickPile:se,capturedCards:[...Y.capturedCards,W.matchedCard]}}return Y}))):(Se("KAI_CHONG_FAIL",Q),d((Q+1)%4)),Be(z=>z+1)},1200):U=setTimeout(()=>{const Z=Ya({players:s,bankerId:f,lang:e.language,kaiChongHistory:D,violationLog:S}),F={...R};F.totalRounds=(F.totalRounds||0)+1;const Q=Z.find(M=>M.playerId===f)?.totalRoundChange||0;Q>0?(F.bankerWins++,F.lastRoundWinnerType="BANKER"):Q<0?(F.peasantWins++,F.lastRoundWinnerType="PEASANT"):F.lastRoundWinnerType="DRAW";const W=s.map(M=>{const se=Z.find($=>$.playerId===M.id);return{...M,score:M.score+(se?.totalRoundChange||0)}});n(W);const z=Z.find(M=>M.playerId===0);z&&z.violations.length>0&&Se("VIOLATION"),Se("ROUND_END");const Y={...F.aiLearningStates||{}};W.forEach(M=>{if(M.type===fe.AI){const se=Z.find($=>$.playerId===M.id);if(se){const $=Nt(M.id,R);Y[M.id]=ir($,se,M.id===f,e.difficulty)}}}),F.aiLearningStates=Y,xr(F),re(F),A(Z),u([]),c([]),de(null),Ee(null),_(ie.SCORING)},1500)),()=>clearTimeout(U)},[g,Le]),{state:{players:s,deck:a,pot:o,tableCards:l,currentPlayerIndex:p,phase:g,bankerId:f,roundResults:N,trickNumber:h,gameMessage:w,recordedCards:v,faceUpPlayedCardIds:T,violationLog:S,openedSuits:I,firstLeadInfo:ce,gameHistory:R,trickWinnerId:Et,kaiChongCardIndex:Le,kaiChongHistory:D,mianZhangCard:H,selectedCardId:he,pendingRisk:He,violationNotification:$e,lastGameEvent:je,bankerFirstLeadCard:le},actions:{startGame:Rt,startNextRound:_a,exitToTitle:xa,executePlayCard:va,setSelectedCardId:ne,setPendingRisk:Re,setViolationNotification:Oe}}};var Wt={};let De=null,Pe=!1;try{const e=typeof process<"u"&&process&&Wt?Wt.API_KEY:"";e&&e.length>0?De=new ka({apiKey:e}):(console.warn("AI Key not found in process.env.API_KEY. AI features disabled."),Pe=!0)}catch(e){console.warn("GoogleGenAI init failed (likely missing key or network issue):",e),Pe=!0}const zt=()=>!!De&&!Pe;let et=null;const oa=async()=>{if(!De||Pe)return"AI 功能暂时不可用 (API Key Missing)。";try{return et=De.chats.create({model:"gemini-2.5-flash",config:{systemInstruction:Ba}}),"欢迎，年轻的学徒。我是马吊大师。关于规则、策略或惩罚，尽管问我。"}catch(e){return console.error("聊天初始化错误",e),"大师正在冥想中（连接错误）。"}},yr=async e=>{if(et||await oa(),!et)return"大师保持沉默。";try{return(await et.sendMessage({message:e})).text||"无言以对。"}catch(a){return console.error("发送消息错误",a),a.message?.includes("429")||a.status===429||a.code===429?(Pe=!0,"思维疲惫（频率限制）。请稍后再试。"):"网络波动，请重试。"}},Nr=async(e,a="Puck")=>{if(!De||Pe)return null;try{const s=(await De.models.generateContent({model:"gemini-2.5-flash-preview-tts",contents:{parts:[{text:e}]},config:{responseModalities:[Ca.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:a}}}}})).candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;if(s){const n=atob(s),o=n.length,c=new Uint8Array(o);for(let l=0;l<o;l++)c[l]=n.charCodeAt(l);return c}}catch(r){console.error("TTS Generation Error",r)}return null},kr=async(e,a,r,s,n,o=Ke.MEDIUM,c,l=[],u=null,p=1,d=null)=>{if(Pe||!De)return e.hand.length>0?e.hand[0]:null;if(e.hand.length===0)return null;const g=8-e.hand.length,_=()=>{const f=[...e.hand],m=c?Nt(e.id,c):{aggression:.5,riskTolerance:.3,playerId:e.id},N=f.map(S=>{const L=ta({...e,type:fe.HUMAN},S,a,n,r,s,l,u,g,d);return{card:S,risk:L}});let A=N.filter(S=>!S.risk||S.risk.riskLevel!==K.PENALTY);if(A.length===0&&(A=N),o!==Ke.EASY&&m.riskTolerance<.5){const S=A.filter(L=>!L.risk||L.risk.riskLevel!==K.WARNING);S.length>0&&(A=S)}if(m.aggression<.4){const S=A.filter(L=>!L.risk||L.risk.riskLevel===K.SAFE);S.length>0&&(A=S)}const h=A.map(S=>S.card),x=e.hand.some(S=>S.id==="c_9"),w=S=>[...S].sort((L,I)=>L.value-I.value),y=S=>[...S].sort((L,I)=>I.value-L.value);if(a.length===0)return m.aggression>.6||e.id===n||x?y(h)[0]:w(h)[0];const v=a[0].card.suit,k=h.filter(S=>S.suit===v);if(k.length>0){let S=-1;a.forEach(I=>{I.card.suit===v&&I.card.value>S&&(S=I.card.value)});const L=k.filter(I=>I.value>S);return L.length>0?m.aggression>.8?y(L)[0]:w(L)[0]:w(k)[0]}return(S=>S.sort((L,I)=>{if(L.id==="c_9")return 1;if(I.id==="c_9")return-1;const B=L.color==="red",ce=I.color==="red";if(m.aggression>.5){if(B&&!ce)return 1;if(!B&&ce)return-1}return L.value-I.value}))(h)[0]};try{return _()}catch(f){return console.error("AI Decision Error",f),e.hand[0]}},Ft={zh_CN:{GAME_START:["夫马吊者，兵法也。四十张牌，变化无穷，诸君慎之。","冯梦龙先生有云：‘知己知彼，百战不殆’。今日且看谁是英雄。","明季士大夫皆好此道，吾辈今日重聚，定要以此会友。","这四十张纸牌，暗合梁山一百单八将之数，各位切莫轻视。","局以变生，制由机发。请诸位落座，共演此纵横之术。"],TRICK_WIN:["此乃顺手牵羊之计。","笑纳了。正所谓：取之有道。","这一墩，恰如探囊取物。","兵贵神速，此牌出得正是时候。","吾观此局，运势在我也。"],TRICK_WIN_BIG:["一夫当关，万夫莫开！","百万军中取上将首级，如探囊取物！","至尊在此，谁敢造次？","此乃定海神针，这分吾拿定了。","痛快！此局气势如虹，势不可挡！"],TRICK_LOSS:["大意了，竟被汝钻了空子。","此乃诱敌深入之计，汝莫要高兴太早。","好一招借刀杀人，佩服。","胜败兵家常事，暂且让你一回。","这牌路诡谲，颇有古风，吾竟未看破。"],PENALTY:["哎呀！老夫竟犯了如此低级之错，愧对先贤！","这...这是‘包赔’？吾一世英名，毁于一旦！","一时眼花，误打误撞，罪过罪过。","此乃天亡我也，非战之罪。","惨矣！触犯天条，自食苦果。"],ROUND_WIN:["运筹帷幄之中，决胜千里之外。","今日手气，颇有当年冯梦龙之风。","承让承让。此局赢得惊险，全赖各位成全。","牌风顺遂，如鱼得水。再来一局？","吾之牌技，虽不及古人，亦足以在此桌称雄矣。"],ROUND_LOSS:["时运不济，命途多舛...","卷土重来未可知，下局定要翻盘。","汝等牌技精进神速，老夫佩服。","这一局输得蹊跷，待老夫复盘一番。","胜负乃浮云，唯博弈之乐长存。"],KAI_CHONG_SUCCESS:["天作之合！此乃天意！","踏破铁鞋无觅处，得来全不费工夫。","妙哉！这底牌正如吾意。","神来之笔，冲得漂亮！","这便是缘分，挡都挡不住。"],KAI_CHONG_FAIL:["缘分未到，强求不得。","镜中花，水中月，空欢喜一场。","底牌无情，奈何奈何。","时机未到，且看下回分解。","罢了，得之我幸，失之我命。"],PLAY_HIGH_CARD:["泰山压顶！谁能挡我？","此牌一出，乾坤定矣。","重剑无锋，大巧不工。","看这张‘尊’张，可有气势？"],WAITING:["思考良久，莫非在推演天机？","兵贵神速，犹豫则败北。","莫让光阴虚度，速速出牌。","阁下可是在研读《马吊牌经》？快哉快哉。"],TEACH_VIOLATION:["孺子不可教也！《牌经》有云：首发千万乃是大忌！你怎敢造次？","荒唐！非‘百老’而首发十字门，你这是自寻死路，还要连累旁人！","若是当年在苏州茶馆，你这般打法，是要被赶下桌的！","同门‘肩’未出，怎可妄动‘尊’张？新手切记：三防为上！","你这打法，毫无章法！这就是‘包赔’的下场，好好记着！","不懂规矩！趣张在手，岂可灭绝青牌？回去再读读规则吧！"]},zh_TW:{GAME_START:["夫馬吊者，兵法也。四十張牌，變化無窮，諸君慎之。","馮夢龍先生有云：『知己知彼，百戰不殆』。今日且看誰是英雄。","明季士大夫皆好此道，吾輩今日重聚，定要以此會友。","這四十張紙牌，暗合梁山一百單八將之數，各位切莫輕視。","局以變生，制由機發。請諸位落座，共演此縱橫之術。"],TRICK_WIN:["此乃順手牽羊之計。","笑納了。正所謂：取之有道。","這一墩，恰如探囊取物。","兵貴神速，此牌出得正是時候。","吾觀此局，運勢在我也。"],TRICK_WIN_BIG:["一夫當關，萬夫莫開！","百萬軍中取上將首級，如探囊取物！","至尊在此，誰敢造次？","此乃定海神針，這分吾拿定了。","痛快！此局氣勢如虹，勢不可擋！"],TRICK_LOSS:["大意了，竟被汝鑽了空子。","此乃誘敵深入之計，汝莫要高興太早。","好一招借刀殺人，佩服。","勝敗兵家常事，暫且讓你一回。","這牌路詭譎，頗有古風，吾竟未看破。"],PENALTY:["哎呀！老夫竟犯了如此低級之錯，愧對先賢！","這...這是『包賠』？吾一世英名，毀於一旦！","一時眼花，誤打誤撞，罪過罪過。","此乃天亡我也，非戰之罪。","慘矣！觸犯天條，自食苦果。"],ROUND_WIN:["運籌帷幄之中，決勝千里之外。","今日手氣，頗有當年馮夢龍之風。","承讓承讓。此局贏得驚險，全賴各位成全。","牌風順遂，如魚得水。再來一局？","吾之牌技，雖不及古人，亦足以在此桌稱雄矣。"],ROUND_LOSS:["時運不濟，命途多舛...","捲土重來未可知，下局定要翻盤。","汝等牌技精進神速，老夫佩服。","這一局輸得蹊蹺，待老夫復盤一番。","勝負乃浮雲，唯博弈之樂長存。"],KAI_CHONG_SUCCESS:["天作之合！此乃天意！","踏破鐵鞋無覓處，得來全不費工夫。","妙哉！這底牌正如吾意。","神來之筆，衝得漂亮！","這便是緣分，擋都擋不住。"],KAI_CHONG_FAIL:["緣分未到，強求不得。","鏡中花，水中月，空歡喜一場。","底牌無情，奈何奈何。","時機未到，且看下回分解。","罷了，得之我幸，失之我命。"],PLAY_HIGH_CARD:["泰山壓頂！誰能擋我？","此牌一出，乾坤定矣。","重劍無鋒，大巧不工。","看這張『尊』張，可有氣勢？"],WAITING:["思考良久，莫非在推演天機？","兵貴神速，猶豫則敗北。","莫讓光陰虛度，速速出牌。","閣下可是在研讀《馬吊牌經》？快哉快哉。"],TEACH_VIOLATION:["孺子不可教也！《牌經》有云：首發千萬乃是大忌！你怎敢造次？","荒唐！非『百老』而首發十字門，你這是自尋死路，還要連累旁人！","若是當年在蘇州茶館，你這般打法，是要被趕下桌的！","同門『肩』未出，怎可妄動『尊』張？新手切記：三防為上！","你這打法，毫無章法！這就是『包賠』的下場，好好記著！","不懂規矩！趣張在手，豈可滅絕青牌？回去再讀讀規則吧！"]},en:{GAME_START:["Ma Diao is akin to military strategy. Forty cards, infinite changes. Proceed with caution.","As the ancient masters said: Know yourself and your enemy. Let us duel.","In the Ming Dynasty, scholars adored this game. Let us honor their tradition."],TRICK_WIN:["A strategic acquisition.","I accept this tribute gratefully.","Just as the manuals predicted.","Swift as the wind, I take this trick."],TRICK_WIN_BIG:["One man guards the pass, ten thousand cannot break through!","The Supreme Card is here!","Who dares to challenge my authority?","Absolute dominance!"],TRICK_LOSS:["A momentary lapse in judgment...","I let you have this one intentionally.","A clever trap, I must admit.","The ancients warned of such strategies."],PENALTY:["Alas! I have brought shame upon my ancestors!","A penalty? My reputation is ruined!","I was momentarily blinded by greed.","A painful lesson learned."],ROUND_WIN:["Strategy woven within the tent determines victory a thousand miles away.","My luck today rivals the masters of old.","A narrow victory, thank you for the game.","The flow of the cards was with me."],ROUND_LOSS:["Fortune is fickle...","I shall return stronger in the next hand.","Your skills have improved, young one.","I must meditate on this defeat."],KAI_CHONG_SUCCESS:["A match made in heaven!","It was destined to be.","A stroke of genius!","Fate is on my side."],KAI_CHONG_FAIL:["Fate has not yet arrived.","Like a flower in the mirror, an illusion.","The pot is cruel today.","Patience is a virtue."],PLAY_HIGH_CARD:["Behold, the weight of Mount Tai!","This card settles the universe.","Power without flash.","Can you withstand this?"],WAITING:["Are you calculating the movements of the stars?","Hesitation leads to defeat.","Time flows like a river, please play.","Studying the ancient texts, are we?"],TEACH_VIOLATION:["Foolish apprentice! Leading 'Qian Wan' is strictly forbidden by the ancients!","Absurd! Leading Cash without being a Millionaire? You court disaster!","In the old tea houses of Suzhou, such play would get you expelled!","Do not play the Reward (Zun) before the Shoulder appears! Remember the Three Preventions!","Chaos! This is why the 'Grand Penalty' exists. Learn from this!","You hold the Extreme (Ji) yet discard your Blacks? Amateur!"]},ja:{GAME_START:["馬吊は兵法の如し。四十枚の札、変化は無限なり。","馮夢龍先生曰く『彼を知り己を知れば百戦殆うからず』。","明代の文人たちも愛したこの遊戯、雅に参ろう。"],TRICK_WIN:["頂いた。","兵は神速を貴ぶ。","計算通りだ。","この一手が戦局を変える。"],TRICK_WIN_BIG:["一夫当関、万夫莫開！","至尊ここにあり！","誰がこの勢いを止められようか？","圧倒的ではないか！"],TRICK_LOSS:["不覚...","敵を欺くにはまず味方からか。","見事な策だ。","次はこうはいかんぞ。"],PENALTY:["嗚呼！先人に顔向けできぬ...","責任払いとは...一生の不覚！","魔が差したとしか言いようがない。","自業自得か..."],ROUND_WIN:["帷幄の中で謀り、千里の外で勝つ。","今日の運勢は古の達人の如し。","良い勝負であった。","流れは我にあり。"],ROUND_LOSS:["運命とは非情なもの...","次は必ず雪辱を果たす。","若手にしてはやるな。","この敗北を糧としよう。"],KAI_CHONG_SUCCESS:["天の配剤なり！","待っていたぞ。","妙手！","運命の巡り合わせだ。"],KAI_CHONG_FAIL:["縁がなかったか。","鏡花水月...","無念。","次機を待つのみ。"],PLAY_HIGH_CARD:["泰山の重みを知れ！","乾坤一擲！","この札で決める。","これぞ王者の風格。"],WAITING:["天機を読んでいるのか？","長考は敗北の元なり。","時は金なり、早う。","古文書でも読んでいるのか？"],TEACH_VIOLATION:["愚か者め！『千万』の先発は古来よりの大禁忌ぞ！","なんと！『百老』でもないのに十字門を出すとは、自滅する気か！","昔の蘇州の茶館なら、叩き出されているところだぞ！","同門の『肩』が出ぬうちに『尊』を出すなど、言語道断！","無茶苦茶だ！それが『責任払い』の報いだ、よく覚えておけ！","『極』を持っているのに青牌を捨てるとは...素人め！"]},ko:{GAME_START:["마조는 병법과 같다. 40장의 패, 변화무쌍하니 신중하라.","풍몽룡 선생 왈: 지피지기면 백전불태라 했다.","명나라 선비들이 즐기던 이 놀이, 풍류를 즐겨보자."],TRICK_WIN:["감사히 받겠소.","병법은 신속을 귀하게 여긴다.","계산대로군.","이 한 수가 판세를 뒤집으리라."],TRICK_WIN_BIG:["일당백의 기세로다!","지존이 여기 있다!","누가 감히 막을쏘냐?","압도적이군!"],TRICK_LOSS:["방심했군...","적을 속이려다 내가 당했소.","훌륭한 계략이오.","다음엔 어림없다."],PENALTY:["오호 통재라! 선현들께 면목이 없구나...","독박이라니... 일생일대의 실수로다!","귀신에 홀렸나 보오.","자업자득이로다."],ROUND_WIN:["천리 밖의 승부를 앉아서 결정짓는군.","오늘 운세가 옛 고수들과 같구려.","좋은 승부였소.","흐름이 나에게 왔소."],ROUND_LOSS:["운명이 야속하군...","다음 판엔 반드시 설욕하리라.","젊은 친구가 제법이군.","이 패배를 교훈 삼겠소."],KAI_CHONG_SUCCESS:["하늘이 정해준 인연이로다!","기다리고 있었소.","묘수!","운명의 장난이군."],KAI_CHONG_FAIL:["인연이 아닌가 보오.","신기루였군...","아쉽구려.","때를 기다려야지."],PLAY_HIGH_CARD:["태산의 무게를 느껴보라!","건곤일척의 승부수!","이 패로 끝내겠소.","왕의 품격이로다."],WAITING:["천기를 읽고 계시오?","망설임은 패배를 부를 뿐.","시간이 금이오, 어서.","고서라도 읽고 있는 게요?"],TEACH_VIOLATION:["어리석은지고! '천만'을 먼저 내는 것은 옛부터 금기였거늘!","당치 않소! '백로'도 아니면서 십자문을 내다니, 자멸할 셈이오?","옛날 소주 찻집이었으면 쫓겨났을 플레이오!","같은 무늬 '견'이 나오기도 전에 '존'을 내다니, 언어도단이오!","무모하군! 그것이 바로 '독박'의 대가이니, 명심하시오!","'극'을 쥐고도 청패를 버리다니... 하수나 하는 짓이오!"]}},Cr=(e,a,r)=>{const n=(Ft[a]||Ft.en)[e]||[];if(n.length===0)return"";const o=Math.floor(Math.random()*n.length);return n[o]},Sr=({gameState:e,gameActions:a,audioSystem:r,isMuted:s,language:n})=>{const[o,c]=C({}),l=Qe(!1),{players:u,currentPlayerIndex:p,phase:d,trickNumber:g,tableCards:_,recordedCards:f,bankerId:m,difficulty:N,gameHistory:A,openedSuits:h,firstLeadInfo:x,mianZhangCard:w,lastGameEvent:y,trickWinnerId:v}=e;me(()=>{const T=u[p];if(d===ie.PLAYING&&g<8&&T?.type===fe.AI&&_.length<4&&!v&&!l.current){l.current=!0;const S=setTimeout(async()=>{const L=T,I=_.map(B=>({card:B.card,playerId:B.playerId}));try{const B=await kr(L,I,u,f,m,N,A,h,x,g,w);B&&((B.rank===E.ZUN||B.rank===E.BAI)&&k(L.id,"PLAY_HIGH_CARD"),await a.executePlayCard(L.id,B.id))}catch(B){console.error("AI Move Error",B)}finally{l.current=!1}},1e3+Math.random()*500);return()=>clearTimeout(S)}},[p,d,_.length,v,g]),me(()=>{if(!y)return;(async()=>{const{type:P,playerId:S,context:L}=y,I=u.find(B=>B.id===S);if(P==="TRICK_WIN")I?.type===fe.AI&&k(S,L?.isBig?"TRICK_WIN_BIG":"TRICK_WIN"),u.forEach(B=>{B.id!==S&&B.type===fe.AI&&Math.random()>.7&&k(B.id,"TRICK_LOSS")});else if(P==="VIOLATION"){const B=u.find(ce=>ce.type===fe.AI)?.id||1;k(B,"TEACH_VIOLATION")}else P==="KAI_CHONG_SUCCESS"?I?.type===fe.AI&&k(S,"KAI_CHONG_SUCCESS"):P==="KAI_CHONG_FAIL"&&I?.type===fe.AI&&k(S,"KAI_CHONG_FAIL")})()},[y]);const k=async(T,P)=>{if(!u.find(I=>I.id===T))return;Nt(T,A||{});const L=Cr(P,n);if(L&&(c(I=>({...I,[T]:L})),setTimeout(()=>{c(I=>({...I,[T]:null}))},4e3),!s)){let I="Puck";T===2&&(I="Kore"),T===3&&(I="Fenrir");const B=await Nr(L,I);B&&r.playPcmAudio(B)}};return{aiChatMessages:o}},Ir=e=>{const a=Qe(null);me(()=>{const n=window.AudioContext||window.webkitAudioContext;return n&&(a.current=new n({sampleRate:24e3})),()=>{a.current?.close()}},[]);const r=async(n,o,c,l)=>{const u=new Int16Array(n.buffer),p=u.length/l,d=o.createBuffer(l,p,c);for(let g=0;g<l;g++){const _=d.getChannelData(g);for(let f=0;f<p;f++)_[f]=u[f*l+g]/32768}return d};return{playPcmAudio:Xt(async n=>{if(!(e||!a.current))try{a.current.state==="suspended"&&await a.current.resume();const o=await r(n,a.current,24e3,1),c=a.current.createBufferSource();c.buffer=o,c.connect(a.current.destination),c.start()}catch(o){console.error("Audio playback error",o)}},[e])}},At=()=>{const[e,a]=C("zh_CN"),[r,s]=C(Ke.MEDIUM),[n,o]=C(!0),[c,l]=C(!0),[u,p]=C(!0),[d,g]=C(!0),[_,f]=C(!0),[m,N]=C(!1);me(()=>{const y=()=>{const v=window.innerWidth<1024,k=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);N(v||k)};return y(),window.addEventListener("resize",y),()=>window.removeEventListener("resize",y)},[]);const[A,h]=C("HIGH"),[x,w]=C(!0);return me(()=>{m&&h("LOW")},[m]),{language:e,setLanguage:a,difficulty:r,setDifficulty:s,oneClickPlay:n,setOneClickPlay:o,isMuted:c,setIsMuted:l,isRiskAlertOn:u,setIsRiskAlertOn:p,showSuitHistory:d,setShowSuitHistory:g,graphicsQuality:A,setGraphicsQuality:h,githubAutoSync:_,setGithubAutoSync:f,showPaperDolls:m?!1:x,setShowPaperDolls:w,isMobileDevice:m}},Ar=()=>{const[e,a]=C(!1),[r,s]=C("GENERAL"),[n,o]=C(!1);return{showSettings:e,setShowSettings:a,activeSettingsTab:r,setActiveSettingsTab:s,showSocialModal:n,setShowSocialModal:o}},Tr=(e,a,r,s)=>{const{players:n,phase:o,trickNumber:c,currentPlayerIndex:l,tableCards:u,recordedCards:p,openedSuits:d,bankerId:g,firstLeadInfo:_,selectedCardId:f}=e,m=_e(()=>{if(!r||o!==ie.PLAYING)return{label:"",disabled:!0,highlightedCardIds:new Set};const h=n[l]?.id===0&&c!==8&&(u?u.length<4:!0);let x="出牌",w=new Set,y=!h;if(c===8)y=!0,x="比张";else if(h){if(!u||u.length===0)x="发牌";else{const v=u[0].card.suit;let k=-1;u.forEach(P=>{P.card.suit===v&&P.card.value>k&&(k=P.card.value)}),x=r.hand.some(P=>P.suit===v&&P.value>k)?"捉牌":"灭牌",x==="捉牌"||rr(r).forEach(S=>w.add(S.id))}!s.oneClickPlay&&!f&&(y=!0)}else y=!0,x="等待";return{label:x,disabled:y,highlightedCardIds:w}},[n,l,o,c,u,r,s.oneClickPlay,f,p,d,g,_]);return{interactionState:m,handle3DActionClick:()=>{m.disabled||(f?a.executePlayCard(0,f):s.oneClickPlay&&(m.highlightedCardIds.size>0?a.executePlayCard(0,Array.from(m.highlightedCardIds)[0]):r&&r.hand.length>0&&a.executePlayCard(0,r.hand[0].id)))}}};oe.memo(({activePlayerId:e,spotlightPos:a})=>{const r=_e(()=>a?{background:`radial-gradient(circle at ${a.x} ${a.y}, 
                    rgba(255, 215, 0, 0.2) 0%, 
                    rgba(184, 134, 11, 0.05) 40%, 
                    transparent 70%)`,transition:"background 0.8s cubic-bezier(0.25, 1, 0.5, 1)",mixBlendMode:"plus-lighter"}:{background:"transparent"},[a]);return t("div",{className:"absolute inset-0 z-[5] pointer-events-none transition-all duration-1000",style:r})});const la="-250 -100 900 640",Ze="M -100 0 L 500 0 A 220 220 0 0 1 500 440 L -100 440 A 220 220 0 0 1 -100 0 Z",Er="M -100 0 L 500 0",Lr="M 500 440 L -100 440",Rr="M 500 0 A 220 220 0 0 1 500 440",Or="M -100 440 A 220 220 0 0 1 -100 0",Gr=oe.memo(({activePlayerId:e,isVertical:a=!1})=>t("div",{className:"absolute inset-0 pointer-events-none z-[12] overflow-visible mix-blend-screen",style:{transform:a?"rotate(90deg)":"none",transition:"transform 0.5s ease-out"},children:i("svg",{className:"w-full h-full overflow-visible",viewBox:la,preserveAspectRatio:"xMidYMid meet",children:[t("defs",{children:i("linearGradient",{id:"teaFlowGrad",gradientUnits:"userSpaceOnUse",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t("stop",{offset:"0%",stopColor:"#8c6239",stopOpacity:"0"}),t("stop",{offset:"20%",stopColor:"#d4af37",stopOpacity:"0.4"}),t("stop",{offset:"50%",stopColor:"#fff8e1",stopOpacity:"1"}),t("stop",{offset:"80%",stopColor:"#d4af37",stopOpacity:"0.4"}),t("stop",{offset:"100%",stopColor:"#8c6239",stopOpacity:"0"})]})}),t("style",{children:`
                        @keyframes borderFlowReverse {
                            0% { stroke-dashoffset: 0; } 
                            100% { stroke-dashoffset: 2000; }
                        }
                    `}),t("path",{d:Ze,stroke:"url(#teaFlowGrad)",strokeWidth:"3",fill:"none",strokeLinecap:"round",strokeDasharray:"300 1700",style:{animation:"borderFlowReverse 4s linear infinite"}})]})})),Mr=oe.memo(({activePlayerId:e,bankerId:a,revealedBaiLaoId:r,suspectedBaiLaoId:s,playedPlayerIds:n=[],hasTableCards:o,phase:c,isVertical:l=!1})=>{const u=_e(()=>{let h=0;switch(e){case 0:h=180;break;case 1:h=90;break;case 2:h=0;break;case 3:h=-90;break}return h},[e]),p=_e(()=>l?{2:3,0:1,1:2,3:0}:{0:0,1:1,2:2,3:3},[l]),d=h=>h===a&&h===r,g=h=>d(h)?{main:"#ef4444",glow:"#ef4444",needle:"#dc2626"}:h===a?{main:"#b91c1c",glow:"#ff0000",needle:"#b91c1c"}:h===r?{main:"#0d9488",glow:"#2dd4bf",needle:"#0f766e"}:{main:"#d4af37",glow:"#ffeebb",needle:"#b8860b"},_=(h,x)=>h===a?"庄":h===r?"百":x,f=h=>{const x=e===h,w=h===a,y=h===r;let v="text-[#5c4025] opacity-60 mix-blend-overlay",k="",T="scale-100";return w?(v="text-[#ef4444] opacity-90 drop-shadow-[0_0_8px_rgba(220,38,38,0.8)]",k="animate-pulse-slow"):y&&(v="text-[#34d399] opacity-90 drop-shadow-[0_0_8px_rgba(16,185,129,0.8)]",k="animate-pulse-slow"),x&&(T="scale-125 md:scale-150",!w&&!y?v="text-[#ffdb7a] opacity-100 drop-shadow-[0_0_15px_rgba(255,215,0,0.8)]":(v=v.replace("opacity-90","opacity-100 brightness-150"),k="")),`absolute font-serif font-bold transition-all duration-700 transform -translate-x-1/2 -translate-y-1/2 z-[25] flex items-center justify-center text-sm md:text-xl ${v} ${T} ${k}`},m=c===ie.KAI_CHONG,N=m?300:0,A=g(e);return i("div",{className:"relative w-full h-full pointer-events-none z-[0]",style:{transformStyle:"preserve-3d"},children:[t("div",{className:"absolute inset-0 z-[10]",style:{transform:l?"rotate(90deg) translateZ(0px)":"translateZ(0px)",transition:"transform 0.5s ease-out"},children:i("svg",{className:"w-full h-full overflow-visible",viewBox:la,preserveAspectRatio:"xMidYMid meet",children:[i("defs",{children:[i("linearGradient",{id:"glassReflection",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t("stop",{offset:"0%",stopColor:"white",stopOpacity:"0.05"}),t("stop",{offset:"40%",stopColor:"white",stopOpacity:"0.0"}),t("stop",{offset:"60%",stopColor:"white",stopOpacity:"0.0"}),t("stop",{offset:"100%",stopColor:"white",stopOpacity:"0.1"})]}),i("filter",{id:"rimGlow",children:[t("feGaussianBlur",{stdDeviation:"2",result:"blur"}),t("feComposite",{in:"SourceGraphic",in2:"blur",operator:"over"})]}),i("clipPath",{id:"clipTopHalf",children:[t("rect",{x:"-250",y:"-100",width:"900",height:"320"})," "]}),i("clipPath",{id:"clipBottomHalf",children:[t("rect",{x:"-250",y:"220",width:"900",height:"420"})," "]})]}),t("path",{d:Ze,fill:"#050302",stroke:"none",opacity:"0.6"}),t("path",{d:Ze,fill:"none",stroke:"#3e2b22",strokeWidth:"2",opacity:"0.5"}),i("g",{style:{transition:"transform 1.5s cubic-bezier(0.4, 0, 0.2, 1)",transform:`translateY(-${N}px)`},clipPath:"url(#clipTopHalf)",children:[t("path",{d:Ze,fill:"url(#glassReflection)",stroke:"none",style:{mixBlendMode:"overlay"}}),t("path",{d:"M -100 220 L 500 220",stroke:"#5c4025",strokeWidth:"1",opacity:"0.5"})]}),i("g",{style:{transition:"transform 1.5s cubic-bezier(0.4, 0, 0.2, 1)",transform:`translateY(${N}px)`},clipPath:"url(#clipBottomHalf)",children:[t("path",{d:Ze,fill:"url(#glassReflection)",stroke:"none",style:{mixBlendMode:"overlay"}}),t("path",{d:"M -100 220 L 500 220",stroke:"#5c4025",strokeWidth:"1",opacity:"0.5"})]}),i("g",{style:{mixBlendMode:"plus-lighter",opacity:m?.3:1,transition:"opacity 1s"},children:[t("line",{x1:"-80",y1:"220",x2:"480",y2:"220",stroke:"#8c6239",strokeWidth:"1.5",opacity:"0.5",strokeDasharray:"6 3"}),t("line",{x1:"200",y1:"20",x2:"200",y2:"420",stroke:"#8c6239",strokeWidth:"1.5",opacity:"0.5",strokeDasharray:"6 3"}),t("circle",{cx:"200",cy:"220",r:"120",fill:"none",stroke:"#5c4025",strokeWidth:"1",opacity:"0.2"}),t("circle",{cx:"200",cy:"220",r:"40",fill:"none",stroke:"#d4af37",strokeWidth:"1",opacity:"0.15"}),t("circle",{cx:"200",cy:"220",r:"3",fill:"#d4af37",opacity:"0.8"})]}),t("g",{style:{mixBlendMode:"screen",opacity:m?.5:1,transition:"opacity 1s"},children:[{id:2,path:Er},{id:1,path:Rr},{id:0,path:Lr},{id:3,path:Or}].map(h=>{const x=Object.keys(p).find(T=>p[T]===h.id),w=x?parseInt(x):-1,y=w===e,v=y||n.includes(w),k=g(w);return i("g",{children:[t("path",{d:h.path,fill:"none",stroke:k.main,strokeWidth:y?6:v?2:0,strokeLinecap:"round",filter:y?"url(#rimGlow)":"",opacity:v?1:0,style:{transition:"all 0.5s ease-out"}}),t("path",{d:h.path,fill:"none",stroke:"#2a1d15",strokeWidth:"1",strokeLinecap:"round"})]},h.id)})})]})}),t("div",{className:"absolute inset-0 z-[100] flex items-center justify-center pointer-events-none",style:{transformStyle:"preserve-3d",transform:"translateZ(10px)"},children:i("div",{className:"relative transition-transform duration-1000 cubic-bezier(0.34, 1.56, 0.64, 1)",style:{transform:`rotate(${u}deg)`},children:[t("div",{className:"absolute top-1/2 left-1/2 w-4 h-40 bg-black blur-sm opacity-60",style:{transform:"translate(-50%, -50%) rotate(0deg) translateZ(-15px)",clipPath:"polygon(50% 0%, 80% 40%, 50% 100%, 20% 40%)"}}),t("div",{className:"absolute top-1/2 left-1/2 w-6 h-48 -translate-x-1/2 -translate-y-[65%] transition-colors duration-700",style:{clipPath:"polygon(50% 0%, 100% 85%, 50% 100%, 0% 85%)",background:`linear-gradient(90deg, ${A.needle} 40%, white 50%, ${A.needle} 60%)`,boxShadow:"0 0 10px rgba(0,0,0,0.5)"}}),t("div",{className:"absolute top-1/2 left-1/2 w-4 h-16 -translate-x-1/2 translate-y-[20%] transition-colors duration-700",style:{clipPath:"polygon(50% 100%, 100% 15%, 50% 0%, 0% 15%)",background:"linear-gradient(90deg, #1a0505 40%, #3e2b22 50%, #1a0505 60%)"}}),t("div",{className:"absolute top-[50%] left-[50%] -translate-x-1/2 -translate-y-1/2 w-8 h-8 rounded-full shadow-lg border-2 border-[#451a03] z-50 transition-colors duration-700 overflow-hidden",style:{background:`radial-gradient(circle at 30% 30%, white, ${A.glow}, ${A.needle})`},children:t("div",{className:"absolute inset-0 bg-gradient-to-tr from-black/40 to-transparent pointer-events-none"})})]})}),i("div",{className:"absolute inset-0 z-[25] pointer-events-none",style:{transform:"translateZ(15px)",opacity:m?.3:1,transition:"opacity 1s"},children:[t("div",{className:f(2),style:{top:"25%",left:"50%"},children:_(2,"北")}),t("div",{className:f(0),style:{top:"75%",left:"50%"},children:_(0,"南")}),t("div",{className:f(3),style:{top:"50%",left:"32%"},children:_(3,"西")}),t("div",{className:f(1),style:{top:"50%",left:"68%"},children:_(1,"東")})]})]})}),ca="radial-gradient(circle, rgba(255,215,0,0.3) 1px, transparent 1px)",Dr=({quality:e})=>i("div",{className:"absolute inset-0 pointer-events-none z-0 overflow-hidden bg-[#020101]",children:[t("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_30%,#150505_0%,#000000_100%)]"}),e!=="LOW"&&t("div",{className:"absolute inset-0 opacity-20 animate-sway-slow mix-blend-screen",style:{backgroundImage:ca,backgroundSize:"150px 150px"}}),t("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,transparent_30%,rgba(0,0,0,0.9)_100%)]"})]}),Pr=({isSmall:e})=>i("div",{className:"absolute inset-0 w-full h-full rounded-[inherit] overflow-hidden bg-[#050202] shadow-inner border border-[#333]",children:[t("div",{className:"absolute inset-0 opacity-30",style:{backgroundImage:ca,backgroundSize:"30px 30px"}}),t("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-black/95"}),t("div",{className:"absolute inset-1 border border-[#b8860b] rounded-[4px] opacity-40"}),!e&&t("div",{className:"absolute inset-0 flex items-center justify-center",children:t("div",{className:"w-8 h-12 border border-[#b8860b] flex items-center justify-center bg-black/60 backdrop-blur-sm shadow-[0_0_15px_#b8860b] animate-pulse-slow",children:t("span",{className:"text-[#b8860b] font-serif font-bold text-lg drop-shadow-[0_0_5px_#b8860b] writing-vertical-rl",children:"御"})})})]}),Br=({effect:e})=>e?i("div",{className:"absolute inset-0 z-30 rounded-[inherit] pointer-events-none overflow-hidden mix-blend-plus-lighter",children:[t("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(255,215,0,0.2)_0%,transparent_70%)] animate-pulse-slow"}),t("div",{className:"absolute inset-[-1px] border-[1.5px] border-[#ffd700] opacity-90 rounded-[inherit] shadow-[0_0_15px_#ffd700]"})]}):null,Hr=()=>t("div",{className:"absolute inset-0 pointer-events-none opacity-30 mix-blend-soft-light overflow-hidden",style:{zIndex:1},children:i("svg",{viewBox:"0 0 500 500",className:"w-full h-full animate-actor-move",style:{filter:"blur(8px)"},children:[t("path",{d:"M250,450 C200,450 150,350 150,250 C150,150 220,100 250,100 C280,100 350,150 350,250 C350,350 300,450 250,450 Z",fill:"#000"}),t("circle",{cx:"200",cy:"200",r:"40",fill:"#000"})," ",t("rect",{x:"300",y:"150",width:"20",height:"200",transform:"rotate(15)",fill:"#000"})," "]})}),mt=()=>t("div",{className:"w-full h-full bg-[#0a0505] opacity-60 blur-xl rounded-full"}),$r=()=>t("div",{className:"w-full h-full border-b-4 border-[#3e1010] opacity-50"}),ot={id:"imperial",name:"Imperial Court (Lacquer)",description:"Deep Urushi lacquer with suspended gold dust (Maki-e).",layout:{backgroundClass:"bg-[#020101]",atmosphereComponent:Dr,EnvironmentalShadows:Hr,tableSurfaceClass:"rounded-[32px] shadow-[0_40px_100px_black] border border-[#3e1010]/60 overflow-hidden",tableBaseColor:"#050202",tableTexture:`
            radial-gradient(circle at 60% 30%, rgba(255,255,255,0.03) 0%, transparent 30%),
            radial-gradient(circle at 40% 70%, rgba(184, 134, 11, 0.05) 0%, transparent 50%),
            url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E")
        `,tableTextureSize:"auto",tableReflectivity:!0,tableBorderClass:"bg-[#0f0505] border-t border-[#3e1010]/40"},card:{getContainerClass:e=>{let a="w-16 h-24 md:w-20 md:h-32";e.isSmall?a=e.isRotated?"w-12 h-8":"w-8 h-12":e.isTrick?a=e.isRotated?"w-20 h-14 md:w-28 md:h-20":"w-14 h-20 md:w-20 md:h-28":e.isHand&&(a=e.isRotated?"w-24 h-16 md:w-28 md:h-20":"w-16 h-24 md:w-24 md:h-36");let r=e.isInverted?"bg-[#080404] text-[#e6c278] border border-[#3e1010]":"bg-[#f7f2e6] text-[#1c1917]";e.isFaceDown&&(r="bg-[#050202]"),e.isDisabled&&(r="bg-[#1a1a1a] grayscale opacity-40");let s="transition-all duration-300 cubic-bezier(0.2, 0.8, 0.2, 1)";!e.isFaceDown&&!e.isHand&&!e.isDisabled&&(s+=" hover:-translate-y-2 hover:shadow-[0_15px_30px_rgba(0,0,0,0.8)] cursor-pointer hover:brightness-110");let n="";return e.isSelected&&(n="-translate-y-4 scale-105 z-[100] shadow-[0_0_30px_rgba(218,165,32,0.6)] ring-1 ring-[#daa520]"),`relative flex flex-col group rounded-[6px] ${a} ${r} ${s} ${n}`},getMainColorClass:(e,a)=>a?"text-[#d4af37] font-serif tracking-widest drop-shadow-[0_1px_2px_rgba(0,0,0,0.9)]":e===O.RED?"text-[#9f1212] font-bold opacity-90 mix-blend-multiply":e===O.GREEN?"text-[#0f5132] font-bold opacity-90 mix-blend-multiply":"text-[#0a0a0a] font-bold opacity-90 mix-blend-multiply",getPokerColorClass:(e,a)=>a?"text-[#b8860b]":e===b.STRINGS||e===b.TEXTS?"text-[#9f1212]":"text-[#0a0a0a]",getBorderClass:e=>e.isFaceDown?"border border-[#3e1010]":e.isWinner?"border border-[#d4af37] shadow-[0_0_15px_rgba(212,175,55,0.6)]":"border-[0.5px] border-[#ccc]/30",getShadowClass:e=>e.isFaceDown?"shadow-[0_10px_20px_black]":"shadow-[0_2px_8px_rgba(0,0,0,0.3)]",BackComponent:Pr,EffectOverlay:Br},hud:{avatarContainerClass:e=>`
            relative w-16 h-16 md:w-24 md:h-24 rounded-full flex items-center justify-center 
            transition-all duration-700
            ${e?"bg-[#150505] border-2 border-[#FFD700] shadow-[0_0_50px_rgba(255,215,0,0.5)] scale-110 z-50 ring-1 ring-[#b8860b]":"bg-[#0a0202] border border-[#3e1010] opacity-70 grayscale-[0.5] scale-90"}
        `,buttonClass:e=>`
            relative min-w-[140px] h-12 rounded-[4px] flex items-center justify-center transition-all duration-300 font-serif tracking-[0.3em] font-bold text-sm shadow-[0_10px_30px_rgba(0,0,0,0.9)]
            ${e?"bg-[#0f0505] text-[#555] border border-[#333] cursor-not-allowed opacity-50":"bg-gradient-to-br from-[#2b0d0d] via-[#4a1212] to-[#1a0505] text-[#ffdb7a] border border-[#d4af37] hover:brightness-125 hover:-translate-y-1 active:scale-95 shadow-[0_0_20px_rgba(212,175,55,0.2)] backdrop-blur-md"}
        `,modalOverlayClass:"fixed inset-0 z-[300] flex items-center justify-center bg-[#000000]/98 backdrop-blur-xl p-4 animate-fade-in font-serif",modalContentClass:"relative w-full max-w-5xl bg-[#050202] border-[1px] border-[#3e1010] shadow-[0_0_150px_rgba(139,0,0,0.5)] text-[#e6c278] rounded-[4px]"},lighting:{StoveLighting:()=>null,TableBorderFlow:Gr},character:{bodyFront:mt,bodySideLeft:mt,bodySideRight:mt,headOutline:"",chairComponent:$r}},Tt="radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px)",jr=()=>i("div",{className:"absolute inset-0 pointer-events-none z-0 overflow-hidden bg-[#050a14]",children:[t("div",{className:"absolute inset-0 bg-gradient-to-b from-[#050a14] via-[#0f0a0a] to-[#1a0505]"}),t("div",{className:"absolute bottom-[-20%] left-[-10%] w-[80%] h-[80%] bg-[#ff4500] blur-[180px] opacity-15 animate-candleFlicker mix-blend-screen"}),t("div",{className:"absolute top-[10%] right-[10%] w-[300px] h-[300px] bg-[#aaddff] blur-[120px] opacity-05 rounded-full"}),t("div",{className:"absolute inset-0 opacity-10 mix-blend-overlay animate-sway-slow",style:{backgroundImage:Tt,backgroundSize:"10px 10px"}})]}),Wr=({isSmall:e})=>i("div",{className:"absolute inset-0 w-full h-full rounded-[inherit] overflow-hidden bg-[#0a2e18] flex items-center justify-center shadow-inner",children:[t("div",{className:"absolute inset-0 opacity-40 mix-blend-overlay",style:{backgroundImage:Tt,backgroundSize:"4px 4px"}}),t("div",{className:"absolute inset-0 bg-gradient-to-b from-white/5 to-black/60"}),t("div",{className:"absolute inset-1.5 border-2 border-dashed border-[#c5a059] rounded-[4px] opacity-60"}),!e&&t("div",{className:"text-[#c5a059] opacity-80 text-4xl drop-shadow-md",children:"❄"})]}),zr=({effect:e})=>e?t("div",{className:"absolute inset-0 z-20 pointer-events-none rounded-[inherit] ring-4 ring-[#b91c1c] ring-opacity-60 animate-pulse shadow-[0_0_20px_#b91c1c]"}):null,gt=()=>i("svg",{viewBox:"0 0 100 100",className:"w-full h-full drop-shadow-xl",children:[t("path",{d:"M20,100 C20,60 30,35 50,35 C70,35 80,60 80,100 Z",fill:"#8a1c1c",stroke:"#330000",strokeWidth:"1"}),t("path",{d:"M50,35 L50,100",stroke:"rgba(0,0,0,0.2)",strokeWidth:"1",strokeDasharray:"2 2"})]}),Fr=({position:e})=>i("svg",{viewBox:"0 0 100 100",className:"w-full h-full",children:[t("path",{d:"M10,100 L10,30 Q50,20 90,30 L90,100",fill:"#3e2723"}),t("rect",{x:"15",y:"35",width:"70",height:"60",fill:"#143d22",rx:"5",stroke:"#0a2012",strokeWidth:"2"})]}),da={id:"christmas",name:"Victorian Parlor (Velvet)",description:"Aged green velvet, dark mahogany, warm firelight.",layout:{backgroundClass:"bg-[#050a14]",atmosphereComponent:jr,tableSurfaceClass:"rounded-[30px] shadow-[inset_0_0_80px_black,0_30px_80px_black] border-[12px] border-[#2d1b1b] overflow-hidden",tableBaseColor:"#0f2e1c",tableTexture:Tt,tableTextureSize:"4px 4px",tableBorderClass:"bg-[#1a0f0f]"},card:{getContainerClass:e=>{let a="w-16 h-24 md:w-20 md:h-32";e.isSmall?a=e.isRotated?"w-14 h-10":"w-10 h-14":e.isTrick?a=e.isRotated?"w-24 h-16 md:w-28 md:h-20":"w-16 h-24 md:w-20 md:h-28":e.isHand&&(a=e.isRotated?"w-20 h-12 md:w-24 md:h-16":"w-14 h-22 md:w-20 md:h-32");let r=e.isInverted?"bg-[#3e2723] text-[#e6c278]":"bg-[#fffaf0] text-[#1e293b]";e.isFaceDown&&(r="bg-[#0a2e18]"),e.isDisabled&&(r="bg-gray-600 grayscale opacity-50");let s="transition-transform duration-300";!e.isFaceDown&&!e.isHand&&!e.isDisabled&&(s+=" hover:-translate-y-2 hover:rotate-1 cursor-pointer hover:shadow-[0_10px_20px_rgba(0,0,0,0.5)]");let n="";return e.isSelected&&(n="-translate-y-4 scale-105 z-[100] ring-2 ring-[#c52222] shadow-[0_20px_30px_rgba(0,0,0,0.6)]"),`relative flex flex-col group rounded-[6px] ${a} ${r} ${s} ${n}`},getMainColorClass:(e,a)=>a?"text-[#f0e68c] font-serif":e===O.RED?"text-[#b91c1c] font-bold":e===O.GREEN?"text-[#15803d] font-bold":"text-[#1e293b] font-bold",getPokerColorClass:(e,a)=>a?"text-[#f0e68c]":e===b.STRINGS||e===b.TEXTS?"text-[#b91c1c]":"text-[#1e293b]",getBorderClass:e=>e.isFaceDown?"border-2 border-[#051a0d]":e.isWinner?"border-2 border-[#ffd700]":e.isSelected?"border-2 border-[#c52222]":"border border-gray-300",getShadowClass:e=>e.isFaceDown?"shadow-lg":"shadow-[1px_2px_4px_rgba(0,0,0,0.3)]",BackComponent:Wr,EffectOverlay:zr},hud:{avatarContainerClass:e=>`
            relative w-20 h-20 md:w-24 md:h-24 rounded-full flex items-center justify-center 
            transition-all duration-500 border-4 border-[#3e2723]
            ${e?"bg-[#4a0e0e] border-[#ffd700] shadow-[0_0_25px_rgba(255,215,0,0.4)] scale-105":"bg-[#1e293b] opacity-90"}
        `,buttonClass:e=>`
            relative min-w-[150px] h-14 rounded-full flex items-center justify-center transition-all duration-300 font-bold tracking-wider text-sm shadow-xl
            ${e?"bg-[#334155] text-gray-400 border border-[#475569] cursor-not-allowed":"bg-gradient-to-b from-[#c52222] to-[#7f1d1d] text-white border border-[#fecaca] hover:brightness-110 shadow-[0_5px_15px_rgba(185,28,28,0.4)]"}
        `,modalOverlayClass:"fixed inset-0 z-[300] flex items-center justify-center bg-[#050a14]/98 backdrop-blur-md p-4 animate-fade-in font-serif",modalContentClass:"bg-[#1a0f0f] border-[6px] border-[#2d1b1b] p-8 w-full max-w-5xl rounded-[12px] shadow-2xl relative overflow-hidden text-[#fffaf0]"},lighting:{StoveLighting:()=>null,TableBorderFlow:()=>null},character:{bodyFront:gt,bodySideLeft:gt,bodySideRight:gt,headOutline:"",chairComponent:Fr}},Ur=()=>i("div",{className:"absolute inset-0 pointer-events-none z-[-1] overflow-hidden bg-[#0a0604]",children:[t("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_30%,#2d1a10_0%,#050202_90%)]"}),t("div",{className:"absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/wood-pattern.png')] mix-blend-overlay"})]}),Yr=({isSmall:e})=>i("div",{className:"absolute inset-0 w-full h-full rounded-[inherit] overflow-hidden bg-[#26140c] flex items-center justify-center shadow-inner border border-[#3e2b22]",children:[t("div",{className:"absolute inset-0 opacity-40",style:{background:`
                    repeating-radial-gradient(circle at 0 0, transparent 0, #26140c 10px),
                    repeating-linear-gradient(45deg, #3e2b22, #26140c 10px, #3e2b22 20px)
                 `}}),t("div",{className:"absolute inset-0 bg-gradient-to-tr from-black/80 to-transparent"}),!e&&t("div",{className:"relative z-10 w-8 h-20 border-[1px] border-[#8c6239]/40 flex items-center justify-center rounded-[2px] bg-[#3d1e11]/90 backdrop-blur-sm shadow-[0_2px_10px_rgba(0,0,0,0.8)] animate-pulse-slow",children:t("span",{className:"text-[#e6c278] font-serif font-bold text-2xl writing-vertical-rl tracking-widest drop-shadow-[0_1px_2px_black] opacity-90 select-none",children:"明"})})]}),Kr=({effect:e})=>e?t("div",{className:"absolute inset-[-4px] rounded-[inherit] pointer-events-none z-[50]",children:t("div",{className:"absolute inset-0 border-[1px] border-[#d4af37] rounded-[inherit] opacity-60 animate-pulse shadow-[0_0_15px_#d4af37,inset_0_0_10px_#d4af37]"})}):null,qr=()=>i("div",{className:"absolute inset-0 pointer-events-none opacity-40 mix-blend-multiply overflow-hidden",style:{zIndex:1},children:[t("svg",{viewBox:"0 0 500 500",className:"w-full h-full animate-shadow-sway origin-bottom-left",style:{filter:"blur(4px)"},children:i("g",{transform:"rotate(45) translate(100, -100)",children:[t("rect",{x:"50",y:"0",width:"10",height:"600",fill:"#1a0f0a"}),t("rect",{x:"150",y:"0",width:"8",height:"600",fill:"#1a0f0a"}),t("ellipse",{cx:"60",cy:"100",rx:"60",ry:"10",transform:"rotate(30)",fill:"#1a0f0a"}),t("ellipse",{cx:"160",cy:"200",rx:"70",ry:"12",transform:"rotate(-20)",fill:"#1a0f0a"}),t("ellipse",{cx:"60",cy:"300",rx:"50",ry:"8",transform:"rotate(45)",fill:"#1a0f0a"}),t("ellipse",{cx:"160",cy:"400",rx:"80",ry:"15",transform:"rotate(-10)",fill:"#1a0f0a"})]})}),t("div",{className:"absolute inset-0 bg-gradient-to-tr from-transparent via-[#ff8c00]/10 to-transparent mix-blend-overlay"})]}),bt=()=>i("svg",{viewBox:"0 0 100 100",className:"w-full h-full drop-shadow-[0_10px_30px_rgba(0,0,0,0.9)] filter contrast-125 sepia-[0.3]",children:[t("defs",{children:i("filter",{id:"silkFlow",children:[t("feTurbulence",{type:"fractalNoise",baseFrequency:"0.01",numOctaves:"3"}),t("feDisplacementMap",{in:"SourceGraphic",scale:"5"})]})}),t("path",{d:"M20,100 L20,50 Q50,40 80,50 L80,100 Z",fill:"#2d1a10",stroke:"none",filter:"url(#silkFlow)",opacity:"0.9"})]}),Zr=({position:e})=>i("svg",{viewBox:"0 0 100 100",className:"w-full h-full drop-shadow-2xl",children:[t("path",{d:"M15,100 L15,30 Q15,10 50,15 Q85,10 85,30 L85,100",fill:"none",stroke:"#3e2723",strokeWidth:"6",strokeLinecap:"round"}),t("path",{d:"M20,100 L20,40 L80,40 L80,100",fill:"#26140c",opacity:"0.8"})]}),ua={id:"ming_scholar",name:"Ming Scholar (Huanghuali)",description:"Aged Huanghuali wood with ghost face grains and deep amber patina.",layout:{backgroundClass:"bg-[#0a0604]",atmosphereComponent:Ur,EnvironmentalShadows:qr,tableSurfaceClass:"rounded-[12px] overflow-hidden shadow-[0_50px_120px_black] border border-[#5c3a21]/50",tableBaseColor:"#2b1105",tableTexture:`
            radial-gradient(circle at 30% 40%, rgba(20, 10, 5, 0.4) 0%, transparent 60%),
            repeating-linear-gradient(110deg, rgba(62, 39, 35, 0.1) 0px, rgba(62, 39, 35, 0.1) 1px, transparent 1px, transparent 8px),
            radial-gradient(ellipse at 70% 60%, rgba(139, 69, 19, 0.15), transparent 40%),
            conic-gradient(from 0deg at 50% 50%, transparent 0deg, rgba(0,0,0,0.2) 20deg, transparent 40deg)
        `,tableTextureSize:"auto",tableReflectivity:!0,tableBorderClass:"bg-[#1a0a05] border-t border-[#3e2b22] brightness-75"},card:{getContainerClass:e=>{let a="w-16 h-24 md:w-20 md:h-32";e.isSmall?a=e.isRotated?"w-14 h-10":"w-10 h-14":e.isTrick?a=e.isRotated?"w-24 h-14 md:w-32 md:h-20":"w-14 h-24 md:w-20 md:h-32":e.isHand&&(a=e.isRotated?"w-20 h-12 md:w-24 md:h-16":"w-14 h-24 md:w-20 md:h-32");let r=e.isInverted?"bg-[#26140c] text-[#d9c7b0] border border-[#5c3a21]":"bg-[#e8e4d9] text-[#2b1810]";e.isFaceDown&&(r="bg-[#26140c]"),e.isDisabled&&(r="bg-[#1a1a1a] opacity-40 grayscale");let s="transition-all duration-300 ease-out";!e.isFaceDown&&!e.isHand&&!e.isDisabled&&(s+=" hover:-translate-y-2 hover:shadow-[0_15px_30px_rgba(0,0,0,0.7)] cursor-pointer hover:brightness-110");let n="";return e.isSelected&&(n="-translate-y-4 scale-105 z-[100] shadow-[0_0_30px_rgba(217,199,176,0.4)]"),`relative flex flex-col group rounded-[4px] ${a} ${r} ${s} ${n}`},getMainColorClass:(e,a)=>a?"text-[#d9c7b0] font-serif tracking-widest opacity-90 drop-shadow-sm":e===O.RED?"text-[#8c1c0b] font-bold font-calligraphy opacity-90 mix-blend-multiply":e===O.GREEN?"text-[#2e4c2e] font-bold font-calligraphy opacity-95 mix-blend-multiply":"text-[#1a1a1a] font-bold font-calligraphy opacity-90 mix-blend-multiply",getPokerColorClass:(e,a)=>a?"text-[#c5a059]":e===b.STRINGS||e===b.TEXTS?"text-[#8c1c0b]":"text-[#1a1a1a]",getBorderClass:e=>e.isFaceDown?"border border-[#3e2b22]":e.isWinner?"border-[2px] border-[#d4af37]":e.isSelected?"border-[1px] border-[#8c6239]":"border-[0.5px] border-[#a8a499]/50 shadow-[inset_0_0_10px_rgba(0,0,0,0.05)]",getShadowClass:e=>e.isFaceDown?"shadow-[0_4px_10px_rgba(0,0,0,0.8)]":"shadow-[1px_2px_6px_rgba(0,0,0,0.3)]",BackComponent:Yr,EffectOverlay:Kr},hud:{avatarContainerClass:e=>`
            relative w-20 h-20 md:w-24 md:h-24 rounded-full flex items-center justify-center 
            transition-all duration-700 border-[3px] 
            ${e?"bg-[#2b1105] border-[#d4af37] shadow-[0_0_40px_rgba(212,175,55,0.3)] scale-105 z-50 ring-2 ring-[#5c3a21]/50":"bg-[#1a0a05] border-[#3e2b22] opacity-80 sepia-[0.4]"}
        `,buttonClass:e=>`
            relative min-w-[150px] h-14 rounded-[2px] flex items-center justify-center transition-all duration-300 font-serif tracking-[0.25em] font-bold shadow-lg text-sm
            ${e?"bg-[#1a1a1a] text-[#444] border border-[#333] cursor-not-allowed":"bg-gradient-to-b from-[#3e2b22] to-[#26140c] text-[#d9c7b0] border border-[#5c4025] hover:border-[#d4af37] hover:text-[#fff] shadow-[0_5px_15px_rgba(0,0,0,0.5)]"}
        `,modalOverlayClass:"fixed inset-0 z-[300] flex items-center justify-center bg-[#050302]/95 backdrop-blur-xl p-4 animate-fade-in font-serif",modalContentClass:"bg-[#1a0d08] border border-[#3e2b22] p-8 w-full max-w-5xl rounded-[2px] shadow-[0_0_100px_black] relative overflow-hidden text-[#d9c7b0] bg-[url('https://www.transparenttextures.com/patterns/wood-pattern.png')]"},lighting:{StoveLighting:()=>null,TableBorderFlow:()=>null},character:{bodyFront:bt,bodySideLeft:bt,bodySideRight:bt,headOutline:"",chairComponent:Zr}},ha="linear-gradient(45deg, rgba(255,255,255,0.02) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.02) 75%, rgba(255,255,255,0.02))",Qr=()=>i("div",{className:"absolute inset-0 pointer-events-none z-[-1] overflow-hidden bg-[#e0e4e8]",children:[t("div",{className:"absolute inset-0 bg-gradient-to-b from-[#f0f4f8] via-[#cfd8dc] to-[#b0bec5]"}),t("div",{className:"absolute top-[-20%] left-[-20%] w-[140%] h-[140%] bg-[radial-gradient(circle,rgba(0,0,0,0.03)_0%,transparent_70%)] blur-[80px]"}),t("div",{className:"absolute inset-0 opacity-20 mix-blend-multiply animate-sway-slow",style:{backgroundImage:ha,backgroundSize:"40px 40px"}})]}),Xr=({isSmall:e})=>i("div",{className:"absolute inset-0 w-full h-full rounded-[inherit] overflow-hidden bg-[#1a1a1a] flex items-center justify-center border border-[#444]",children:[t("div",{className:"absolute inset-0 bg-[#0f0f0f]"}),t("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:ha,backgroundSize:"4px 4px"}}),t("div",{className:`relative ${e?"scale-50":"scale-75"} opacity-80 mix-blend-screen`,children:i("div",{className:"w-12 h-12 rounded-full border-2 border-white/40 flex items-center justify-center animate-[spin_20s_linear_infinite]",children:[t("div",{className:"w-6 h-12 bg-white/90 rounded-l-full border-r border-black"}),t("div",{className:"w-6 h-12 bg-black rounded-r-full border-l border-white/90"})]})})]}),Vr=({effect:e})=>e?i("div",{className:"absolute inset-[-12px] pointer-events-none z-[10]",children:[t("div",{className:"absolute inset-0 rounded-full blur-xl bg-black/10 animate-pulse transform scale-90"}),t("div",{className:"absolute inset-2 border border-black/30 rounded-[inherit] opacity-60"})]}):null,_t=()=>i("svg",{viewBox:"0 0 100 100",className:"w-full h-full drop-shadow-2xl",children:[t("filter",{id:"ink-blur",children:t("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"1.0"})}),t("path",{d:"M20,100 C20,50 40,40 50,40 C60,40 80,50 80,100 Z",fill:"#111",filter:"url(#ink-blur)",opacity:"0.9"})]}),Jr=({position:e})=>i("svg",{viewBox:"0 0 100 100",className:"w-full h-full",children:[" ",t("rect",{x:"20",y:"40",width:"60",height:"60",fill:"#2a2a2a",rx:"1"})," ",t("rect",{x:"15",y:"35",width:"70",height:"5",fill:"#444"})," "]}),fa={id:"taoist_mystery",name:"Taoist Void (Ink Stone)",description:"Cold inkstone slab, rice paper, ethereal mist.",layout:{backgroundClass:"bg-[#cfd8dc]",atmosphereComponent:Qr,tableSurfaceClass:"shadow-[0_40px_120px_rgba(0,0,0,0.5)] border border-[#455a64] rounded-[40px] overflow-hidden",tableBaseColor:"#263238",tableTexture:`
            url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.15'/%3E%3C/svg%3E"),
            linear-gradient(to bottom right, #37474f, #263238)
        `,tableTextureSize:"auto",tableBorderClass:"bg-[#1c2529] border-t border-[#455a64]"},card:{getContainerClass:e=>{let a="w-16 h-24 md:w-20 md:h-32";e.isSmall?a=e.isRotated?"w-14 h-10":"w-10 h-14":e.isTrick?a=e.isRotated?"w-24 h-16 md:w-28 md:h-20":"w-16 h-24 md:w-20 md:h-28":e.isHand&&(a=e.isRotated?"w-20 h-12 md:w-24 md:h-16":"w-14 h-22 md:w-20 md:h-32");let r=e.isInverted?"bg-[#111] text-[#ddd]":"bg-[#fcfcfc] text-[#111]";e.isFaceDown&&(r="bg-[#0f0f0f]"),e.isDisabled&&(r="bg-[#999] opacity-50 grayscale");let s="transition-all duration-500 ease-out";!e.isFaceDown&&!e.isHand&&!e.isDisabled&&(s+=" hover:-translate-y-2 hover:shadow-2xl cursor-pointer hover:scale-105");let n="";return e.isSelected&&(n="-translate-y-4 z-[100] scale-105 shadow-[0_15px_30px_rgba(0,0,0,0.3)]"),`relative flex flex-col group rounded-[2px] ${a} ${r} ${s} ${n}`},getMainColorClass:(e,a)=>a?"text-[#ccc] font-calligraphy tracking-widest":e===O.RED?"text-[#b71c1c] font-bold font-calligraphy opacity-90":"text-[#212121] font-bold font-calligraphy opacity-95",getPokerColorClass:(e,a)=>a?"text-[#ccc]":e===b.STRINGS||e===b.TEXTS?"text-[#b71c1c]":"text-[#212121]",getBorderClass:e=>e.isFaceDown?"border border-[#333]":e.isWinner?"border-[2px] border-black":e.isSelected?"border-[1px] border-black":"border border-transparent",getShadowClass:e=>e.isFaceDown?"shadow-[0_5px_15px_rgba(0,0,0,0.8)]":"shadow-[2px_2px_8px_rgba(0,0,0,0.1)]",BackComponent:Xr,EffectOverlay:Vr},hud:{avatarContainerClass:e=>`
            relative w-20 h-20 md:w-24 md:h-24 rounded-full flex items-center justify-center 
            transition-all duration-1000 border
            ${e?"bg-black border-white shadow-[0_0_50px_rgba(0,0,0,0.3)] scale-105 z-50":"bg-white border-black opacity-80 grayscale"}
        `,buttonClass:e=>`
            relative min-w-[140px] h-14 flex items-center justify-center transition-all duration-500 font-calligraphy tracking-[0.3em] rounded-full text-sm font-bold shadow-lg
            ${e?"bg-[#b0bec5] text-[#546e7a] cursor-not-allowed":"bg-[#263238] text-white border border-transparent hover:bg-[#37474f]"}
        `,modalOverlayClass:"fixed inset-0 z-[300] flex items-center justify-center bg-[#eceff1]/95 backdrop-blur-md p-4 animate-fade-in font-serif",modalContentClass:"bg-[#fafafa] border border-[#cfd8dc] p-8 w-full max-w-5xl rounded-[2px] shadow-2xl relative overflow-hidden text-[#263238]"},lighting:{StoveLighting:()=>null,TableBorderFlow:()=>null},character:{bodyFront:_t,bodySideLeft:_t,bodySideRight:_t,headOutline:"",chairComponent:Jr}},en={skin:ot,setSkinId:()=>{},availableSkins:[ot,da,ua,fa]},pa=wa(en),tn=({children:e})=>{const a=[ot,da,ua,fa],[r,s]=C(ot),n=o=>{const c=a.find(l=>l.id===o);if(c){s(c);try{localStorage.setItem("ma_diao_skin_id",o)}catch(l){console.warn("Could not save skin preference",l)}}};return oe.useEffect(()=>{try{const o=localStorage.getItem("ma_diao_skin_id");if(o&&o!==r.id){const c=a.find(l=>l.id===o);c&&s(c)}}catch(o){console.warn("Could not load skin preference",o)}},[]),t(pa.Provider,{value:{skin:r,setSkinId:n,availableSkins:a},children:e})},ke=()=>ya(pa),an="data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='paper'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.04' numOctaves='5'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23paper)' opacity='0.15'/%3E%3C/svg%3E",rn=e=>e.toString(),nn=e=>{switch(e){case b.CASH:return"♠";case b.STRINGS:return"♥";case b.COINS:return"♣";case b.TEXTS:return"♦";default:return""}},sn=e=>{const{card:a,onClick:r,onTouchStart:s,style:n,domId:o,textRotation:c=0,isRotated:l=!1,lanternGlow:u,isLocked:p}=e,{skin:d}=ke(),g=e.textLayout?e.textLayout==="vertical":!l;if(!a)return null;const _=d.card.getContainerClass(e),f=d.card.getMainColorClass(a.color,e.isInverted),m=d.card.getMainColorClass(a.color,e.isInverted);let N=g?"text-2xl md:text-4xl":"text-xl md:text-3xl";e.isSmall&&(N="text-[9px] leading-tight"),e.isTrick&&(N=g?"text-3xl md:text-5xl font-black tracking-widest":"text-2xl md:text-4xl font-black");const A=e.isSmall?"text-[7px]":"text-[10px] md:text-sm font-black",h=e.isSmall?"text-[7px]":"text-[9px] md:text-xs font-bold",x=c?{transform:`rotate(${c}deg)`}:{};let w="";e.isSmall?w="absolute inset-0 flex flex-col items-center justify-center pt-3 pb-1":g?w="absolute inset-0 flex flex-col items-center justify-center pt-5 pb-2 px-1 gap-0.5":w="absolute inset-0 flex flex-row items-center justify-center px-4 py-2 gap-1";let y="top-[3px] left-[3px]";c===180&&(y="bottom-[3px] right-[3px] transform rotate-180");const v=e.isSmall?1:2;let k="#dcdcdc",T="#1a1a1a";d.id==="imperial"?(k="#b8860b",T="#0a0505"):d.id==="ming_scholar"&&(k="#a8a499",T="#26140c");const P={...x,textShadow:e.isInverted?"0 1px 1px rgba(0,0,0,0.8)":"inset 0 1px 2px rgba(0,0,0,0.2), 0 1px 0 rgba(255,255,255,0.5)",mixBlendMode:e.isInverted?"normal":"multiply"},S=()=>i("div",{className:"w-full h-full rounded-[inherit] overflow-hidden relative",children:[u&&t("div",{className:"absolute inset-0 z-[5] pointer-events-none rounded-[inherit] animate-pulse-fast",style:{boxShadow:`inset 0 0 15px ${u.color}`,mixBlendMode:"plus-lighter",opacity:u.intensity||.6}}),!e.isFaceDown&&i(yt,{children:[e.isInverted?t("div",{className:"absolute inset-0 z-0",style:{backgroundColor:T}}):t("div",{className:"absolute inset-0 bg-[#f0eee5] z-0"}),t("div",{className:"absolute inset-0 opacity-100 pointer-events-none mix-blend-multiply z-0",style:{backgroundImage:`url("${an}")`}}),t("div",{className:`absolute inset-0 border-[1px] ${e.isInverted?"border-[#5c4025]":"border-[#2c1a12]"} rounded-[inherit] pointer-events-none z-50 opacity-40`}),t("div",{className:`z-10 ${w}`,children:t("div",{className:`${f} ${N} font-calligraphy select-none whitespace-nowrap ${g?"tategaki":""} transition-all overflow-visible`,style:P,children:a.name})}),t("div",{className:`absolute ${y} z-30 flex flex-col items-center justify-center pointer-events-none origin-center`,children:i("div",{className:"flex flex-col items-center leading-none opacity-80",children:[t("span",{className:`block ${A} ${m} font-serif`,children:rn(a.value)}),t("span",{className:`block ${h} ${m}`,children:nn(a.suit)})]})}),e.isBanker&&t("div",{className:"absolute top-1.5 right-1.5 z-30",style:x,children:t("div",{className:"w-3.5 h-3.5 rounded-full bg-[#8c1c0b] border border-[#f59e0b] flex items-center justify-center shadow-md",children:t("span",{className:"text-[8px] text-[#fff] font-serif leading-none pt-[1px]",children:"庄"})})}),(e.isBaiLao||e.isSuspectedBaiLao)&&t("div",{className:"absolute bottom-1.5 right-1.5 z-30",style:x,children:t("div",{className:`w-3.5 h-3.5 rounded-full ${e.isSuspectedBaiLao?"bg-amber-700":"bg-amber-600"} border border-[#3e2b22] flex items-center justify-center shadow-md`,children:t("span",{className:"text-[8px] text-[#e8e4d9] font-serif leading-none pt-[1px]",children:"百"})})}),e.suitStatus&&e.suitStatus!=="NEUTRAL"&&t("div",{className:"absolute bottom-1.5 left-1.5 z-30",style:x,children:t("div",{className:`w-2.5 h-2.5 rounded-full shadow-[0_1px_2px_rgba(0,0,0,0.6)] ${e.suitStatus==="FORBIDDEN"?"bg-[#b91c1c] border border-[#ef4444] shadow-[0_0_5px_rgba(220,38,38,0.5)] animate-pulse-slow":"bg-[#15803d] border border-[#4ade80] shadow-[0_0_5px_rgba(74,222,128,0.5)]"}`,title:e.suitStatus==="FORBIDDEN"?"Jin Men (Forbidden)":"Shu Men (Safe)"})}),t(d.card.EffectOverlay,{effect:e.leadingEffect||(e.isWinner?"GOLD":null)}),e.isSelected&&t("div",{className:"absolute inset-0 rounded-[inherit] z-50 pointer-events-none ring-2 ring-white/90 shadow-[0_0_20px_rgba(255,255,255,0.6)]"})]}),t("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-black/20 opacity-30 pointer-events-none mix-blend-overlay rounded-[inherit] z-40"})]});return i("div",{id:o,className:`${_} relative aspect-[2/3] ${d.card.getBorderClass(e)} ${d.card.getShadowClass(e)} ${p?"!cursor-default !transform-none !transition-none pointer-events-none":""}`,style:{transformStyle:"preserve-3d",...n},onClick:e.isDisabled||p?void 0:r,onTouchStart:e.isDisabled||p?void 0:s,children:[u&&t("div",{className:"absolute inset-[-15px] z-0 rounded-[inherit] animate-pulse-slow pointer-events-none",style:{background:`radial-gradient(circle at 50% 50%, ${u.color} 0%, transparent 70%)`,opacity:u.intensity||.8,filter:"blur(10px)",transform:"translateZ(-5px)"}}),t("div",{className:"absolute inset-0 backface-hidden z-20 rounded-[inherit]",style:{transform:`translateZ(${v}px)`},children:t(S,{})}),[1,2].map(L=>t("div",{className:"absolute inset-0 rounded-[inherit] pointer-events-none z-10",style:{background:k,transform:`translateZ(${v-L*.5}px)`,boxShadow:`0 0 1px ${k}`}},`edge-${L}`)),t("div",{className:"absolute inset-0 backface-hidden z-20 rounded-[inherit]",style:{transform:`rotateY(180deg) translateZ(${v}px)`},children:i("div",{className:"w-full h-full rounded-[inherit] overflow-hidden relative bg-[#050303] p-[1px]",children:[t(d.card.BackComponent,{isSmall:e.isSmall}),t("div",{className:"absolute inset-0 bg-black/30 pointer-events-none"})]})})]})},Ce=oe.memo(sn,(e,a)=>e.card.id===a.card.id&&e.isSelected===a.isSelected&&e.isFaceDown===a.isFaceDown&&e.isDisabled===a.isDisabled&&e.isSuggested===a.isSuggested&&e.isWinner===a.isWinner&&e.isInverted===a.isInverted&&e.lanternGlow===a.lanternGlow&&e.style?.transform===a.style?.transform),on="data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.2'/%3E%3C/svg%3E",ln=oe.memo(({player:e,position:a,isActive:r,isBanker:s,isBaiLao:n,statusText:o})=>{const{skin:c}=ke(),{graphicsQuality:l}=At(),u=e.profile,p=u?.avatar_url||`https://api.dicebear.com/9.x/miniavs/svg?seed=${e.name}&backgroundColor=transparent`;let d=c.character.bodyFront;a==="Left"&&(d=c.character.bodySideLeft),a==="Right"&&(d=c.character.bodySideRight);let _=["#8c1c0b","#2b3e5c","#5c4025","#3e2b22"][e.id%4];(a==="Left"||a==="Right")&&(_="#0F0F0F");const f=_e(()=>{const h=u?.gazeDirection||"CENTER";let x="scale(1.05) translateY(2%)";return a==="Left"&&h==="LEFT"||a==="Right"&&h==="RIGHT"?"scaleX(-1) translateY(2%) scale(1.05)":x},[a,u?.gazeDirection]),m=_e(()=>{const h={chairScale:"scale(1.1)",chairY:"0%",chairX:"0%",bodyY:"8%",headScale:1,headX:"50%",headY:"2%",headRotateY:0,headRotateZ:0,lightingGradient:"radial-gradient(circle at 50% 30%, rgba(255,255,255,0.25), rgba(0,0,0,0) 70%)",chinShadow:"linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 25%)"};return a==="Top"?{...h,headY:"-5%",headScale:1.15,lightingGradient:"linear-gradient(to bottom, rgba(255,255,255,0.2), rgba(0,0,0,0.5))"}:a==="Left"?{...h,chairX:"5%",headX:"52%",headY:"0%",headScale:1.08,headRotateY:0,headRotateZ:2,lightingGradient:"linear-gradient(90deg, rgba(0,0,0,0.7) 0%, rgba(255,255,255,0.2) 100%)"}:a==="Right"?{...h,chairX:"-5%",headX:"48%",headY:"0%",headScale:1.08,headRotateY:0,headRotateZ:-2,lightingGradient:"linear-gradient(-90deg, rgba(0,0,0,0.7) 0%, rgba(255,255,255,0.2) 100%)"}:h},[a]),N=h=>h==="赤脚"?"bg-[#5c0b00] border-red-400 text-white shadow-[0_0_8px_rgba(220,38,38,0.6)]":h==="正本"?"bg-[#1c1917] border-stone-400 text-stone-100 shadow-[0_0_8px_rgba(87,83,78,0.6)]":h==="得吊"?"bg-[#064e3b] border-emerald-400 text-emerald-50 shadow-[0_0_8px_rgba(16,185,129,0.6)]":h==="双吊"?"bg-[#065f46] border-[#34d399] text-white shadow-[0_0_10px_rgba(52,211,153,0.8)]":"bg-black/90 border-stone-600",A=a==="Top"?{transform:"rotateY(180deg)"}:void 0;return i("div",{className:`
                relative w-96 h-96 flex items-end justify-center pointer-events-none 
                transition-all duration-700 ease-out select-none
                ${r?"z-50 filter brightness-110 drop-shadow-[0_0_25px_rgba(255,215,0,0.3)]":"opacity-95"}
            `,style:{transformStyle:"preserve-3d",transformOrigin:"bottom center",transform:r?"scale(1.08) translateY(-5px)":"scale(1.0)"},children:[t("svg",{width:"0",height:"0",className:"absolute",children:t("defs",{children:t("clipPath",{id:"head-contour-clip",clipPathUnits:"objectBoundingBox",children:t("path",{d:"M 0.5, 0.02 C 0.85, 0.02, 1.0, 0.25, 1.0, 0.55 C 1.0, 0.75, 0.80, 0.92, 0.5, 0.98 C 0.20, 0.92, 0.0, 0.75, 0.0, 0.55 C 0.0, 0.25, 0.15, 0.02, 0.5, 0.02 Z"})})})}),t("div",{className:"absolute bottom-0 w-[80%] h-[10%] bg-black/80 blur-xl rounded-[100%] transform scale-y-50 -z-10 translate-y-4"}),t("div",{className:"absolute bottom-[2%] z-0 origin-bottom filter brightness-[0.6] contrast-125 saturate-50 drop-shadow-2xl",style:{transform:`translateZ(-20px) ${m.chairScale} translateX(${m.chairX}) translateY(${m.chairY})`,width:"100%",height:"100%"},children:t(c.character.chairComponent,{position:a,quality:l})}),t("div",{className:"absolute z-[5] w-[35%] h-[35%]",style:{left:m.headX,top:m.headY,transform:`translate(-50%, 0) scale(${m.headScale}) rotateY(${m.headRotateY}deg) rotateZ(${m.headRotateZ}deg)`,transformOrigin:"bottom center",transformStyle:"preserve-3d"},children:t("div",{className:"relative w-full h-full group",children:i("div",{className:"w-full h-full relative overflow-hidden bg-[#dcd0b8]",style:{clipPath:"url(#head-contour-clip)",boxShadow:"inset 0 0 20px rgba(0,0,0,0.9)",maskImage:"radial-gradient(circle at center, black 65%, transparent 100%)",WebkitMaskImage:"radial-gradient(circle at center, black 65%, transparent 100%)"},children:[t("img",{src:p,alt:"face",className:"w-full h-full object-cover",style:{filter:"sepia(0.2) contrast(1.15) saturate(1.1) brightness(0.95)",transform:f,imageRendering:"-webkit-optimize-contrast"}}),t("div",{className:"absolute inset-0 z-10 pointer-events-none mix-blend-overlay",style:{background:m.lightingGradient}}),t("div",{className:"absolute inset-0 z-20 pointer-events-none opacity-20 mix-blend-multiply",style:{backgroundImage:`url("${on}")`}}),t("div",{className:"absolute bottom-0 left-0 w-full h-[40%] z-20 pointer-events-none mix-blend-multiply",style:{background:m.chinShadow}})]})})}),i("div",{className:`absolute bottom-3 z-10 w-full h-full flex items-end justify-center ${r&&l==="HIGH"?"animate-breathe-subtle":""}`,style:{transformOrigin:"bottom center",transform:`translateY(${m.bodyY}) translateZ(5px)`},children:[t("div",{className:"absolute bottom-2 w-[70%] h-4 bg-black/90 blur-md rounded-full transform scale-y-50"}),i("div",{className:"relative w-full h-full drop-shadow-[0_20px_35px_rgba(0,0,0,0.9)] filter contrast-[1.15]",children:[t(d,{colorTheme:_,quality:l}),(a==="Left"||a==="Right")&&t("div",{className:"absolute inset-0 z-20 pointer-events-none mix-blend-multiply rounded-[30%]",style:{background:a==="Left"?"linear-gradient(90deg, rgba(0,0,0,0.8) 0%, transparent 40%, rgba(0,0,0,0.4) 100%)":"linear-gradient(-90deg, rgba(0,0,0,0.8) 0%, transparent 40%, rgba(0,0,0,0.4) 100%)"}}),t("div",{className:"absolute top-[20%] w-full flex flex-col items-center justify-center z-40 pointer-events-none",style:{transform:"translateZ(30px) scale(0.35)",transformOrigin:"top center",width:"300%",left:"-100%"},children:i("div",{className:"flex flex-col gap-4 items-center justify-center w-full",style:A,children:[(s||n)&&i("div",{className:"flex gap-6 items-center justify-center",children:[s&&t("div",{className:"w-28 h-28 rounded-full bg-gradient-to-br from-[#aa1d1d] via-[#8c1c0b] to-[#450a0a] border-[6px] border-[#ffd700] shadow-[0_20px_40px_black] flex items-center justify-center text-[#fff] font-serif font-black text-7xl tracking-tighter ring-4 ring-black/40 z-10 animate-pulse-slow-opacity",children:t("span",{className:"drop-shadow-[0_4px_8px_rgba(0,0,0,0.9)] relative -top-1",children:"庄"})}),n&&t("div",{className:"w-28 h-28 rounded-full bg-gradient-to-br from-[#10b981] via-[#047857] to-[#064e3b] border-[6px] border-[#34d399] shadow-[0_20px_40px_black] flex items-center justify-center text-[#ecfdf5] font-serif font-black text-7xl tracking-tighter ring-4 ring-black/40 z-10",children:t("span",{className:"drop-shadow-[0_2px_0_rgba(255,255,255,0.4)] relative -top-1",children:"百"})})]}),o&&o!=="-"&&t("div",{className:`px-8 py-3 rounded-[12px] shadow-[0_15px_30px_rgba(0,0,0,0.9)] border-[4px] backdrop-blur-xl flex items-center h-24 mt-2 ${N(o)}`,children:t("span",{className:"text-6xl font-serif font-black tracking-widest drop-shadow-md whitespace-nowrap",style:{textShadow:"0 4px 8px rgba(0,0,0,0.6)"},children:o})})]})})]})]}),r&&l==="HIGH"&&t("div",{className:"absolute inset-0 -z-10 bg-radial-gradient from-[#ffaa00]/15 to-transparent blur-3xl transform scale-125 translate-y-[-10%] mix-blend-screen animate-pulse-slow-opacity"})]})}),cn=oe.memo(()=>i("div",{className:"absolute inset-0 pointer-events-none z-[100]",children:[t("div",{className:"absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] mix-blend-overlay"}),t("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,transparent_40%,rgba(0,0,0,0.6)_100%)]"}),t("div",{className:"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] bg-orange-500/5 blur-[100px] mix-blend-screen pointer-events-none"})]})),dn=oe.memo(({skinId:e})=>i("div",{className:"absolute top-0 inset-x-0 h-[50vh] pointer-events-none z-[0] overflow-hidden",style:{maskImage:"linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,1) 40%, rgba(0,0,0,0) 100%)",WebkitMaskImage:"linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,1) 40%, rgba(0,0,0,0) 100%)"},children:[t("div",{className:"absolute top-[-20%] left-1/2 -translate-x-1/2 w-[120%] h-[120%] blur-[60px] opacity-60",style:{background:"radial-gradient(circle, rgba(255, 160, 100, 0.5) 0%, transparent 70%)"}}),t("div",{className:"absolute inset-0 opacity-20 mix-blend-overlay",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")`,backgroundSize:"200px 200px"}}),i("div",{className:"absolute inset-0 opacity-30 mix-blend-multiply filter blur-[4px]",children:[t("div",{className:"absolute top-0 right-[10%] w-[4px] h-full bg-black transform rotate-12"}),t("div",{className:"absolute top-[10%] right-[10%] w-[60px] h-[2px] bg-black transform rotate-12"}),t("div",{className:"absolute top-[30%] right-[8%] w-[40px] h-[2px] bg-black transform rotate-45"}),t("div",{className:"absolute top-[-10%] left-[15%] w-[6px] h-full bg-black transform -rotate-6"}),t("div",{className:"absolute top-[20%] left-[12%] w-[80px] h-[3px] bg-black transform -rotate-12"})]}),t("div",{className:"absolute inset-0 opacity-10 mix-blend-multiply",style:{backgroundImage:"linear-gradient(90deg, #000 1px, transparent 1px), linear-gradient(180deg, #000 1px, transparent 1px)",backgroundSize:"60px 100px",transform:"perspective(500px) rotateX(10deg) scale(1.1)"}})]})),un=oe.memo(({skinId:e})=>e==="taoist_mystery"?null:t("div",{className:"absolute top-[-25%] left-1/2 -translate-x-1/2 w-[180%] h-[90%] z-[-10] opacity-30 pointer-events-none flex justify-center perspective-[1000px]",style:{transform:"translateZ(-800px)",transformStyle:"preserve-3d"},children:t("div",{className:"flex w-full h-full",style:{transformStyle:"preserve-3d"},children:[...Array(6)].map((a,r)=>t("div",{className:"flex-1 bg-gradient-to-b from-black to-transparent border-r border-white/5 relative overflow-hidden origin-bottom",style:{transform:`rotateY(${r%2===0?15:-15}deg) scale(1.1)`},children:t("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:"linear-gradient(45deg, transparent 45%, rgba(255,255,255,0.05) 50%, transparent 55%)",backgroundSize:"10px 10px"}})},r))})})),Ut={camera:{rotateX:40,z:-350,perspective:"1400px"},table:{width:"130vh",height:"85vh"},tableY:"55%",isVertical:!1,hidePaperDolls:!1,hidePingFeng:!1,players:{Top:{top:"-38%",left:"50%",scale:.8},Left:{left:"-32%",top:"0%",scale:.8},Right:{right:"-32%",top:"0%",scale:.8},Bottom:{bottom:"10%",left:"50%",scale:1}},cardScale:1.3,pot:{x:500,y:-280,scale:.8},tableCardSpread:{x:180,y:120},cardCenterOffset:{x:0,y:30}},Yt={mobile_portrait:{camera:{rotateX:35,z:-50,perspective:"1000px"},table:{width:"96vw",height:"135vh"},tableY:"81%",isVertical:!0,hidePaperDolls:!0,hidePingFeng:!0,players:{Top:{top:"5%",left:"50%",scale:.7},Left:{left:"2%",top:"28%",scale:.7},Right:{right:"2%",top:"28%",scale:.7},Bottom:{bottom:"0%",left:"50%",scale:.9}},cardScale:.95,pot:{x:-120,y:-260,scale:.9},tableCardSpread:{x:45,y:115},cardCenterOffset:{x:0,y:0}},mobile_landscape:{camera:{rotateX:35,z:-380,perspective:"1100px"},table:{width:"110vw",height:"80vh"},tableY:"58%",isVertical:!1,hidePaperDolls:!1,hidePingFeng:!0,players:{Top:{top:"-45%",left:"50%",scale:.65},Left:{left:"-35%",top:"0%",scale:.65},Right:{right:"-35%",top:"0%",scale:.65},Bottom:{bottom:"5%",left:"50%",scale:.65}},cardScale:1,pot:{x:350,y:-180,scale:.65},tableCardSpread:{x:130,y:80},cardCenterOffset:{x:0,y:10}},tablet_portrait:{camera:{rotateX:45,z:-600,perspective:"1200px"},table:{width:"90vw",height:"70vh"},tableY:"45%",isVertical:!1,hidePaperDolls:!1,hidePingFeng:!1,players:{Top:{top:"-45%",left:"50%",scale:.8},Left:{left:"-25%",top:"0%",scale:.75},Right:{right:"-25%",top:"0%",scale:.75},Bottom:{bottom:"10%",left:"50%",scale:.75}},cardScale:1.1,pot:{x:320,y:-240,scale:.75},tableCardSpread:{x:140,y:100},cardCenterOffset:{x:0,y:20}},desktop:Ut,tablet_landscape:Ut},hn=()=>{const[e,a]=C("desktop");return me(()=>{const r=()=>{const s=window.innerWidth,n=window.innerHeight,o=s/n;return s>=1024&&o>=1.3?a("desktop"):Math.min(s,n)>=600?a(o<1?"tablet_portrait":"tablet_landscape"):a(o<1?"mobile_portrait":"mobile_landscape")};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),e},fn=oe.memo(({label:e,disabled:a,onClick:r,skin:s,isVertical:n})=>{const[o,c]=C(!1),l=n?350:320,u=150;let p="#1a0b05",d="#d4af37",g="#ffdb7a";s.id==="ming_scholar"&&(p="#3d2616",d="#5c3a21",g="#d9c7b0");const _=()=>{a||(c(!0),r(),setTimeout(()=>c(!1),200))};return a?null:t("div",{className:"absolute z-[60]",onClick:_,style:{transform:`translate3d(-50%, ${l}px, ${u}px) rotateX(20deg)`,left:"50%",top:"50%",transformStyle:"preserve-3d",cursor:"pointer",pointerEvents:"auto",transition:"opacity 0.3s"},children:i("div",{className:`relative w-40 h-16 transition-transform duration-100 ease-out ${o?"translate-y-2":"animate-float-slow"}`,style:{transformStyle:"preserve-3d"},children:[i("div",{className:"absolute inset-0 flex items-center justify-center rounded-[4px] transition-all duration-300",style:{background:`linear-gradient(135deg, ${p}, #050202)`,border:`1px solid ${d}`,boxShadow:"0 10px 30px rgba(0,0,0,0.9), inset 0 1px 1px rgba(255,255,255,0.1)",transform:"translateZ(10px)"},children:[t("span",{className:"font-calligraphy text-2xl tracking-[0.4em] select-none drop-shadow-[0_2px_0_rgba(0,0,0,1)]",style:{color:g},children:e}),t("div",{className:"absolute inset-0 bg-gradient-to-tr from-transparent via-white/5 to-transparent pointer-events-none rounded-[3px]"})]}),t("div",{className:"absolute top-0 left-0 w-full h-[15px] origin-top bg-black/80",style:{transform:"rotateX(-90deg)"}}),t("div",{className:"absolute bottom-0 left-0 w-full h-[15px] origin-bottom",style:{background:"#000",transform:"rotateX(90deg)"}}),t("div",{className:"absolute top-0 left-0 w-[15px] h-full origin-left bg-black/90",style:{transform:"rotateY(90deg)"}}),t("div",{className:"absolute top-0 right-0 w-[15px] h-full origin-right bg-black/90",style:{transform:"rotateY(-90deg)"}})]})})}),pn=oe.memo(({skin:e,width:a,height:r,thickness:s=40,visualYOffset:n="0px",children:o})=>{const c={filter:"brightness(0.15)"},l=typeof window<"u"&&window.innerWidth<768;return i("div",{className:"relative w-full h-full group",style:{transformStyle:"preserve-3d"},children:[i("div",{className:"absolute inset-0 pointer-events-none",style:{transform:`translateY(${n})`,transformStyle:"preserve-3d"},children:[i("div",{className:`absolute inset-0 z-0 ${e.layout.tableSurfaceClass}`,style:{transform:`translateZ(${s/2}px)`,transformStyle:l?"flat":"preserve-3d"},children:[t("div",{className:"absolute inset-0 w-full h-full rounded-[inherit]",style:{backgroundColor:e.layout.tableBaseColor||"#1a1a1a"}}),t("div",{className:"absolute inset-0 w-full h-full rounded-[inherit] mix-blend-normal",style:{backgroundImage:e.layout.tableTexture||"none",backgroundSize:e.layout.tableTextureSize||"auto",opacity:1}}),e.layout.EnvironmentalShadows&&t(e.layout.EnvironmentalShadows,{}),e.layout.tableReflectivity&&t("div",{className:"absolute inset-0 w-full h-full rounded-[inherit] mix-blend-overlay opacity-40 pointer-events-none",style:{background:"linear-gradient(120deg, transparent 30%, rgba(255,255,255,0.15) 45%, rgba(255,255,255,0.05) 50%, transparent 60%)",filter:"blur(10px)"}}),t("div",{className:"absolute inset-0 w-full h-full rounded-[inherit] pointer-events-none mix-blend-multiply bg-[radial-gradient(ellipse_at_center,transparent_40%,rgba(0,0,0,0.85)_100%)]"}),t("div",{className:"absolute inset-0 w-full h-full rounded-[inherit] pointer-events-none border border-white/10 shadow-[inset_0_0_20px_rgba(0,0,0,0.5)]"})]}),t("div",{className:`absolute bottom-0 left-0 w-full h-[${s}px] ${e.layout.tableBorderClass}`,style:{...c,height:s,transformOrigin:"bottom",transform:"rotateX(-90deg) translateZ(0px)"}}),t("div",{className:`absolute top-0 right-0 h-full w-[${s}px] ${e.layout.tableBorderClass}`,style:{...c,width:s,transformOrigin:"right",transform:"rotateY(90deg) translateZ(0px)"}}),t("div",{className:`absolute top-0 left-0 h-full w-[${s}px] ${e.layout.tableBorderClass}`,style:{...c,width:s,transformOrigin:"left",transform:"rotateY(-90deg) translateZ(0px)"}}),t("div",{className:`absolute top-0 left-0 w-full h-[${s}px] ${e.layout.tableBorderClass}`,style:{...c,height:s,transformOrigin:"top",transform:"rotateX(90deg) translateZ(0px)"}}),t("div",{className:"absolute inset-4 bg-black blur-[80px] opacity-90 rounded-[50%]",style:{transform:`translateZ(-${s*3}px) scale(0.9)`}})]}),t("div",{className:"absolute inset-0 z-20 pointer-events-none",style:{transform:`translateZ(${s/2}px)`,transformStyle:"preserve-3d"},children:o})]})}),mn=e=>{if(!e.trickPile)return"-";const a=e.trickPile.filter(r=>r.round<=8&&!r.isKaiChong&&r.isFaceUp).length;return a<2?"赤脚":a===2?"正本":a===3?"得吊":"双吊"},gn=e=>e.isDealer?{color:"#ef4444",secondaryColor:"#b91c1c",intensity:.9}:e.isBaiLaoRevealed?{color:"#10b981",secondaryColor:"#047857",intensity:.9}:e.isSuspectedBaiLao?{color:"#f59e0b",secondaryColor:"#b45309",intensity:.7}:null,Kt=(e,a)=>e===a,bn=oe.memo(({card:e,playerPos:a,spread:r,centerOffset:s,isFaceDown:n,isWinner:o,isMobilePortrait:c})=>{const l=_e(()=>o?"animate-card-smash":n?"animate-card-wither":"animate-fade-in",[o,n]),[u,p]=C({transform:"translate(-50%, -50%)",opacity:0});return me(()=>{let d=0,g=0;const{x:_,y:f}=r,{x:m,y:N}=s;a==="Bottom"?(d=0,g=f):a==="Top"?(d=0,g=-f):a==="Left"?(d=-_,g=0):a==="Right"&&(d=_,g=0),d+=m,g+=N;const A=o?80:35,h=requestAnimationFrame(()=>{p({transform:`translate(-50%, -50%) translate(${d}px, ${g}px) translateZ(${A}px) rotateX(-25deg)`,opacity:1,transition:"transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.3s ease-out"})});return()=>cancelAnimationFrame(h)},[a,r,s,o,c]),t("div",{className:"absolute left-1/2 top-1/2 w-16 h-24",style:{...u,transformStyle:"preserve-3d"},children:i("div",{className:`w-full h-full ${l}`,style:{transformStyle:"preserve-3d"},children:[t(Ce,{card:e,isTrick:!0,isFaceDown:n,isWinner:o,isSmall:!1}),o&&t("div",{className:"absolute inset-[-50%] bg-white mix-blend-overlay animate-slash pointer-events-none z-50"})]})})},(e,a)=>e.card.id===a.card.id&&e.isWinner===a.isWinner&&e.isFaceDown===a.isFaceDown&&e.playerPos===a.playerPos),_n=oe.memo(({cards:e,winnerId:a,layoutConfig:r,players:s})=>!e||e.length===0?null:t("div",{style:{position:"absolute",inset:0,pointerEvents:"none",transformStyle:"preserve-3d",zIndex:10},children:e.map(n=>{const c=s.find(u=>u.id===n.playerId)?.position||"Bottom",l=a===n.playerId;return t(bn,{card:n.card,playerPos:c,spread:r.tableCardSpread,centerOffset:r.cardCenterOffset,isFaceDown:n.isFaceDown,isWinner:l,isMobilePortrait:r.isVertical},`${n.card.id}-${n.playerId}`)})}),(e,a)=>{if(e.winnerId!==a.winnerId||e.cards.length!==a.cards.length)return!1;for(let r=0;r<e.cards.length;r++)if(e.cards[r].card.id!==a.cards[r].card.id)return!1;return!0}),xn=oe.memo(({count:e,baseRotation:a=0,scale:r=1,alignLeft:s=!1,alignRight:n=!1,skin:o})=>e<=0?null:i("div",{style:{position:"relative",width:`${64*r}px`,height:`${96*r}px`,transformStyle:"preserve-3d"},children:[[...Array(Math.min(e,3))].map((c,l)=>{let u=-l;return s&&(u=l*2),n&&(u=-l*2),i("div",{className:"absolute inset-0 shadow-sm rounded-[3px] border-white/10",style:{transform:`translateZ(${l*1}px) translate(${u}px, -${l}px)`},children:[t(o.card.BackComponent,{isSmall:!0}),t("div",{className:"absolute inset-0 bg-black/40 animate-pulse-slow pointer-events-none rounded-[inherit] border border-white/10 shadow-[inset_0_0_10px_rgba(0,0,0,0.8)]"})]},l)}),t("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",style:{transform:`translateZ(${Math.min(e,3)*1+2}px) translate(${s?Math.min(e,3)*2:-Math.min(e,3)*2}px, -${Math.min(e,3)}px)`},children:t("div",{className:"text-[#e6c278] font-serif font-bold text-lg drop-shadow-md bg-black/50 px-2 rounded-full border border-[#5c4025]",children:e})})]})),vn=oe.memo(({cards:e,baseRotation:a=0,scale:r=.5,potCardIds:s,lanternGlow:n,playerId:o,forceVerticalLayout:c=!1,align:l="center",isVertical:u=!1,isFramed:p=!1,hideBackground:d=!1,hideLabel:g=!1})=>{if(!e||e.length===0)return null;const _=8,f=4*r,m=64*r,N=96*r,A=c||a===90||a===-90,h=A?N*Math.ceil(e.length/_):m*Math.min(e.length,_),x=A?m*Math.min(e.length,_):N*Math.ceil(e.length/_),w=8*r,y=h+w*2,v=x+w*2;let k=-h/2;l==="left"&&(k=0),l==="right"&&(k=-h);const T=-x/2,P=u?0:o===2?180:0;return i("div",{style:{position:"relative",width:0,height:0,transformStyle:"preserve-3d"},children:[!d&&t("div",{className:"absolute rounded-[8px]",style:{width:y,height:v,left:k-w,top:T-w,transform:"translateZ(-2px)",background:"rgba(0, 0, 0, 0.25)",boxShadow:"inset 0 0 15px rgba(0,0,0,0.6)"}}),e.map((S,L)=>{let I=L%_,B=Math.floor(L/_),ce=I*(m+f),be=B*(N+f);A&&(ce=B*(N+f),be=I*(m+f));const le=ce+m/2+k,G=be+N/2+T,re=S.rank===E.ZUN||S.rank===E.BAI||S.rank===E.JIAN||S.isPot?n:null;return i("div",{className:"absolute w-16 h-24 transition-transform duration-500",style:{left:0,top:0,marginLeft:-32*r,marginTop:-48*r,transform:`translate(${le}px, ${G}px) translateZ(${L*.05}px) rotateZ(${a}deg) scale(${r*.9})`,filter:"brightness(0.65)"},children:[t("div",{className:"absolute inset-0 rounded-[4px] shadow-[inset_0_0_8px_rgba(0,0,0,0.8)] z-50 pointer-events-none"}),t(Ce,{card:S,isSmall:!1,isTrick:!1,isFaceDown:!1,isInverted:S.isPot||s?.has(S.id),textRotation:P,className:"border-black/50",lanternGlow:re,isLocked:!0})]},S.id)})]})},(e,a)=>e.cards.length===a.cards.length&&e.scale===a.scale),wn=oe.memo(({player:e,position:a,isMyTurn:r,potCardIds:s,layoutConfig:n,showPaperDolls:o})=>{const{skin:c}=ke(),l=e.type==="HUMAN",u=n.players[a];if(!u)return null;let p=0,d={},g={},_=!1,f="center",m=!1,N=!1;if(a==="Top"?(p=180,d={top:"5%",left:"50%",transform:"translateX(-50%)"},g={top:"25%",left:"50%",transform:"translateX(-50%)"}):a==="Left"?(p=90,d={left:"5%",top:"50%",transform:"translateY(-50%)"},g={left:"20%",top:"50%",transform:"translateY(-50%)"}):a==="Right"?(p=-90,d={right:"5%",top:"50%",transform:"translateY(-50%)"},g={right:"20%",top:"50%",transform:"translateY(-50%)"}):a==="Bottom"&&(p=0,g={bottom:"25%",left:"50%",transform:"translateX(-50%)"}),n.isVertical){if(a==="Left"||a==="Right"){p=0,_=!0;const y=e.capturedCards.length;let v=n.cardScale;y>5&&(v*=.85),y>8&&(v*=.85);const k=Math.min(y,8)*1,T=42,P=58,S=`${T-k}%`,L=`${P-k}%`;a==="Left"?(f="left",d={left:"3%",top:S,transform:"translate(0, -50%)"},g={left:"3%",top:L,transform:"translate(0, -50%)"}):(f="right",d={right:"3%",top:S,transform:"translate(0, -50%)"},g={right:"-5%",top:L,transform:"translate(0, -50%)"}),n.tempWonScale=v}else if(a==="Top")p=0,d={top:"3%",left:"50%",transform:"translateX(-50%)"},g={top:"23%",left:"50%",transform:"translateX(-50%)",zIndex:10};else if(a==="Bottom"){const k=e.capturedCards.length>10?n.cardScale*.75:n.cardScale;n.tempWonScale=k,g={bottom:"19%",left:"50%",transform:"translateX(-50%)",zIndex:10},m=!0,N=!0}}const A=gn(e),h=n.tempWonScale||n.cardScale,x={position:"absolute",top:u.top,left:u.left,right:u.right,bottom:u.bottom,transform:`translate(${a==="Top"||a==="Left"?"-50%":"50%"}, -50%) rotateX(-45deg) rotateY(${a==="Top"?180:a==="Left"?-20:20}deg) scale(${u.scale})`,zIndex:0};n.isVertical&&(a==="Left"||a==="Right")&&(x.transform=`translateY(-50%) rotateX(-45deg) rotateY(${a==="Left"?-15:15}deg) scale(${u.scale})`);const w=a==="Bottom"?"pointer-events-none":"pointer-events-auto";return i("div",{className:"absolute inset-0 pointer-events-none z-[20]",style:{transformStyle:"preserve-3d"},children:[!l&&!n.hidePaperDolls&&o&&t("div",{style:x,className:"pointer-events-auto origin-bottom",children:t(ln,{player:e,position:a,isActive:r,isBanker:e.isDealer,isBaiLao:e.isBaiLaoRevealed,statusText:mn(e)})}),!l&&t("div",{className:"absolute pointer-events-auto transition-all duration-500",style:{...d,zIndex:30},children:t(xn,{count:e.hand.length,baseRotation:p,scale:n.cardScale,alignLeft:f==="left",alignRight:f==="right",skin:c})}),e.capturedCards?.length>0&&t("div",{className:`absolute ${w} transition-all duration-500 opacity-90`,style:{...g},children:t(vn,{cards:e.capturedCards,baseRotation:p,scale:h,potCardIds:s,lanternGlow:A,playerId:e.id,forceVerticalLayout:_,align:f,isVertical:n.isVertical,isFramed:!0,hideBackground:m,hideLabel:N})})]})},(e,a)=>{const r=e.player,s=a.player;return!(r.id!==s.id||e.isMyTurn!==a.isMyTurn||r.hand.length!==s.hand.length||r.capturedCards.length!==s.capturedCards.length||r.isBaiLaoRevealed!==s.isBaiLaoRevealed||r.isDealer!==s.isDealer||e.showPaperDolls!==a.showPaperDolls||e.layoutConfig.isVertical!==a.layoutConfig.isVertical)}),yn=oe.memo(({pot:e,phase:a,kaiChongCardIndex:r,layoutConfig:s,lastGameEvent:n,kaiChongHistory:o})=>{if(a!==ie.KAI_CHONG)return null;const c=a===ie.KAI_CHONG,l=e,u=s.isVertical;let p=s.pot.scale;u&&(p=.75);const d=(_,f)=>c&&f===r-1&&n?.type==="KAI_CHONG_SUCCESS"?_.color===O.GREEN?{color:"#22c55e",secondaryColor:"#4ade80",intensity:1.5}:_.color===O.RED?{color:"#ef4444",secondaryColor:"#f59e0b",intensity:1.5}:{color:"#60a5fa",secondaryColor:"#93c5fd",intensity:1.5}:null;let g=0;return t("div",{style:{position:"absolute",inset:0,pointerEvents:"none",transformStyle:"preserve-3d",zIndex:5},children:l.map((_,f)=>{const m=f<r,N=f===r,A=f>r,h=o?.some(L=>L.matchedCard.id===_.id);let x=0,w=0,y=0,v=p,k=f*2;if(c){if(m&&!h)x=0,w=-150+g*30,y=90+(Math.random()*4-2),v=p*.9,k=20+g,g++;else if(u){const L=50*p,I=-200;x=Math.sin(f*.6)*30,w=I+f*L,y=f*8}else w=-120+f*40,y=0;if(h&&n?.type==="KAI_CHONG_SUCCESS"){const L=n.playerId;if(Kt(f,r-1))L===0?(w+=600,y+=10):L===1?(x+=600,y+=90):L===2?(w-=600,y-=10):L===3&&(x-=600,y-=90),v=p*.8,k=200;else if(f<r-1)return null}else N&&(k=50,v=p*1.1)}const T=A,P=d(_,f),S=h&&n?.type==="KAI_CHONG_SUCCESS"&&Kt(f,r-1)?{transition:"transform 0.4s cubic-bezier(0.5, 0, 0.2, 1), opacity 0.4s ease-in"}:{transition:"all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1)"};return t("div",{className:`absolute left-1/2 top-1/2 w-16 h-24 ${N?"animate-breathe-subtle":""}`,style:{transform:`translate(-50%, -50%) translate(${x}px, ${w}px) rotate(${y}deg) scale(${v}) translateZ(${k}px)`,...S},children:t(Ce,{card:_,isFaceDown:T,isSmall:!1,isInverted:!0,lanternGlow:P})},_.id)})})},(e,a)=>!(e.phase!==a.phase||e.kaiChongCardIndex!==a.kaiChongCardIndex||e.lastGameEvent!==a.lastGameEvent||e.layoutConfig.isVertical!==a.layoutConfig.isVertical)),Nn=oe.memo(({state:e,interactionState:a})=>{const{skin:r}=ke(),s=hn(),n=Yt[s]||Yt.desktop,{graphicsQuality:o,showPaperDolls:c}=At(),{phase:l,currentPlayerIndex:u,trickWinnerId:p,tableCards:d,players:g,bankerId:_,pot:f,mianZhangCard:m,gameMessage:N,violationNotification:A,kaiChongCardIndex:h,kaiChongHistory:x,lastGameEvent:w}=e,y=_e(()=>d?d.map(k=>k.playerId):[],[d]);return i("div",{className:"absolute inset-0 w-full h-full overflow-hidden select-none bg-[#020101]",children:[t(r.layout.atmosphereComponent,{quality:o}),n.isVertical&&t(dn,{skinId:r.id}),t(cn,{}),t("div",{className:"w-full h-full perspective-container",style:{perspective:n.camera.perspective},children:t("div",{className:"world-3d w-full h-full relative preserve-3d transition-transform duration-1000 ease-out",style:{transform:`rotateX(${n.camera.rotateX}deg) translateY(-50%) translateZ(${n.camera.z}px)`,transformStyle:"preserve-3d"},children:i("div",{className:"absolute left-1/2 -translate-x-1/2 -translate-y-1/2 preserve-3d transition-all duration-1000",style:{top:n.tableY,width:n.table.width,height:n.table.height,transformStyle:"preserve-3d"},children:[!n.hidePingFeng&&t(un,{skinId:r.id}),i(pn,{skin:r,width:n.table.width,height:n.table.height,visualYOffset:"0px",children:[t("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-[10]",style:{transform:"translateY(0%) translateZ(1px)"},children:i("div",{className:"w-full max-w-[800px] relative opacity-90 transition-all duration-700",style:{aspectRatio:n.isVertical?"3/4":"2/1"},children:[t(Mr,{activePlayerId:u,bankerId:_,revealedBaiLaoId:g.find(k=>k.isBaiLaoRevealed)?.id??null,suspectedBaiLaoId:g.find(k=>k.isSuspectedBaiLao)?.id??null,hasTableCards:d?.length>0,playedPlayerIds:y,phase:l,isVertical:n.isVertical}),t(r.lighting.TableBorderFlow,{activePlayerId:u,isVertical:n.isVertical})]})}),l!==ie.DEALING&&i(yt,{children:[g.map(k=>{const T=x.filter(S=>S.playerId===k.id),P=new Set(T.map(S=>S.matchedCard.id));return t(wn,{player:k,position:k.position,isMyTurn:u===k.id,potCardIds:P,layoutConfig:n,quality:o,showPaperDolls:c},k.id)}),t(yn,{pot:f,phase:l,kaiChongCardIndex:h,layoutConfig:n,lastGameEvent:w,kaiChongHistory:x}),t(_n,{cards:d,winnerId:p,layoutConfig:n,players:g})]}),t(r.lighting.StoveLighting,{activePlayerId:u,spotlightPos:l===ie.KAI_CHONG?{x:`${50+(h-3)*8}%`,y:"50%"}:null}),a&&!n.isVertical&&t(fn,{label:a.label,disabled:a.disabled,onClick:a.onActionClick,skin:r,isVertical:n.isVertical}),N&&i("div",{className:"absolute top-[32%] left-1/2 z-[1000] flex items-center justify-center pointer-events-none",style:{transform:"translate(-50%, -50%) translateZ(120px) rotateX(-45deg)",width:"100%",textAlign:"center"},children:[" ",t("div",{className:"text-[#e6c278] font-calligraphy text-3xl md:text-4xl drop-shadow-[0_5px_15px_rgba(0,0,0,1)] bg-[#0f0a08]/90 px-10 py-4 rounded-sm border-y-2 border-[#8c6239] backdrop-blur-xl animate-fade-in-up tracking-[0.3em] shadow-lg",children:N})," "]}),A&&i("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[200]",style:{transform:"translateZ(200px) rotateX(-45deg)"},children:[" ",i("div",{className:"bg-[#1a0505]/95 border-4 border-[#8c1c0b] p-10 text-center shadow-[0_0_150px_rgba(255,0,0,0.6)] rounded-sm animate-shake backdrop-blur-md",children:[" ",t("h3",{className:"text-4xl text-[#ff4d4d] font-bold uppercase mb-4 tracking-[0.3em] drop-shadow-md",children:A.title})," ",t("p",{className:"text-[#e8e4d9] text-xl font-serif leading-relaxed",children:A.message})," "]})," "]})]})]})})})]})},(e,a)=>!(e.state.phase!==a.state.phase||e.state.currentPlayerIndex!==a.state.currentPlayerIndex||e.state.tableCards!==a.state.tableCards||e.state.players!==a.state.players)),ma=e=>{if(!e||!Array.isArray(e))return{text:"-",color:"bg-black/40",textColor:"text-white/40"};const a=e.filter(r=>r.round<=8&&!r.isKaiChong&&r.isFaceUp).length;return a<2?{text:"赤脚",color:"bg-red-900/90",textColor:"text-red-100"}:a===2?{text:"正本",color:"bg-stone-800/90",textColor:"text-stone-300"}:a===3?{text:"得吊",color:"bg-emerald-900/90",textColor:"text-emerald-200"}:{text:"双吊",color:"bg-emerald-600/90",textColor:"text-white"}},ga=e=>e?e.length>5?e.substring(0,4)+".":e:"Player",vt="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23333'/%3E%3Ccircle cx='50' cy='40' r='20' fill='%23666'/%3E%3Cpath d='M20 90 Q50 60 80 90' fill='%23666'/%3E%3C/svg%3E",kn=oe.memo(({players:e,bankerId:a,currentPlayerIndex:r,aiChatMessages:s})=>{const{skin:n}=ke(),o=e.filter(c=>c.type!==fe.HUMAN);return t("div",{className:"fixed inset-0 pointer-events-none z-[200]",children:o.map(c=>{const l=e[r]?.id===c.id,u=c.id===a,p=c.isBaiLaoRevealed||c.isSuspectedBaiLao,d=c.profile,g=d?.avatar_url||`https://api.dicebear.com/9.x/miniavs/svg?seed=${c.name}&backgroundColor=transparent`,_=ma(c.trickPile),f=s[c.id];let m="hidden";return c.position==="Top"?m="top-[2%] landscape:top-[2%] left-1/2 -translate-x-1/2":c.position==="Left"?m="top-[28%] left-[2%] landscape:top-[35%] landscape:left-[1%]":c.position==="Right"&&(m="top-[28%] right-[2%] landscape:top-[35%] landscape:right-[1%]"),i("div",{className:`absolute flex flex-col items-center pointer-events-auto transition-all duration-500 ${m}`,children:[i("div",{className:`overflow-hidden ${n.hud.avatarContainerClass(l)} relative group`,children:[t("img",{src:g,className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700",alt:c.name,onError:N=>{N.target.src=vt}}),t("div",{className:"absolute inset-0 bg-gradient-to-b from-black/30 via-transparent to-black/90 pointer-events-none"}),t("div",{className:"absolute top-1 left-1 z-10",children:t("span",{className:"text-[8px] md:text-[10px] font-mono text-[#e6c278] bg-black/60 px-1.5 rounded-[2px] border border-[#3e2b22] backdrop-blur-[2px] shadow-sm",children:c.hand.length})}),i("div",{className:"absolute top-1 right-1 flex flex-col gap-0.5 items-end z-10",children:[u&&t("div",{className:"w-3.5 h-3.5 md:w-4 md:h-4 bg-[#8c1c0b] text-[#e8e4d9] rounded-full flex items-center justify-center text-[8px] md:text-[9px] font-bold border border-[#b8860b] shadow-md leading-none",children:"庄"}),p&&t("div",{className:"w-3.5 h-3.5 md:w-4 md:h-4 bg-[#047857] text-[#e8e4d9] rounded-full flex items-center justify-center text-[8px] md:text-[9px] font-bold border border-[#34d399] shadow-md leading-none",children:"百"})]}),i("div",{className:"absolute bottom-0 inset-x-0 flex flex-col z-10",children:[t("div",{className:"text-[8px] md:text-[10px] text-center text-[#e8e4d9] font-bold drop-shadow-[0_1px_2px_rgba(0,0,0,1)] truncate px-1 pb-[1px]",children:ga(d?.username||c.name)}),t("div",{className:`h-3.5 md:h-4 w-full flex items-center justify-center ${_.color} backdrop-blur-sm`,children:t("span",{className:`text-[7px] md:text-[9px] font-serif font-bold ${_.textColor} scale-90`,children:_.text})})]})]}),f&&t("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-28 md:w-36 z-[300] animate-fade-in-up",children:i("div",{className:"bg-[#e8e4d9]/95 text-[#1a0505] p-2 rounded-sm text-[9px] md:text-[11px] font-serif shadow-xl border border-[#c5a059] text-center relative leading-tight",children:[t("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-[#e8e4d9] transform rotate-45 border-l border-t border-[#c5a059]"}),f]})})]},c.id)})})}),Cn=oe.memo(({player:e,isMyTurn:a,onCardClick:r,onDragPlay:s,onPlayConfirm:n,selectedCardId:o,highlightedCardIds:c,cardMarkers:l,oneClickPlay:u,canInteract:p,actionLabel:d,mianZhangCard:g})=>{const{skin:_}=ke(),f=Qe(null),[m,N]=C(null),[A,h]=C(null),[x,w]=C(null),[y,v]=C(typeof window<"u"?window.innerWidth:375),[k,T]=C(typeof window<"u"?window.innerHeight>window.innerWidth:!0);if(me(()=>{const D=()=>{v(window.innerWidth),T(window.innerHeight>window.innerWidth)};return window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]),!e||e.type!==fe.HUMAN)return null;const S=e.profile?.avatar_url||"https://api.dicebear.com/9.x/miniavs/svg?seed=Me&backgroundColor=transparent",L=ma(e.trickPile),I=e.isDealer,B=e.isBaiLaoRevealed||e.isSuspectedBaiLao,ce=Xt(D=>{p&&(u?n(D):r(D))},[p,u,n,r]),be=()=>{if(p)if(o)n(o);else if(c&&c.size>0){const D=Array.from(c)[0];n(D)}else e.hand.length>0&&n(e.hand[0].id)},le=(D,q,H)=>{p&&(f.current={id:H,startX:D,startY:q,currentX:D,currentY:q},N(H),h({x:0,y:0}))};me(()=>{const D=H=>{if(!f.current)return;const de="touches"in H?H.touches[0].clientX:H.clientX,he="touches"in H?H.touches[0].clientY:H.clientY;f.current.currentX=de,f.current.currentY=he,h({x:de-f.current.startX,y:he-f.current.startY})},q=()=>{if(f.current){const{id:H,startY:de,currentY:he,startX:ne,currentX:He}=f.current;he-de<-80?s(H):Math.abs(He-ne)<10&&Math.abs(he-de)<10&&ce(H),f.current=null,N(null),h(null)}};return window.addEventListener("mousemove",D),window.addEventListener("touchmove",D,{passive:!1}),window.addEventListener("mouseup",q),window.addEventListener("touchend",q),()=>{window.removeEventListener("mousemove",D),window.removeEventListener("touchmove",D),window.removeEventListener("mouseup",q),window.removeEventListener("touchend",q)}},[ce,s]);const G=e.hand.length,R=y<768,re=R?5.8:7.5,ve=re*16,Ee=y-(R?2:100),Le=D=>{if(R){let q=0;const H=G*ve;if(H<=Ee)q=-((H+(G-1)*5)/2)+ve/2+D*(ve+5);else{const de=(Ee-ve)/(G-1);q=-(Ee/2)+ve/2+D*de}return{x:q,y:0,rot:0,scale:1,zIndex:100+D,width:`${re}rem`,marginLeft:`-${re/2}rem`,bottom:"10px",transformOrigin:"center bottom"}}else{let de=Math.min(40,G*5);const he=-de/2,ne=G>1?de/(G-1):0;return{x:0,y:0,rot:he+D*ne,scale:1,zIndex:100+D,width:"7.5rem",marginLeft:"-3.75rem",bottom:"30px",transformOrigin:"50% 800px"}}},Be=()=>{const D=p;return t("div",{className:"absolute bottom-[15%] left-1/2 -translate-x-1/2 z-[90] transition-all duration-500 ease-out flex items-center justify-center",onClick:D?be:void 0,children:i("div",{className:`flex items-center gap-6 px-6 py-2 rounded-full transition-all duration-500 backdrop-blur-md border shadow-lg min-w-[240px] justify-between relative overflow-hidden ${D?"bg-gradient-to-r from-[#3e2b22] to-[#1a0b05] border-[#d4af37] cursor-pointer animate-pulse-slow ring-1 ring-[#d4af37]/50 shadow-[0_0_15px_rgba(212,175,55,0.3)] transform scale-110":"bg-[#0a0605]/80 border-[#3e2b22] shadow-[inset_0_1px_4px_rgba(0,0,0,0.8)] grayscale-[0.3]"}`,children:[t("div",{className:`relative w-8 h-8 rounded-full border-2 ${D?"border-[#ffdb7a] ring-2 ring-[#5c4025]":"border-[#5c4025]"} overflow-hidden shrink-0 transition-colors duration-500`,children:t("img",{src:S,className:"w-full h-full object-cover",alt:"Me",onError:he=>{he.target.src=vt}})}),t("div",{className:`absolute left-[3.5rem] top-1/2 -translate-y-1/2 w-[1px] h-6 ${D?"bg-[#ffdb7a]/50":"bg-[#3e2b22]"}`}),t("div",{className:"flex items-center flex-1 justify-center transition-all duration-300 pl-4",children:D?t("span",{className:"text-[#ffdb7a] font-calligraphy text-2xl font-bold tracking-widest drop-shadow-md whitespace-nowrap px-2",children:d||"出牌"}):i("div",{className:"flex items-center gap-3 px-1",children:[t("div",{className:"text-[10px] text-[#8c6239] font-serif font-bold tracking-wider uppercase",children:I?"Banker":B?"Million":"Wait"}),t("div",{className:"w-[1px] h-3 bg-[#3e2b22]"}),t("div",{className:`text-[10px] font-mono font-bold ${e.score>=0?"text-[#4ade80]":"text-[#ff6b6b]"}`,children:e.score})]})})]})})};return i("div",{className:"fixed inset-0 pointer-events-none z-[100] perspective-container overflow-visible",style:{perspective:"1200px"},children:[g&&t("div",{className:"absolute top-[2%] left-4 z-[200] flex flex-col items-center gap-1 animate-fade-in pointer-events-auto",children:i("div",{className:"relative w-8 h-12",children:[[...Array(7)].map((D,q)=>t("div",{className:"absolute inset-0 border border-[#3e2b22] bg-[#0a0505] rounded-[2px]",style:{transform:`translate(${q*2}px, ${q*2}px)`,zIndex:-q}},q)),t("div",{className:"absolute inset-0 transform scale-75 origin-top-left z-10",style:{transform:"translate(4px, 4px)"},children:t(Ce,{card:g,isSmall:!0,isInverted:!0,isFaceDown:!1})})]})}),R&&k?t(Be,{}):i("div",{className:"absolute bottom-[40px] right-[5%] pointer-events-auto flex flex-col items-center z-[150] animate-fade-in-up",children:[i("div",{className:`overflow-hidden ${_.hud.avatarContainerClass(a)} relative group`,children:[t("img",{src:S,className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700",alt:"Me",onError:D=>{D.target.src=vt}}),t("div",{className:"absolute inset-0 bg-gradient-to-b from-black/30 via-transparent to-black/90 pointer-events-none"}),i("div",{className:"absolute top-1 right-1 flex flex-col gap-0.5 items-end z-10",children:[I&&t("div",{className:"w-3.5 h-3.5 md:w-4 md:h-4 bg-[#8c1c0b] text-[#e8e4d9] rounded-full flex items-center justify-center text-[8px] md:text-[9px] font-bold border border-[#b8860b] shadow-sm leading-none",children:"庄"}),B&&t("div",{className:"w-3.5 h-3.5 md:w-4 md:h-4 bg-[#047857] text-[#e8e4d9] rounded-full flex items-center justify-center text-[8px] md:text-[9px] font-bold border border-[#34d399] shadow-sm leading-none",children:"百"})]}),i("div",{className:"absolute bottom-0 inset-x-0 flex flex-col z-10",children:[t("div",{className:"text-[8px] md:text-[10px] text-center text-[#e8e4d9] font-bold drop-shadow-[0_1px_2px_rgba(0,0,0,0.1)] truncate px-1 pb-[1px]",children:ga("You")}),t("div",{className:`h-3.5 md:h-4 w-full flex items-center justify-center ${L.color} backdrop-blur-sm`,children:t("span",{className:`text-[7px] md:text-[9px] font-serif font-bold ${L.textColor} scale-90`,children:L.text})})]})]}),t("div",{className:`mt-1 text-lg font-bold font-serif ${e.score>=0?"text-[#4ade80]":"text-[#ff6b6b]"} drop-shadow-md bg-black/60 px-2 rounded-full border border-white/10`,children:e.score})]}),i("div",{className:"absolute left-1/2 w-full flex justify-center items-end pointer-events-none",style:{transformStyle:"preserve-3d",transform:"translateX(-50%)",bottom:"0px",height:"0px",zIndex:200},children:[e.hand.map((D,q)=>{const H=Le(q);if(m===D.id)return null;const he=R?{position:"absolute",left:"50%",bottom:H.bottom,width:H.width,marginLeft:H.marginLeft,transform:`translate3d(${H.x}px, ${H.y}px, ${q}px)`,zIndex:300}:{position:"absolute",left:"50%",bottom:H.bottom,width:H.width,marginLeft:H.marginLeft,transformOrigin:H.transformOrigin,transform:`rotateZ(${H.rot}deg) translateZ(${q}px)`,zIndex:300};return t("div",{className:"pointer-events-auto opacity-0 cursor-pointer",style:{...he,height:R?"8rem":"10rem"},onMouseDown:ne=>le(ne.clientX,ne.clientY,D.id),onTouchStart:ne=>le(ne.touches[0].clientX,ne.touches[0].clientY,D.id),onMouseEnter:()=>w(D.id),onMouseLeave:()=>w(null)},`hit-${D.id}`)}),e.hand.map((D,q)=>{const H=Le(q),de=m===D.id,he=x===D.id,ne=p&&(o===D.id||he),He=c&&c.has(D.id),Re=l?l[D.id]:{isMature:!1,isForbidden:!1};let $e={};if(de&&A)$e={position:"absolute",left:"50%",bottom:R?"100px":"150px",transform:`translate(${A.x}px, ${A.y}px) scale(1.1) rotateZ(0deg)`,width:R?"5.5rem":"7.5rem",transformOrigin:"center center",zIndex:1e3};else if(R){const Oe=ne?-30:0,je=ne?50:0,We=ne?1.15:1;$e={position:"absolute",left:"50%",bottom:H.bottom,marginLeft:H.marginLeft,width:H.width,transformOrigin:"center bottom",transform:`translate3d(${H.x}px, ${H.y+Oe}px, ${q+je}px) scale(${We})`,zIndex:ne?200:H.zIndex,transition:"transform 0.1s cubic-bezier(0.2, 0.8, 0.2, 1)"}}else{let Oe=0,je=0,We=1;const Se=H.rot;ne&&(Oe=-30,je=50,We=1.15),$e={position:"absolute",left:"50%",bottom:H.bottom,marginLeft:H.marginLeft,width:H.width,transformOrigin:H.transformOrigin,transform:`rotateZ(${Se}deg) translateY(${Oe}px) translateZ(${q+je}px) scale(${We})`,zIndex:ne?200:H.zIndex,transition:"transform 0.1s cubic-bezier(0.2, 0.8, 0.2, 1)"}}return t("div",{className:"pointer-events-none",style:$e,children:t("div",{className:"w-full h-full rounded-[4px]",children:t(Ce,{card:D,isHand:!0,isDisabled:!1,isSelected:ne,suitStatus:Re.isMature?"SAFE":Re.isForbidden?"FORBIDDEN":"NEUTRAL",isDraggable:!1,isSuggested:He,isSuspectedBaiLao:e.isSuspectedBaiLao,isBaiLao:!1,isBanker:!1,isFaceDown:!1})})},`vis-${D.id}`)})]})]})}),ba=({className:e="",size:a=200,id:r})=>{const s=_e(()=>Math.random().toString(36).substr(2,9),[]);return t("div",{id:r,className:`relative overflow-hidden rounded-[22%] shadow-2xl ${e}`,style:{width:a,height:a},children:i("svg",{viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg",className:"w-full h-full",preserveAspectRatio:"xMidYMid slice",children:[i("defs",{children:[i("filter",{id:`ancientRubbing-${s}`,children:[t("feMorphology",{operator:"dilate",radius:"1.5",in:"SourceAlpha",result:"thick"}),t("feTurbulence",{type:"fractalNoise",baseFrequency:"0.8",numOctaves:"3",result:"noise"}),t("feComposite",{operator:"in",in:"noise",in2:"thick",result:"texturedText"}),t("feComposite",{operator:"in",in:"SourceGraphic",in2:"thick"}),t("feGaussianBlur",{stdDeviation:"0.3"})]}),i("filter",{id:`crispVeins-${s}`,children:[t("feTurbulence",{type:"fractalNoise",baseFrequency:"0.015",numOctaves:"5",result:"noise"}),t("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"5"}),t("feComposite",{operator:"in",in2:"SourceGraphic"})]}),i("filter",{id:`moonGlow-${s}`,children:[t("feGaussianBlur",{stdDeviation:"2.5",result:"coloredBlur"}),i("feMerge",{children:[t("feMergeNode",{in:"coloredBlur"}),t("feMergeNode",{in:"SourceGraphic"})]})]}),i("filter",{id:`nightGrain-${s}`,children:[t("feTurbulence",{type:"fractalNoise",baseFrequency:"0.9",numOctaves:"3",result:"noise"}),t("feColorMatrix",{type:"matrix",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.08 0"}),t("feComposite",{operator:"in",in2:"SourceGraphic"})]}),i("radialGradient",{id:`nightGrad-${s}`,cx:"50%",cy:"30%",r:"90%",fx:"50%",fy:"30%",children:[t("stop",{offset:"0%",stopColor:"#1a1e24"}),t("stop",{offset:"60%",stopColor:"#08090c"}),t("stop",{offset:"100%",stopColor:"#000000"})]}),i("linearGradient",{id:`leafGreen-${s}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t("stop",{offset:"0%",stopColor:"#3d5c3d"}),t("stop",{offset:"60%",stopColor:"#223822"}),t("stop",{offset:"100%",stopColor:"#0f1a0f"})]}),i("linearGradient",{id:`leafMixed-${s}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t("stop",{offset:"0%",stopColor:"#9c8c74"}),t("stop",{offset:"50%",stopColor:"#807050"}),t("stop",{offset:"100%",stopColor:"#4a4030"})]}),i("linearGradient",{id:`leafRed-${s}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t("stop",{offset:"0%",stopColor:"#8a3324"}),t("stop",{offset:"50%",stopColor:"#5e2121"}),t("stop",{offset:"100%",stopColor:"#2e0f0f"})]}),i("linearGradient",{id:`veinLight-${s}`,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t("stop",{offset:"0%",stopColor:"transparent"}),t("stop",{offset:"50%",stopColor:"#b0c4de",stopOpacity:"0.2"}),t("stop",{offset:"100%",stopColor:"transparent"})]}),i("radialGradient",{id:`heavyVignette-${s}`,cx:"50%",cy:"50%",r:"55%",children:[t("stop",{offset:"70%",stopColor:"transparent"}),t("stop",{offset:"100%",stopColor:"#000",stopOpacity:"0.9"})]})]}),t("rect",{width:"512",height:"512",fill:`url(#nightGrad-${s})`}),t("rect",{width:"512",height:"512",fill:"white",filter:`url(#nightGrain-${s})`,opacity:"0.15",style:{mixBlendMode:"overlay"}}),t("path",{d:"M-10,90 C150,120 362,120 522,90",stroke:"#5c4025",strokeWidth:"2",fill:"none",opacity:"0.7",filter:`url(#moonGlow-${s})`}),i("g",{transform:"translate(256, 90)",children:[i("g",{transform:"translate(-140, 20) rotate(8)",children:[t("path",{d:"M0,0 C -110,60 -90,260 0,360 C 90,260 110,60 0,0 Z",fill:`url(#leafGreen-${s})`,filter:`url(#crispVeins-${s})`}),t("path",{d:"M0,0 L0,350",stroke:"#000",strokeWidth:"1",opacity:"0.4"}),t("path",{d:"M0,0 L0,350",stroke:`url(#veinLight-${s})`,strokeWidth:"1",opacity:"0.4"}),t("text",{x:"0",y:"200",textAnchor:"middle",fontFamily:"'Ma Shan Zheng', serif",fontSize:"130",fill:"#0a1a0a",stroke:"#0a1a0a",strokeWidth:"3",opacity:"0.9",filter:`url(#ancientRubbing-${s})`,style:{mixBlendMode:"multiply"},children:"馬"}),t("circle",{cx:"0",cy:"5",r:"3",fill:"#221"})]}),i("g",{transform:"translate(0, 30) rotate(0)",children:[t("path",{d:"M0,0 C -115,70 -95,280 0,380 C 95,280 115,70 0,0 Z",fill:`url(#leafMixed-${s})`,filter:`url(#crispVeins-${s})`}),t("path",{d:"M0,0 L0,370",stroke:"#000",strokeWidth:"1",opacity:"0.4"}),t("path",{d:"M0,0 L0,370",stroke:`url(#veinLight-${s})`,strokeWidth:"1",opacity:"0.5"}),t("text",{x:"0",y:"210",textAnchor:"middle",fontFamily:"'Ma Shan Zheng', serif",fontSize:"140",fill:"#2e2618",stroke:"#2e2618",strokeWidth:"3",opacity:"0.95",filter:`url(#ancientRubbing-${s})`,style:{mixBlendMode:"multiply"},children:"弔"}),t("circle",{cx:"0",cy:"5",r:"3",fill:"#221"})]}),i("g",{transform:"translate(140, 20) rotate(-8)",children:[t("path",{d:"M0,0 C -110,60 -90,260 0,360 C 90,260 110,60 0,0 Z",fill:`url(#leafRed-${s})`,filter:`url(#crispVeins-${s})`}),t("path",{d:"M0,0 L0,350",stroke:"#000",strokeWidth:"1",opacity:"0.4"}),t("path",{d:"M0,0 L0,350",stroke:`url(#veinLight-${s})`,strokeWidth:"1",opacity:"0.4"}),t("text",{x:"0",y:"200",textAnchor:"middle",fontFamily:"'Ma Shan Zheng', serif",fontSize:"130",fill:"#1f0a0a",stroke:"#1f0a0a",strokeWidth:"3",opacity:"0.9",filter:`url(#ancientRubbing-${s})`,style:{mixBlendMode:"multiply"},children:"牌"}),t("circle",{cx:"0",cy:"5",r:"3",fill:"#221"})]})]}),t("rect",{x:"0",y:"380",width:"512",height:"132",fill:`url(#nightGrad-${s})`,opacity:"0.4",filter:`url(#moonGlow-${s})`}),t("rect",{width:"512",height:"512",fill:`url(#heavyVignette-${s})`,style:{mixBlendMode:"multiply"}})]})})},Sn=e=>e.length>8?e.substring(0,8)+"...":e,In=e=>`https://flagcdn.com/w40/${e.toLowerCase()}.png`,ye=e=>e<0?"text-[#f87171] font-bold":e>0?"text-[#4ade80] font-bold":"text-[#555]",qt=e=>e<2?{text:"赤脚",color:"text-[#f87171] border-[#f87171]"}:e===2?{text:"正本",color:"text-[#888] border-[#888]"}:e===3?{text:"得吊",color:"text-[#4ade80] border-[#4ade80]"}:{text:"双吊",color:"text-emerald-400 border-emerald-400"},An=({card:e,onClose:a})=>e?i("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-black/90 backdrop-blur-lg animate-fade-in cursor-zoom-out",onClick:a,children:[t("div",{className:"relative transform scale-[1.5] md:scale-[2.0] transition-transform duration-300 shadow-[0_0_50px_rgba(0,0,0,1)] rounded-xl",onClick:r=>r.stopPropagation(),children:t("div",{className:"w-40 h-64 pointer-events-none",children:t(Ce,{card:e,isTrick:!1,isHand:!1,isSmall:!1,isFaceDown:!1,isInverted:e.isPot})})}),t("div",{className:"absolute bottom-10 text-white/50 text-xs md:text-sm font-serif tracking-[0.3em] animate-pulse",children:"TAP TO CLOSE"})]}):null,Tn=({label:e,score:a,cards:r,highlightInverted:s,onCardClick:n})=>i("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between border-b border-white/5 p-3 hover:bg-white/5 transition-colors gap-2 md:gap-4 font-serif",children:[t("div",{className:"w-full md:w-1/3",children:t("span",{className:"text-[#a0a0a0] text-sm tracking-wide leading-tight font-bold",children:e})}),t("div",{className:"flex flex-wrap gap-2 md:justify-center w-full md:w-1/3",children:r.map((o,c)=>{const l=o.isPot||s&&c===r.length-1;return t("div",{className:"relative group cursor-zoom-in z-10 mx-1",onClick:u=>{u.stopPropagation(),n(o)},children:t("div",{className:"transition-transform duration-200 group-hover:scale-125 group-hover:z-50 origin-center",children:t(Ce,{card:o,isSmall:!0,isInverted:l,isFaceDown:!1,isLocked:!0})})},c)})}),t("div",{className:"w-full md:w-1/3 text-right",children:i("span",{className:`font-bold text-lg ${a>0?"text-[#4ade80]":"text-[#f87171]"}`,children:[a>0?"+":"",a]})})]}),En=({results:e,onClose:a,onNextRound:r,onHome:s,onQuit:n,bankerId:o,language:c,players:l})=>{const{skin:u}=ke(),[p,d]=C([]),[g,_]=C(null),f=h=>{d(x=>x.includes(h)?x.filter(w=>w!==h):[...x,h])},m=h=>at[c][h]||at.en[h],N=h=>{const w={TONG:"kc_single",BROTHER:"kc_brother",SHUANG_LIN:"kc_double",SHUN_LING:"kc_seq",JIAN_LING:"kc_gap"}[h];return w?m(w):h},A=({res:h})=>i("div",{className:"bg-black/40 p-4 md:p-6 animate-fade-in shadow-inner text-sm border-t border-white/10 backdrop-contrast-125",children:[i("div",{className:"grid grid-cols-5 gap-2 mb-6 md:hidden text-center bg-white/5 p-3 rounded-sm border border-white/5",children:[i("div",{children:[t("div",{className:"text-[8px] text-[#5c4025] uppercase",children:"Diao"}),t("div",{className:ye(h.diaoPointChange),children:h.diaoPointChange})]}),i("div",{children:[t("div",{className:"text-[8px] text-[#5c4025] uppercase",children:"Pot"}),t("div",{className:ye(h.kaiZhuPointChange),children:h.kaiZhuPointChange})]}),i("div",{children:[t("div",{className:"text-[8px] text-[#5c4025] uppercase",children:"Knock"}),t("div",{className:ye(h.qiaoMenPointChange),children:h.qiaoMenPointChange})]}),i("div",{children:[t("div",{className:"text-[8px] text-[#5c4025] uppercase",children:"Meld"}),t("div",{className:ye(h.seYangPointChange),children:h.seYangPointChange})]}),i("div",{children:[t("div",{className:"text-[8px] text-[#5c4025] uppercase",children:"Break"}),t("div",{className:ye(h.kaiChongPointChange),children:h.kaiChongPointChange})]})]}),h.allCapturedCards&&h.allCapturedCards.length>0&&i("div",{className:"mb-4",children:[i("div",{className:"text-[10px] text-[#8c6239] font-serif uppercase tracking-[0.2em] mb-2 border-b border-white/5 pb-1",children:[m("visibleCards")," (",h.cardsWonCount,")"]}),t("div",{className:"flex flex-wrap gap-2",children:h.allCapturedCards.map((x,w)=>t("div",{className:"relative group cursor-zoom-in z-10 mx-1",onClick:y=>{y.stopPropagation(),_(x)},children:t("div",{className:"transition-transform duration-200 group-hover:scale-125 group-hover:z-50 origin-center",children:t(Ce,{card:x,isSmall:!0,isInverted:x.isPot,isFaceDown:!1,isLocked:!0})})},w))})]}),i("div",{className:"space-y-2",children:[[...h.kaiChongDetails.map(x=>({name:N(x.matchType),cards:[...x.sourceCards,x.matchedCard],score:x.score,isInverted:!0})),...h.patternDetails.map(x=>({name:x.name,cards:x.cards,score:x.score,isInverted:!1}))].map((x,w)=>t(Tn,{label:x.name,score:x.score,cards:x.cards||[],highlightInverted:x.isInverted,onCardClick:_},w)),h.patternDetails.length===0&&h.kaiChongDetails.length===0&&t("div",{className:"text-center text-[#555] italic py-2",children:"No special patterns"})]})]});return i("div",{className:u.hud.modalOverlayClass,children:[t(An,{card:g,onClose:()=>_(null)}),i("div",{className:`w-full max-w-4xl flex flex-col max-h-[90vh] ${u.hud.modalContentClass}`,children:[t("div",{className:"absolute inset-0 pointer-events-none opacity-30 mix-blend-overlay bg-gradient-to-tr from-transparent via-white/5 to-transparent animate-shimmer-slow",style:{backgroundSize:"200% 200%"}}),i("div",{className:"relative z-50 flex items-center justify-between px-6 py-5 border-b border-white/10 shrink-0 bg-black/40 backdrop-blur-md",children:[t("h2",{className:"text-2xl md:text-3xl tracking-[0.2em] font-bold uppercase font-calligraphy text-[#c5a059] drop-shadow-md",children:m("tab_summary")}),i("div",{className:"flex items-center gap-3",children:[t("button",{onClick:s,className:"text-[10px] md:text-xs uppercase tracking-widest text-[#8c6239] hover:text-[#c5a059] transition-colors border border-[#3e2b22] px-3 py-2 rounded-sm hover:border-[#c5a059]",children:"HOME"}),t("button",{onClick:r,className:u.hud.buttonClass(!1),children:"NEXT"})]})]}),i("div",{className:"p-2 md:p-8 relative z-20 overflow-y-auto custom-scrollbar flex-1 space-y-2",children:[i("div",{className:"grid grid-cols-12 gap-2 text-[10px] uppercase tracking-widest text-[#8c6239] mb-2 px-4 font-bold border-b border-[#3e2b22] pb-2",children:[t("div",{className:"col-span-8 md:col-span-4",children:"Player"}),t("div",{className:"hidden md:block col-span-1 text-center",children:"Diao"}),t("div",{className:"hidden md:block col-span-1 text-center",children:"Pot"}),t("div",{className:"hidden md:block col-span-1 text-center",children:"Knock"}),t("div",{className:"hidden md:block col-span-1 text-center",children:"Meld"}),t("div",{className:"hidden md:block col-span-1 text-center",children:"Break"}),t("div",{className:"col-span-4 md:col-span-3 text-right",children:"Total"})]}),e.map(h=>{const x=h.playerId===o,w=h.playerId===0,y=p.includes(h.playerId),v=l.find(S=>S.id===h.playerId),k=v?.profile,T=k?.avatar_url||`https://api.dicebear.com/9.x/miniavs/svg?seed=${v?.name||"Player"}&backgroundColor=b6e3f4,c0aede,d1d4f9`,P=In(k?.country||"cn");return i("div",{className:`group transition-all duration-300 border border-transparent rounded-sm ${y?"bg-white/5 border-white/5":"hover:bg-white/5"}`,children:[i("div",{onClick:()=>f(h.playerId),className:"grid grid-cols-12 gap-2 items-center p-3 md:p-4 cursor-pointer",children:[i("div",{className:"col-span-8 md:col-span-4 flex items-center gap-3",children:[t("div",{className:`w-5 h-5 md:w-6 md:h-6 flex items-center justify-center border text-[9px] md:text-[10px] font-serif rounded-sm ${x?"border-red-800 text-red-500 bg-red-900/20":"border-[#333] text-[#666]"}`,children:x?"庄":"闲"}),i("div",{className:"relative",children:[t("div",{className:"relative w-8 h-8 rounded-full border border-[#3e2b22] overflow-hidden shrink-0 shadow-lg",children:t("img",{src:T,alt:"",className:"w-full h-full object-cover filter brightness-90"})}),i("div",{className:"absolute -bottom-2 -right-2 w-5 h-4 bg-[#1a0505] border border-[#5c4025] shadow-md transform rotate-12 z-10 flex items-center justify-center p-[1px]",children:[t("img",{src:P,alt:k?.country,className:"w-full h-full object-cover opacity-90"}),t("div",{className:"absolute inset-0 bg-gradient-to-tr from-transparent to-white/20 pointer-events-none"})]})]}),i("div",{className:"flex flex-col overflow-hidden",children:[t("div",{className:"flex items-center gap-1",children:t("span",{className:`text-sm font-bold tracking-wider truncate ${w?"text-[#e6c278]":"text-[#a0a0a0]"}`,children:Sn(k?.username||v?.name||"")})}),!x&&t("span",{className:`text-[8px] border px-1 w-max mt-0.5 opacity-80 ${qt(h.trickCount).color}`,children:qt(h.trickCount).text})]})]}),t("div",{className:`hidden md:block col-span-1 text-center ${ye(h.diaoPointChange)}`,children:h.diaoPointChange}),t("div",{className:`hidden md:block col-span-1 text-center ${ye(h.kaiZhuPointChange)}`,children:h.kaiZhuPointChange}),t("div",{className:`hidden md:block col-span-1 text-center ${ye(h.qiaoMenPointChange)}`,children:h.qiaoMenPointChange}),t("div",{className:`hidden md:block col-span-1 text-center ${ye(h.seYangPointChange)}`,children:h.seYangPointChange}),t("div",{className:`hidden md:block col-span-1 text-center ${ye(h.kaiChongPointChange)}`,children:h.kaiChongPointChange}),i("div",{className:"col-span-4 md:col-span-3 text-right",children:[i("span",{className:`text-2xl font-serif font-bold ${h.totalRoundChange>0?"text-[#e6c278]":h.totalRoundChange<0?"text-[#f87171]":"text-[#555]"}`,children:[h.totalRoundChange>0?"+":"",h.totalRoundChange]}),t("div",{className:"md:hidden text-[9px] text-[#5c4025] uppercase tracking-widest mt-1",children:"Tap for Details"})]})]}),y&&t(A,{res:h})]},h.playerId)})]})]})]})},Ln=({recordedCards:e,faceUpPlayedCardIds:a})=>{const r=_e(()=>e.filter(c=>a.has(c.id)),[e,a]),s=_e(()=>{const c={[b.CASH]:[],[b.STRINGS]:[],[b.COINS]:[],[b.TEXTS]:[]};return r.forEach(l=>{c[l.suit]&&c[l.suit].push(l)}),Object.keys(c).forEach(l=>{c[l].sort((u,p)=>p.value-u.value)}),c},[r]),n=[b.CASH,b.STRINGS,b.COINS,b.TEXTS],o={[b.CASH]:"Cash / 十",[b.STRINGS]:"Strings / 貫",[b.COINS]:"Coins / 索",[b.TEXTS]:"Texts / 文"};return i("div",{className:"flex flex-col h-full overflow-hidden",children:[i("div",{className:"flex justify-between items-center mb-4 px-2 shrink-0",children:[t("h4",{className:"text-[#c5a059] text-sm uppercase tracking-widest font-bold",children:"Public Knowledge"}),i("span",{className:"text-xs text-[#5c4025]",children:["Face-Up: ",r.length," / ",e.length]})]}),t("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-6 pr-2",children:n.map(c=>i("div",{className:"bg-[#0a0806] border border-[#2a1d15] rounded-sm p-3 relative",children:[t("div",{className:"absolute -top-2 left-3 bg-[#15100e] px-2 text-[10px] text-[#8c6239] uppercase tracking-widest font-bold border border-[#2a1d15]",children:o[c]}),t("div",{className:"flex flex-wrap gap-2 mt-2",children:s[c].length>0?s[c].map((l,u)=>t("div",{className:"transform hover:scale-110 transition-transform origin-bottom duration-200",children:t(Ce,{card:l,isSmall:!0,className:"shadow-md border-white/5"})},`${l.id}-${u}`)):t("span",{className:"text-[10px] text-[#3e2b22] italic w-full text-center py-2",children:"No visible cards"})})]},c))})]})},Rn=({history:e})=>i("div",{className:"flex flex-col h-full overflow-y-auto custom-scrollbar",children:[i("div",{className:"grid grid-cols-2 gap-4 mb-6 text-[#a0a0a0] shrink-0",children:[i("div",{className:"bg-[#0a0806] p-4 border border-[#2a1d15] text-center rounded-sm",children:[t("div",{className:"text-[10px] text-[#5c4025] uppercase tracking-widest mb-1",children:"Total Rounds"}),t("div",{className:"text-2xl text-[#e6c278] font-bold font-serif",children:e.totalRounds})]}),i("div",{className:"bg-[#0a0806] p-4 border border-[#2a1d15] text-center rounded-sm",children:[t("div",{className:"text-[10px] text-[#5c4025] uppercase tracking-widest mb-1",children:"Banker vs Peasant"}),i("div",{className:"text-xl text-[#e6c278] font-serif",children:[e.bankerWins," : ",e.peasantWins]})]})]}),i("div",{className:"space-y-3",children:[t("h4",{className:"text-[#8c6239] text-[10px] uppercase tracking-widest sticky top-0 bg-[#15100e] py-2 border-b border-[#2a1d15] mb-2",children:"Opponent Intelligence"}),Object.entries(e.aiLearningStates||{}).map(([a,r])=>i("div",{className:"bg-[#0a0806] p-3 border border-[#2a1d15] flex justify-between items-center rounded-sm hover:border-[#3e2b22] transition-colors",children:[i("span",{className:"text-[#c5a059] text-xs font-bold",children:["Seat ",a]}),i("div",{className:"text-[10px] text-[#5c4025] flex gap-3 font-mono",children:[i("span",{children:["AGR: ",t("span",{className:"text-[#a0a0a0]",children:r.aggression.toFixed(2)})]}),i("span",{children:["RSK: ",t("span",{className:"text-[#a0a0a0]",children:r.riskTolerance.toFixed(2)})]})]})]},a))]})]}),On=({settings:e,onOpenAdmin:a})=>{const{language:r,setLanguage:s,oneClickPlay:n,setOneClickPlay:o,isRiskAlertOn:c,setIsRiskAlertOn:l,isMuted:u,setIsMuted:p,graphicsQuality:d,setGraphicsQuality:g,githubAutoSync:_,setGithubAutoSync:f,showPaperDolls:m,setShowPaperDolls:N,isMobileDevice:A}=e,{skin:h,setSkinId:x,availableSkins:w}=ke(),[y,v]=C(""),[k,T]=C(""),[P,S]=C(!1),[L,I]=C(""),B=Qe(null);me(()=>{const R=It();R.url&&R.key&&(v(R.url),T(R.key),S(it(R.url,R.key)))},[]);const ce=()=>{it(y,k)?(S(!0),I("Connected.")):I("Failed.")},be=async R=>{if(R.target.files&&R.target.files[0]){I("Uploading...");const re=await fr(R.target.files[0]);re&&(localStorage.setItem("ma_diao_avatar_url",re),I("Avatar updated!"))}},le=({label:R,children:re})=>i("div",{className:"flex justify-between items-center text-[#a0a0a0] py-2 border-b border-[#2a1d15]/50",children:[" ",t("span",{className:"text-xs uppercase tracking-wide text-[#8c6239] font-bold",children:R})," ",re," "]}),G=({active:R,onClick:re,labelOn:Te="ON",labelOff:ve="OFF"})=>i("button",{onClick:re,className:`px-3 py-1 text-[10px] border transition-all duration-300 font-bold tracking-wider rounded-sm ${R?"border-[#c5a059] text-[#15100e] bg-[#c5a059]":"border-[#3e2b22] text-[#5c4025] hover:text-[#8c6239]"}`,children:[" ",R?Te:ve," "]});return i("div",{className:"space-y-4 h-full overflow-y-auto custom-scrollbar pr-2",children:[i("div",{className:"space-y-1",children:[t("div",{className:"text-[10px] text-[#5c4025] uppercase tracking-[0.3em] mb-2 font-bold",children:"Gameplay"}),i(le,{label:"Visual Theme",children:[" ",i("select",{value:h.id,onChange:R=>x(R.target.value),className:"bg-[#0a0806] border border-[#3e2b22] text-[#c5a059] px-2 py-1 text-[10px] outline-none rounded-sm",children:[" ",w.map(R=>t("option",{value:R.id,children:R.name},R.id))," "]})," "]}),i(le,{label:"Graphics",children:[" ",i("div",{className:"flex gap-1",children:[" ",t("button",{onClick:()=>g("LOW"),className:`px-2 py-1 text-[10px] border ${d==="LOW"?"border-[#c5a059] text-[#c5a059]":"border-[#3e2b22] text-[#5c4025]"}`,children:"Low"})," ",t("button",{onClick:()=>g("HIGH"),className:`px-2 py-1 text-[10px] border ${d==="HIGH"?"border-[#c5a059] text-[#c5a059]":"border-[#3e2b22] text-[#5c4025]"}`,children:"High"})," "]})," "]}),!A&&i(le,{label:"3D Avatars",children:[" ",t(G,{active:m,onClick:()=>N(!m),labelOn:"Show",labelOff:"Hide"})," "]}),i(le,{label:"Language",children:[" ",i("select",{value:r,onChange:R=>s(R.target.value),className:"bg-[#0a0806] border border-[#3e2b22] text-[#c5a059] px-2 py-1 text-[10px] outline-none rounded-sm",children:[" ",["en","zh_CN","zh_TW","ja","ko"].map(R=>t("option",{value:R,children:R},R))," "]})," "]}),i(le,{label:"Control Mode",children:[" ",t(G,{active:n,onClick:()=>o(!n),labelOn:"1-Click",labelOff:"Confirm"})," "]}),i(le,{label:"Strategy Hints",children:[" ",t(G,{active:c,onClick:()=>l(!c)})," "]}),i(le,{label:"Sound (TTS)",children:[" ",t(G,{active:!u,onClick:()=>p(!u)})," "]})]}),i("div",{className:"space-y-3 pt-4 border-t border-[#2a1d15]",children:[t("div",{className:"text-[10px] text-[#5c4025] uppercase tracking-[0.3em] font-bold",children:"System"}),t("div",{className:"bg-[#0a0806] p-3 border border-[#2a1d15] rounded-sm relative overflow-hidden",children:i("div",{className:"flex justify-between items-center mb-3",children:[" ",t("span",{className:"text-[10px] text-[#8c6239] font-bold",children:"GitHub Sync"})," ",t(G,{active:_,onClick:()=>f(!_),labelOn:"Auto",labelOff:"Manual"})," "]})}),i("div",{className:"bg-[#0a0806] p-3 border border-[#2a1d15] rounded-sm",children:[i("div",{className:"flex justify-between items-center mb-2",children:[" ",t("span",{className:"text-[10px] text-[#8c6239]",children:"Cloud Save"})," ",t("div",{className:`w-1.5 h-1.5 rounded-full ${P?"bg-green-500 shadow-[0_0_5px_lime]":"bg-red-900"}`})," "]}),P?i("div",{className:"flex gap-2",children:[" ",t("button",{onClick:()=>B.current?.click(),className:"flex-1 py-1.5 bg-[#3e2b22]/50 text-[#a0a0a0] text-[10px] border border-[#3e2b22] hover:border-[#c5a059] transition-colors",children:"Upload Avatar"})," ",t("input",{type:"file",ref:B,onChange:be,accept:"image/*",className:"hidden"})," ",t("button",{onClick:()=>{lr(),S(!1)},className:"px-3 text-[10px] text-red-500 border border-red-900/30 hover:bg-red-900/10",children:"Unlink"})," "]}):i("div",{className:"flex gap-2",children:[" ",t("input",{type:"password",placeholder:"MemFire/Supabase URL",value:y,onChange:R=>v(R.target.value),className:"flex-1 bg-black border border-[#3e2b22] px-2 text-[10px] text-[#c5a059]"})," ",t("input",{type:"password",placeholder:"Key",value:k,onChange:R=>T(R.target.value),className:"w-16 bg-black border border-[#3e2b22] px-2 text-[10px] text-[#c5a059]"})," ",t("button",{onClick:ce,className:"px-2 text-[10px] bg-[#3e2b22] text-[#c5a059]",children:"Link"})," "]}),L&&t("div",{className:"text-[9px] text-[#c5a059] mt-1 text-right italic",children:L})]}),t("button",{onClick:a,className:"w-full py-2 bg-[#1a1a1a] text-[#333] border border-[#222] text-[10px] uppercase tracking-widest hover:text-[#555] transition-colors",children:" Admin Portal "})]})]})},Gn=({onClose:e,onOpenAdmin:a,settings:r,initialTab:s="GENERAL",gameData:n})=>{const{skin:o}=ke(),[c,l]=C(s),u=()=>i("div",{className:"absolute top-0 left-0 -z-50 opacity-0 pointer-events-none",style:{width:"1024px",height:"1024px"},children:[" ",t(ba,{id:"app-icon-export-target",size:1024})," "]}),p=({id:d,label:g,icon:_})=>i("button",{onClick:()=>l(d),className:`flex-1 py-3 text-xs uppercase tracking-widest font-bold transition-all duration-300 flex flex-col items-center gap-1 border-b-2 ${c===d?"text-[#c5a059] border-[#c5a059] bg-[#c5a059]/10":"text-[#5c4025] border-transparent hover:text-[#8c6239] hover:bg-white/5"}`,children:[" ",t("span",{className:"text-lg opacity-80",children:_})," ",t("span",{className:"scale-90",children:g})," "]});return i("div",{className:o.hud.modalOverlayClass,children:[t(u,{}),i("div",{className:`w-full max-w-lg flex flex-col relative overflow-hidden ${o.hud.modalContentClass}`,style:{height:"85vh",maxHeight:"700px"},children:[t("div",{className:"absolute inset-0 bg-gradient-to-tr from-transparent via-white/5 to-transparent opacity-30 pointer-events-none"}),t("button",{onClick:e,className:"absolute top-4 right-4 text-[#5c4025] hover:text-[#c5a059] z-50 text-xl font-bold",children:"✕"}),i("div",{className:"flex border-b border-white/10 bg-black/20 shrink-0 z-20 relative",children:[" ",t(p,{id:"RECORDER",label:"Recorder",icon:"👁"})," ",t(p,{id:"GENERAL",label:"Settings",icon:"⚙"})," ",t(p,{id:"HISTORY",label:"History",icon:"📜"})," "]}),i("div",{className:"flex-1 p-6 relative z-10 overflow-hidden",children:[c==="RECORDER"&&n&&t(Ln,{recordedCards:n.recordedCards,faceUpPlayedCardIds:n.faceUpPlayedCardIds}),c==="GENERAL"&&t(On,{settings:r,onOpenAdmin:a}),c==="HISTORY"&&n&&t(Rn,{history:n.gameHistory}),(c==="RECORDER"||c==="HISTORY")&&!n&&t("div",{className:"flex h-full items-center justify-center text-[#5c4025] italic text-xs",children:" Game data not available. "})]})]})]})};class Mn{getSupportedProviders(){return[Ne.GOOGLE,Ne.FACEBOOK,Ne.WECHAT,Ne.DOUYIN]}async checkSession(){const a=await Xe();if(a){const r=await $t(a.id);if(r)return{success:!0,user:r}}return{success:!1}}async login(a){if(!a)return{success:!1,error:"Provider required for Web"};if(a===Ne.WECHAT||a===Ne.DOUYIN){const{user:n}=await dr(a);return{success:!0,user:await $t(n.id)||void 0}}const{data:r,error:s}=await cr(a);return s?{success:!1,error:JSON.stringify(s)}:{success:!0}}async logout(){await ur()}}class Dn{init(){console.log("Web Ads Initialized")}showBanner(){console.log("Show Web Banner")}hideBanner(){console.log("Hide Web Banner")}async showInterstitial(){console.log("Show Web Interstitial"),alert("This is a simulated Interstitial Ad.")}async showRewarded(){return console.log("Show Web Rewarded Video"),confirm("Watch video for rewards? (Simulated)")}}class Pn{async getProducts(a){return a.map(r=>({productId:r,title:"Test Item",description:"A test item for web",price:"$0.99",currencyCode:"USD"}))}async purchase(a){return console.log(`Purchased ${a} on Web`),{success:!0,transactionId:`web_tx_${Date.now()}`}}async restorePurchases(){}}class Bn{async share(a){navigator.share?navigator.share({title:a,url:window.location.href}):prompt("Copy this link to share:",window.location.href)}async inviteFriends(){alert("Invite link copied to clipboard!")}async getFriendList(){return na()}}const Zt={id:"WEB",auth:new Mn,ads:new Dn,iap:new Pn,social:new Bn,initialize:async()=>{console.log("Web Platform Adapter Initialized")}};class Hn{getSupportedProviders(){return[Ne.WECHAT]}async checkSession(){return{success:!1}}async login(){return console.log("Calling wx.login()..."),{success:!1,error:"Not implemented in browser environment"}}async logout(){}}class $n{init(){}showBanner(a){}hideBanner(){}async showInterstitial(a){}async showRewarded(a){return!0}}class jn{async getProducts(a){return[]}async purchase(a){return{success:!1}}async restorePurchases(){}}class Wn{async share(a,r){}async inviteFriends(){}async getFriendList(){return[]}}const zn={id:"WECHAT",auth:new Hn,ads:new $n,iap:new jn,social:new Wn,initialize:async()=>{console.log("WeChat Platform Initialized")}};class Fn{adapter;constructor(){typeof wx<"u"&&typeof wx.getSystemInfo=="function"?this.adapter=zn:typeof FBInstant<"u"?this.adapter=Zt:this.adapter=Zt}get auth(){return this.adapter.auth}get ads(){return this.adapter.ads}get iap(){return this.adapter.iap}get social(){return this.adapter.social}get id(){return this.adapter.id}async init(){await this.adapter.initialize();const a=await this.auth.checkSession();a.success&&a.user&&console.log(`[Platform] Auto-logged in as ${a.user.username} on ${this.adapter.id}`)}}const Ae=new Fn,Un=({onClose:e,onLoginSuccess:a})=>{const[r,s]=C("LOGIN"),[n,o]=C(!1),[c,l]=C(""),[u,p]=C(null),[d,g]=C("GENERATING"),[_,f]=C(""),[m,N]=C("OTHER"),[A,h]=C(25),[x,w]=C("cn"),[y,v]=C(""),[k,T]=C([]),[P,S]=C([]),L=Ae.auth.getSupportedProviders(),I=async G=>{if(l(""),o(!0),Ae.id==="WEB"&&(G===Ne.WECHAT||G===Ne.DOUYIN)){p(G),s("QR_SCAN"),g("GENERATING"),setTimeout(()=>g("WAITING"),800),setTimeout(()=>g("SCANNED"),3500),setTimeout(async()=>{g("SUCCESS");const re=await Ae.auth.login(G);B(re)},5500);return}const R=await Ae.auth.login(G);B(R),o(!1)},B=async G=>{if(!G.success){l(G.error||"Login Failed");return}if(G.user)if(G.user.username&&G.user.age){f(G.user.username),v(G.user.avatar_url||""),s("MATCHING");const R=await na();S(R);const re=await jt(G.user);T(re)}else s("PROFILE"),f(G.user.username||"Player");else s("PROFILE")},ce=async()=>{o(!0);const R=await hr({username:_,gender:m,age:A,country:x,avatar_url:y,is_looking_for_match:!0});if(R){s("MATCHING");const re=await jt(R);T(re)}o(!1)},be=()=>i("div",{className:"flex flex-col items-center justify-center py-6 animate-fade-in",children:[i("div",{className:"text-[#c5a059] mb-4",children:["Scan with ",u]}),t("div",{className:`w-48 h-48 bg-white p-2 ${d==="SUCCESS"?"border-4 border-[#c5a059]":""}`,children:d==="GENERATING"?"Generating...":t("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=login_${u}`,className:"w-full h-full"})}),t("div",{className:"mt-4 text-[#a0a0a0] text-xs",children:d==="WAITING"?"Waiting for scan...":d}),d==="SUCCESS"&&t("div",{className:"text-green-500 font-bold mt-2",children:"Success! Redirecting..."})]}),le=()=>t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 w-full px-8",children:L.map(G=>t("button",{onClick:()=>I(G),className:"flex items-center justify-center gap-2 py-4 border border-[#3e2b22] hover:border-[#c5a059] hover:bg-[#1a1a1a] transition-all bg-[#0a0806]",children:i("span",{className:"text-[#c5a059] uppercase text-xs tracking-widest",children:[G," Login"]})},G))});return t("div",{className:"fixed inset-0 z-[400] flex items-center justify-center bg-black/95 backdrop-blur-md animate-fade-in font-serif",children:i("div",{className:"bg-[#15100e] border border-[#3e2b22] w-full max-w-lg p-8 rounded-sm shadow-lacquer-deep relative overflow-hidden flex flex-col max-h-[90vh]",children:[t("button",{onClick:e,className:"absolute top-4 right-4 text-[#5c4025] hover:text-[#c5a059] z-20",children:"✕"}),r==="LOGIN"&&i("div",{className:"flex flex-col items-center gap-8 py-8",children:[i("h2",{className:"text-2xl text-[#c5a059] font-bold tracking-[0.2em] uppercase text-center",children:["Login via ",Ae.id]}),le(),c&&t("div",{className:"text-red-500 text-xs mt-4",children:c}),n&&t("div",{className:"text-[#c5a059] text-xs animate-pulse",children:"Processing..."})]}),r==="QR_SCAN"&&be(),r==="PROFILE"&&i("div",{className:"flex flex-col gap-4 py-4 overflow-y-auto",children:[t("h2",{className:"text-xl text-[#c5a059] text-center",children:"Create Persona"}),t("input",{type:"text",value:_,onChange:G=>f(G.target.value),placeholder:"Username",className:"bg-[#0a0806] border border-[#3e2b22] px-3 py-2 text-[#e6c278]"}),i("div",{className:"grid grid-cols-2 gap-4",children:[t("input",{type:"number",value:A,onChange:G=>h(parseInt(G.target.value)),className:"bg-[#0a0806] border border-[#3e2b22] px-3 py-2 text-[#e6c278]"}),i("select",{value:m,onChange:G=>N(G.target.value),className:"bg-[#0a0806] border border-[#3e2b22] px-3 py-2 text-[#e6c278]",children:[t("option",{value:"MALE",children:"Male"}),t("option",{value:"FEMALE",children:"Female"}),t("option",{value:"OTHER",children:"Other"})]})]}),t("button",{onClick:ce,className:"mt-4 py-3 bg-[#3d0e0e] text-[#a0a0a0] border border-[#5c1010] hover:text-white",children:"Enter World"})]}),r==="MATCHING"&&i("div",{className:"flex flex-col gap-4 h-full",children:[t("h2",{className:"text-xl text-[#c5a059] text-center border-b border-[#3e2b22] pb-2",children:"Lobby"}),t("div",{className:"flex-1 overflow-y-auto space-y-2",children:k.map(G=>i("div",{className:"p-2 border border-[#3e2b22] flex justify-between items-center text-xs text-[#a0a0a0]",children:[t("span",{children:G.username}),t("button",{onClick:()=>pr(G.id),className:"text-[#c5a059] hover:underline",children:"+ Friend"})]},G.id))}),t("button",{onClick:()=>{e(),a({id:"me",username:_,gender:m,age:A,country:x})},className:"w-full py-3 bg-[#1a1a1a] border border-[#c5a059] text-[#c5a059]",children:"START GAME"})]})]})})},Yn=({language:e})=>{const[a,r]=C(!1),[s,n]=C([]),[o,c]=C(""),[l,u]=C(!1),p=Qe(null),[d,g]=C(!1),_=m=>at[e][m]||at.en[m];me(()=>{g(zt()),zt()?(async()=>{const N=await oa();n(A=>A.length===0?[{role:"model",text:N,timestamp:Date.now()}]:A)})():n(m=>m.length===0?[{role:"system",text:_("aiDisabled"),timestamp:Date.now()}]:m)},[e]),me(()=>{p.current?.scrollIntoView({behavior:"smooth"})},[s,a]);const f=async()=>{if(!o.trim()||!d)return;const m={role:"user",text:o,timestamp:Date.now()};n(h=>[...h,m]),c(""),u(!0);const A={role:"model",text:await yr(o),timestamp:Date.now()};n(h=>[...h,A]),u(!1)};return i("div",{className:`fixed bottom-2 right-2 z-50 flex flex-col items-end transition-all duration-300 ${a?"w-[90vw] md:w-80 h-[60vh] md:h-96":"w-auto h-auto"}`,children:[t("button",{onClick:()=>r(!a),className:"bg-black text-imperial-gold border-2 border-imperial-gold/50 p-3 rounded-full shadow-lg hover:bg-stone-900 transition-colors flex items-center gap-2 mb-2",children:a?t("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):i("div",{className:"flex items-center gap-2",children:[t("span",{className:"font-serif font-bold hidden md:inline text-imperial-gold",children:_("masterTitle")}),t("div",{className:"w-6 h-6 bg-aged-paper rounded-full flex items-center justify-center text-ink-black font-bold font-serif",children:"?"})]})}),a&&i("div",{className:"bg-stone-900 w-full h-full rounded-lg shadow-2xl border-4 border-stone-800 flex flex-col overflow-hidden",children:[t("div",{className:"bg-stone-950 text-imperial-gold p-2 font-serif text-center border-b border-stone-800 font-bold tracking-widest",children:_("masterName")}),i("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-stone-900/95",children:[s.map((m,N)=>t("div",{className:`flex ${m.role==="user"?"justify-end":"justify-start"}`,children:t("div",{className:`max-w-[85%] p-2 rounded-md text-sm font-serif shadow-sm ${m.role==="user"?"bg-urushi-red text-aged-paper border border-stone-700":"bg-aged-paper text-ink-black border border-gray-400"}`,children:m.text})},N)),l&&t("div",{className:"flex justify-start",children:t("div",{className:"text-xs text-stone-500 italic animate-pulse pl-2",children:_("meditating")})}),t("div",{ref:p})]}),i("div",{className:"p-2 bg-stone-950 border-t border-stone-800 flex gap-2",children:[t("input",{type:"text",value:o,onChange:m=>c(m.target.value),onKeyDown:m=>m.key==="Enter"&&f(),disabled:!d,placeholder:_(d?"chatPlaceholder":"chatPlaceholderDisabled"),className:"flex-1 bg-stone-800 text-aged-paper px-3 py-1 rounded-sm focus:outline-none focus:ring-2 focus:ring-imperial-gold font-serif placeholder-stone-400"}),t("button",{onClick:f,disabled:l||!d,className:"text-imperial-gold hover:text-white transition-colors",children:"➤"})]})]})]})},Kn=({onExit:e})=>{const[a,r]=C(!1),[s,n]=C(""),[o,c]=C(""),[l,u]=C(""),[p,d]=C([]),[g,_]=C(!1),[f,m]=C(""),[N,A]=C(""),[h,x]=C("");me(()=>{const T=It();m(T.url),A(T.key)},[]);const w=T=>{T.preventDefault(),s==="Lhy"&&o==="Lhy147258"?(r(!0),u(""),v()):u("Invalid Administrator Credentials")},y=()=>{it(f,N)?(x("Connection Successful (MemFire/Supabase)"),v()):x("Connection Failed")},v=async()=>{_(!0);const T=await gr();d(T),_(!1)},k=async T=>{confirm("Are you sure you want to delete this record? This cannot be undone.")&&(await br(T)?d(S=>S.filter(L=>L.id!==T)):alert("Delete failed. Check database permissions."))};return a?i("div",{className:"fixed inset-0 z-[999] bg-[#0c0c0c] text-[#a0a0a0] font-sans flex flex-col overflow-hidden",children:[i("div",{className:"h-16 bg-[#15100e] border-b border-[#3e2b22] flex items-center justify-between px-6 shrink-0",children:[i("div",{className:"flex items-center gap-4",children:[t("h1",{className:"text-xl text-[#c5a059] font-serif tracking-widest font-bold",children:"MA DIAO ADMIN"}),t("span",{className:"text-xs bg-[#3e2b22] text-[#e6c278] px-2 py-0.5 rounded",children:"Superuser: Lhy"})]}),i("div",{className:"flex gap-4",children:[i("button",{onClick:v,className:"text-xs uppercase hover:text-white flex items-center gap-1",children:[t("span",{children:"↻"})," Refresh"]}),t("button",{onClick:e,className:"text-xs uppercase hover:text-white border border-[#3e2b22] px-3 py-1 rounded hover:bg-[#2a1d15]",children:"Exit to Game"})]})]}),i("div",{className:"flex flex-1 overflow-hidden",children:[i("div",{className:"w-80 bg-[#111] border-r border-[#222] p-6 flex flex-col gap-6 overflow-y-auto",children:[i("div",{children:[t("h3",{className:"text-xs uppercase tracking-widest text-[#8c6239] mb-4 font-bold",children:"Database Connection"}),i("p",{className:"text-[10px] text-gray-500 mb-4 leading-relaxed",children:["Recommended for China: ",t("strong",{children:"MemFire Cloud"}),". It is Supabase-compatible. Enter MemFire API URL & Key below."]}),i("div",{className:"space-y-3",children:[t("input",{type:"text",placeholder:"API URL (e.g., https://xyz.memfiredb.com)",value:f,onChange:T=>m(T.target.value),className:"w-full bg-black border border-[#333] px-3 py-2 text-xs rounded focus:border-[#c5a059] outline-none"}),t("input",{type:"password",placeholder:"Anon Key",value:N,onChange:T=>A(T.target.value),className:"w-full bg-black border border-[#333] px-3 py-2 text-xs rounded focus:border-[#c5a059] outline-none"}),t("button",{onClick:y,className:"w-full py-2 bg-[#222] hover:bg-[#333] text-xs border border-[#444] text-[#ccc]",children:"Update Connection"}),h&&t("div",{className:"text-[10px] text-green-500 mt-2",children:h})]})]}),i("div",{className:"mt-auto",children:[t("h3",{className:"text-xs uppercase tracking-widest text-[#8c6239] mb-2 font-bold",children:"Storage Stats"}),i("div",{className:"text-xs text-gray-500",children:["Logs Loaded: ",p.length]})]})]}),i("div",{className:"flex-1 bg-[#050505] p-8 overflow-y-auto",children:[t("h2",{className:"text-2xl text-white mb-6 font-thin",children:"Game Match Logs"}),g?t("div",{className:"text-center py-20 text-[#555] animate-pulse",children:"Fetching remote data..."}):t("div",{className:"border border-[#222] rounded overflow-hidden",children:i("table",{className:"w-full text-left text-sm",children:[t("thead",{className:"bg-[#1a1a1a] text-[#888]",children:i("tr",{children:[t("th",{className:"p-4 font-normal",children:"Timestamp"}),t("th",{className:"p-4 font-normal",children:"Match ID"}),t("th",{className:"p-4 font-normal",children:"Winner"}),t("th",{className:"p-4 font-normal",children:"Rounds"}),t("th",{className:"p-4 font-normal text-right",children:"Actions"})]})}),i("tbody",{className:"divide-y divide-[#222]",children:[p.map(T=>{const P=new Date(T.timestamp).toLocaleString(),S=T.data.results.find(I=>I.isWinner),L=S?`Player ${S.playerId}`:"Draw";return i("tr",{className:"hover:bg-[#111] transition-colors",children:[t("td",{className:"p-4 text-[#ccc]",children:P}),i("td",{className:"p-4 font-mono text-xs text-[#666]",children:[T.id.substring(0,8),"..."]}),t("td",{className:"p-4 text-[#c5a059]",children:L}),i("td",{className:"p-4 text-[#888]",children:[T.data.results.length," Player Stats"]}),t("td",{className:"p-4 text-right",children:t("button",{onClick:()=>k(T.id),className:"text-red-900 hover:text-red-500 text-xs px-2 py-1 border border-red-900/30 rounded hover:bg-red-900/10 transition-colors",children:"Delete"})})]},T.id)}),p.length===0&&t("tr",{children:t("td",{colSpan:5,className:"p-8 text-center text-[#444] italic",children:"No match logs found in database."})})]})]})})]})]})]}):i("div",{className:"fixed inset-0 z-[999] bg-[#050202] flex items-center justify-center font-serif text-[#c5a059]",children:[t("div",{className:"absolute inset-0 bg-noise opacity-10 pointer-events-none"}),i("div",{className:"w-full max-w-md p-8 border border-[#3e2b22] bg-[#15100e] rounded-sm shadow-lacquer-deep relative",children:[t("button",{onClick:e,className:"absolute top-4 right-4 text-[#5c4025] hover:text-[#c5a059]",children:"✕"}),t("h2",{className:"text-3xl text-center mb-8 font-bold tracking-[0.2em] border-b border-[#2a1d15] pb-4",children:"ADMIN PORTAL"}),i("form",{onSubmit:w,className:"space-y-6",children:[i("div",{children:[t("label",{className:"block text-xs uppercase tracking-widest text-[#8c6239] mb-2",children:"Admin ID"}),t("input",{type:"text",value:s,onChange:T=>n(T.target.value),className:"w-full bg-[#0a0806] border border-[#3e2b22] text-[#e6c278] px-4 py-3 focus:border-[#c5a059] outline-none transition-colors"})]}),i("div",{children:[t("label",{className:"block text-xs uppercase tracking-widest text-[#8c6239] mb-2",children:"Passkey"}),t("input",{type:"password",value:o,onChange:T=>c(T.target.value),className:"w-full bg-[#0a0806] border border-[#3e2b22] text-[#e6c278] px-4 py-3 focus:border-[#c5a059] outline-none transition-colors"})]}),l&&t("div",{className:"text-red-500 text-xs text-center",children:l}),t("button",{type:"submit",className:"w-full py-4 bg-[#3d0e0e] border border-[#5c1010] text-[#a0a0a0] hover:text-white hover:bg-[#5c1010] transition-colors font-bold tracking-[0.2em]",children:"AUTHENTICATE"})]})]})]})},wt=e=>{window.logToScreen&&window.logToScreen(`[App] ${e}`)},qn=()=>{wt("Rendering GameContent...");const{skin:e,setSkinId:a,availableSkins:r}=ke(),[s,n]=C("GAME"),[o,c]=C(void 0),l=At(),u=Ar(),{state:p,actions:d}=wr({difficulty:l.difficulty,isRiskAlertOn:l.isRiskAlertOn,language:l.language}),g=Ir(l.isMuted),{aiChatMessages:_}=Sr({gameState:p,gameActions:d,audioSystem:g,isMuted:l.isMuted,language:l.language}),f=p.players.find(I=>I.type===fe.HUMAN),{interactionState:m,handle3DActionClick:N}=Tr(p,d,f,l);me(()=>{(async()=>{wt("Initializing Platform Service..."),await Ae.init();const B=await Ae.auth.checkSession();B.success&&B.user&&c(B.user)})()},[]);const A=_e(()=>{if(!f)return{};const I={},{bankerId:B,openedSuits:ce,recordedCards:be,firstLeadInfo:le,faceUpPlayedCardIds:G,bankerFirstLeadCard:R}=p;return f.hand.forEach(re=>{const Te=ar(f,re,B,ce,be,le,G,R);I[re.id]={isMature:Te==="SAFE",isForbidden:Te==="FORBIDDEN"}}),I},[f,p.openedSuits,p.recordedCards,p.bankerId,p.firstLeadInfo,p.faceUpPlayedCardIds,p.bankerFirstLeadCard]),h=()=>d.startGame(o),x=()=>{confirm(l.language==="zh_CN"?"确定要关闭游戏吗？":"Are you sure you want to quit?")&&d.exitToTitle()},w=()=>{u.setActiveSettingsTab("RECORDER"),u.setShowSettings(!0)},y=()=>{u.setActiveSettingsTab("GENERAL"),u.setShowSettings(!0)};if(s==="ADMIN")return t(Kn,{onExit:()=>n("GAME")});const{phase:v,currentPlayerIndex:k,bankerId:T,selectedCardId:P,trickNumber:S,mianZhangCard:L}=p;return i("div",{className:`fixed inset-0 perspective-container overflow-hidden ${e.layout.backgroundClass} transition-colors duration-1000`,children:[t(Nn,{state:p,interactionState:{...m,onActionClick:N}}),v!==ie.DEALING&&v!==ie.SHUFFLING&&i(yt,{children:[t(kn,{players:p.players,bankerId:T,currentPlayerIndex:k,aiChatMessages:_}),f&&t(Cn,{player:f,isMyTurn:p.players[k]?.id===0&&v===ie.PLAYING,onCardClick:I=>{l.oneClickPlay?d.executePlayCard(0,I):d.setSelectedCardId(I===P?null:I)},onDragPlay:I=>d.executePlayCard(0,I),onPlayConfirm:I=>d.executePlayCard(0,I),selectedCardId:P,highlightedCardIds:m.highlightedCardIds,cardMarkers:A,oneClickPlay:l.oneClickPlay,canInteract:!m.disabled,actionLabel:m.label,mianZhangCard:L}),i("div",{className:"fixed top-4 right-4 z-[200] flex gap-3",children:[t("button",{onClick:w,className:"text-[#e6c278] bg-black/40 p-2 rounded-full border border-[#5c4025] hover:bg-[#1a0f0a] hover:border-[#c5a059] backdrop-blur-md transition-all shadow-gem-btn w-12 h-12 flex items-center justify-center group",title:"Recorder",children:t("span",{className:"text-xl group-hover:scale-110 transition-transform",children:"👁"})}),t("button",{onClick:y,className:"text-[#8c6239] bg-black/40 p-2 rounded-full border border-[#3e2b22] hover:bg-[#1a0f0a] hover:border-[#c5a059] hover:text-[#c5a059] backdrop-blur-md transition-all shadow-gem-btn w-12 h-12 flex items-center justify-center group",title:"Menu",children:t("span",{className:"text-xl group-hover:rotate-90 transition-transform duration-500",children:"⚙"})})]})]}),p.pendingRisk&&t("div",{className:"fixed inset-0 z-[400] flex items-center justify-center p-4 bg-black/95 backdrop-blur-md animate-fade-in",children:i("div",{className:"bg-[#0f0a08] border border-[#5c1010] p-12 max-w-lg w-full rounded-sm shadow-[0_0_50px_rgba(0,0,0,0.9)] flex flex-col items-center text-center relative overflow-hidden",children:[t("div",{className:"w-24 h-24 rounded-full bg-[#1a0505] text-[#8c1c0b] flex items-center justify-center text-5xl mb-8 border border-[#3d0e0e] shadow-inner",children:"!"}),t("h3",{className:"text-4xl text-[#8c1c0b] font-serif font-bold tracking-[0.2em] mb-4 drop-shadow-md",children:p.pendingRisk.assessment.riskLevel===K.PENALTY?"严重违例":"战术警示"}),t("div",{className:"text-[#5c4025] text-xs uppercase tracking-[0.4em] mb-10 border-b border-[#2a1d15] pb-4 w-full",children:p.pendingRisk.assessment.ruleId}),t("p",{className:"text-[#a0a0a0] mb-12 leading-relaxed font-serif text-xl",children:p.pendingRisk.assessment.message}),i("div",{className:"flex gap-8 w-full",children:[t("button",{onClick:()=>d.setPendingRisk(null),className:"flex-1 py-4 border border-[#2a1d15] text-[#5c4025] hover:text-[#8c6239] hover:border-[#3e2b22] transition-colors uppercase text-xs tracking-[0.3em] font-serif rounded-sm",children:"取消"}),t("button",{onClick:()=>d.executePlayCard(0,p.pendingRisk.cardId,!0),className:"flex-1 py-4 bg-[#3d0e0e] text-[#a0a0a0] border border-[#5c1010] hover:bg-[#5c1010] hover:text-white transition-colors uppercase text-xs tracking-[0.3em] font-bold shadow-lg rounded-sm",children:"强行出牌"})]})]})}),v===ie.DEALING&&i("div",{className:`fixed inset-0 z-[300] flex flex-col items-center justify-center text-[#c5a059] font-serif overflow-hidden transition-all duration-1000 ${e.layout.backgroundClass}`,children:[t("div",{className:"absolute inset-0 bg-gradient-to-b from-[#1a0505] via-transparent to-black opacity-80 pointer-events-none"}),i("div",{className:"relative z-10 flex flex-col items-center animate-fade-in-up w-full max-w-md px-6",children:[t("div",{className:"mb-8 transform hover:scale-105 transition-transform duration-700",children:t(ba,{size:120,className:"border border-[#5c4025] shadow-[0_0_50px_rgba(197,160,89,0.2)]"})}),t("h1",{className:"text-6xl md:text-8xl font-bold tracking-[0.2em] mb-2 text-transparent bg-clip-text bg-gradient-to-b from-[#e6c278] to-[#8c6239] drop-shadow-lg font-calligraphy whitespace-nowrap",children:"馬吊大師"}),i("div",{className:"relative w-64 mb-12 mt-8 group",children:[t("select",{value:e.id,onChange:I=>a(I.target.value),className:"w-full bg-[#15100e] text-[#c5a059] border border-[#3e2b22] py-3 px-8 text-center font-serif text-lg tracking-widest outline-none rounded-[2px] shadow-lg appearance-none cursor-pointer hover:border-[#5c4025] transition-colors focus:border-[#8c6239]",children:r.map(I=>t("option",{value:I.id,children:I.name},I.id))}),t("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-[#5c4025] pointer-events-none group-hover:text-[#8c6239] transition-colors text-xs",children:"▼"})]}),i("div",{className:"flex flex-col gap-4 w-full",children:[i("button",{onClick:h,className:"w-full py-4 bg-[#0a0503] border border-[#3e2b22] text-[#8c6239] hover:text-[#c5a059] hover:border-[#c5a059] transition-all duration-700 text-xl font-bold tracking-[0.3em] rounded-[1px] shadow-[0_0_20px_rgba(0,0,0,0.8)] animate-breathe-subtle relative overflow-hidden group",children:[t("span",{className:"relative z-10",children:o?"CONTINUE":"ENTER GAME"}),t("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-[#c5a059]/5 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000"})]}),!o&&t("button",{onClick:()=>u.setShowSocialModal(!0),className:"w-full py-3 bg-transparent border border-[#2a1d15] text-[#5c4025] text-sm font-bold tracking-[0.3em] rounded-[1px] hover:border-[#3e2b22] hover:text-[#8c6239] transition-all",children:"NETWORK BATTLE"}),o&&t("button",{onClick:async()=>{await Ae.auth.logout(),c(void 0),d.exitToTitle()},className:"text-xs text-[#5c4025] hover:text-[#8c6239] mt-2 underline decoration-[#3e2b22]",children:"Sign Out"})]})]})]}),v===ie.SCORING&&t(En,{results:p.roundResults,onClose:()=>{},onNextRound:d.startNextRound,onHome:d.exitToTitle,onQuit:x,bankerId:T,language:l.language,players:p.players}),u.showSettings&&t(Gn,{onClose:()=>u.setShowSettings(!1),onOpenAdmin:()=>{u.setShowSettings(!1),n("ADMIN")},settings:l,initialTab:u.activeSettingsTab,gameData:{recordedCards:p.recordedCards,faceUpPlayedCardIds:p.faceUpPlayedCardIds,gameHistory:p.gameHistory}}),u.showSocialModal&&t(Un,{onClose:()=>u.setShowSocialModal(!1),onLoginSuccess:I=>{u.setShowSocialModal(!1),c(I),d.startGame(I)}}),t(Yn,{language:l.language})]})},Zn=()=>(wt("App Root Mounted."),t(tn,{children:t(qn,{})}));function Qn(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{let e="";try{window.location.href&&(e=new URL("./sw.js",window.location.href).toString())}catch(a){console.warn("SW URL construction failed:",a)}if(!e&&window.location.origin&&window.location.pathname){const a=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")+1);e=`${window.location.origin}${a}sw.js`}e||(e="./sw.js"),navigator.serviceWorker.register(e).then(a=>{console.log("SW registered: ",a),a.onupdatefound=()=>{const r=a.installing;r!=null&&(r.onstatechange=()=>{r.state==="installed"&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}}).catch(a=>{a.message&&(a.message.includes("origin")||a.message.includes("scriptURL"))?console.warn("Service Worker registration skipped due to environment mismatch (ignoring)."):console.error("Error during service worker registration:",a)})})}const Ye=(e,a="info")=>{const r=window;r.logToScreen?r.logToScreen(e,a):console[a](e)};Ye("index.tsx: Script execution started.");const xt=window;xt.bootTimeout&&(clearTimeout(xt.bootTimeout),xt.bootTimeout=null,Ye("Watchdog cleared. Starting React mount..."));class Xn extends oe.Component{state={hasError:!1,error:null};props;constructor(a){super(a),this.props=a}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){Ye("React Boundary Caught: "+a.message,"error"),console.error(r)}render(){return this.state.hasError?i("div",{style:{padding:"40px",color:"#ff6b6b",fontFamily:"monospace",background:"#1a0505",height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t("h1",{style:{fontSize:"24px",marginBottom:"20px"},children:"Application Error"}),t("pre",{style:{background:"rgba(0,0,0,0.3)",padding:"20px",borderRadius:"4px",maxWidth:"80vw",overflow:"auto"},children:this.state.error?.message}),t("button",{onClick:()=>window.location.reload(),style:{marginTop:"20px",padding:"10px 20px",background:"#8c1c0b",color:"white",border:"1px solid #ff6b6b",cursor:"pointer"},children:"Reload"})]}):this.props.children}}const Qt=()=>{const e=document.getElementById("root");if(!e){Ye("FATAL: #root element not found!","error");return}try{Na(e).render(t(Xn,{children:t(Zn,{})})),Ye("React Root Rendered."),setTimeout(()=>{const r=document.getElementById("app-loader");r&&(r.style.opacity="0",setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},500))},500),Qn()}catch(a){Ye("Mount Exception: "+(a.message||String(a)),"error")}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Qt):Qt();
//# sourceMappingURL=index-DUAuOBoA.js.map
