{"version":3,"file":"index-DUAuOBoA.js","sources":["../../types.ts","../../constants.ts","../../services/kaiChongRules.ts","../../services/scoringService.ts","../../services/ruleDefinitions.ts","../../services/riskEngine.ts","../../services/aiLearningService.ts","../../services/cloudService.ts","../../services/statsService.ts","../../hooks/useMaDiaoLogic.ts","../../services/geminiService.ts","../../services/aiChatService.ts","../../hooks/useAIAgent.ts","../../hooks/useAudioSystem.ts","../../hooks/useGameSettings.ts","../../hooks/useUIState.ts","../../hooks/useGameInteraction.ts","../../components/Visuals/TableEffects.tsx","../../skins/imperialSkin.tsx","../../skins/christmasSkin.tsx","../../skins/mingSkin.tsx","../../skins/taoistSkin.tsx","../../contexts/SkinContext.tsx","../../components/Card.tsx","../../components/Visuals/CharacterFigure.tsx","../../components/Visuals/Scene3D.tsx","../../components/UI/GameInterface.tsx","../../components/Visuals/AppIcon.tsx","../../components/UI/Modals.tsx","../../services/platforms/webAdapter.ts","../../services/platforms/wechatAdapter.ts","../../services/platformService.ts","../../components/UI/SocialLoginModal.tsx","../../components/Chat.tsx","../../components/Admin/AdminGate.tsx","../../App.tsx","../../serviceWorkerRegistration.ts","../../index.tsx"],"sourcesContent":["\nexport enum Suit {\n  CASH = '十',   // Shi (Cash/Tens)\n  STRINGS = '貫', // Guan (Strings)\n  COINS = '索',   // Suo (Coins)\n  TEXTS = '文'    // Wen (Texts/Literati)\n}\n\nexport enum CardColor {\n  RED = 'red',     // Zun/Shang (High/Reward)\n  GREEN = 'green', // Qu/Ji (Interest/Extreme)\n  BLACK = 'black'  // Qing (Blue/Black)\n}\n\nexport enum CardRank {\n  ZUN = 'ZUN',   // Reward (Red)\n  JIAN = 'JIAN', // Shoulder (Red)\n  BAI = 'BAI',   // Hundred (Red - Special)\n  JI = 'JI',     // Extreme (Green)\n  QING = 'QING'  // Qing (Black/Normal)\n}\n\nexport type SuitStatus = 'SAFE' | 'FORBIDDEN' | 'NEUTRAL' | 'RECOMMENDED';\n\nexport type LeadingEffectType = 'GOLD' | 'JADE' | 'BRONZE' | null;\n\nexport interface Card {\n  id: string;\n  suit: Suit;\n  name: string; // Chinese name e.g., \"萬萬\"\n  value: number; // Numeric value for logic\n  color: CardColor;\n  rank: CardRank;\n  description?: string; // Character name like \"宋江\"\n  isSpecial?: boolean; // For visual flair\n  isPot?: boolean; // NEW: Marks cards originating from the Pot or Mian Zhang\n  originalRank?: CardRank; // For Mian Zhang substitution tracking\n  substituteRank?: CardRank; // For Mian Zhang substitution tracking\n}\n\nexport interface TrickCard {\n  card: Card;\n  isFaceUp: boolean;\n  round: number;\n  isKaiChong?: boolean; // Added for Kai Chong tracking\n  meritMultiplier?: number; // Battle Merit: 1, 2, or 3\n  hidden?: boolean; // NEW: Hide visually (e.g. consumed in Kai Chong duplicate)\n}\n\nexport enum PlayerType {\n  HUMAN = 'HUMAN',\n  AI = 'AI',\n  NETWORK = 'NETWORK' // New: Real remote player\n}\n\n// --- SOCIAL & PROFILE TYPES ---\n\nexport type Gender = 'MALE' | 'FEMALE' | 'OTHER';\nexport type GazeDirection = 'LEFT' | 'RIGHT' | 'CENTER'; // NEW: Face orientation\n\nexport interface UserProfile {\n    id: string; // UUID from Auth\n    username: string;\n    avatar_url?: string;\n    gender: Gender;\n    age: number;\n    country: string; // ISO 2-letter code (e.g., 'cn', 'jp', 'us')\n    gazeDirection?: GazeDirection; // NEW: Estimated face direction\n    location?: {\n        lat: number;\n        lng: number;\n        city?: string;\n    };\n    is_looking_for_match: boolean;\n    last_active: number;\n    friends: string[]; // List of friend UUIDs\n}\n\nexport enum SocialProvider {\n    GOOGLE = 'google',\n    FACEBOOK = 'facebook',\n    WECHAT = 'wechat', // Requires specific configuration in Supabase/MemFire\n    DOUYIN = 'douyin'  // Usually custom implementation, we will mock/interface it\n}\n\nexport enum GamePhase {\n  DEALING = 'DEALING',\n  SHUFFLING = 'SHUFFLING', // Added for animation\n  PLAYING = 'PLAYING',\n  KAI_CHONG = 'KAI_CHONG', // New Phase\n  SCORING = 'SCORING',\n  GAME_OVER = 'GAME_OVER'\n}\n\nexport enum Difficulty {\n  EASY = 'EASY',\n  MEDIUM = 'MEDIUM',\n  HARD = 'HARD'\n}\n\nexport interface SpecialCaptureFlags {\n    wanCaughtQian: boolean;\n    wanCaughtBai: boolean;\n    qianCaughtBai: boolean;\n}\n\nexport interface AILearningState {\n    playerId: number;\n    gamesPlayed: number;\n    winRate: number;\n    \n    // Dynamic Personality Parameters (0.0 to 1.0)\n    aggression: number;      // Tendency to lead high cards/capture\n    riskTolerance: number;   // Tendency to ignore Warnings\n    bluffFrequency: number;  // Tendency to play odd cards to confuse\n    \n    // History\n    lastRole: 'BANKER' | 'PEASANT';\n    lastResult: 'WIN' | 'LOSS' | 'DRAW';\n}\n\nexport interface MatchLogEntry {\n    id: string;\n    timestamp: number;\n    bankerId: number;\n    mianZhangName: string;\n    results: {\n        playerId: number;\n        scoreChange: number;\n        patterns: string[];\n        isWinner: boolean;\n    }[];\n}\n\nexport interface GameHistory {\n    totalRounds: number;\n    bankerWins: number;\n    peasantWins: number;\n    lastRoundWinnerType: 'BANKER' | 'PEASANT' | 'DRAW';\n    aggressionModifier: number; // -1 (Conservative) to 1 (Aggressive)\n    aiLearningStates: Record<number, AILearningState>; // Map playerId to state\n    matchLogs: MatchLogEntry[]; // New: List of recent matches\n}\n\nexport interface Player {\n  id: number;\n  name: string;\n  type: PlayerType;\n  hand: Card[];\n  trickPile: TrickCard[]; // Cards played by this player (Visual Pile)\n  capturedCards: Card[];  // Cards won by this player (Logical Scoring Pile)\n  isDealer: boolean;\n  position: 'Bottom' | 'Right' | 'Top' | 'Left'; // UI positioning\n  score: number; // Total Game Score\n  isBaiLaoRevealed?: boolean; // Track if Millionaire identity is revealed\n  isSuspectedBaiLao?: boolean; // NEW: Track if player is suspected Millionaire (led Cash first)\n  avatarUrl?: string; // URL for player avatar\n  \n  // Profile info for Network players\n  profile?: UserProfile; \n  \n  // Round specific stats\n  roundDiao?: number;\n  roundScoreChange?: number;\n  roundPatterns?: string[];\n  \n  // Dynamic Strategy (for AI)\n  learningState?: AILearningState;\n}\n\nexport interface ChatMessage {\n  role: 'user' | 'model' | 'system';\n  text: string;\n  timestamp: number;\n}\n\nexport type SupportedLanguage = 'en' | 'zh_CN' | 'zh_TW' | 'ja' | 'ko';\n\nexport interface PatternDetail {\n    name: string;\n    score: number; // Points awarded or He value\n    cards: Card[]; // The specific cards that form this pattern\n    category: 'KAI_ZHU' | 'QIAO_MEN' | 'SE_YANG' | 'KC_SE_YANG';\n}\n\nexport interface KaiChongDetail {\n    playerId: number;\n    matchedCard: Card; // The pot card\n    sourceCards: Card[]; // The table cards used to match\n    score: number;     // Total Zhu points\n    individualScores?: number[]; // Breakdown of scores per source card\n    matchType: 'TONG' | 'BROTHER' | 'SHUANG_LIN' | 'SHUN_LING' | 'DAN_CHONG' | 'JIAN_LING' | 'OTHER';\n    priorityScore: number; // Internal for sorting (Twin > Double > Single > Gap)\n    description: string; // Formatted string\n}\n\nexport interface ScoreResult {\n    playerId: number;\n    trickCount: number; // Added missing property\n    diaoRawValue: number;\n    diaoPointChange: number;      \n    kaiZhuPointChange: number;    \n    qiaoMenPointChange: number;   \n    seYangPointChange: number;    \n    kaiChongPointChange: number;  \n    totalRoundChange: number;     \n    patterns: string[];           \n    patternDetails: PatternDetail[]; \n    kaiChongDetails: KaiChongDetail[]; \n    cardsWonCount: number;\n    visibleTrickCards: Card[]; // NEW: For displaying 0.5x trick indicators\n    scoringCards: Card[];      // NEW: For displaying 1.0x hot spot cards (Red/Green)\n    allCapturedCards?: Card[]; // NEW: All cards won by the player (for display)\n    penaltyPayerId?: number;      \n    penaltyReason?: string;       \n    violations: ViolationRecord[]; \n}\n\n// --- RISK & PENALTY ENGINE TYPES ---\n\nexport enum RiskLevel {\n    SAFE = 'SAFE',\n    NOTICE = 'NOTICE',       \n    WARNING = 'WARNING',     \n    PENALTY = 'PENALTY'      \n}\n\nexport enum TacticalPriority {\n    ANTI_BANKER = 'ANTI_BANKER',     \n    ANTI_BAI_LAO = 'ANTI_BAI_LAO',   \n    ANTI_SE_YANG = 'ANTI_SE_YANG'    \n}\n\nexport interface ViolationRecord {\n    playerId: number;\n    round: number;\n    card: Card;\n    ruleId: string;\n    riskLevel: RiskLevel;\n    tacticalContext: TacticalPriority;\n}\n\nexport interface RiskAssessment {\n    riskLevel: RiskLevel;\n    ruleId: string;\n    message: string; \n    tacticalContext: TacticalPriority;\n}\n","\nimport { Card, Suit, CardColor, CardRank, SupportedLanguage } from './types';\n\n// Helper to create a card\nconst createCard = (suit: Suit, name: string, val: number, color: CardColor, rank: CardRank, desc: string, id: string): Card => ({\n  id, suit, name, value: val, color, rank, description: desc\n});\n\n// Card IDs for Logic\nexport const ID_WAN_WAN = 'c_11';\nexport const ID_QIAN_WAN = 'c_10';\nexport const ID_BAI_WAN = 'c_9';\nexport const ID_90_WAN = 'c_8';\nexport const ID_20_WAN = 'c_1';\n\nexport const ID_9_GUAN = 's_9';\nexport const ID_8_GUAN = 's_8';\nexport const ID_6_GUAN = 's_6';\nexport const ID_5_GUAN = 's_5';\nexport const ID_1_GUAN = 's_1';\n\nexport const ID_9_SUO = 'k_9';\nexport const ID_1_SUO = 'k_1';\n\nexport const ID_KONG_WEN = 't_11';\nexport const ID_BAN_WEN = 't_10'; // Zhi Hua\nexport const ID_1_WEN = 't_9'; // Reversed Value logic: One Wen is High (Value 9)\nexport const ID_9_WEN = 't_1'; // Reversed Value logic: Nine Wen is Low (Value 1)\n\nexport const RED_CARDS = new Set([ID_WAN_WAN, ID_QIAN_WAN, ID_BAI_WAN, ID_9_GUAN, ID_8_GUAN, ID_9_SUO, 'k_8', ID_KONG_WEN, ID_BAN_WEN]);\nexport const GREEN_CARDS = new Set([ID_20_WAN, ID_1_GUAN, ID_1_SUO, ID_9_WEN]);\n\nexport const MA_DIAO_TUTOR_PROMPT = `\n你现在是“马吊大师”，一位精通中国古代纸牌游戏“马吊”的智者。\n你的目标是用中文教会用户“三防”策略和出牌规则。\n\n**策略：闲家三防 (Three Preventions)**\n1. **防庄家 (Prevent the Banker):** 如果庄家出牌可能赢墩，你必须尽全力捉打（Capture）。\n2. **防百老 (Prevent the Millionaire):** 持有“百万”的玩家很危险。阻止他赢两墩（正本）。\n3. **防色样 (Prevent Patterns):** 如果某人已经打出了3张同色样牌（如3张极/趣），绝不能让他赢第4张！\n\n**出牌规则 (Leading Rules):**\n1. **尊张限制:** 在同门的“肩”张出现之前，不要轻易首发“尊”（红）牌。\n2. **青张保护:** 如果你持有同门的“极”（绿/趣），不要过早打完手中的青牌（黑）。\n3. **十字门限制:** 除非你是“百老”（持有百万），否则避免首发十字门（钱/十）。\n4. **两门原则:** 尽量只打你最强的两门花色。不要随意开第三门。\n5. **千万禁手:** 永远不要首发“千万”。\n\n请用简洁、古风的中文解释这些规则。警告用户，违反这些规则可能导致“包赔”（Penalty），即一人承担所有输分！\n`;\n\n// Generating the Ma Diao Deck (40 Cards) based on the PDF table\nexport const generateDeck = (): Card[] => {\n  const deck: Card[] = [];\n\n  // 1. CASH SUIT (十) - 11 Cards\n  deck.push(createCard(Suit.CASH, '萬萬', 11, CardColor.RED, CardRank.ZUN, '宋江', ID_WAN_WAN)); \n  deck.push(createCard(Suit.CASH, '千萬', 10, CardColor.RED, CardRank.JIAN, '武松', ID_QIAN_WAN));\n  deck.push(createCard(Suit.CASH, '百萬', 9, CardColor.RED, CardRank.BAI, '阮小五', ID_BAI_WAN));\n  deck.push(createCard(Suit.CASH, '九十', 8, CardColor.BLACK, CardRank.QING, '阮小七', ID_90_WAN)); \n  deck.push(createCard(Suit.CASH, '八十', 7, CardColor.BLACK, CardRank.QING, '朱仝', 'c_7'));\n  deck.push(createCard(Suit.CASH, '七十', 6, CardColor.BLACK, CardRank.QING, '孫立', 'c_6'));\n  deck.push(createCard(Suit.CASH, '六十', 5, CardColor.BLACK, CardRank.QING, '呼延灼', 'c_5'));\n  deck.push(createCard(Suit.CASH, '五十', 4, CardColor.BLACK, CardRank.QING, '魯智深', 'c_4'));\n  deck.push(createCard(Suit.CASH, '四十', 3, CardColor.BLACK, CardRank.QING, '李逵', 'c_3'));\n  deck.push(createCard(Suit.CASH, '三十', 2, CardColor.BLACK, CardRank.QING, '楊志', 'c_2'));\n  deck.push(createCard(Suit.CASH, '二十', 1, CardColor.GREEN, CardRank.JI, '扈三娘', ID_20_WAN));\n\n  // 2. STRINGS SUIT (貫) - 9 Cards\n  deck.push(createCard(Suit.STRINGS, '九貫', 9, CardColor.RED, CardRank.ZUN, '雷橫', ID_9_GUAN));\n  deck.push(createCard(Suit.STRINGS, '八貫', 8, CardColor.RED, CardRank.JIAN, '索超', ID_8_GUAN));\n  deck.push(createCard(Suit.STRINGS, '七貫', 7, CardColor.BLACK, CardRank.QING, '秦明', 's_7'));\n  deck.push(createCard(Suit.STRINGS, '六貫', 6, CardColor.BLACK, CardRank.QING, '史進', ID_6_GUAN));\n  deck.push(createCard(Suit.STRINGS, '五貫', 5, CardColor.BLACK, CardRank.QING, '李俊', ID_5_GUAN));\n  deck.push(createCard(Suit.STRINGS, '四貫', 4, CardColor.BLACK, CardRank.QING, '柴進', 's_4'));\n  deck.push(createCard(Suit.STRINGS, '三貫', 3, CardColor.BLACK, CardRank.QING, '關勝', 's_3'));\n  deck.push(createCard(Suit.STRINGS, '二貫', 2, CardColor.BLACK, CardRank.QING, '花榮', 's_2'));\n  deck.push(createCard(Suit.STRINGS, '一貫', 1, CardColor.GREEN, CardRank.JI, '燕青', ID_1_GUAN));\n\n  // 3. COINS SUIT (索) - 9 Cards\n  deck.push(createCard(Suit.COINS, '九索', 9, CardColor.RED, CardRank.ZUN, '九條', ID_9_SUO));\n  deck.push(createCard(Suit.COINS, '八索', 8, CardColor.RED, CardRank.JIAN, '八條', 'k_8'));\n  deck.push(createCard(Suit.COINS, '七索', 7, CardColor.BLACK, CardRank.QING, '七條', 'k_7'));\n  deck.push(createCard(Suit.COINS, '六索', 6, CardColor.BLACK, CardRank.QING, '六條', 'k_6'));\n  deck.push(createCard(Suit.COINS, '五索', 5, CardColor.BLACK, CardRank.QING, '五條', 'k_5'));\n  deck.push(createCard(Suit.COINS, '四索', 4, CardColor.BLACK, CardRank.QING, '四條', 'k_4'));\n  deck.push(createCard(Suit.COINS, '三索', 3, CardColor.BLACK, CardRank.QING, '三條', 'k_3'));\n  deck.push(createCard(Suit.COINS, '二索', 2, CardColor.BLACK, CardRank.QING, '二條', 'k_2'));\n  deck.push(createCard(Suit.COINS, '一索', 1, CardColor.GREEN, CardRank.JI, '麼雞', ID_1_SUO));\n\n  // 4. TEXTS SUIT (文) - 11 Cards (Reversed Order)\n  // Red: Kong Wen (Zun) - 11\n  deck.push(createCard(Suit.TEXTS, '空文', 11, CardColor.RED, CardRank.ZUN, '王英', ID_KONG_WEN));\n  // Red: Ban Wen (Jian) - 10\n  deck.push(createCard(Suit.TEXTS, '半文', 10, CardColor.RED, CardRank.JIAN, '花束', ID_BAN_WEN));\n  // Black: 1 Wen (High) to 8 Wen (Low)\n  deck.push(createCard(Suit.TEXTS, '一文', 9, CardColor.BLACK, CardRank.QING, '一筒', ID_1_WEN));\n  deck.push(createCard(Suit.TEXTS, '二文', 8, CardColor.BLACK, CardRank.QING, '二筒', 't_8'));\n  deck.push(createCard(Suit.TEXTS, '三文', 7, CardColor.BLACK, CardRank.QING, '三筒', 't_7'));\n  deck.push(createCard(Suit.TEXTS, '四文', 6, CardColor.BLACK, CardRank.QING, '四筒', 't_6'));\n  deck.push(createCard(Suit.TEXTS, '五文', 5, CardColor.BLACK, CardRank.QING, '五筒', 't_5'));\n  deck.push(createCard(Suit.TEXTS, '六文', 4, CardColor.BLACK, CardRank.QING, '六筒', 't_4'));\n  deck.push(createCard(Suit.TEXTS, '七文', 3, CardColor.BLACK, CardRank.QING, '七筒', 't_3'));\n  deck.push(createCard(Suit.TEXTS, '八文', 2, CardColor.BLACK, CardRank.QING, '八筒', 't_2'));\n  // Green: 9 Wen (Low) - 1 (Ji)\n  deck.push(createCard(Suit.TEXTS, '九文', 1, CardColor.GREEN, CardRank.JI, '九筒', ID_9_WEN));\n\n  return deck;\n};\n\nexport const TRANSLATIONS: Record<SupportedLanguage, Record<string, string>> = {\n  en: {\n    title: 'MA DIAO MASTER',\n    subtitle: 'ANCIENT CHINESE BRIDGE',\n    enterGame: 'ENTER GAME',\n    roundStart: 'Hand Start',\n    trick: 'Trick',\n    yourTurn: 'Your Turn',\n    thinking: 'Thinking...',\n    winsTrick: 'takes the trick',\n    player: 'Player',\n    visibleCards: 'Table Cards',\n    diaoPoints: 'Diao (Penalty)',\n    kaiZhuPoints: 'Open Pot',\n    qiaoMenPoints: 'Knock',\n    seYangPoints: 'Melds/Patterns',\n    kaiChongPoints: 'Breakout',\n    score: 'Score',\n    nextRound: 'Next Deal',\n    patterns: 'Melds:',\n    confirm: 'CONFIRM',\n    \n    // Play Button Contexts (Bridge Style)\n    act_play: 'Play Card',\n    ctx_lead: 'Lead',\n    ctx_catch: 'Capture',\n    ctx_melt: 'Discard', // \"Slough\" is also used, but Discard is clearer for UI\n\n    act_deal: 'Lead',\n    act_catch: 'Take',\n    act_melt: 'Disc',\n    dir_north: 'North',\n    dir_south: 'South',\n    dir_east: 'East',\n    dir_west: 'West',\n    \n    // Patterns\n    pat_clouds: 'Azure Clouds (Ping Bu Qing Yun)',\n    pat_huang_hui_tu: 'Imperial Gathering',\n    pat_qian_jun_zhu: 'Iron Pillar',\n    pat_hua_du_dou: 'Flower Bodice',\n    pat_hua_bi_jian: 'Flower Shoulder',\n    pat_qiao_si_shang: 'Smart Four Rewards',\n    pat_qiao_si_jian: 'Smart Four Shoulders',\n    pat_tian_di_fen: 'Heaven & Earth',\n    pat_jian_tian_di: 'Shoulder Heaven & Earth',\n    pat_xiao_tian_di: 'Lesser Heaven & Earth',\n    pat_bai_duan_jian: 'Million Short Shoulder',\n    pat_bai_chang_jian: 'Million Long Shoulder',\n    pat_ji_duan_jian: 'Extreme Short Shoulder',\n    pat_ji_chang_jian: 'Extreme Long Shoulder',\n    pat_bai_ji_si_shang: 'Million Extreme Rewards',\n    pat_bai_ji_si_jian: 'Million Extreme Shoulders',\n    pat_bai_shang_si_ji: 'Million Reward Extremes',\n    pat_bai_jian_si_ji: 'Million Shoulder Extremes',\n    pat_jie_jie_gao: 'Rising Step by Step',\n    pat_duan_jian: 'Short Shoulder',\n    pat_dui_jian: 'Pair Shoulder',\n    pat_chang_jian: 'Long Shoulder',\n    pat_shang_ji_yu: 'Reward Carp Back',\n    pat_jian_ji_yu: 'Shoulder Carp Back',\n    pat_bai_ji_yu: 'Million Carp Back',\n    pat_six_table: 'Six Trick Diao',\n    pat_seven_table: 'Seven Trick Diao',\n    pat_eight_table: 'Eight Trick Diao',\n    pat_nei_sheng: 'Inner Saint Outer King',\n    pat_tian_ran_qu: 'Natural Charm',\n    pat_empress: 'Empress Ascension',\n    pat_dragon_leap: 'Dragon Leap',\n    pat_buddha_pearl: 'Buddha Pearl',\n    pat_flower_goddess: 'Flower Goddess',\n    pat_butterfly: 'Twin Butterflies',\n    pat_three_stack: 'Triple Stack',\n    pat_wind_flag: 'Wind Flag',\n    pat_mirror_person: 'Mirror Image',\n    pat_beauty_med: 'Beauty Meditating',\n    pat_borrow_flower: 'Borrow Flower',\n    pat_couple_reunion: 'Reunion',\n    pat_fairy_son: 'Fairy Gift',\n    pat_fo_chi_jiao: 'Barefoot Buddha',\n\n    aiDisabled: 'AI Tutor disabled (No API Key).',\n    masterTitle: 'Tutor',\n    masterName: 'Ma Diao Master',\n    meditating: 'Thinking...',\n    chatPlaceholder: 'Ask a rule...',\n    chatPlaceholderDisabled: 'AI Disabled',\n    soundOn: 'Sound On',\n    soundOff: 'Mute',\n    diff_easy: 'Novice',\n    diff_medium: 'Standard',\n    diff_hard: 'Expert',\n    quitGame: 'Quit',\n    quitConfirm: 'Quit current game? Progress will be lost.',\n    cancel: 'Cancel',\n    oneClickPlay: '1-Click',\n    \n    // Risk Alert Switch\n    riskAlertOn: 'Hints: ON',\n    riskAlertOff: 'Hints: OFF',\n    \n    // Strategy Warnings\n    risk_safe: 'Safe Play',\n    risk_warning: 'Strategy Warning',\n    risk_penalty: 'GRAND PENALTY',\n    risk_confirm_penalty: 'Accept Penalty & Play',\n    risk_confirm_warning: 'Ignore Warning',\n    risk_cancel: 'Reconsider',\n\n    warn_title: 'Strategy Alert',\n    warn_cash_lead: 'Only the \"Millionaire\" (Bai Lao) should lead Cash. Leading this risks a Penalty.',\n    warn_zun_early: 'Leading a \"Reward\" (Zun) before the \"Shoulder\" appears is dangerous.',\n    warn_qing_exhaust: 'Do not exhaust your Black (Qing) cards while holding the Extreme (Ji).',\n    warn_qian_wan: 'Leading \"Qian Wan\" is a forbidden move.',\n    warn_continue: 'Proceed anyway?',\n\n    // Kai Chong\n    phase_kai_chong: 'Breakout Phase',\n    flip_card: 'Draw',\n    kc_match_success: 'Matched!',\n    kc_match_fail: 'No Match',\n    kc_turn_pass: 'Pass',\n    kc_skip_ineligible: 'Skip (Ineligible)',\n    kc_single: 'Single',\n    kc_dan_chong: 'Single Match (1pt)',\n    kc_brother: 'Brother',\n    kc_double: 'Twin',\n    kc_triple: 'Triplet',\n    kc_seq: 'Sequential',\n    kc_gap: 'Gap',\n\n    // Tabs\n    tab_summary: 'Summary',\n    tab_kai_zhu: 'Pot / Knock',\n    tab_se_yang: 'Melds',\n    tab_kai_chong: 'Breakout',\n    tab_kc_se_yang: 'BO Melds',\n\n    // Kai Chong Se Yang\n    pat_kc_shi_hong: 'Ten Red Gathering',\n    pat_kc_man_tang_hong: 'Full House Red',\n    pat_kc_10_zui: 'Drunken Beauty (10)',\n    pat_kc_9_zui: 'Drunken Beauty (9)',\n    pat_kc_8_zui: 'Drunken Beauty (8)',\n    pat_kc_ju_qing: 'All Same Clan',\n    pat_kc_shi_tong: 'Ten of a Kind',\n    pat_kc_jiu_tong: 'Nine of a Kind',\n    pat_kc_qian_shi_quan: 'Full Cash/Texts',\n    pat_kc_guan_suo_quan: 'Full Strings/Coins',\n    pat_kc_tai_ji: 'Tai Chi (7+1)',\n    pat_kc_yuan_yang: 'Mandarin Duck 7',\n    pat_kc_lian_huan: 'Chain 7',\n    pat_kc_one_shot_7: 'One Shot 7',\n    pat_kc_one_shot_6: 'One Shot 6',\n    pat_kc_yin_hua: 'Stamp',\n    pat_kc_jin_jue: 'Gold Dig',\n    pat_kc_yin_jue: 'Silver Dig',\n    pat_kc_shuang_jue: 'Double Dig',\n    pat_kc_duo_jin: 'Trophy Snatch',\n  },\n  zh_CN: {\n    title: '馬吊大師',\n    subtitle: '古风纸牌游戏',\n    enterGame: '开始游戏',\n    roundStart: '回合开始',\n    trick: '第几墩',\n    yourTurn: '轮到你了',\n    thinking: '思考中...',\n    winsTrick: '赢得此墩',\n    player: '玩家',\n    visibleCards: '得桌',\n    diaoPoints: '吊数',\n    kaiZhuPoints: '开注',\n    qiaoMenPoints: '敲门',\n    seYangPoints: '色样',\n    kaiChongPoints: '开冲',\n    score: '得分',\n    nextRound: '下一局',\n    patterns: '牌型:',\n    confirm: '确认',\n    \n    act_play: '出牌',\n    ctx_lead: '发牌',\n    ctx_catch: '捉牌',\n    ctx_melt: '灭牌',\n\n    act_deal: '发',\n    act_catch: '捉',\n    act_melt: '灭',\n    dir_north: '北',\n    dir_south: '南',\n    dir_east: '东',\n    dir_west: '西',\n    pat_clouds: '平步青云',\n    pat_huang_hui_tu: '皇会图',\n    pat_qian_jun_zhu: '千均柱',\n    pat_hua_du_dou: '花肚兜',\n    pat_hua_bi_jian: '花比肩',\n    pat_qiao_si_shang: '巧四赏',\n    pat_qiao_si_jian: '巧四肩',\n    pat_tian_di_fen: '天地分',\n    pat_jian_tian_di: '肩天地分',\n    pat_xiao_tian_di: '小天地分',\n    pat_bai_duan_jian: '百短肩',\n    pat_bai_chang_jian: '百长肩',\n    pat_ji_duan_jian: '极短肩',\n    pat_ji_chang_jian: '极长肩',\n    pat_bai_ji_si_shang: '百极四赏',\n    pat_bai_ji_si_jian: '百极四肩',\n    pat_bai_shang_si_ji: '百赏四极',\n    pat_bai_jian_si_ji: '百肩四极',\n    pat_jie_jie_gao: '节节高',\n    pat_duan_jian: '短肩',\n    pat_dui_jian: '对肩',\n    pat_chang_jian: '长肩',\n    pat_shang_ji_yu: '赏鲫鱼背',\n    pat_jian_ji_yu: '肩鲫鱼背',\n    pat_bai_ji_yu: '百鲫鱼背',\n    pat_six_table: '六桌吊',\n    pat_seven_table: '七桌吊',\n    pat_eight_table: '八桌吊',\n    pat_nei_sheng: '内圣外王',\n    pat_tian_ran_qu: '天然趣',\n    pat_empress: '女帝登基',\n    pat_dragon_leap: '龙门跃',\n    pat_buddha_pearl: '佛顶珠',\n    pat_flower_goddess: '散花天女',\n    pat_butterfly: '蝶双飞',\n    pat_three_stack: '三叠趣',\n    pat_wind_flag: '顺风旗',\n    pat_mirror_person: '镜中人',\n    pat_beauty_med: '美女参禅',\n    pat_borrow_flower: '借花献佛',\n    pat_couple_reunion: '夫妻团圆',\n    pat_fairy_son: '天仙送子',\n    pat_fo_chi_jiao: '佛赤脚',\n    aiDisabled: 'AI导师已禁用 (未配置API Key)',\n    masterTitle: '导师',\n    masterName: '马吊大师',\n    meditating: '冥想中...',\n    chatPlaceholder: '询问规则...',\n    chatPlaceholderDisabled: 'AI已禁用',\n    soundOn: '开启声音',\n    soundOff: '静音',\n    diff_easy: '简单',\n    diff_medium: '中等',\n    diff_hard: '困难',\n    quitGame: '退出游戏',\n    quitConfirm: '确定要退出吗？当前进度将丢失。',\n    cancel: '取消',\n    oneClickPlay: '单击出牌',\n    \n    riskAlertOn: '提示: 开',\n    riskAlertOff: '提示: 关',\n    risk_safe: '安全',\n    risk_warning: '战术警示',\n    risk_penalty: '严重违例 (包赔)',\n    risk_confirm_penalty: '坚持出牌 (承担包赔)',\n    risk_confirm_warning: '忽略警告',\n    risk_cancel: '重新考虑',\n    \n    warn_title: '战术警示',\n    warn_cash_lead: '非“百老”之家不应首发十字门（十、钱）。此举可能导致“包赔”。',\n    warn_zun_early: '同门“肩”张未现身前，首发“赏”（尊）张风险极大。',\n    warn_qing_exhaust: '持有“极”（趣）张时，切勿将同门青张发完。',\n    warn_qian_wan: '首发“千万”属于禁手。',\n    warn_continue: '坚持出牌（可能导致包赔）？',\n\n    phase_kai_chong: '开冲阶段',\n    flip_card: '翻底牌',\n    kc_match_success: '开冲成功!',\n    kc_match_fail: '无匹配',\n    kc_turn_pass: '过',\n    kc_skip_ineligible: '跳过 (无红/趣)',\n    kc_single: '单冲',\n    kc_dan_chong: '单冲 (1分)',\n    kc_brother: '兄弟冲',\n    kc_double: '双胞胎冲',\n    kc_triple: '三胞胎冲',\n    kc_seq: '顺领冲',\n    kc_gap: '间领冲',\n\n    tab_summary: '结算',\n    tab_kai_zhu: '开注 / 敲门',\n    tab_se_yang: '色样',\n    tab_kai_chong: '开冲明细',\n    tab_kc_se_yang: '冲成色样',\n\n    // Kai Chong Se Yang\n    pat_kc_shi_hong: '十红聚会',\n    pat_kc_man_tang_hong: '满堂红',\n    pat_kc_10_zui: '十红醉楊妃',\n    pat_kc_9_zui: '九红醉楊妃',\n    pat_kc_8_zui: '八红醉楊妃',\n    pat_kc_ju_qing: '具庆堂',\n    pat_kc_shi_tong: '十同',\n    pat_kc_jiu_tong: '九同',\n    pat_kc_qian_shi_quan: '钱十全门',\n    pat_kc_guan_suo_quan: '贯索全门',\n    pat_kc_tai_ji: '太极图',\n    pat_kc_yuan_yang: '鸳鸯七同',\n    pat_kc_lian_huan: '连环七同',\n    pat_kc_one_shot_7: '一冲七',\n    pat_kc_one_shot_6: '一冲六',\n    pat_kc_yin_hua: '印花',\n    pat_kc_jin_jue: '金掘藏',\n    pat_kc_yin_jue: '银掘藏',\n    pat_kc_shuang_jue: '双掘藏',\n    pat_kc_duo_jin: '夺锦标',\n  },\n  zh_TW: {\n    title: '馬吊大師',\n    subtitle: '古風紙牌遊戲',\n    enterGame: '進入遊戲',\n    roundStart: '回合開始',\n    trick: '第幾墩',\n    yourTurn: '輪到你了',\n    thinking: '思考中...',\n    winsTrick: '贏得此墩',\n    player: '玩家',\n    visibleCards: '得桌',\n    diaoPoints: '吊數',\n    kaiZhuPoints: '開註',\n    qiaoMenPoints: '敲門',\n    seYangPoints: '色樣',\n    kaiChongPoints: '開衝',\n    score: '得分',\n    nextRound: '下一局',\n    patterns: '牌型:',\n    confirm: '確認',\n    \n    act_play: '出牌',\n    ctx_lead: '發牌',\n    ctx_catch: '捉牌',\n    ctx_melt: '滅牌',\n\n    act_deal: '發',\n    act_catch: '捉',\n    act_melt: '滅',\n    dir_north: '北',\n    dir_south: '南',\n    dir_east: '東',\n    dir_west: '西',\n    pat_clouds: '平步青雲',\n    pat_huang_hui_tu: '皇會圖',\n    pat_qian_jun_zhu: '千均柱',\n    pat_hua_du_dou: '花肚兜',\n    pat_hua_bi_jian: '花比肩',\n    pat_qiao_si_shang: '巧四賞',\n    pat_qiao_si_jian: '巧四肩',\n    pat_tian_di_fen: '天地分',\n    pat_jian_tian_di: '肩天地分',\n    pat_xiao_tian_di: '小天地分',\n    pat_bai_duan_jian: '百短肩',\n    pat_bai_chang_jian: '百長肩',\n    pat_ji_duan_jian: '極短肩',\n    pat_ji_chang_jian: '極長肩',\n    pat_bai_ji_si_shang: '百極四賞',\n    pat_bai_ji_si_jian: '百極四肩',\n    pat_bai_shang_si_ji: '百賞四極',\n    pat_bai_jian_si_ji: '百肩四極',\n    pat_jie_jie_gao: '節節高',\n    pat_duan_jian: '短肩',\n    pat_dui_jian: '對肩',\n    pat_chang_jian: '長肩',\n    pat_shang_ji_yu: '賞鯽魚背',\n    pat_jian_ji_yu: '肩鯽魚背',\n    pat_bai_ji_yu: '百鯽魚背',\n    pat_six_table: '六桌吊',\n    pat_seven_table: '七桌吊',\n    pat_eight_table: '八桌吊',\n    pat_nei_sheng: '內聖外王',\n    pat_tian_ran_qu: '天然趣',\n    pat_empress: '女帝登基',\n    pat_dragon_leap: '龍門躍',\n    pat_buddha_pearl: '佛頂珠',\n    pat_flower_goddess: '散花天女',\n    pat_butterfly: '蝶雙飛',\n    pat_three_stack: '三疊趣',\n    pat_wind_flag: '順風旗',\n    pat_mirror_person: '鏡中人',\n    pat_beauty_med: '美女參禪',\n    pat_borrow_flower: '借花獻佛',\n    pat_couple_reunion: '夫妻團圓',\n    pat_fairy_son: '天仙送子',\n    pat_fo_chi_jiao: '佛赤腳',\n    aiDisabled: 'AI導師已禁用 (未配置API Key)',\n    masterTitle: '導師',\n    masterName: '馬吊大師',\n    meditating: '冥想中...',\n    chatPlaceholder: '詢問規則...',\n    chatPlaceholderDisabled: 'AI已禁用',\n    soundOn: '開啟聲音',\n    soundOff: '靜音',\n    diff_easy: '簡單',\n    diff_medium: '中等',\n    diff_hard: '困難',\n    quitGame: '退出遊戲',\n    quitConfirm: '確定要退出嗎？當前進度將丟失。',\n    cancel: '取消',\n    oneClickPlay: '單擊出牌',\n\n    riskAlertOn: '提示: 開',\n    riskAlertOff: '提示: 關',\n    risk_safe: '安全',\n    risk_warning: '戰術警示',\n    risk_penalty: '嚴重違例 (包賠)',\n    risk_confirm_penalty: '堅持出牌 (承擔包賠)',\n    risk_confirm_warning: '忽略警告',\n    risk_cancel: '重新考慮',\n\n    warn_title: '戰術警示',\n    warn_cash_lead: '非“百老”之家不應首發十字門（十、錢）。此舉可能導致“包賠”。',\n    warn_zun_early: '同門“肩”張未現身前，首發“賞”（尊）張風險極大。',\n    warn_qing_exhaust: '持有“極”（趣）張時，切勿將同門青張發完。',\n    warn_qian_wan: '首發“千萬”屬於禁手。',\n    warn_continue: '堅持出牌（可能導致包賠）？',\n\n    phase_kai_chong: '開衝階段',\n    flip_card: '翻底牌',\n    kc_match_success: '開衝成功!',\n    kc_match_fail: '無匹配',\n    kc_turn_pass: '過',\n    kc_skip_ineligible: '跳過 (無紅/趣)',\n    kc_single: '單衝',\n    kc_dan_chong: '單衝 (1分)',\n    kc_brother: '兄弟衝',\n    kc_double: '雙胞胎衝',\n    kc_triple: '三胞胎衝',\n    kc_seq: '順領衝',\n    kc_gap: '間領衝',\n\n    tab_summary: '結算',\n    tab_kai_zhu: '開註 / 敲門',\n    tab_se_yang: '色樣',\n    tab_kai_chong: '開衝明細',\n    tab_kc_se_yang: '衝成色樣',\n\n    // Kai Chong Se Yang\n    pat_kc_shi_hong: '十紅聚會',\n    pat_kc_man_tang_hong: '滿堂紅',\n    pat_kc_10_zui: '十紅醉楊妃',\n    pat_kc_9_zui: '九紅醉楊妃',\n    pat_kc_8_zui: '八紅醉楊妃',\n    pat_kc_ju_qing: '具慶堂',\n    pat_kc_shi_tong: '十同',\n    pat_kc_jiu_tong: '九同',\n    pat_kc_qian_shi_quan: '錢十全門',\n    pat_kc_guan_suo_quan: '貫索全門',\n    pat_kc_tai_ji: '太極圖',\n    pat_kc_yuan_yang: '鴛鴦七同',\n    pat_kc_lian_huan: '連環七同',\n    pat_kc_one_shot_7: '一衝七',\n    pat_kc_one_shot_6: '一衝六',\n    pat_kc_yin_hua: '印花',\n    pat_kc_jin_jue: '金掘藏',\n    pat_kc_yin_jue: '銀掘藏',\n    pat_kc_shuang_jue: '雙掘藏',\n    pat_kc_duo_jin: '奪錦標',\n  },\n  ja: {\n    title: '馬吊マスター',\n    subtitle: '古代中国のカードゲーム',\n    enterGame: 'ゲーム開始',\n    roundStart: '配牌完了',\n    trick: 'トリック',\n    yourTurn: 'あなたの番',\n    thinking: '思考中...',\n    winsTrick: 'が獲得',\n    player: 'プレイヤー',\n    visibleCards: '獲得札',\n    diaoPoints: '吊数',\n    kaiZhuPoints: '開注',\n    qiaoMenPoints: '敲門',\n    seYangPoints: '役 (Se Yang)',\n    kaiChongPoints: '開衝 (ボーナス)',\n    score: 'スコア',\n    nextRound: '次の局へ',\n    patterns: '成立役:',\n    confirm: '確認',\n    \n    // Play Button Contexts (Mahjong/Card Game Style)\n    act_play: '打牌',\n    ctx_lead: '先発 (Lead)',\n    ctx_catch: '奪取 (Take)',\n    ctx_melt: '捨牌 (Discard)',\n\n    act_deal: '出',\n    act_catch: '奪',\n    act_melt: '捨',\n    dir_north: '北家',\n    dir_south: '南家',\n    dir_east: '東家',\n    dir_west: '西家',\n\n    pat_clouds: '平步青雲',\n    pat_huang_hui_tu: '皇会図',\n    pat_qian_jun_zhu: '千均柱',\n    pat_nei_sheng: '内聖外王',\n    pat_tian_ran_qu: '天然趣',\n    pat_empress: '女帝登基',\n    pat_dragon_leap: '龍門躍',\n    pat_buddha_pearl: '佛頂珠',\n    pat_flower_goddess: '散花天女',\n    pat_butterfly: '蝶雙飛',\n    pat_three_stack: '三疊趣',\n    pat_wind_flag: '順風旗',\n    pat_mirror_person: '鏡中人',\n    pat_beauty_med: '美女參禪',\n    pat_borrow_flower: '借花献佛',\n    pat_couple_reunion: '夫妻團圓',\n    pat_fairy_son: '天仙送子',\n    pat_fo_chi_jiao: '佛赤脚 (仏の裸足)',\n    aiDisabled: 'AI無効',\n    masterTitle: '先生',\n    masterName: '馬吊大師',\n    meditating: '瞑想中...',\n    chatPlaceholder: 'ルールを聞く...',\n    chatPlaceholderDisabled: 'AI無効',\n    soundOn: '音オン',\n    soundOff: '音オフ',\n    diff_easy: '初級',\n    diff_medium: '中級',\n    diff_hard: '上級',\n    quitGame: '終了',\n    quitConfirm: '終了しますか？進行状況は失われます。',\n    cancel: 'キャンセル',\n    oneClickPlay: '1クリック',\n\n    riskAlertOn: 'ヒント: オン',\n    riskAlertOff: 'ヒント: オフ',\n    risk_safe: '安全',\n    risk_warning: '戦略警告',\n    risk_penalty: '責任払い (パオ)',\n    risk_confirm_penalty: '続行 (責任払い)',\n    risk_confirm_warning: '警告を無視',\n    risk_cancel: '再考する',\n\n    warn_title: '戦略警告',\n    warn_cash_lead: '「百老」でない場合、十字門（十、金）を先発してはいけません。責任払いのリスクがあります。',\n    warn_zun_early: '同スートの「肩」が出る前に「賞」（尊）を出すのは危険です。',\n    warn_qing_exhaust: '「極」（趣）を持っている場合、同スートの青牌を使い切ってはいけません。',\n    warn_qian_wan: '「千万」を先発するのは禁止手（チョンボ）です。',\n    warn_continue: '続けますか（責任払いの可能性あり）？',\n\n    phase_kai_chong: '開衝フェーズ',\n    flip_card: 'めくる',\n    kc_match_success: 'マッチ!',\n    kc_match_fail: 'マッチなし',\n    kc_turn_pass: 'パス',\n    kc_skip_ineligible: 'スキップ',\n    kc_single: '単衝',\n    kc_dan_chong: '単衝 (1点)',\n    kc_brother: '兄弟衝',\n    kc_double: '双子衝',\n    kc_triple: '三つ子衝',\n    kc_seq: '順領衝',\n    kc_gap: '間領衝',\n\n    tab_summary: '集計',\n    tab_kai_zhu: '開注 / 敲門',\n    tab_se_yang: '役種',\n    tab_kai_chong: '開衝',\n    tab_kc_se_yang: '衝成役',\n\n    pat_kc_shi_hong: '十紅聚会',\n    pat_kc_man_tang_hong: '滿堂紅',\n    pat_kc_10_zui: '十紅醉楊妃',\n    pat_kc_9_zui: '九紅醉楊妃',\n    pat_kc_8_zui: '八紅醉楊妃',\n    pat_kc_ju_qing: '具慶堂',\n    pat_kc_shi_tong: '十同',\n    pat_kc_jiu_tong: '九同',\n    pat_kc_qian_shi_quan: '錢十全門',\n    pat_kc_guan_suo_quan: '貫索全門',\n    pat_kc_tai_ji: '太極圖',\n    pat_kc_yuan_yang: '鴛鴦七同',\n    pat_kc_lian_huan: '連環七同',\n    pat_kc_one_shot_7: '一衝七',\n    pat_kc_one_shot_6: '一衝六',\n    pat_kc_yin_hua: '印花',\n    pat_kc_jin_jue: '金掘藏',\n    pat_kc_yin_jue: '銀掘藏',\n    pat_kc_shuang_jue: '雙掘藏',\n    pat_kc_duo_jin: '奪錦標',\n  },\n  ko: {\n    title: '마조 마스터',\n    subtitle: '고대 중국 카드 게임',\n    enterGame: '게임 시작',\n    roundStart: '판 시작',\n    trick: '트릭',\n    yourTurn: '내 차례',\n    thinking: '생각 중...',\n    winsTrick: '획득',\n    player: '플레이어',\n    visibleCards: '획득한 패',\n    diaoPoints: '조',\n    kaiZhuPoints: '개주',\n    qiaoMenPoints: '고문',\n    seYangPoints: '색양 (족보)',\n    kaiChongPoints: '개충',\n    score: '점수',\n    nextRound: '다음 판',\n    patterns: '족보:',\n    confirm: '확인',\n    \n    // Play Button Contexts (Hwatu/Go-Stop Style)\n    act_play: '내기',\n    ctx_lead: '선 (Lead)',\n    ctx_catch: '먹기 (Capture)',\n    ctx_melt: '버림 (Discard)',\n\n    act_deal: '선',\n    act_catch: '먹',\n    act_melt: '버',\n    dir_north: '북',\n    dir_south: '남',\n    dir_east: '동',\n    dir_west: '서',\n    pat_clouds: '평보청운',\n    pat_huang_hui_tu: '황회도',\n    pat_qian_jun_zhu: '천균주',\n    pat_hua_du_dou: '화두두',\n    pat_hua_bi_jian: '화비견',\n    pat_qiao_si_shang: '교사상',\n    pat_qiao_si_jian: '교사견',\n    pat_tian_di_fen: '천지분',\n    pat_jian_tian_di: '견천지분',\n    pat_xiao_tian_di: '소천지분',\n    pat_bai_duan_jian: '백단견',\n    pat_bai_chang_jian: '백장견',\n    pat_ji_duan_jian: '극단견',\n    pat_ji_chang_jian: '극장견',\n    pat_bai_ji_si_shang: '백극사상',\n    pat_bai_ji_si_jian: '백극사견',\n    pat_bai_shang_si_ji: '백상사극',\n    pat_bai_jian_si_ji: '백견사극',\n    pat_jie_jie_gao: '절절고',\n    pat_duan_jian: '단견',\n    pat_dui_jian: '대견',\n    pat_chang_jian: '장견',\n    pat_shang_ji_yu: '상즉어배',\n    pat_jian_ji_yu: '견즉어배',\n    pat_bai_ji_yu: '백즉어배',\n    pat_six_table: '육탁조',\n    pat_seven_table: '칠탁조',\n    pat_eight_table: '팔탁조',\n    pat_nei_sheng: '내성외왕',\n    pat_tian_ran_qu: '천연취',\n    pat_empress: '여제등극',\n    pat_dragon_leap: '용문약',\n    pat_buddha_pearl: '불정주',\n    pat_flower_goddess: '산화천녀',\n    pat_butterfly: '접쌍비',\n    pat_three_stack: '삼첩취',\n    pat_wind_flag: '순풍기',\n    pat_mirror_person: '경중인',\n    pat_beauty_med: '미녀참선',\n    pat_borrow_flower: '차화헌불',\n    pat_couple_reunion: '부처단원',\n    pat_fairy_son: '천선송자',\n    pat_fo_chi_jiao: '불적각 (부처의 맨발)',\n    aiDisabled: 'AI 비활성화됨',\n    masterTitle: '스승',\n    masterName: '마조 대사',\n    meditating: '명상 중...',\n    chatPlaceholder: '규칙 물어보기...',\n    chatPlaceholderDisabled: 'AI 꺼짐',\n    soundOn: '소리 켜기',\n    soundOff: '소리 끄기',\n    diff_easy: '하수',\n    diff_medium: '중수',\n    diff_hard: '고수',\n    quitGame: '게임 종료',\n    quitConfirm: '정말 종료하시겠습니까? 진행 상황이 손실됩니다.',\n    cancel: '취소',\n    oneClickPlay: '원클릭',\n\n    riskAlertOn: '알림: 켜짐',\n    riskAlertOff: '알림: 꺼짐',\n    risk_safe: '안전',\n    risk_warning: '전술 경고',\n    risk_penalty: '독박 (벌칙)',\n    risk_confirm_penalty: '독박 감수하고 진행',\n    risk_confirm_warning: '경고 무시',\n    risk_cancel: '다시 생각하기',\n\n    warn_title: '전술 경고',\n    warn_cash_lead: '백만(Bai Wan)을 가진 \"백로\"가 아니라면 십(Cash) 무늬를 먼저 내지 마십시오. 독박 위험이 있습니다.',\n    warn_zun_early: '같은 무늬의 \"견(Shoulder)\" 카드가 나오기 전에 \"상(Reward/Zun)\" 카드를 먼저 내는 것은 위험합니다.',\n    warn_qing_exhaust: '\"극(Extreme/Ji)\" 카드를 가지고 있다면, 같은 무늬의 청(Black) 카드를 다 써버리지 마십시오.',\n    warn_qian_wan: '\"천만(Qian Wan)\"을 먼저 내는 것은 금지된 수입니다.',\n    warn_continue: '계속하시겠습니까 (독박 가능성 있음)?',\n\n    phase_kai_chong: '개충 단계',\n    flip_card: '뒤집기',\n    kc_match_success: '매치 성공!',\n    kc_match_fail: '매치 없음',\n    kc_turn_pass: '패스',\n    kc_skip_ineligible: '건너뜀',\n    kc_single: '단충',\n    kc_dan_chong: '단충 (1점)',\n    kc_brother: '형제충',\n    kc_double: '쌍포태충',\n    kc_triple: '삼포태충',\n    kc_seq: '순령충',\n    kc_gap: '간령충',\n\n    tab_summary: '요약',\n    tab_kai_zhu: '개주 / 고문',\n    tab_se_yang: '색양',\n    tab_kai_chong: '개충',\n    tab_kc_se_yang: '개충 색양',\n\n    pat_kc_shi_hong: '십홍집합',\n    pat_kc_man_tang_hong: '만당홍',\n    pat_kc_10_zui: '십홍취양비',\n    pat_kc_9_zui: '구홍취양비',\n    pat_kc_8_zui: '팔홍취양비',\n    pat_kc_ju_qing: '구경당',\n    pat_kc_shi_tong: '십동',\n    pat_kc_jiu_tong: '구동',\n    pat_kc_qian_shi_quan: '전십전문',\n    pat_kc_guan_suo_quan: '관색전문',\n    pat_kc_tai_ji: '태극도',\n    pat_kc_yuan_yang: '원앙칠동',\n    pat_kc_lian_huan: '연환칠동',\n    pat_kc_one_shot_7: '일충칠',\n    pat_kc_one_shot_6: '일충육',\n    pat_kc_yin_hua: '인화',\n    pat_kc_jin_jue: '금굴장',\n    pat_kc_yin_jue: '은굴장',\n    pat_kc_shuang_jue: '쌍굴장',\n    pat_kc_duo_jin: '탈금표',\n  }\n};\n","\nimport { Card, Suit, CardRank, CardColor, KaiChongDetail, SpecialCaptureFlags } from '../types';\nimport { \n    ID_WAN_WAN, ID_QIAN_WAN, ID_BAI_WAN, ID_20_WAN, ID_90_WAN\n} from '../constants';\n\n// --- CONFIGURATION ---\n// Values updated to represent the actual Jin Zhang (Red/Green) anchors\nconst SUIT_CONFIG = {\n    [Suit.TEXTS]: { \n        viceShoulderVal: 10, // Ban Wen (Red)\n        viceExtremeVal: 1,   // 9 Wen (Green)\n    },\n    [Suit.CASH]: {\n        viceShoulderVal: 9,  // Bai Wan (Red) - Note: 90(8) is Qing\n        viceExtremeVal: 1,   // 20 Wan (Green)\n    },\n    [Suit.STRINGS]: {\n        viceShoulderVal: 8,  // 8 Guan (Red)\n        viceExtremeVal: 1    // 1 Guan (Green)\n    },\n    [Suit.COINS]: {\n        viceShoulderVal: 8,  // 8 Suo (Red)\n        viceExtremeVal: 1    // 1 Suo (Green)\n    }\n};\n\n// --- HELPERS ---\n\nconst isBigFourCash = (value: number) => [11, 10, 9, 1].includes(value);\nconst isJinZhang = (card: Card) => card.color === CardColor.RED || card.color === CardColor.GREEN;\n\n// Neighbor Check\nconst isNeighbor = (val1: number, val2: number, suit: Suit): boolean => {\n    const diff = Math.abs(val1 - val2);\n    if (diff === 1) return true;\n    \n    // Cyclic Rules\n    if (suit === Suit.CASH || suit === Suit.TEXTS) {\n        if ((val1 === 11 && val2 === 1) || (val1 === 1 && val2 === 11)) return true;\n    } else {\n        if ((val1 === 9 && val2 === 1) || (val1 === 1 && val2 === 9)) return true;\n    }\n    return false;\n};\n\n// Restricted Qing check\nconst isRestrictedQing = (val: number, suit: Suit): boolean => {\n    // Determine the range of Qing cards based on Jin Zhang anchors\n    const config = SUIT_CONFIG[suit];\n    if (!config) return false;\n    \n    // Calculate range between the two anchors (exclusive)\n    const min = Math.min(config.viceExtremeVal, config.viceShoulderVal);\n    const max = Math.max(config.viceExtremeVal, config.viceShoulderVal);\n    \n    // Cash 90 (Value 8) is safe from generic restrictions, handled by specific rules below\n    if (suit === Suit.CASH && val === 8) return false;\n\n    // If value is strictly between anchors, it is a restricted Qing\n    return val > min && val < max;\n};\n\n// Connectivity Check (BFS)\nconst checkConnectivity = (startVal: number, targetVal: number, suit: Suit, unionSet: Set<number>): boolean => {\n    if (startVal === targetVal) return true;\n    if (isNeighbor(startVal, targetVal, suit)) return true;\n\n    // Special Cash Jump: 9 (Bai) connects to 8 (90)\n    if (suit === Suit.CASH) {\n        if ((startVal === 9 && targetVal === 8) || (startVal === 8 && targetVal === 9)) return true;\n    }\n\n    const visited = new Set<number>();\n    const queue = [startVal];\n    visited.add(startVal);\n\n    while (queue.length > 0) {\n        const current = queue.shift()!;\n        \n        // Check direct neighbor or special cash connection\n        if (isNeighbor(current, targetVal, suit)) return true;\n        if (suit === Suit.CASH && ((current === 9 && targetVal === 8) || (current === 8 && targetVal === 9))) return true;\n\n        for (const uVal of unionSet) {\n            if (!visited.has(uVal)) {\n                let connected = isNeighbor(current, uVal, suit);\n                if (!connected && suit === Suit.CASH) {\n                    if ((current === 9 && uVal === 8) || (current === 8 && uVal === 9)) connected = true;\n                }\n                \n                if (connected) {\n                    visited.add(uVal);\n                    queue.push(uVal);\n                }\n            }\n        }\n    }\n    return false;\n};\n\nconst hasRoot = (val: number, suit: Suit, uSet: Set<number>): boolean => {\n    const config = SUIT_CONFIG[suit];\n    if (!config) return false;\n\n    if (uSet.has(config.viceShoulderVal) && checkConnectivity(val, config.viceShoulderVal, suit, uSet)) return true;\n    if (uSet.has(config.viceExtremeVal) && checkConnectivity(val, config.viceExtremeVal, suit, uSet)) return true;\n    // Cash 90 (8) is also a valid root/connector for Cash\n    if (suit === Suit.CASH && uSet.has(8) && checkConnectivity(val, 8, suit, uSet)) return true;\n\n    return false;\n};\n\nconst getCaptureMultiplier = (card: Card, flags: SpecialCaptureFlags): number => {\n    if (card.suit !== Suit.CASH) return 1;\n    if (card.value === 11) {\n        if (flags.wanCaughtQian && flags.qianCaughtBai) return 3;\n        if (flags.wanCaughtQian || flags.wanCaughtBai) return 2;\n    } else if (card.value === 10) {\n        if (flags.qianCaughtBai) return 2;\n    }\n    return 1;\n};\n\n// --- SCORING LOGIC ---\n\nexport interface KaiChongScoreResult {\n    score: number;\n    matchType: 'TONG' | 'BROTHER' | 'SHUANG_LIN' | 'SHUN_LING' | 'DAN_CHONG' | 'JIAN_LING' | 'OTHER';\n    description: string;\n    validCards: Card[];\n    priority: number;\n}\n\nexport const evaluateKaiChong = (\n    player: { capturedCards: Card[], id: number },\n    potCard: Card,\n    history: KaiChongDetail[],\n    specialCaptures: SpecialCaptureFlags\n): KaiChongScoreResult | null => {\n    \n    // Filter used\n    const setB_Ids = new Set<string>();\n    if (history) { history.forEach(h => { if (h.playerId === player.id) setB_Ids.add(h.matchedCard.id); }); }\n\n    // U Set\n    const uSet = new Set<number>();\n    player.capturedCards.forEach(c => { if (c.suit === potCard.suit) uSet.add(c.value); });\n    uSet.add(potCard.value); \n\n    const sourceCards = player.capturedCards.filter(c => c.suit === potCard.suit && !setB_Ids.has(c.id));\n    if (sourceCards.length === 0) return null;\n\n    let totalScore = 0;\n    const validCards: Card[] = [];\n    const descriptions: string[] = [];\n    let minLinearDistance = 999; \n\n    // --- CHECK FOR SPECIAL CASH CASE: Bai(9) + 80(7) + Pot(90/8) ---\n    if (potCard.suit === Suit.CASH && potCard.value === 8) {\n        const baiCard = sourceCards.find(c => c.value === 9);\n        const card80 = sourceCards.find(c => c.value === 7);\n        \n        if (baiCard && card80) {\n            return {\n                score: 5,\n                matchType: 'JIAN_LING', \n                description: '间领冲 (5分): 百万顺冲(2) + 八十逆冲(3)',\n                validCards: [baiCard, card80],\n                priority: 0 \n            };\n        }\n    }\n\n    // Standard Logic\n    for (const card of sourceCards) {\n        let score = 0;\n        let desc = '';\n        let multiplier = getCaptureMultiplier(card, specialCaptures);\n        const sVal = card.value;\n        const pVal = potCard.value;\n        const suit = card.suit;\n\n        // RULE: Jian Restriction (General)\n        if (card.rank === CardRank.JIAN) {\n            const zunVal = (suit === Suit.CASH || suit === Suit.TEXTS) ? 11 : 9;\n            if (!uSet.has(zunVal)) continue; \n        }\n\n        // RULE: Cash Suit Special - \"Jiushi (90)\" acts as Shoulder\n        // It cannot match with Qing (e.g. 80, 70...) unless Bai (9) is in Union Set.\n        if (suit === Suit.CASH) {\n            const isOne90 = (sVal === 8 || pVal === 8);\n            const isOneQing = (sVal < 8 && sVal > 1) || (pVal < 8 && pVal > 1); // 20(1) is Ji, treated differently. Qing is 2-7.\n            \n            if (isOne90 && isOneQing) {\n                // Must have Bai Wan (9) in uSet to activate 90\n                if (!uSet.has(9)) continue; \n            }\n        }\n        \n        // 1. Jin vs Jin\n        if (isJinZhang(card) && isJinZhang(potCard)) {\n            if (suit === Suit.CASH) {\n                if (isBigFourCash(sVal) && isBigFourCash(pVal)) { score = 5; desc = \"十字互冲 (5分)\"; }\n            } else {\n                const sRank = card.rank;\n                const pRank = potCard.rank;\n                if ((sRank === CardRank.ZUN || sRank === CardRank.JI) && pRank === CardRank.JIAN) { score = 2; desc = \"冲肩 (2分)\"; }\n                else if (sRank === CardRank.JIAN && (pRank === CardRank.ZUN || pRank === CardRank.JI)) {\n                    if (pRank === CardRank.ZUN) { score = 3; desc = \"肩冲赏 (3分)\"; }\n                    else if (pRank === CardRank.JI) { score = 2; desc = \"肩冲极 (2分)\"; }\n                }\n                else if (sRank === CardRank.ZUN && pRank === CardRank.JI) { score = 3; desc = \"赏冲极 (3分)\"; }\n                else if (sRank === CardRank.JI && pRank === CardRank.ZUN) { score = 3; desc = \"极冲赏 (3分)\"; }\n            }\n        }\n        // 2. Jin vs Qing\n        else if (isJinZhang(card) && !isJinZhang(potCard)) {\n            const isRestricted = isRestrictedQing(pVal, suit);\n            let canMatch = true;\n            if (isRestricted && !hasRoot(pVal, suit, uSet)) canMatch = false;\n\n            if (canMatch) {\n                if (checkConnectivity(sVal, pVal, suit, uSet)) {\n                    score = 2; desc = \"完整连续 (2分)\";\n                } else {\n                    score = 0; \n                }\n            }\n        }\n        // 3. Qing vs Jin\n        else if (!isJinZhang(card) && isJinZhang(potCard)) {\n             if (suit === Suit.CASH && sVal === 8) { // 90 vs Big\n                 if (uSet.has(9)) { score = 3; desc = \"九十冲百 (3分)\"; }\n             }\n        }\n        // 4. Qing vs Qing\n        else {\n            if (checkConnectivity(sVal, pVal, suit, uSet)) {\n                let isValidSequence = true;\n                const maxVal = Math.max(sVal, pVal);\n                const minVal = Math.min(sVal, pVal);\n                \n                if (isRestrictedQing(sVal, suit) || isRestrictedQing(pVal, suit)) {\n                     if (suit === Suit.CASH) {\n                         const connectsTo90 = checkConnectivity(maxVal, 8, suit, uSet);\n                         const connectsTo30 = checkConnectivity(minVal, 2, suit, uSet);\n                         if (!connectsTo90 && !connectsTo30) isValidSequence = false;\n                     } else {\n                         if (!hasRoot(maxVal, suit, uSet) && !hasRoot(minVal, suit, uSet)) isValidSequence = false;\n                     }\n                }\n                if (isValidSequence) { score = 2; desc = \"顺领 (2分)\"; }\n            }\n        }\n\n        if (suit === Suit.COINS && ((sVal === 9 && pVal === 3) || (sVal === 3 && pVal === 9))) {\n             if (!uSet.has(1) && !uSet.has(2)) score = 0; \n        }\n\n        if (score > 0) {\n            const finalScore = score * multiplier;\n            totalScore += finalScore;\n            validCards.push(card);\n            \n            let finalDesc = desc;\n            if (multiplier > 1) finalDesc += ` [x${multiplier}]`;\n            descriptions.push(finalDesc);\n            \n            const dist = Math.abs(sVal - pVal);\n            if (dist < minLinearDistance) minLinearDistance = dist;\n        }\n    }\n\n    if (totalScore === 0) return null;\n\n    let matchType: KaiChongScoreResult['matchType'] = 'DAN_CHONG';\n    if (validCards.length >= 3) matchType = 'SHUN_LING';\n    else if (validCards.length === 2) matchType = 'BROTHER';\n\n    // RULE: Single Match (Dan Chong) Restrictions\n    // A single Qing card cannot Kai Chong.\n    // Exception: 90 Wan (Value 8) is considered a Shoulder (Jin Zhang equivalent) in Cash suit.\n    if (matchType === 'DAN_CHONG') {\n        const sourceCard = validCards[0];\n        const isSpecial90 = sourceCard.id === ID_90_WAN;\n        \n        // If source is NOT Jin Zhang AND NOT 90 Wan, it cannot be a Single Match.\n        if (!isJinZhang(sourceCard) && !isSpecial90) {\n            return null;\n        }\n    }\n\n    const uniqueDescs = Array.from(new Set(descriptions));\n    return {\n        score: totalScore,\n        matchType,\n        description: `${getLabel(matchType)}: ${uniqueDescs.join(', ')}`,\n        validCards,\n        priority: minLinearDistance \n    };\n};\n\nconst getLabel = (type: string) => {\n    const map: Record<string, string> = {\n        'SHUN_LING': '顺领',\n        'BROTHER': '兄弟',\n        'DAN_CHONG': '单冲',\n        'JIAN_LING': '间领',\n        'OTHER': '开冲'\n    };\n    return map[type] || type;\n};\n","\nimport { Card, Suit, CardColor, CardRank, PatternDetail, ScoreResult, Player, KaiChongDetail, ViolationRecord, SupportedLanguage, SpecialCaptureFlags } from '../types';\nimport { ID_WAN_WAN, ID_QIAN_WAN, ID_BAI_WAN, ID_20_WAN, ID_1_GUAN, ID_1_SUO, ID_9_WEN } from '../constants';\nimport { TRANSLATIONS } from '../constants';\nimport { evaluateKaiChong } from './kaiChongRules'; \n\n// --- HELPERS ---\nconst isRed = (card: Card) => card.color === CardColor.RED;\nconst isGreen = (card: Card) => card.color === CardColor.GREEN;\nconst isJinZhang = (card: Card) => isRed(card) || isGreen(card);\n\n// --- PATTERN IDENTIFICATION ---\nconst identifyPatterns = (cards: Card[]): { details: PatternDetail[], score: number } => {\n    const details: PatternDetail[] = [];\n    let score = 0;\n    // Implementation placeholder for advanced patterns (can be expanded later)\n    return { details, score };\n};\n\nexport const identifyKaiChongSeYang = (uCards: Card[]): { details: PatternDetail[], score: number } => {\n    const details: PatternDetail[] = [];\n    let score = 0;\n    const U = uCards;\n    const redCards = U.filter(c => isRed(c));\n    const redCount = redCards.length;\n    if (redCount >= 10) {\n        const pts = 20 + (redCount - 10) * 5;\n        details.push({ name: `Ten Red Gathering (${redCount})`, score: pts, cards: redCards, category: 'KC_SE_YANG' });\n        score += pts;\n    }\n    return { details, score };\n};\n\n// --- EXPORTED FUNCTIONS ---\n\nexport interface CalculateRoundScoresOptions {\n    players: Player[];\n    bankerId: number;\n    lang: SupportedLanguage;\n    kaiChongHistory: KaiChongDetail[];\n    violationLog: ViolationRecord[];\n}\n\nexport const calculateRoundScores = ({\n    players,\n    bankerId,\n    lang,\n    kaiChongHistory,\n    violationLog\n}: CalculateRoundScoresOptions): ScoreResult[] => {\n    const results: ScoreResult[] = [];\n\n    // 1. Calculate Raw Scores (Points Generated by each player)\n    players.forEach(p => {\n        const mainTricks = p.trickPile.filter(t => t.round <= 8 && !t.isKaiChong).length;\n        \n        let diaoRaw = 0;\n        let diaoChange = 0;\n\n        // Base Diao Logic (Banker vs Peasant)\n        if (p.id !== bankerId) {\n            if (mainTricks === 0) { diaoRaw = -1; diaoChange = -1; }\n            else if (mainTricks < 2) { diaoRaw = -0.5; diaoChange = -1; }\n            else if (mainTricks === 2) { diaoRaw = 0; diaoChange = 0; }\n            else if (mainTricks === 3) { diaoRaw = 0.5; diaoChange = 1; }\n            else { diaoRaw = 1; diaoChange = 1; }\n        } else {\n            // Banker's Diao is placeholder, will be balanced later\n            diaoRaw = mainTricks >= 4 ? 1 : -1;\n            diaoChange = 0; \n        }\n\n        const myKcMatches = kaiChongHistory.filter(h => h.playerId === p.id);\n        const potCardIds = new Set(myKcMatches.map(m => m.matchedCard.id));\n        const mainCapturedCards = p.capturedCards.filter(c => !potCardIds.has(c.id));\n\n        const { details: seYangDetails, score: seYangScore } = identifyPatterns(mainCapturedCards);\n        const { details: kcSeYangDetails, score: kcScore } = identifyKaiChongSeYang(p.capturedCards);\n        \n        let kaiChongPoints = 0;\n        myKcMatches.forEach(m => kaiChongPoints += m.score);\n\n        const myViolations = violationLog.filter(v => v.playerId === p.id);\n        const patternDetails = [...seYangDetails, ...kcSeYangDetails];\n        \n        results.push({\n            playerId: p.id,\n            trickCount: mainTricks,\n            diaoRawValue: diaoRaw,\n            diaoPointChange: diaoChange, // Preliminary\n            kaiZhuPointChange: 0, \n            qiaoMenPointChange: 0, \n            seYangPointChange: seYangScore,\n            kaiChongPointChange: kaiChongPoints + kcScore,\n            totalRoundChange: 0, // Will be calculated in Phase 3\n            patterns: patternDetails.map(d => d.name),\n            patternDetails: patternDetails,\n            kaiChongDetails: myKcMatches,\n            cardsWonCount: mainCapturedCards.length,\n            visibleTrickCards: p.trickPile.filter(t => t.isFaceUp).map(t => t.card),\n            scoringCards: mainCapturedCards.filter(c => isRed(c) || isGreen(c)),\n            allCapturedCards: mainCapturedCards,\n            violations: myViolations\n        });\n    });\n\n    // 2. Balance Diao (Zero Sum Step 1)\n    const banker = results.find(r => r.playerId === bankerId);\n    if (banker) {\n        let bankerDiaoTotal = 0;\n        results.forEach(r => {\n            if (r.playerId !== bankerId) {\n                bankerDiaoTotal -= r.diaoPointChange;\n            }\n        });\n        banker.diaoPointChange = bankerDiaoTotal;\n    }\n\n    // Initialize Total with Balanced Diao\n    results.forEach(r => {\n        r.totalRoundChange = r.diaoPointChange;\n    });\n\n    // 3. Balance Bonuses (Zero Sum Step 2)\n    // Rule: Banker pays for Peasant bonuses. Peasants split Banker bonuses.\n    results.forEach(scorer => {\n        // Calculate points generated by this player\n        const generatedPoints = scorer.seYangPointChange + scorer.kaiChongPointChange + scorer.kaiZhuPointChange + scorer.qiaoMenPointChange;\n        \n        if (generatedPoints > 0) {\n            // Scorer gets the positive points\n            scorer.totalRoundChange += generatedPoints;\n\n            if (scorer.playerId !== bankerId) {\n                // Case A: Scorer is Peasant -> Banker Pays full amount\n                if (banker) {\n                    banker.totalRoundChange -= generatedPoints;\n                }\n            } else {\n                // Case B: Scorer is Banker -> Peasants split the cost\n                const peasants = results.filter(r => r.playerId !== bankerId);\n                const count = peasants.length;\n                if (count > 0) {\n                    const splitCost = Math.floor(generatedPoints / count);\n                    const remainder = generatedPoints % count;\n                    \n                    peasants.forEach((p, idx) => {\n                        let deduction = splitCost;\n                        if (idx < remainder) deduction += 1; // Distribute remainder to ensure exact sum\n                        p.totalRoundChange -= deduction;\n                    });\n                }\n            }\n        }\n    });\n\n    // 4. Balance Penalties (Zero Sum Step 3)\n    // Rule: Violator pays fixed amount (e.g., 60), distributed to others (20 each).\n    results.forEach(violator => {\n        if (violator.violations.some(v => v.riskLevel === 'PENALTY')) {\n            const penaltyAmount = 60;\n            violator.totalRoundChange -= penaltyAmount;\n            violator.penaltyReason = \"严重违例 (包赔)\"; // Flag for UI\n\n            const others = results.filter(r => r.playerId !== violator.playerId);\n            const count = others.length;\n            if (count > 0) {\n                const compensation = penaltyAmount / count; // Should be 20 for 3 players\n                others.forEach(o => o.totalRoundChange += compensation);\n            }\n        }\n    });\n\n    return results;\n};\n\nexport interface FindKaiChongMatchOptions {\n    players: Player[];\n    potCard: Card;\n    lang: SupportedLanguage;\n    history: KaiChongDetail[];\n    currentAttempterId: number;\n    specialCaptures: SpecialCaptureFlags;\n}\n\nexport const findBestKaiChongMatch = ({\n    players,\n    potCard,\n    lang,\n    history,\n    currentAttempterId,\n    specialCaptures\n}: FindKaiChongMatchOptions): KaiChongDetail | null => {\n    const player = players.find(p => p.id === currentAttempterId);\n    if (!player) return null;\n\n    const result = evaluateKaiChong(player, potCard, history, specialCaptures);\n\n    if (result) {\n        return {\n            playerId: currentAttempterId,\n            matchedCard: potCard,\n            sourceCards: result.validCards,\n            score: result.score,\n            matchType: result.matchType as any,\n            priorityScore: result.priority, // Distance-based Priority\n            description: result.description\n        };\n    }\n\n    return null;\n};\n","\nexport enum PenaltyType {\n  LOU_ZHUANG = 'LOU_ZHUANG',\n  ZONG_ZHUANG = 'ZONG_ZHUANG',\n  JI_ZHUO = 'JI_ZHUO',\n  // Deprecated sub-types of JI_ZHUO removed\n  \n  LEAD_QIAN_WAN = 'LEAD_QIAN_WAN',\n  ZONG_QU_GAME = 'ZONG_QU', \n  FANG_GONG_QIAN = 'FANG_GONG_QIAN',\n  LOU_ZHUANG_FAIL = 'LOU_ZHUANG_FAIL',\n  \n  // Active Strategy Rules\n  DAO_LI = 'DAO_LI',\n  BU_LI_WAN = 'BU_LI_WAN',\n  BU_LI_SHANG = 'BU_LI_SHANG',\n  DAO_LI_QIAN_HONG = 'DAO_LI_QIAN_HONG',\n  TI_JIN_QIAN_WANG = 'TI_JIN_QIAN_WANG',\n  WO_DI_BAI_LAO = 'WO_DI_BAI_LAO',\n  WU_SHANG_BAO_BAI = 'WU_SHANG_BAO_BAI',\n  BU_BAO_BAI = 'BU_BAO_BAI',\n  QIAN_SENG_WO_DI = 'QIAN_SENG_WO_DI',\n  JIN_MEN_CI_XU = 'JIN_MEN_CI_XU',\n  WU_ZHUO_TI_WAN = 'WU_ZHUO_TI_WAN',\n  CHUANG_QIAN = 'CHUANG_QIAN'\n}\n\nexport const RULE_DESCRIPTIONS: Record<string, string> = {\n  [PenaltyType.FANG_GONG_QIAN]: \"放功千：千万捉了百万，你持万万却未捉千万。\",\n  [PenaltyType.LOU_ZHUANG]: \"漏庄：未能顶住庄家。\",\n  [PenaltyType.ZONG_ZHUANG]: \"纵庄：放任庄家赢牌或未正确捉打。\",\n  [PenaltyType.JI_ZHUO]: \"急捉：捉牌理由不足（非真张/大张/连张）或牌力不够。\",\n  [PenaltyType.ZONG_QU_GAME]: \"纵趣：当趣张（极）称霸牌池时，持有大牌者必须捉打，违者包赔。\",\n  [PenaltyType.LEAD_QIAN_WAN]: \"首发千万：禁手。\",\n  [PenaltyType.LOU_ZHUANG_FAIL]: \"漏庄：持有真张或大牌必须捉打！\",\n  \n  // New Descriptions\n  [PenaltyType.DAO_LI]: \"倒立：持有万万和千万（无百万），首发千万为严重违例。\",\n  [PenaltyType.BU_LI_WAN]: \"不立万：持有万万和千万（无百万），首发必须立万（出万万），否则违例。\",\n  [PenaltyType.BU_LI_SHANG]: \"不立赏：持有同门赏、肩，首发必须出赏、肩或其同花顺连牌，否则违例。\",\n  [PenaltyType.DAO_LI_QIAN_HONG]: \"倒立千红：持有万万，首发千万，以急桌论处。\",\n  [PenaltyType.TI_JIN_QIAN_WANG]: \"提尽千王：双持万千只能首发红万，千僧留守，违者包赔。\",\n  [PenaltyType.WO_DI_BAI_LAO]: \"卧底百老：庄家已首发过，或两门熟门已定，百老不应再出十字门。\",\n  [PenaltyType.WU_SHANG_BAO_BAI]: \"无赏报百：手中无赏，不应首发十字门报百。\",\n  [PenaltyType.BU_BAO_BAI]: \"不报百：符合报百条件（闲家、持百、有熟门）必须首发十字门。\",\n  [PenaltyType.QIAN_SENG_WO_DI]: \"千僧卧底：无千万万万，有百万及大青张，应先发百万。\",\n  [PenaltyType.JIN_MEN_CI_XU]: \"禁门次序：三门优先级高于十字门。应先发三门。\",\n  [PenaltyType.WU_ZHUO_TI_WAN]: \"五桌提万：剩余4张牌时违规提万。\",\n  [PenaltyType.CHUANG_QIAN]: \"闯千：单持千万（无百万），首发千万属于违规（除非顶色）。\"\n};\n","\nimport { Player, Card, Suit, CardRank, CardColor, RiskLevel, TacticalPriority, RiskAssessment, SuitStatus } from '../types';\nimport { \n    ID_WAN_WAN, ID_QIAN_WAN, ID_BAI_WAN, ID_20_WAN, ID_90_WAN\n} from '../constants';\nimport { PenaltyType } from './ruleDefinitions';\n\n// --- HELPERS ---\n\nconst isRed = (card: Card) => card.color === CardColor.RED;\nconst isGreen = (card: Card) => card.color === CardColor.GREEN;\nconst isCash = (card: Card) => card.suit === Suit.CASH;\n\nconst isZhenZhang = (\n    card: Card, \n    hand: Card[], \n    recordedCards: Card[], \n    tableCards: { card: Card }[], \n    mianZhangCard: Card | null\n): boolean => {\n    const W = new Set<string>();\n    \n    hand.forEach(c => W.add(c.id));\n    recordedCards.forEach(c => W.add(c.id));\n    tableCards.forEach(tc => W.add(tc.card.id));\n\n    if (mianZhangCard) {\n        const isQing = mianZhangCard.rank === CardRank.QING;\n        const is90Wan = mianZhangCard.id === ID_90_WAN;\n        if (isQing && !is90Wan) {\n            W.add(mianZhangCard.id);\n        }\n    }\n\n    const maxVal = (card.suit === Suit.CASH || card.suit === Suit.TEXTS) ? 11 : 9;\n\n    for (let v = card.value + 1; v <= maxVal; v++) {\n        const higherCardInW = \n            hand.some(c => c.suit === card.suit && c.value === v) ||\n            recordedCards.some(c => c.suit === card.suit && c.value === v) ||\n            tableCards.some(tc => tc.card.suit === card.suit && tc.card.value === v) ||\n            (mianZhangCard && mianZhangCard.suit === card.suit && mianZhangCard.value === v && mianZhangCard.rank === CardRank.QING && mianZhangCard.id !== ID_90_WAN);\n\n        if (!higherCardInW) {\n            return false;\n        }\n    }\n    return true;\n};\n\nconst isDaZhang = (card: Card): boolean => {\n    if (card.suit === Suit.TEXTS) return card.value >= 7;\n    return card.value >= 6;\n};\n\nconst getSequenceWinners = (hand: Card[], winningCard: Card, recordedCards: Card[]): Card[] => {\n    return hand.filter(c => c.suit === winningCard.suit && c.value > winningCard.value);\n};\n\n// --- RULE IMPLEMENTATIONS ---\n\n// 1. 不立赏 (Bu Li Shang)\nconst checkBuLiShang = (player: Player, card: Card): RiskAssessment | null => {\n    const tricksWon = player.capturedCards ? player.capturedCards.length : 0;\n    if (tricksWon > 0) return null;\n\n    const hand = player.hand;\n    const hasWan = hand.some(c => c.id === ID_WAN_WAN);\n    const hasQian = hand.some(c => c.id === ID_QIAN_WAN);\n    const hasBai = hand.some(c => c.id === ID_BAI_WAN);\n\n    if (hasWan && hasQian && hasBai) {\n        if (hand.length > 1 && card.id === ID_QIAN_WAN) {\n             return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.TI_JIN_QIAN_WANG, message: '提尽千王：三公在手，手牌>1时不能发千万！', tacticalContext: TacticalPriority.ANTI_BANKER };\n        }\n    }\n\n    if (hasWan && hasQian && !hasBai) {\n        if (card.id === ID_QIAN_WAN) {\n            return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.DAO_LI_QIAN_HONG, message: '倒立千红：有万无百，首发千万，以急桌论处！', tacticalContext: TacticalPriority.ANTI_BANKER };\n        }\n        if (card.id !== ID_WAN_WAN) {\n            return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.BU_LI_WAN, message: '不立万：有万无百，必须首发万万！', tacticalContext: TacticalPriority.ANTI_BANKER };\n        }\n        return null;\n    }\n\n    const suits = [Suit.CASH, Suit.STRINGS, Suit.COINS, Suit.TEXTS];\n    for (const suit of suits) {\n        const suitCards = hand.filter(c => c.suit === suit);\n        const shang = suitCards.find(c => c.rank === CardRank.ZUN);\n        const jian = suitCards.find(c => c.rank === CardRank.JIAN);\n\n        if (shang && jian) {\n            const isPlayingShangOrJian = (card.id === shang.id || card.id === jian.id);\n            const isPlayingSequence = suitCards.some(c => c.id === card.id && (Math.abs(c.value - shang.value) === 1 || Math.abs(c.value - jian.value) === 1));\n            \n            if (card.suit !== suit) {\n                 return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.BU_LI_SHANG, message: '不立赏：持有同门赏肩，必须优先打出该门！', tacticalContext: TacticalPriority.ANTI_BANKER };\n            }\n            \n            if (!isPlayingShangOrJian && !isPlayingSequence) {\n                 return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.BU_LI_SHANG, message: '不立赏：必须打出赏、肩或其同花顺！', tacticalContext: TacticalPriority.ANTI_BANKER };\n            }\n        }\n    }\n\n    return null;\n};\n\n// 2. 不报百 (Bu Bao Bai)\nconst checkBuBaoBai = (\n    player: Player, \n    card: Card, \n    openedSuits: { suit: Suit, leaderId: number, isBanker: boolean }[]\n): RiskAssessment | null => {\n    if (player.isDealer) return null;\n    \n    const hand = player.hand;\n    const hasBai = hand.some(c => c.id === ID_BAI_WAN);\n    if (!hasBai) return null;\n\n    const openedNonCash = openedSuits.filter(s => s.suit !== Suit.CASH);\n    const hasShuMen = openedNonCash.length > 0;\n    \n    if (!hasShuMen) return null;\n\n    const bankerLed = openedSuits.some(s => s.isBanker);\n    if (bankerLed && card.suit === Suit.CASH) {\n        return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.WO_DI_BAI_LAO, message: '卧底百老：庄家已首发过，百老不可发十字门！', tacticalContext: TacticalPriority.ANTI_BAI_LAO };\n    }\n\n    const uniqueSuits = new Set(openedNonCash.map(s => s.suit));\n    if (uniqueSuits.size >= 2 && card.suit === Suit.CASH) {\n        return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.WO_DI_BAI_LAO, message: '卧底百老：两门熟门已定，百老不可发十字门！', tacticalContext: TacticalPriority.ANTI_BAI_LAO };\n    }\n\n    const hasShang = hand.some(c => c.rank === CardRank.ZUN);\n    if (!hasShang && card.suit === Suit.CASH) {\n        return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.WU_SHANG_BAO_BAI, message: '无赏报百：无赏不可发十字门！', tacticalContext: TacticalPriority.ANTI_BAI_LAO };\n    }\n\n    if (!bankerLed && uniqueSuits.size < 2 && hasShang) {\n        if (card.suit !== Suit.CASH) {\n            return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.BU_BAO_BAI, message: '不报百：符合条件必须首发十字门！', tacticalContext: TacticalPriority.ANTI_BAI_LAO };\n        }\n    }\n\n    return null;\n};\n\n// 3. 禁门次序 (Jin Men Ci Xu)\nconst checkJinMenCiXu = (\n    player: Player, \n    card: Card, \n    openedSuits: { suit: Suit, leaderId: number, isBanker: boolean }[]\n): RiskAssessment | null => {\n    if (player.isDealer) return null;\n\n    const hand = player.hand;\n    // Definition Fix: \n    // Jin Men (Forbidden/Raw) = Suits NOT in openedSuits (excluding Cash).\n    // Shu Men (Familiar/Cooked) = Suits IN openedSuits.\n    // If I hold cards from a Jin Men (Unopened Non-Cash), I should play them (Open the door) before playing Cash (unless I'm Bai Lao).\n    \n    const openedNonCashSuits = new Set(openedSuits.filter(s => s.suit !== Suit.CASH).map(s => s.suit));\n    const jinMenCards = hand.filter(c => c.suit !== Suit.CASH && !openedNonCashSuits.has(c.suit));\n    \n    const hasBai = hand.some(c => c.id === ID_BAI_WAN);\n    const hasWan = hand.some(c => c.id === ID_WAN_WAN);\n    const hasQian = hand.some(c => c.id === ID_QIAN_WAN);\n    \n    const bankerLedWan = openedSuits.some(s => s.suit === Suit.CASH && s.isBanker); \n\n    // --- CONFLICT RESOLUTION: Bu Li Wan Priority ---\n    // Rule: If holding Wan Wan & Qian Wan (but no Bai Wan), the player MUST lead Wan Wan.\n    // This obligation overrides the \"Jin Men\" (Open Door) restriction.\n    if (hasWan && hasQian && !hasBai) {\n        // If the player is doing the right thing (Leading Wan Wan), do not flag Jin Men violation.\n        if (card.id === ID_WAN_WAN) {\n            return null;\n        }\n    }\n    // -----------------------------------------------\n\n    // Obligation 1: Qian Seng Wo Di\n    if (!bankerLedWan && !hasWan && !hasQian) {\n        if (hasBai) {\n            const bigQing = hand.some(c => c.suit === Suit.CASH && c.rank === CardRank.QING && c.value > 4); \n            if (bigQing && card.id !== ID_BAI_WAN) {\n                 return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.QIAN_SENG_WO_DI, message: '千僧卧底：无千万万万，有百及大青，应先发百万！', tacticalContext: TacticalPriority.ANTI_BANKER };\n            }\n        }\n    }\n\n    // Obligation 2: San Men Priority (Open Unopened Suits)\n    if (jinMenCards.length > 0) {\n        if (card.suit === Suit.CASH) {\n             // You have cards in a suit that hasn't been opened yet. Prioritize opening them over playing Cash.\n             // This assumes player is NOT Bai Lao (handled by Bu Bao Bai checks) or logic falls through.\n             // If player IS Bai Lao, checkBuBaoBai might force Cash, which takes precedence. \n             // But if BuBaoBai didn't trigger (e.g. no Shu Men yet), then Jin Men priority holds.\n             return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.JIN_MEN_CI_XU, message: '禁门次序：应先发三门（未开门/生门），不可发十字门！', tacticalContext: TacticalPriority.ANTI_BANKER };\n        }\n    }\n\n    return null;\n};\n\n// 4. 违规提万 & 5. 提尽千王 & 6. 闯千\nconst checkCashLeadingRules = (\n    player: Player,\n    card: Card,\n    openedSuits: { suit: Suit, leaderId: number, isBanker: boolean }[]\n): RiskAssessment | null => {\n    if (player.isDealer) return null;\n    const hand = player.hand;\n    const n = hand.length;\n\n    const hasWan = hand.some(c => c.id === ID_WAN_WAN);\n    const hasQian = hand.some(c => c.id === ID_QIAN_WAN);\n    const hasBai = hand.some(c => c.id === ID_BAI_WAN);\n\n    const isRedWan = [ID_WAN_WAN, ID_QIAN_WAN, ID_BAI_WAN].includes(card.id);\n    if (isRedWan && n === 4) {\n         return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.WU_ZHUO_TI_WAN, message: '五桌提万：剩4张牌时不可提万！', tacticalContext: TacticalPriority.ANTI_BANKER };\n    }\n\n    const playerLedCash = openedSuits.some(s => s.suit === Suit.CASH && s.leaderId === player.id);\n\n    if (hasWan && hasQian) {\n        if (n > 1) {\n            if (hasBai && card.id === ID_WAN_WAN) return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.TI_JIN_QIAN_WANG, message: '提尽千王：三公在手首发万万！', tacticalContext: TacticalPriority.ANTI_BANKER };\n            \n            if (!hasBai) {\n                if (playerLedCash && card.id === ID_QIAN_WAN) return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.TI_JIN_QIAN_WANG, message: '提尽千王：曾首发万，今发千，违例！', tacticalContext: TacticalPriority.ANTI_BANKER };\n                if (!playerLedCash && card.id === ID_QIAN_WAN) return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.DAO_LI_QIAN_HONG, message: '倒立千红：未发万先发千！', tacticalContext: TacticalPriority.ANTI_BANKER };\n            }\n        }\n    }\n\n    if (hasQian && !hasBai) {\n        if (n > 1) {\n            if (!hasWan && card.id === ID_QIAN_WAN) return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.CHUANG_QIAN, message: '闯千：单千无百，首发千违例！', tacticalContext: TacticalPriority.ANTI_BANKER };\n            \n            if (hasWan && card.id === ID_QIAN_WAN) {\n                if (playerLedCash) return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.CHUANG_QIAN, message: '闯千：有万无百，再次发千违例！', tacticalContext: TacticalPriority.ANTI_BANKER };\n            }\n        }\n    }\n\n    return null;\n};\n\n\n// REFACTORED PRIORITY ONE (Follow Logic: Qin Wang & Others)\nconst checkPriorityOne = (\n    player: Player,\n    card: Card,\n    winningCard: Card,\n    winningPlayerId: number,\n    tableCards: { card: Card, playerId: number }[],\n    bankerId: number,\n    recordedCards: Card[],\n    firstLeadInfo: { card: Card, playerId: number } | null,\n    mianZhangCard: Card | null\n): RiskAssessment | null => {\n    const isBanker = player.id === bankerId;\n    const hand = player.hand;\n\n    if (!isBanker && tableCards.length > 0) {\n        const winners = hand.filter(c => c.suit === winningCard.suit && c.value > winningCard.value).sort((a,b) => b.value - a.value); \n        const canWin = winners.length > 0;\n        \n        const isXCash = winningCard.suit === Suit.CASH;\n\n        const capturedCount = player.capturedCards ? player.capturedCards.length : 0;\n        const holdsWanOrQian = hand.some(c => c.id === ID_WAN_WAN || c.id === ID_QIAN_WAN);\n        const nonCashShangCount = hand.filter(c => c.suit !== Suit.CASH && c.rank === CardRank.ZUN).length;\n        \n        const isQinWangEligible = !isXCash && capturedCount === 0 && holdsWanOrQian && nonCashShangCount < 2;\n\n        const bankerPlayed = tableCards.some(tc => tc.playerId === bankerId);\n\n        if (canWin) {\n            const isCapturing = card.suit === winningCard.suit && card.value > winningCard.value;\n\n            if (!bankerPlayed) {\n                if (isQinWangEligible) {\n                    const isTrue = isZhenZhang(card, hand, recordedCards, tableCards, mianZhangCard);\n                    const isMax = card.id === winners[0].id;\n                    const sequenceWinners = getSequenceWinners(hand, winningCard, recordedCards);\n                    const isSeq = sequenceWinners.some(c => c.id === card.id);\n\n                    if (isCapturing) {\n                        if (!isTrue && !isMax && !isSeq) {\n                            return null; // Valid Qin Wang\n                        }\n                        return null; \n                    } else {\n                        return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.LOU_ZHUANG, message: '漏庄：勤王时刻，你有赢牌却未捉打！', tacticalContext: TacticalPriority.ANTI_BANKER };\n                    }\n                } else {\n                    if (!isCapturing) {\n                         const isTrue = isZhenZhang(card, hand, recordedCards, tableCards, mianZhangCard);\n                         const isMax = card.id === winners[0].id;\n                         if (isTrue || isMax) {\n                             return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.LOU_ZHUANG_FAIL, message: '漏庄：持有真张或大牌必须捉打！', tacticalContext: TacticalPriority.ANTI_BANKER };\n                         }\n                    }\n                }\n            }\n            else {\n                const winnerIsPeasant = winningPlayerId !== bankerId;\n                if (winnerIsPeasant) {\n                    if (isCapturing) {\n                        // EXCEPTION: Cash High Card Battle (Wan/Qian vs Bai/Qian) is allowed\n                        // User Request: When table has Bai(9) or Qian(10), playing Qian(10) or Wan(11) is legal.\n                        if (winningCard.suit === Suit.CASH && card.suit === Suit.CASH) {\n                            const winningIsBig = winningCard.value === 9 || winningCard.value === 10; // Bai or Qian\n                            const playingIsBig = card.value === 10 || card.value === 11; // Qian or Wan\n                            if (winningIsBig && playingIsBig) {\n                                return null; // Safe, no Ji Zhuo check\n                            }\n                        }\n\n                        // FIX: 纵趣优先。如果必捉趣张（Zong Qu），则不视为急捉。\n                        if (!isGreen(winningCard)) {\n                            return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.JI_ZHUO, message: '急捉：庄家已出牌，同伙赢牌中，不可捉打！', tacticalContext: TacticalPriority.ANTI_SE_YANG };\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    return null;\n};\n\nconst checkPriorityZero = (player: Player, card: Card, winningCard: Card, winningPlayerId: number, tableCards: any[]) => {\n    if (isGreen(winningCard) && player.hand.some(c => c.suit === winningCard.suit && c.value > winningCard.value)) {\n        if (!(card.suit === winningCard.suit && card.value > winningCard.value)) {\n             return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.ZONG_QU_GAME, message: '纵趣：趣张称霸，必须捉打！', tacticalContext: TacticalPriority.ANTI_SE_YANG };\n        }\n    }\n    if (winningCard.id === ID_QIAN_WAN && player.hand.some(c => c.id === ID_WAN_WAN)) {\n        if (card.id !== ID_WAN_WAN) {\n             return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.FANG_GONG_QIAN, message: '放功千：必须用万万捉千万！', tacticalContext: TacticalPriority.ANTI_BANKER };\n        }\n    }\n    return null;\n};\n\n// --- MAIN EXPORT ---\n\nexport const evaluatePlayRisk = (\n    player: Player,\n    card: Card,\n    tableCards: { card: Card, playerId: number }[],\n    bankerId: number,\n    allPlayers: Player[],\n    recordedCards: Card[],\n    openedSuits: { suit: Suit, leaderId: number, isBanker: boolean }[] = [],\n    firstLeadInfo: { card: Card, playerId: number } | null = null,\n    roundNumber: number = 1,\n    mianZhangCard: Card | null = null,\n    bankerFirstLeadCard: Card | null = null // Updated signature\n): RiskAssessment | null => {\n    if (tableCards.length === 0) {\n        const buLiShang = checkBuLiShang(player, card);\n        if (buLiShang) return buLiShang;\n\n        const buBaoBai = checkBuBaoBai(player, card, openedSuits);\n        if (buBaoBai) return buBaoBai;\n\n        const jinMen = checkJinMenCiXu(player, card, openedSuits);\n        if (jinMen) return jinMen;\n\n        const cashRules = checkCashLeadingRules(player, card, openedSuits);\n        if (cashRules) return cashRules;\n\n        if (card.id === ID_QIAN_WAN && player.hand.length === 8 && !player.isDealer) { \n             return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.LEAD_QIAN_WAN, message: '首发千万是禁手。', tacticalContext: TacticalPriority.ANTI_BANKER };\n        }\n        return null;\n    }\n\n    const leadSuit = tableCards[0].card.suit;\n    let winningCard = tableCards[0].card;\n    let winningPlayerId = tableCards[0].playerId;\n    let currentBest = winningCard.value;\n\n    tableCards.forEach(tc => {\n        if (tc.card.suit === leadSuit && tc.card.value > currentBest) {\n            currentBest = tc.card.value;\n            winningCard = tc.card;\n            winningPlayerId = tc.playerId;\n        }\n    });\n\n    const p0 = checkPriorityZero(player, card, winningCard, winningPlayerId, tableCards);\n    if (p0) return p0;\n\n    const p1 = checkPriorityOne(player, card, winningCard, winningPlayerId, tableCards, bankerId, recordedCards, firstLeadInfo, mianZhangCard);\n    if (p1) return p1;\n\n    const canWin = player.hand.some(c => c.suit === winningCard.suit && c.value > winningCard.value);\n    if (canWin && winningPlayerId === bankerId && !player.isDealer) {\n        const isCapturing = card.suit === winningCard.suit && card.value > winningCard.value;\n        if (!isCapturing) {\n             if (isDaZhang(winningCard) || tableCards.length === 3) {\n                 return { riskLevel: RiskLevel.PENALTY, ruleId: PenaltyType.ZONG_ZHUANG, message: '纵庄：庄家大牌必须捉！', tacticalContext: TacticalPriority.ANTI_BANKER };\n             }\n        }\n    }\n\n    return { riskLevel: RiskLevel.SAFE, ruleId: 'SAFE', message: '安全', tacticalContext: TacticalPriority.ANTI_BANKER };\n};\n\nexport const getSuitStatusContext = (\n    player: Player, \n    card: Card, \n    bankerId: number, \n    openedSuits: { suit: Suit, leaderId: number, isBanker: boolean }[], \n    recordedCards: Card[], \n    firstLeadInfo: any, \n    faceUpCardIds: Set<string>,\n    bankerFirstLeadCard: Card | null\n): SuitStatus => {\n    \n    // 1. CASH LOGIC\n    if (card.suit === Suit.CASH) {\n        // Global Unlock: Wan, Qian, Bai all face up\n        const allBigThreeUp = faceUpCardIds.has(ID_WAN_WAN) && faceUpCardIds.has(ID_QIAN_WAN) && faceUpCardIds.has(ID_BAI_WAN);\n        if (allBigThreeUp) return 'SAFE'; // Shu Men\n\n        const hasBai = player.hand.some(c => c.id === ID_BAI_WAN);\n        if (player.isDealer) {\n            return hasBai ? 'SAFE' : 'FORBIDDEN';\n        } else {\n            // Peasant with Bai Wan\n            if (hasBai) {\n                // Check if Banker's FIRST lead was NOT Wan Wan\n                // If banker hasn't led yet, or led Wan Wan, it's Forbidden.\n                // If banker led something else first, it's Familiar.\n                if (bankerFirstLeadCard && bankerFirstLeadCard.id !== ID_WAN_WAN) {\n                    return 'SAFE';\n                }\n            }\n            // Normal Peasant or Bai Lao (before conditions met)\n            return 'FORBIDDEN';\n        }\n    }\n\n    // 2. NON-CASH LOGIC\n    // Logic: Identify if this suit is currently Forbidden (Jin Men)\n    \n    // Analyze Opened Suits history to find Familiar/Forbidden assignment\n    const nonCashOpened = openedSuits.filter(s => s.suit !== Suit.CASH);\n    \n    // Collect distinct suits led by peasants\n    const peasantLedSuits = new Set<Suit>();\n    nonCashOpened.forEach(s => {\n        if (!s.isBanker) peasantLedSuits.add(s.suit);\n    });\n\n    let forbiddenSuit: Suit | null = null;\n    let isLocked = false;\n\n    // Check Banker's Trigger\n    // Find the first Non-Cash suit led by Banker\n    const bankerLeadEntry = nonCashOpened.find(s => s.isBanker);\n    \n    if (bankerLeadEntry) {\n        // Did the banker lead this BEFORE 2 peasant suits were established?\n        // We iterate to see order.\n        let pCount = 0;\n        for (const s of nonCashOpened) {\n            if (s.suit === bankerLeadEntry.suit && s.isBanker) {\n                // Found Banker's lead.\n                if (pCount < 2) {\n                    // Banker led before 2 peasant suits established.\n                    // This suit becomes Forbidden.\n                    forbiddenSuit = s.suit;\n                    isLocked = true;\n                }\n                break;\n            }\n            if (!s.isBanker) {\n                // It's a peasant lead. Note: strictly distinct count needed?\n                // The rules imply \"First and Second suits led by peasants\".\n                // We simplify: If we see Banker lead, check unique peasant suits before it.\n            }\n            // Re-eval: let's do it properly by index.\n        }\n    }\n\n    if (!isLocked) {\n        // If Banker didn't trigger early forbidden, check if Peasants established 2.\n        const pSuits = Array.from(peasantLedSuits);\n        if (pSuits.length >= 2) {\n            // First 2 are Familiar. The 3rd (if exists) is Forbidden.\n            // Which is the 3rd? The one NOT in the first 2.\n            const allNonCash = [Suit.STRINGS, Suit.COINS, Suit.TEXTS];\n            const familiar = new Set([pSuits[0], pSuits[1]]);\n            const remaining = allNonCash.find(s => !familiar.has(s));\n            if (remaining) forbiddenSuit = remaining;\n        }\n    }\n\n    // Default for non-Cash is Familiar (Safe), unless identified as Forbidden\n    if (forbiddenSuit && card.suit === forbiddenSuit) {\n        return 'FORBIDDEN';\n    }\n\n    return 'SAFE'; // Shu Men\n};\n\nexport const getPriorityDiscardCards = (\n    player: Player, \n    tableCards: { card: Card, playerId: number }[], \n    recordedCards: Card[], \n    openedSuits: { suit: Suit, leaderId: number, isBanker: boolean }[], \n    bankerId: number, \n    firstLeadInfo: { card: Card, playerId: number } | null\n) => {\n    return player.hand;\n};\n\nexport const getCaptureRequirement = (\n    player: Player, \n    tableCards: { card: Card, playerId: number }[], \n    bankerId: number\n) => {\n    return { isForced: false, winningCards: [] };\n};\n","\nimport { AILearningState, ScoreResult, GameHistory, Difficulty, ViolationRecord } from '../types';\n\nconst DEFAULT_STATE: AILearningState = {\n    playerId: -1,\n    gamesPlayed: 0,\n    winRate: 0,\n    aggression: 0.5,     // 0.0 (保守) - 1.0 (激进)\n    riskTolerance: 0.3,  // 0.0 (极度谨慎) - 1.0 (赌徒)\n    bluffFrequency: 0.1, // 0.0 (从不诈唬) - 1.0 (频繁诈唬)\n    lastRole: 'PEASANT',\n    lastResult: 'DRAW'\n};\n\n// Key for LocalStorage\nconst STORAGE_KEY = 'ma_diao_ai_memory_v2_zh';\n\nexport const loadAIMemory = (): Record<number, AILearningState> => {\n    try {\n        const stored = localStorage.getItem(STORAGE_KEY);\n        if (stored) {\n            return JSON.parse(stored);\n        }\n    } catch (e) {\n        console.warn(\"读取AI记忆失败\", e);\n    }\n    return {};\n};\n\nexport const saveAIMemory = (states: Record<number, AILearningState>) => {\n    try {\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(states));\n    } catch (e) {\n        console.warn(\"保存AI记忆失败\", e);\n    }\n};\n\nexport const getAIState = (playerId: number, history: GameHistory): AILearningState => {\n    if (history.aiLearningStates && history.aiLearningStates[playerId]) {\n        return history.aiLearningStates[playerId];\n    }\n    return { ...DEFAULT_STATE, playerId };\n};\n\n/**\n * 根据回合结果动态调整AI个性参数。\n * 策略核心：\"赢则强化，输则调整\" (Win-Stay, Lose-Shift)。\n * 包含对“违例惩罚”的强负面反馈。\n */\nexport const updateAILearning = (\n    currentState: AILearningState, \n    result: ScoreResult, \n    isBanker: boolean,\n    difficulty: Difficulty\n): AILearningState => {\n    const newState = { ...currentState };\n    newState.gamesPlayed += 1;\n    newState.lastRole = isBanker ? 'BANKER' : 'PEASANT';\n\n    // 判定胜负 (根据总分变动)\n    const isWin = result.totalRoundChange > 0;\n    newState.lastResult = isWin ? 'WIN' : (result.totalRoundChange < 0 ? 'LOSS' : 'DRAW');\n\n    // 更新胜率 (移动平均)\n    const prevWins = newState.winRate * (newState.gamesPlayed - 1);\n    newState.winRate = (prevWins + (isWin ? 1 : 0)) / newState.gamesPlayed;\n\n    // --- 1. 惩罚反馈机制 (Penalty Feedback) ---\n    // 如果AI本局出现了违例（包赔或警告），立即进行负面强化。\n    if (result.violations && result.violations.length > 0) {\n        // 大幅降低风险容忍度，变成“惊弓之鸟”\n        newState.riskTolerance = Math.max(0.05, newState.riskTolerance - 0.25);\n\n        // 检查违例类型以调整特定性格\n        const hasAggressiveViolation = result.violations.some(v => \n            v.ruleId.includes('JI_ZHUO') ||  // 急捉\n            v.ruleId === 'JIN_MEN_CI_XU' ||  // 开禁门 (Updated from KAI_JIN_MEN)\n            v.ruleId === 'CHUANG_QIAN'       // 闯千 (Replaces GUA_WAN logic partially)\n        );\n\n        const hasCarelessViolation = result.violations.some(v => \n            v.ruleId === 'LOU_ZHUANG' ||     // 漏庄\n            v.ruleId === 'ZONG_ZHUANG' ||    // 纵庄\n            v.ruleId === 'ZONG_QU'           // 纵趣\n        );\n\n        if (hasAggressiveViolation) {\n            // 因太激进而犯错 -> 降低激进值\n            newState.aggression = Math.max(0.1, newState.aggression - 0.2);\n        }\n\n        if (hasCarelessViolation) {\n            // 因太随意而犯错 -> 降低诈唬/随意出牌频率\n            newState.bluffFrequency = Math.max(0, newState.bluffFrequency - 0.1);\n        }\n        \n        // 惩罚是最高优先级的反馈，处理完后直接返回，覆盖常规逻辑\n        return newState; \n    } \n\n    // --- 2. 赢则强化，输则调整 (Win-Stay, Lose-Shift) ---\n    \n    const adjustmentRate = 0.05; // 调整步长\n\n    if (isWin) {\n        // **赢了 (Win-Stay)**：强化当前风格\n        \n        // 如果是激进获胜，变得更自信（激进）\n        if (newState.aggression > 0.5) newState.aggression = Math.min(1.0, newState.aggression + adjustmentRate);\n        // 如果是保守获胜，变得更沉稳（保守/低激进）\n        else newState.aggression = Math.max(0.0, newState.aggression - adjustmentRate);\n        \n        // 如果冒了风险还赢了，增加风险容忍度\n        if (newState.riskTolerance > 0.4) {\n            newState.riskTolerance = Math.min(0.9, newState.riskTolerance + adjustmentRate);\n        }\n\n    } else {\n        // **输了 (Lose-Shift)**：改变策略\n        \n        // 如果太激进导致输，尝试保守一点\n        if (newState.aggression > 0.6) {\n            newState.aggression -= (adjustmentRate * 2);\n        } \n        // 如果太保守导致输（错失机会），尝试激进一点\n        else if (newState.aggression < 0.4) {\n            newState.aggression += (adjustmentRate * 2);\n        }\n\n        // 输了通常意味着需要更谨慎\n        newState.riskTolerance = Math.max(0.1, newState.riskTolerance - adjustmentRate);\n    }\n\n    // --- 3. 难度系数修正 ---\n    if (difficulty === Difficulty.HARD) {\n        // 困难AI：参数趋向于优化值（通常激进和容忍度适中偏高能带来高收益，但要守规则）\n        // 确保不会因为连续失败变得太“怂”\n        newState.riskTolerance = Math.max(0.2, newState.riskTolerance); \n        newState.aggression = Math.max(0.3, newState.aggression);\n    } else if (difficulty === Difficulty.EASY) {\n        // 简单AI：保持高风险容忍度（容易犯错）\n        newState.riskTolerance = Math.min(0.8, Math.max(0.5, newState.riskTolerance)); \n    }\n\n    return newState;\n};\n","\nimport { GameHistory, UserProfile, SocialProvider, Gender, MatchLogEntry, GazeDirection } from '../types';\n\n// Use any for Supabase types since we're using the global UMD build\nlet supabase: any = null;\n\nconst STORAGE_KEY_URL = 'ma_diao_supabase_url';\nconst STORAGE_KEY_KEY = 'ma_diao_supabase_key';\nconst BUCKET_NAME = 'avatars';\nconst TABLE_HISTORY = 'match_logs';\nconst TABLE_PROFILES = 'profiles';\nconst TABLE_FRIENDS = 'friendships';\n\nconst MOCK_USER_KEY = 'ma_diao_mock_user';\nconst MOCK_PROFILE_KEY = 'ma_diao_mock_profile';\nconst MOCK_FRIENDS_KEY = 'ma_diao_mock_friends';\n\nexport interface AdminLogEntry {\n    id: string;\n    timestamp: number;\n    data: MatchLogEntry;\n}\n\n// --- CULTURAL POOLS & ID MAPPING ---\n// We define ID ranges for xsgames.co to approximate ethnicities.\n// Range helper\nconst range = (start: number, end: number) => Array.from({ length: end - start + 1 }, (_, i) => start + i);\n\ninterface CulturalPool {\n    regionName: string;\n    countries: string[];\n    names: string[];\n    titles: string[];\n    // ID ranges for xsgames.co/randomusers/assets/avatars/{gender}/{id}.jpg\n    // We arbitrarily partition them to create \"buckets\" of consistent looks.\n    maleIds: number[]; \n    femaleIds: number[];\n}\n\nconst CULTURAL_POOLS: Record<string, CulturalPool> = {\n    EAST_ASIA: {\n        regionName: 'East Asia',\n        countries: ['cn', 'jp', 'kr', 'hk', 'tw', 'sg', 'vn'],\n        names: [\n            'Wei', 'Jie', 'Ming', 'Hao', 'Yi', 'Long', 'Chen', // CN\n            'Ken', 'Ryu', 'Hiro', 'Satoshi', 'Takumi', // JP\n            'Min-Ho', 'Ji-Sung', 'Soo', 'Jin' // KR\n        ],\n        titles: ['The Scholar', 'Master', 'Sifu', 'Ronin', 'Poet', 'Hand', 'Fox', 'Dragon'],\n        // Assigning lower ID ranges to Asia (Arbitrary partitioning for consistency)\n        maleIds: [...range(0, 10), ...range(60, 65)], \n        femaleIds: [...range(0, 10), ...range(60, 65)]\n    },\n    WESTERN: {\n        regionName: 'Western',\n        countries: ['us', 'gb', 'fr', 'de', 'it', 'ru', 'au', 'ca'],\n        names: [\n            'John', 'Arthur', 'William', 'James', 'Leo', 'Oliver', 'Harry', \n            'Alice', 'Rose', 'Clara', 'Emma', 'Sofia', 'Charlotte'\n        ],\n        titles: ['The Duke', 'Knight', 'Ace', 'Gambler', 'Baron', 'Duchess', 'Queen'],\n        // Assigning middle ID ranges to Western\n        maleIds: [...range(11, 40)],\n        femaleIds: [...range(11, 40)]\n    },\n    GLOBAL_SOUTH: {\n        regionName: 'Global South',\n        countries: ['br', 'mx', 'in', 'za', 'ng', 'eg', 'th', 'ph', 'sa'],\n        names: [\n            'Mateo', 'Diego', 'Ravi', 'Arjun', 'Malik', 'Omar', 'Amir',\n            'Luna', 'Camila', 'Priya', 'Zara', 'Nia', 'Fatima'\n        ],\n        titles: ['Traveler', 'Merchant', 'Guide', 'Mystic', 'Wanderer', 'Sheikh', 'Raja'],\n        // Assigning remaining ID ranges\n        maleIds: [...range(41, 59), ...range(66, 78)],\n        femaleIds: [...range(41, 59), ...range(66, 78)]\n    }\n};\n\n// --- CORE GENERATOR LOGIC ---\n\nconst generateRandomProfile = (preferredRegion?: keyof typeof CULTURAL_POOLS): UserProfile => {\n    // 1. Pick Ethnicity/Region\n    let regionKey = preferredRegion;\n    if (!regionKey) {\n        const rand = Math.random();\n        // Weighted probability: 50% East Asia (Theme fit), 30% Western, 20% Global\n        if (rand < 0.5) regionKey = 'EAST_ASIA'; \n        else if (rand < 0.8) regionKey = 'WESTERN';\n        else regionKey = 'GLOBAL_SOUTH';\n    }\n    const pool = CULTURAL_POOLS[regionKey!];\n\n    // 2. Pick Gender\n    const isFemale = Math.random() > 0.5;\n    const gender: Gender = isFemale ? 'FEMALE' : 'MALE';\n\n    // 3. Pick Name & Country from the MATCHING pool\n    const name = pool.names[Math.floor(Math.random() * pool.names.length)];\n    const title = pool.titles[Math.floor(Math.random() * pool.titles.length)];\n    const country = pool.countries[Math.floor(Math.random() * pool.countries.length)];\n    \n    // 4. Pick Avatar ID from the MATCHING pool's ID list\n    // This ensures \"John\" gets a Western face and \"Wei\" gets an Asian face.\n    const idList = isFemale ? pool.femaleIds : pool.maleIds;\n    // Fallback if list empty (shouldn't happen with correct ranges)\n    const photoId = idList.length > 0 ? idList[Math.floor(Math.random() * idList.length)] : Math.floor(Math.random() * 50);\n    \n    const genderPath = isFemale ? 'female' : 'male';\n    const avatarUrl = `https://xsgames.co/randomusers/assets/avatars/${genderPath}/${photoId}.jpg`;\n\n    // 5. Simulate Gaze Direction (For intelligent seating)\n    // Most portraits look roughly center, but many have a distinct left/right bias.\n    // We assign this property so the seating algorithm can use it.\n    const gazeRand = Math.random();\n    let gazeDirection: GazeDirection = 'CENTER';\n    if (gazeRand < 0.35) gazeDirection = 'LEFT';\n    else if (gazeRand < 0.7) gazeDirection = 'RIGHT';\n\n    return {\n        id: `ai_${Date.now()}_${Math.random().toString(36).substring(7)}`,\n        username: `${name} ${title}`,\n        gender: gender,\n        age: 18 + Math.floor(Math.random() * 45),\n        country: country,\n        gazeDirection: gazeDirection,\n        is_looking_for_match: true,\n        last_active: Date.now(),\n        friends: [],\n        avatar_url: avatarUrl,\n        location: { lat: 30 + Math.random() * 10, lng: 110 + Math.random() * 20 }\n    };\n};\n\nexport const MOCK_PLAYERS = Array.from({ length: 20 }).map(() => generateRandomProfile());\n\n// --- INITIALIZATION ---\n\nexport const isCloudConfigured = (): boolean => {\n    return !!supabase;\n};\n\nexport const initSupabase = (url?: string, key?: string) => {\n    let supabaseUrl = url || localStorage.getItem(STORAGE_KEY_URL);\n    let supabaseKey = key || localStorage.getItem(STORAGE_KEY_KEY);\n\n    if (supabaseUrl && supabaseKey) {\n        try {\n            const globalSupabase = (window as any).supabase;\n            if (globalSupabase && globalSupabase.createClient) {\n                supabase = globalSupabase.createClient(supabaseUrl, supabaseKey);\n                if (url) localStorage.setItem(STORAGE_KEY_URL, url);\n                if (key) localStorage.setItem(STORAGE_KEY_KEY, key);\n                console.log(\"Cloud Service (MemFire/Supabase) initialized.\");\n                return true;\n            }\n        } catch (e) {\n            console.error(\"Failed to init Cloud\", e);\n        }\n    }\n    return false;\n};\n\nexport const getSupabaseConfig = () => {\n    return {\n        url: localStorage.getItem(STORAGE_KEY_URL) || '',\n        key: localStorage.getItem(STORAGE_KEY_KEY) || ''\n    };\n};\n\nexport const clearSupabaseConfig = () => {\n    localStorage.removeItem(STORAGE_KEY_URL);\n    localStorage.removeItem(STORAGE_KEY_KEY);\n    supabase = null;\n};\n\n// --- AUTHENTICATION ---\n\nexport const getCurrentUser = async () => {\n    if (supabase) {\n        const { data: { user } } = await supabase.auth.getUser();\n        if (user) return user;\n    }\n    const mock = localStorage.getItem(MOCK_USER_KEY);\n    if (mock) return JSON.parse(mock);\n    return null;\n};\n\nexport const signInWithProvider = async (provider: SocialProvider) => {\n    if (!supabase) return { error: \"CLOUD_NOT_CONFIGURED\" };\n    try {\n        const { data, error } = await supabase.auth.signInWithOAuth({\n            provider: provider,\n            options: { redirectTo: window.location.origin }\n        });\n        return { data, error };\n    } catch (e) {\n        return { error: e };\n    }\n};\n\nexport const loginAsGuest = async (provider: string) => {\n    const mockUser = {\n        id: `guest_${Date.now()}_${Math.floor(Math.random() * 1000)}`,\n        email: `${provider}_guest@jianghu.com`,\n        app_metadata: { provider },\n        user_metadata: {},\n        aud: 'authenticated',\n        created_at: new Date().toISOString()\n    };\n    \n    localStorage.setItem(MOCK_USER_KEY, JSON.stringify(mockUser));\n\n    // Guest gets an Asian profile by default for immersion\n    const gen = generateRandomProfile('EAST_ASIA');\n    const mockProfile = {\n        ...gen,\n        username: `Guest ${gen.username.split(' ')[0]}`\n    };\n\n    const updates = {\n        ...mockProfile, // Spread first to provide defaults\n        id: mockUser.id, // Then override with specific user ID\n        is_looking_for_match: true,\n        last_active: Date.now(),\n        updated_at: new Date(),\n        friends: []\n    };\n    \n    localStorage.setItem(MOCK_PROFILE_KEY, JSON.stringify(updates));\n\n    return { user: mockUser, error: null };\n};\n\nexport const signOut = async () => {\n    if (supabase) await supabase.auth.signOut();\n    localStorage.removeItem(MOCK_USER_KEY);\n};\n\n// --- PROFILE MANAGEMENT ---\n\nconst isGuest = (id: string) => id.startsWith('guest_');\n\nexport const upsertUserProfile = async (profile: Partial<UserProfile>) => {\n    const user = await getCurrentUser();\n    if (!user) return null;\n\n    const updates = {\n        id: user.id,\n        username: profile.username || user.email?.split('@')[0] || 'Wanderer',\n        avatar_url: profile.avatar_url,\n        gender: profile.gender,\n        age: profile.age,\n        country: profile.country || 'cn', \n        location: profile.location, \n        is_looking_for_match: profile.is_looking_for_match,\n        last_active: Date.now(),\n        updated_at: new Date(),\n        friends: [] \n    };\n\n    if (isGuest(user.id)) {\n        const existing = JSON.parse(localStorage.getItem(MOCK_PROFILE_KEY) || '{}');\n        const final = { ...existing, ...updates, ...profile }; \n        localStorage.setItem(MOCK_PROFILE_KEY, JSON.stringify(final));\n        return final;\n    } else if (supabase) {\n        const { friends, ...profileData } = updates;\n        const { error } = await supabase.from(TABLE_PROFILES).upsert(profileData);\n        if (error) {\n            localStorage.setItem(MOCK_PROFILE_KEY, JSON.stringify(updates));\n            return updates;\n        }\n        return updates;\n    }\n    return null;\n};\n\nexport const getUserProfile = async (userId?: string): Promise<UserProfile | null> => {\n    let id = userId;\n    if (!id) {\n        const u = await getCurrentUser();\n        if (!u) return null;\n        id = u.id;\n    }\n\n    // Safety check to ensure id is a string\n    if (!id) return null;\n\n    if (isGuest(id)) {\n        const local = localStorage.getItem(MOCK_PROFILE_KEY);\n        if (local) {\n            const parsed = JSON.parse(local);\n            const localFriends = JSON.parse(localStorage.getItem(MOCK_FRIENDS_KEY) || '[]');\n            return { ...parsed, friends: localFriends };\n        }\n        return null;\n    }\n\n    if (supabase) {\n        const { data, error } = await supabase\n            .from(TABLE_PROFILES)\n            .select('*')\n            .eq('id', id)\n            .single();\n        if (!error && data) {\n            return data as UserProfile; \n        }\n    }\n    const local = localStorage.getItem(MOCK_PROFILE_KEY);\n    return local ? JSON.parse(local) : null;\n};\n\n// --- AVATAR UPLOAD ---\n\nexport const uploadAvatar = async (file: File): Promise<string | null> => {\n    if (supabase) {\n        try {\n            const fileExt = file.name.split('.').pop();\n            const fileName = `${Date.now()}.${fileExt}`;\n            const filePath = `user_avatar/${fileName}`;\n            const { error: uploadError } = await supabase.storage.from(BUCKET_NAME).upload(filePath, file);\n            if (!uploadError) {\n                const { data } = supabase.storage.from(BUCKET_NAME).getPublicUrl(filePath);\n                return data.publicUrl;\n            }\n        } catch (e) {\n            console.warn(\"Cloud upload failed, using local URL\");\n        }\n    }\n    return URL.createObjectURL(file);\n};\n\n// --- MATCHMAKING LOGIC ---\n\nexport const findMatch = async (myProfile: UserProfile): Promise<UserProfile[]> => {\n    let candidates: UserProfile[] = [];\n\n    // 1. Try Fetch Cloud Candidates\n    if (supabase) {\n        const fiveMinutesAgo = Date.now() - 5 * 60 * 1000;\n        const { data } = await supabase\n            .from(TABLE_PROFILES)\n            .select('*')\n            .neq('id', myProfile.id)\n            .eq('is_looking_for_match', true)\n            .gt('last_active', fiveMinutesAgo)\n            .limit(20);\n        if (data) candidates = data;\n    }\n\n    // 2. Mix in Freshly Generated Mocks\n    const freshMocks = Array.from({ length: 5 }).map(() => generateRandomProfile(Math.random() > 0.3 ? 'EAST_ASIA' : undefined));\n    candidates = [...candidates, ...freshMocks];\n\n    // 3. Score & Sort\n    const scored = candidates.map(c => {\n        let score = 0;\n        if (myProfile.gender !== 'OTHER' && c.gender !== 'OTHER' && myProfile.gender !== c.gender) score += 50;\n        const ageDiff = Math.abs(myProfile.age - c.age);\n        if (ageDiff <= 5) score += 20;\n        return { profile: c, score };\n    });\n\n    return scored.sort((a, b) => b.score - a.score).map(s => s.profile);\n};\n\n// --- FRIENDS SYSTEM ---\n\nexport const addFriend = async (friendId: string) => {\n    const user = await getCurrentUser();\n    if (!user) return false;\n\n    if (isGuest(user.id)) {\n        const friends = JSON.parse(localStorage.getItem(MOCK_FRIENDS_KEY) || '[]');\n        if (!friends.includes(friendId)) {\n            friends.push(friendId);\n            localStorage.setItem(MOCK_FRIENDS_KEY, JSON.stringify(friends));\n        }\n        return true;\n    }\n\n    if (supabase) {\n        const { error } = await supabase.from(TABLE_FRIENDS).insert([{ user_id_1: user.id, user_id_2: friendId, status: 'accepted' }]);\n        return !error;\n    }\n    return false;\n};\n\nexport const getFriends = async (): Promise<UserProfile[]> => {\n    const user = await getCurrentUser();\n    if (!user) return [];\n\n    if (isGuest(user.id)) {\n        const friendIds = JSON.parse(localStorage.getItem(MOCK_FRIENDS_KEY) || '[]');\n        return MOCK_PLAYERS.slice(0, friendIds.length); \n    }\n\n    if (supabase) {\n        const { data: friendships } = await supabase.from(TABLE_FRIENDS).select('*').or(`user_id_1.eq.${user.id},user_id_2.eq.${user.id}`);\n        if (friendships) {\n            const ids = friendships.map((f: any) => f.user_id_1 === user.id ? f.user_id_2 : f.user_id_1);\n            const { data: friends } = await supabase.from(TABLE_PROFILES).select('*').in('id', ids);\n            return friends || [];\n        }\n    }\n    return [];\n};\n\n// --- EXISTING ADMIN & STATS ---\nexport const syncGameStats = async (history: GameHistory) => {\n    if (supabase && history.matchLogs.length > 0) {\n        supabase.from(TABLE_HISTORY).upsert({ id: history.matchLogs[0].id, timestamp: history.matchLogs[0].timestamp, data: history.matchLogs[0] }).then();\n    }\n};\nexport const fetchAllMatchLogs = async (): Promise<AdminLogEntry[]> => {\n    if (!supabase) return [];\n    const { data } = await supabase.from(TABLE_HISTORY).select('*').order('timestamp', { ascending: false }).limit(50);\n    return data || [];\n};\nexport const deleteMatchLog = async (id: string): Promise<boolean> => {\n    if (!supabase) return false;\n    const { error } = await supabase.from(TABLE_HISTORY).delete().eq('id', id);\n    return !error;\n};\n","\nimport { GameHistory, MatchLogEntry } from '../types';\nimport { loadAIMemory } from './aiLearningService';\nimport { syncGameStats, initSupabase, getSupabaseConfig } from './cloudService';\n\nconst STATS_KEY = 'ma_diao_stats_v1';\n\n// Init Cloud if keys exist on load - WRAPPED IN TRY/CATCH to prevent top-level module crash\ntry {\n    const config = getSupabaseConfig();\n    if (config.url && config.key) {\n        initSupabase(config.url, config.key);\n    }\n} catch (e) {\n    console.warn(\"Failed to auto-init cloud service:\", e);\n}\n\nexport const loadGameStats = (): GameHistory => {\n    const defaults: GameHistory = {\n        totalRounds: 0,\n        bankerWins: 0,\n        peasantWins: 0,\n        lastRoundWinnerType: 'DRAW',\n        aggressionModifier: 0,\n        aiLearningStates: loadAIMemory(),\n        matchLogs: [] // Initialize empty logs\n    };\n    try {\n        const stored = localStorage.getItem(STATS_KEY);\n        if (stored) {\n            const parsed = JSON.parse(stored);\n            return { \n                ...defaults, \n                ...parsed, \n                // Ensure matchLogs exists if loading from old data\n                matchLogs: parsed.matchLogs || [],\n                aiLearningStates: loadAIMemory() \n            };\n        }\n    } catch(e) { \n        console.error(\"Failed to load stats\", e); \n    }\n    return defaults;\n};\n\nexport const saveGameStats = (history: GameHistory) => {\n    try {\n        // Exclude aiLearningStates from this key as they are managed by aiLearningService\n        const { aiLearningStates, ...stats } = history; \n        localStorage.setItem(STATS_KEY, JSON.stringify(stats));\n        \n        // Sync with Cloud\n        syncGameStats(history);\n    } catch(e) { \n        console.error(\"Failed to save stats\", e); \n    }\n};\n\nexport const clearGameStats = () => {\n    localStorage.removeItem(STATS_KEY);\n};\n\nexport const addMatchLog = (history: GameHistory, entry: MatchLogEntry): GameHistory => {\n    // Keep only the last 20 matches locally to prevent unlimited storage growth\n    const updatedLogs = [entry, ...(history.matchLogs || [])].slice(0, 20);\n    return {\n        ...history,\n        matchLogs: updatedLogs\n    };\n};\n","\nimport { useState, useEffect } from 'react';\nimport { \n    generateDeck, \n    ID_WAN_WAN, ID_QIAN_WAN, ID_BAI_WAN, \n} from '../constants';\nimport { Player, PlayerType, GamePhase, Card, Suit, ScoreResult, Difficulty, KaiChongDetail, CardRank, GameHistory, ViolationRecord, RiskAssessment, RiskLevel, SpecialCaptureFlags, UserProfile, SupportedLanguage } from '../types';\nimport { calculateRoundScores, findBestKaiChongMatch } from '../services/scoringService';\nimport { evaluatePlayRisk } from '../services/riskEngine';\nimport { loadGameStats, saveGameStats } from '../services/statsService';\nimport { updateAILearning, getAIState } from '../services/aiLearningService';\nimport { MOCK_PLAYERS } from '../services/cloudService'; \n\n// Utility\nfunction shuffle<T>(array: T[]): T[] {\n  const newArray = [...array];\n  for (let i = newArray.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];\n  }\n  return newArray;\n}\n\nconst sortHand = (cards: Card[]): Card[] => {\n    const getSuitWeight = (suit: Suit) => {\n        switch (suit) {\n            case Suit.CASH: return 4;\n            case Suit.STRINGS: return 3;\n            case Suit.COINS: return 2;\n            case Suit.TEXTS: return 1;\n            default: return 0;\n        }\n    };\n    return [...cards].sort((a, b) => {\n        const weightA = getSuitWeight(a.suit);\n        const weightB = getSuitWeight(b.suit);\n        if (weightA !== weightB) return weightB - weightA;\n        return b.value - a.value;\n    });\n};\n\nconst generateEntertainingDeck = (): Card[] => {\n    const fullDeck = generateDeck();\n    return shuffle(fullDeck);\n};\n\nexport type GameEvent = {\n    type: 'GAME_START' | 'TRICK_WIN' | 'TRICK_LOSS' | 'VIOLATION' | 'ROUND_WIN' | 'ROUND_LOSS' | 'KAI_CHONG_SUCCESS' | 'KAI_CHONG_FAIL' | 'ROUND_END' | 'PENALTY';\n    playerId?: number;\n    context?: any;\n    timestamp: number;\n};\n\ninterface GameConfig {\n    difficulty: Difficulty;\n    isRiskAlertOn: boolean;\n    language: SupportedLanguage;\n}\n\nexport const useMaDiaoGame = (config: GameConfig) => {\n  // --- CORE GAME STATE ONLY ---\n  const [deck, setDeck] = useState<Card[]>([]);\n  const [players, setPlayers] = useState<Player[]>([]);\n  const [pot, setPot] = useState<Card[]>([]);\n  const [tableCards, setTableCards] = useState<{ playerId: number; card: Card; isFaceDown: boolean }[]>([]);\n  const [currentPlayerIndex, setCurrentPlayerIndex] = useState<number>(0);\n  const [phase, setPhase] = useState<GamePhase>(GamePhase.DEALING);\n  const [bankerId, setBankerId] = useState<number>(3);\n  const [roundResults, setRoundResults] = useState<ScoreResult[]>([]);\n  const [trickNumber, setTrickNumber] = useState<number>(1);\n  const [gameMessage, setGameMessage] = useState<string>(\"\");\n  \n  // Game Data Recording\n  const [recordedCards, setRecordedCards] = useState<Card[]>([]);\n  const [faceUpPlayedCardIds, setFaceUpPlayedCardIds] = useState<Set<string>>(new Set());\n  const [violationLog, setViolationLog] = useState<ViolationRecord[]>([]);\n  const [openedSuits, setOpenedSuits] = useState<{suit: Suit, leaderId: number, isBanker: boolean}[]>([]);\n  const [firstLeadInfo, setFirstLeadInfo] = useState< {card: Card, playerId: number} | null>(null);\n  const [bankerFirstLeadCard, setBankerFirstLeadCard] = useState<Card | null>(null); \n  const [gameHistory, setGameHistory] = useState<GameHistory>(() => loadGameStats());\n  const [specialCaptures, setSpecialCaptures] = useState<SpecialCaptureFlags>({ wanCaughtQian: false, wanCaughtBai: false, qianCaughtBai: false });\n  const [trickWinnerId, setTrickWinnerId] = useState<number | null>(null);\n  const [kaiChongCardIndex, setKaiChongCardIndex] = useState<number>(0);\n  const [kaiChongHistory, setKaiChongHistory] = useState<KaiChongDetail[]>([]);\n  const [mianZhangCard, setMianZhangCard] = useState<Card | null>(null);\n  \n  // Interaction State (Selection/Risk)\n  const [selectedCardId, setSelectedCardId] = useState<string | null>(null);\n  const [pendingRisk, setPendingRisk] = useState<{cardId: string, assessment: RiskAssessment} | null>(null);\n  const [violationNotification, setViolationNotification] = useState<{title: string, message: string} | null>(null);\n\n  // --- EVENT STREAM ---\n  const [lastGameEvent, setLastGameEvent] = useState<GameEvent | null>(null);\n\n  const emitEvent = (type: GameEvent['type'], playerId?: number, context?: any) => {\n      setLastGameEvent({ type, playerId, context, timestamp: Date.now() });\n  };\n\n  // --- ACTIONS ---\n\n  const resetRoundState = () => {\n      setTableCards([]);\n      setPot([]);\n      setMianZhangCard(null);\n      setRoundResults([]);\n      setTrickNumber(1);\n      setRecordedCards([]);\n      setFaceUpPlayedCardIds(new Set());\n      setOpenedSuits([]);\n      setViolationLog([]);\n      setGameMessage(\"\");\n      setKaiChongHistory([]);\n      setKaiChongCardIndex(0);\n      setSpecialCaptures({ wanCaughtQian: false, wanCaughtBai: false, qianCaughtBai: false });\n      setSelectedCardId(null);\n      setPendingRisk(null);\n      setViolationNotification(null);\n      setFirstLeadInfo(null);\n      setBankerFirstLeadCard(null);\n  };\n\n  const startGame = (userProfile?: UserProfile, existingPlayers?: Player[]) => {\n    setPhase(GamePhase.SHUFFLING);\n    resetRoundState();\n\n    setTimeout(() => {\n        const newDeck = generateEntertainingDeck();\n        setDeck(newDeck);\n        const hands = [\n            sortHand(newDeck.slice(0, 8)),\n            sortHand(newDeck.slice(8, 16)),\n            sortHand(newDeck.slice(16, 24)),\n            sortHand(newDeck.slice(24, 32))\n        ];\n        // MARK POT CARDS WITH isPot: true\n        const potCards = newDeck.slice(32, 39).map(c => ({ ...c, isPot: true })); \n        const mianZhang = { ...newDeck[39], isPot: true };\n        \n        let newPlayers: Player[] = [];\n        let newBankerId = 0;\n\n        if (existingPlayers && existingPlayers.length === 4) {\n            newBankerId = (existingPlayers.findIndex(p => p.isDealer) + 1) % 4; // Rotate Banker\n            newPlayers = existingPlayers.map((p, i) => {\n                return {\n                    ...p,\n                    hand: hands[i],\n                    trickPile: [],\n                    capturedCards: [],\n                    isDealer: p.id === newBankerId,\n                    isBaiLaoRevealed: false,\n                    isSuspectedBaiLao: false,\n                };\n            });\n        } else {\n            const availableProfiles = shuffle([...MOCK_PLAYERS]);\n            const findAndPop = (gaze: string) => {\n                const idx = availableProfiles.findIndex(p => p.gazeDirection === gaze);\n                if (idx !== -1) {\n                    const [found] = availableProfiles.splice(idx, 1);\n                    return found;\n                }\n                return null;\n            };\n            const rightBot = findAndPop('LEFT') || findAndPop('CENTER') || availableProfiles.pop();\n            const leftBot = findAndPop('RIGHT') || findAndPop('CENTER') || availableProfiles.pop();\n            const topBot = findAndPop('CENTER') || availableProfiles.pop();\n\n            // Fallback if pool is empty\n            const createFallbackProfile = (name: string): UserProfile => ({\n                id: `bot_${Math.random().toString(36).substring(7)}`,\n                username: name,\n                gender: 'OTHER',\n                age: 30,\n                country: 'cn',\n                is_looking_for_match: false,\n                last_active: Date.now(),\n                friends: [],\n                gazeDirection: 'CENTER'\n            });\n\n            const safeRight = rightBot || createFallbackProfile('Bot 1');\n            const safeTop = topBot || createFallbackProfile('Bot 2');\n            const safeLeft = leftBot || createFallbackProfile('Bot 3');\n\n            newPlayers = [\n                { id: 0, name: userProfile?.username || \"You\", type: PlayerType.HUMAN, hand: hands[0], trickPile: [], capturedCards: [], isDealer: false, position: 'Bottom', score: 0, profile: userProfile },\n                { id: 1, name: safeRight.username, type: PlayerType.AI, hand: hands[1], trickPile: [], capturedCards: [], isDealer: false, position: 'Right', score: 0, profile: safeRight },\n                { id: 2, name: safeTop.username, type: PlayerType.AI, hand: hands[2], trickPile: [], capturedCards: [], isDealer: false, position: 'Top', score: 0, profile: safeTop },\n                { id: 3, name: safeLeft.username, type: PlayerType.AI, hand: hands[3], trickPile: [], capturedCards: [], isDealer: false, position: 'Left', score: 0, profile: safeLeft }\n            ];\n            newBankerId = Math.floor(Math.random() * 4);\n            newPlayers.forEach(p => p.isDealer = p.id === newBankerId);\n        }\n        \n        setPlayers(newPlayers);\n        setPot(potCards);\n        setMianZhangCard(mianZhang);\n        setBankerId(newBankerId);\n        \n        const offset = (mianZhang.value - 1) % 4;\n        const starterId = (newBankerId + offset) % 4;\n        setCurrentPlayerIndex(starterId);\n        \n        setPhase(GamePhase.PLAYING);\n        setGameMessage(starterId === 0 ? \"You Lead First\" : `Player ${starterId} Leads`);\n        setTimeout(() => setGameMessage(\"\"), 3000);\n        emitEvent('GAME_START', starterId);\n    }, 2000);\n  };\n\n  const startNextRound = () => {\n      startGame(undefined, players);\n  };\n\n  const exitToTitle = () => {\n      setPhase(GamePhase.DEALING);\n      setPlayers([]);\n      resetRoundState();\n  };\n\n  const advanceTurn = (nextPlayerId: number) => {\n      setCurrentPlayerIndex(nextPlayerId);\n  };\n\n  const resolveTrick = (cards: { playerId: number, card: Card, isFaceDown: boolean }[], currentPlayers: Player[]) => {\n      if (!cards || cards.length === 0) return;\n      const leadSuit = cards[0].card.suit;\n      let winnerId = cards[0].playerId;\n      let maxVal = -1;\n      let winningCardRef: Card | null = null;\n      \n      cards.forEach(tc => {\n          if (!tc.isFaceDown && tc.card.suit === leadSuit && tc.card.value > maxVal) {\n              maxVal = tc.card.value;\n              winnerId = tc.playerId;\n              winningCardRef = tc.card;\n          }\n      });\n      if (!winningCardRef) { winnerId = cards[0].playerId; winningCardRef = cards[0].card; }\n      setTrickWinnerId(winnerId);\n      \n      if (winningCardRef.suit === Suit.CASH) {\n          const winnerVal = winningCardRef.value;\n          const hasQian = cards.some(tc => tc.card.id === ID_QIAN_WAN);\n          const hasBai = cards.some(tc => tc.card.id === ID_BAI_WAN);\n          setSpecialCaptures(prev => {\n              const next = { ...prev };\n              if (winnerVal === 11) {\n                  if (hasQian) next.wanCaughtQian = true;\n                  if (hasBai) next.wanCaughtBai = true;\n              } else if (winnerVal === 10) {\n                  if (hasBai) next.qianCaughtBai = true;\n              }\n              return next;\n          });\n      }\n\n      const isBigWin = winningCardRef.rank === CardRank.ZUN || winningCardRef.rank === CardRank.BAI;\n      emitEvent('TRICK_WIN', winnerId, { isBig: isBigWin });\n\n      setTimeout(() => {\n          setTrickWinnerId(null);\n          setTableCards([]);\n          const updatedPlayers = currentPlayers.map(p => {\n              let newTrickPile = [...p.trickPile];\n              let newCapturedCards = [...p.capturedCards];\n              if (p.id === winnerId && winningCardRef) {\n                   newTrickPile.push({ card: winningCardRef, isFaceUp: true, round: trickNumber });\n                   newCapturedCards.push(winningCardRef);\n              }\n              return { ...p, trickPile: newTrickPile, capturedCards: newCapturedCards };\n          });\n          setPlayers(updatedPlayers);\n          if (trickNumber === 8) { \n              setPhase(GamePhase.KAI_CHONG); \n              setGameMessage(\"Kai Chong Phase\"); \n              setKaiChongCardIndex(0); \n              setCurrentPlayerIndex(winnerId);\n          } else { \n              setTrickNumber(trickNumber + 1); \n              advanceTurn(winnerId);\n          }\n      }, 1500);\n  };\n\n  const executePlayCard = async (playerId: number, cardId: string, bypassRisk: boolean = false) => {\n    // 1. Snapshot current state for logic\n    const player = players.find(p => p.id === playerId);\n    if (!player) return;\n    const card = player.hand.find(c => c.id === cardId);\n    if (!card) return;\n    \n    // Risk Check\n    const tableCardsForRisk = tableCards.map(tc => ({ card: tc.card, playerId: tc.playerId }));\n    if (playerId === 0 && config.isRiskAlertOn && !bypassRisk) {\n        const risk = evaluatePlayRisk(player, card, tableCardsForRisk, bankerId, players, recordedCards, openedSuits, firstLeadInfo, trickNumber, mianZhangCard, bankerFirstLeadCard);\n        if (risk && risk.riskLevel !== RiskLevel.SAFE) {\n            setPendingRisk({ cardId, assessment: risk });\n            return;\n        }\n    }\n    setPendingRisk(null);\n    \n    const leadSuit = tableCards.length > 0 ? tableCards[0].card.suit : null;\n    let isFaceDown = false;\n    if (leadSuit) {\n        if (card.suit !== leadSuit) isFaceDown = true;\n        else {\n             let currentMax = -1;\n             tableCards.forEach((tc:any) => { if (!tc.isFaceDown && tc.card.suit === leadSuit && tc.card.value > currentMax) { currentMax = tc.card.value; } });\n             if (card.value <= currentMax) isFaceDown = true;\n        }\n    }\n    if (trickNumber === 8 && (!player.capturedCards || player.capturedCards.length === 0)) isFaceDown = true;\n\n    if (!isFaceDown) {\n        setFaceUpPlayedCardIds(prev => { const next = new Set(prev); next.add(card.id); return next; });\n    }\n\n    const isMillion = card.id === ID_BAI_WAN;\n    const isWanWan = card.id === ID_WAN_WAN;\n    const isCashLead = tableCards.length === 0 && card.suit === Suit.CASH;\n    const isMillionFaceUp = isMillion && !isFaceDown;\n    const alreadyRevealed = players.some(p => p.isBaiLaoRevealed);\n\n    // 2. ATOMIC STATE UPDATES (Functional Update Pattern)\n    // We update players state using the previous state to avoid race conditions\n    setPlayers(currentPlayers => {\n        return currentPlayers.map(p => {\n            if (p.id === playerId) {\n                // Remove card from hand\n                const newHand = p.hand.filter(c => c.id !== cardId);\n                let newP = { ...p, hand: newHand };\n                \n                // Update Metadata (Bai Lao status)\n                if (isMillionFaceUp) {\n                    newP.isBaiLaoRevealed = true;\n                    newP.isSuspectedBaiLao = false;\n                } else if (!alreadyRevealed) {\n                    if (isCashLead && !isWanWan && !isFaceDown) {\n                        if (!newP.isSuspectedBaiLao) newP.isSuspectedBaiLao = true;\n                    }\n                }\n                return newP;\n            }\n            // Logic for other players (e.g. if one reveals Bai Lao, others might update suspicion, but here only current player changes)\n            return p;\n        });\n    });\n\n    const newTableCards = [...tableCards, { playerId, card, isFaceDown }];\n    setTableCards(newTableCards);\n    setRecordedCards(prev => [...prev, card]);\n\n    if (tableCards.length === 0) {\n        setFirstLeadInfo({ card, playerId });\n        \n        // Track Banker's First Lead\n        if (playerId === bankerId && !bankerFirstLeadCard) {\n            setBankerFirstLeadCard(card);\n        }\n\n        const isSuitOpened = openedSuits.some(s => s.suit === card.suit);\n        if (!isSuitOpened) {\n            setOpenedSuits(prev => [...prev, { suit: card.suit, leaderId: playerId, isBanker: playerId === bankerId }]);\n        }\n    }\n\n    setSelectedCardId(null);\n    \n    // Resolve trick AFTER state updates are committed\n    if (newTableCards.length === 4) { \n        // We need the *latest* players for resolution, but we can't get them synchronously from state.\n        // However, resolveTrick takes `currentPlayers` as arg. We can simulate the state update locally for the logic.\n        const nextPlayersState = players.map(p => p.id === playerId ? { ...p, hand: p.hand.filter(c => c.id !== cardId) } : p);\n        setTimeout(() => resolveTrick(newTableCards, nextPlayersState), 1000); \n    } else { \n        advanceTurn((currentPlayerIndex + 1) % 4); \n    }\n  };\n\n  // Bi Zhang\n  useEffect(() => {\n      if (trickNumber === 8 && phase === GamePhase.PLAYING && tableCards.length === 0) {\n          const runBiZhang = async () => {\n              setGameMessage(\"Bi Zhang\");\n              let currentTable: { playerId: number; card: Card; isFaceDown: boolean }[] = [];\n              let tempPlayers = [...players];\n              const turnOrder = [0, 1, 2, 3].map(i => (currentPlayerIndex + i) % 4);\n              for (const pid of turnOrder) {\n                  const p = tempPlayers.find(pl => pl.id === pid)!;\n                  if (p.hand.length === 0) continue; \n                  const card = p.hand[0]; \n                  let isFaceDown = false;\n                  if (!p.capturedCards || p.capturedCards.length === 0) { isFaceDown = true; } \n                  else if (currentTable.length > 0) {\n                      const leadSuit = currentTable[0].card.suit;\n                      if (card.suit !== leadSuit) { isFaceDown = true; } \n                      else {\n                          let currentMax = -1;\n                          currentTable.forEach((tc:any) => { if (!tc.isFaceDown && tc.card.suit === leadSuit && tc.card.value > currentMax) { currentMax = tc.card.value; } });\n                          if (card.value <= currentMax) { isFaceDown = true; }\n                      }\n                  }\n                  const newEntry = { playerId: pid, card, isFaceDown };\n                  if (!isFaceDown) setFaceUpPlayedCardIds(prev => new Set(prev).add(card.id));\n                  currentTable.push(newEntry);\n                  tempPlayers = tempPlayers.map(pl => pl.id === pid ? { ...pl, hand: [] } : pl);\n                  setPlayers(tempPlayers);\n                  setTableCards([...currentTable]); \n                  await new Promise(r => setTimeout(r, 800));\n              }\n              resolveTrick(currentTable, tempPlayers);\n          };\n          runBiZhang();\n      }\n  }, [trickNumber, phase]); \n\n  // Kai Chong Phase Logic - Fix for stalling\n  useEffect(() => {\n      let timer: any;\n      if (phase === GamePhase.KAI_CHONG) {\n          // Check bounds\n          if (kaiChongCardIndex < 7) { // 7 Pot Cards\n              timer = setTimeout(() => {\n                  const currentPotCard = pot[kaiChongCardIndex];\n                  \n                  // CRITICAL FIX: Ensure pot card exists before processing\n                  if (!currentPotCard) {\n                      setKaiChongCardIndex(prev => prev + 1);\n                      return;\n                  }\n\n                  const possibleMatches: KaiChongDetail[] = [];\n                  players.forEach(p => {\n                      const match = findBestKaiChongMatch({ \n                          players, potCard: currentPotCard, lang: config.language, history: kaiChongHistory, currentAttempterId: p.id, specialCaptures \n                      });\n                      if (match) possibleMatches.push(match);\n                  });\n\n                  // SORT Matches (Priority)\n                  const flipperId = currentPlayerIndex;\n                  possibleMatches.sort((a, b) => {\n                      if (a.priorityScore !== b.priorityScore) return a.priorityScore - b.priorityScore;\n                      const distA = (a.playerId - flipperId + 4) % 4;\n                      const distB = (b.playerId - flipperId + 4) % 4;\n                      return distA - distB;\n                  });\n\n                  const winningMatch = possibleMatches[0];\n\n                  if (winningMatch) {\n                      setKaiChongHistory(prev => [...prev, winningMatch]);\n                      emitEvent('KAI_CHONG_SUCCESS', winningMatch.playerId);\n                      setCurrentPlayerIndex(winningMatch.playerId); \n                      // Update Player's pile immediately for visual feedback\n                      setPlayers(prevPlayers => prevPlayers.map(p => {\n                          if (p.id === winningMatch.playerId) {\n                              const duplicateSourceIds = winningMatch.sourceCards.filter(sc => sc.suit === winningMatch.matchedCard.suit && sc.value === winningMatch.matchedCard.value).map(sc => sc.id);\n                              // Hide duplicates in the trick pile\n                              const newTrickPile = p.trickPile.map(tc => duplicateSourceIds.includes(tc.card.id) ? { ...tc, hidden: true } : tc);\n                              // Add pot card (Keep isPot metadata)\n                              newTrickPile.push({ card: winningMatch.matchedCard, isFaceUp: true, round: 9, isKaiChong: true });\n                              return { ...p, trickPile: newTrickPile, capturedCards: [...p.capturedCards, winningMatch.matchedCard] };\n                          }\n                          return p;\n                      }));\n                  } else {\n                      emitEvent('KAI_CHONG_FAIL', flipperId);\n                      setCurrentPlayerIndex((flipperId + 1) % 4);\n                  }\n                  \n                  // Advance to next card\n                  setKaiChongCardIndex(prev => prev + 1);\n              }, 1200); // Slower pacing for better visual follow\n          } else {\n              // End of Round / Scoring\n              timer = setTimeout(() => {\n                  const scores = calculateRoundScores({ players, bankerId, lang: config.language, kaiChongHistory, violationLog });\n                  const newHistory = { ...gameHistory };\n                  newHistory.totalRounds = (newHistory.totalRounds || 0) + 1;\n                  const bankerScore = scores.find(s => s.playerId === bankerId)?.totalRoundChange || 0;\n                  \n                  if (bankerScore > 0) { newHistory.bankerWins++; newHistory.lastRoundWinnerType = 'BANKER'; } \n                  else if (bankerScore < 0) { newHistory.peasantWins++; newHistory.lastRoundWinnerType = 'PEASANT'; } \n                  else { newHistory.lastRoundWinnerType = 'DRAW'; }\n                  \n                  // Update player total scores\n                  const updatedPlayers = players.map(p => {\n                      const pScore = scores.find(s => s.playerId === p.id);\n                      return { ...p, score: p.score + (pScore?.totalRoundChange || 0) };\n                  });\n                  setPlayers(updatedPlayers);\n\n                  const humanScore = scores.find(s => s.playerId === 0);\n                  if (humanScore && humanScore.violations.length > 0) emitEvent('VIOLATION');\n                  emitEvent('ROUND_END');\n\n                  const newLearningStates = { ...(newHistory.aiLearningStates || {}) };\n                  updatedPlayers.forEach(p => {\n                      if (p.type === PlayerType.AI) {\n                          const result = scores.find(s => s.playerId === p.id);\n                          if (result) {\n                              const currentState = getAIState(p.id, gameHistory);\n                              newLearningStates[p.id] = updateAILearning(currentState, result, p.id === bankerId, config.difficulty);\n                          }\n                      }\n                  });\n                  newHistory.aiLearningStates = newLearningStates;\n                  saveGameStats(newHistory);\n                  setGameHistory(newHistory);\n                  setRoundResults(scores);\n                  \n                  // CLEAR TABLE BEFORE SHOWING SCORE\n                  setTableCards([]);\n                  setPot([]);\n                  setMianZhangCard(null);\n                  setTrickWinnerId(null);\n                  \n                  setPhase(GamePhase.SCORING);\n              }, 1500);\n          }\n      }\n      return () => clearTimeout(timer);\n  }, [phase, kaiChongCardIndex]);\n\n  return {\n      state: {\n          players, deck, pot, tableCards, currentPlayerIndex, phase, bankerId, roundResults, trickNumber, gameMessage,\n          recordedCards, faceUpPlayedCardIds, violationLog, openedSuits, firstLeadInfo, gameHistory,\n          trickWinnerId, kaiChongCardIndex, kaiChongHistory, mianZhangCard,\n          selectedCardId, pendingRisk, violationNotification, lastGameEvent, bankerFirstLeadCard\n      },\n      actions: {\n          startGame, startNextRound, exitToTitle, executePlayCard, \n          setSelectedCardId, setPendingRisk, setViolationNotification\n      }\n  };\n};\n","\nimport { GoogleGenAI, Chat, Modality } from \"@google/genai\";\nimport { MA_DIAO_TUTOR_PROMPT } from '../constants';\nimport { Card, Player, Suit, Difficulty, GameHistory, RiskLevel, PlayerType } from '../types';\nimport { evaluatePlayRisk } from './riskEngine';\nimport { getAIState } from './aiLearningService';\n\n// --- ROBUST INITIALIZATION ---\nlet ai: GoogleGenAI | null = null;\nlet globalAIFailure = false;\n\ntry {\n    // Safe check for process.env.API_KEY without throwing ReferenceError\n    // In Vite/Browser env, process.env might be polyfilled or empty\n    const apiKey = (typeof process !== 'undefined' && process && process.env) ? process.env.API_KEY : '';\n    \n    if (apiKey && apiKey.length > 0) {\n        ai = new GoogleGenAI({ apiKey });\n    } else {\n        console.warn(\"AI Key not found in process.env.API_KEY. AI features disabled.\");\n        globalAIFailure = true;\n    }\n} catch (e) {\n    console.warn(\"GoogleGenAI init failed (likely missing key or network issue):\", e);\n    globalAIFailure = true;\n}\n\nexport const isAIEnabled = (): boolean => !!ai && !globalAIFailure;\n\n// 1. AI Tutor/Chat Service\nlet chatSession: Chat | null = null;\n\nexport const initializeChat = async (): Promise<string> => {\n  if (!ai || globalAIFailure) return \"AI 功能暂时不可用 (API Key Missing)。\";\n  \n  try {\n    const chat = ai.chats.create({\n      model: 'gemini-2.5-flash',\n      config: {\n        systemInstruction: MA_DIAO_TUTOR_PROMPT,\n      },\n    });\n    chatSession = chat;\n    return \"欢迎，年轻的学徒。我是马吊大师。关于规则、策略或惩罚，尽管问我。\";\n  } catch (error) {\n    console.error(\"聊天初始化错误\", error);\n    return \"大师正在冥想中（连接错误）。\";\n  }\n};\n\nexport const sendMessageToTutor = async (message: string): Promise<string> => {\n  if (!chatSession) await initializeChat();\n  if (!chatSession) return \"大师保持沉默。\";\n\n  try {\n    const result = await chatSession.sendMessage({ message });\n    return result.text || \"无言以对。\";\n  } catch (error: any) {\n    console.error(\"发送消息错误\", error);\n    if (error.message?.includes('429') || error.status === 429 || error.code === 429) {\n        globalAIFailure = true; \n        return \"思维疲惫（频率限制）。请稍后再试。\";\n    }\n    return \"网络波动，请重试。\";\n  }\n};\n\n// 3. AI Speech Generation (TTS)\nexport const generateSpeech = async (text: string, voiceName: string = 'Puck'): Promise<Uint8Array | null> => {\n    if (!ai || globalAIFailure) return null;\n    try {\n        const response = await ai.models.generateContent({\n            model: 'gemini-2.5-flash-preview-tts',\n            contents: { parts: [{ text }] },\n            config: {\n                responseModalities: [Modality.AUDIO],\n                speechConfig: {\n                    voiceConfig: { prebuiltVoiceConfig: { voiceName } }\n                }\n            }\n        });\n        \n        const base64Audio = response.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;\n        if (base64Audio) {\n            const binaryString = atob(base64Audio);\n            const len = binaryString.length;\n            const bytes = new Uint8Array(len);\n            for (let i = 0; i < len; i++) {\n                bytes[i] = binaryString.charCodeAt(i);\n            }\n            return bytes;\n        }\n    } catch (e) {\n        console.error(\"TTS Generation Error\", e);\n    }\n    return null;\n};\n\n// 2. AI Player Logic (Strategy Brain)\nexport const getAIMove = async (\n  aiPlayer: Player,\n  tableCards: { card: Card, playerId: number }[],\n  allPlayers: Player[],\n  recordedCards: Card[],\n  bankerId: number,\n  difficulty: Difficulty = Difficulty.MEDIUM,\n  gameHistory?: GameHistory,\n  openedSuits: { suit: Suit, leaderId: number, isBanker: boolean }[] = [],\n  firstLeadInfo: { card: Card, playerId: number } | null = null,\n  roundNumber: number = 1,\n  mianZhangCard: Card | null = null // Added parameter\n): Promise<Card | null> => {\n  // If AI is disabled or crashed, fallback to simple heuristic immediately\n  if (globalAIFailure || !ai) {\n      // Fallback: Play first valid card (simplified)\n      return aiPlayer.hand.length > 0 ? aiPlayer.hand[0] : null;\n  }\n\n  if (aiPlayer.hand.length === 0) return null;\n\n  const estimatedRound = 8 - aiPlayer.hand.length;\n\n  const getHeuristicMove = (): Card => {\n     const hand = [...aiPlayer.hand];\n     const learningState = gameHistory ? getAIState(aiPlayer.id, gameHistory) : { aggression: 0.5, riskTolerance: 0.3, bluffFrequency: 0, playerId: aiPlayer.id, gamesPlayed: 0, winRate: 0, lastRole: 'PEASANT', lastResult: 'DRAW' };\n     \n     // Step 1: Risk Assessment\n     const analyzedMoves = hand.map(card => {\n         const risk = evaluatePlayRisk(\n             { ...aiPlayer, type: PlayerType.HUMAN }, // Trick engine to treat as human for risk calc\n             card, \n             tableCards, \n             bankerId, \n             allPlayers, \n             recordedCards,\n             openedSuits,\n             firstLeadInfo,\n             estimatedRound,\n             mianZhangCard // Pass it down\n         );\n         return { card, risk };\n     });\n\n     // Step 2: Filtering based on Personality\n     \n     // Level 1: Absolute Prohibition (PENALTY)\n     let validMoves = analyzedMoves.filter(m => !m.risk || m.risk.riskLevel !== RiskLevel.PENALTY);\n     if (validMoves.length === 0) validMoves = analyzedMoves; \n\n     // Level 2: Risk Tolerance (WARNING)\n     if (difficulty !== Difficulty.EASY) {\n         if (learningState.riskTolerance < 0.5) {\n             const noWarnings = validMoves.filter(m => !m.risk || m.risk.riskLevel !== RiskLevel.WARNING);\n             if (noWarnings.length > 0) validMoves = noWarnings;\n         }\n     }\n\n     // Level 3: Aggression (NOTICE)\n     if (learningState.aggression < 0.4) {\n         const purelySafe = validMoves.filter(m => !m.risk || m.risk.riskLevel === RiskLevel.SAFE);\n         if (purelySafe.length > 0) validMoves = purelySafe;\n     }\n\n     const candidates = validMoves.map(m => m.card);\n     \n     // Step 3: Optimization\n     const isBaiLao = aiPlayer.hand.some(c => c.id === 'c_9');\n\n     const sortLowToHigh = (cards: Card[]) => [...cards].sort((a,b) => a.value - b.value);\n     const sortHighToLow = (cards: Card[]) => [...cards].sort((a,b) => b.value - a.value);\n\n     // Case A: Leading\n     if (tableCards.length === 0) {\n        const shouldAttack = learningState.aggression > 0.6 || aiPlayer.id === bankerId || isBaiLao;\n        \n        if (shouldAttack) {\n            return sortHighToLow(candidates)[0];\n        } else {\n            return sortLowToHigh(candidates)[0];\n        }\n     }\n\n     // Case B: Following Suit\n     const leadSuit = tableCards[0].card.suit;\n     const followCards = candidates.filter(c => c.suit === leadSuit);\n     \n     if (followCards.length > 0) {\n         let currentBestVal = -1;\n         tableCards.forEach(tc => {\n            if (tc.card.suit === leadSuit && tc.card.value > currentBestVal) currentBestVal = tc.card.value;\n         });\n\n         const winningMoves = followCards.filter(c => c.value > currentBestVal);\n         \n         if (winningMoves.length > 0) {\n             if (learningState.aggression > 0.8) {\n                 return sortHighToLow(winningMoves)[0]; \n             }\n             return sortLowToHigh(winningMoves)[0]; \n         } else {\n             return sortLowToHigh(followCards)[0];\n         }\n     }\n\n     // Case C: Discarding (Melting)\n     const safeDiscards = candidates;\n     \n     const sortForDiscard = (cards: Card[]): Card[] => {\n        return cards.sort((a, b) => {\n             if (a.id === 'c_9') return 1;\n             if (b.id === 'c_9') return -1;\n             \n             const aIsRed = a.color === 'red';\n             const bIsRed = b.color === 'red';\n             \n             if (learningState.aggression > 0.5) {\n                 if (aIsRed && !bIsRed) return 1; \n                 if (!aIsRed && bIsRed) return -1;\n             }\n             return a.value - b.value; \n        });\n     };\n     \n     return sortForDiscard(safeDiscards)[0];\n  };\n\n  try {\n      return getHeuristicMove();\n  } catch (e) {\n      console.error(\"AI Decision Error\", e);\n      return aiPlayer.hand[0]; \n  }\n};\n","\nimport { SupportedLanguage, AILearningState } from '../types';\n\nexport type ChatContext = \n    | 'GAME_START' \n    | 'TRICK_WIN' \n    | 'TRICK_WIN_BIG'\n    | 'TRICK_LOSS' \n    | 'PENALTY' \n    | 'ROUND_WIN' \n    | 'ROUND_LOSS' \n    | 'KAI_CHONG_SUCCESS'\n    | 'KAI_CHONG_FAIL'\n    | 'PLAY_HIGH_CARD'\n    | 'WAITING'\n    | 'TEACH_VIOLATION'; // New context for scolding the player\n\nconst MESSAGES: Record<SupportedLanguage, Record<ChatContext, string[]>> = {\n    zh_CN: {\n        GAME_START: [\n            \"夫马吊者，兵法也。四十张牌，变化无穷，诸君慎之。\",\n            \"冯梦龙先生有云：‘知己知彼，百战不殆’。今日且看谁是英雄。\",\n            \"明季士大夫皆好此道，吾辈今日重聚，定要以此会友。\",\n            \"这四十张纸牌，暗合梁山一百单八将之数，各位切莫轻视。\",\n            \"局以变生，制由机发。请诸位落座，共演此纵横之术。\"\n        ],\n        TRICK_WIN: [\n            \"此乃顺手牵羊之计。\",\n            \"笑纳了。正所谓：取之有道。\",\n            \"这一墩，恰如探囊取物。\",\n            \"兵贵神速，此牌出得正是时候。\",\n            \"吾观此局，运势在我也。\"\n        ],\n        TRICK_WIN_BIG: [\n            \"一夫当关，万夫莫开！\",\n            \"百万军中取上将首级，如探囊取物！\",\n            \"至尊在此，谁敢造次？\",\n            \"此乃定海神针，这分吾拿定了。\",\n            \"痛快！此局气势如虹，势不可挡！\"\n        ],\n        TRICK_LOSS: [\n            \"大意了，竟被汝钻了空子。\",\n            \"此乃诱敌深入之计，汝莫要高兴太早。\",\n            \"好一招借刀杀人，佩服。\",\n            \"胜败兵家常事，暂且让你一回。\",\n            \"这牌路诡谲，颇有古风，吾竟未看破。\"\n        ],\n        PENALTY: [\n            \"哎呀！老夫竟犯了如此低级之错，愧对先贤！\",\n            \"这...这是‘包赔’？吾一世英名，毁于一旦！\",\n            \"一时眼花，误打误撞，罪过罪过。\",\n            \"此乃天亡我也，非战之罪。\",\n            \"惨矣！触犯天条，自食苦果。\"\n        ],\n        ROUND_WIN: [\n            \"运筹帷幄之中，决胜千里之外。\",\n            \"今日手气，颇有当年冯梦龙之风。\",\n            \"承让承让。此局赢得惊险，全赖各位成全。\",\n            \"牌风顺遂，如鱼得水。再来一局？\",\n            \"吾之牌技，虽不及古人，亦足以在此桌称雄矣。\"\n        ],\n        ROUND_LOSS: [\n            \"时运不济，命途多舛...\",\n            \"卷土重来未可知，下局定要翻盘。\",\n            \"汝等牌技精进神速，老夫佩服。\",\n            \"这一局输得蹊跷，待老夫复盘一番。\",\n            \"胜负乃浮云，唯博弈之乐长存。\"\n        ],\n        KAI_CHONG_SUCCESS: [\n            \"天作之合！此乃天意！\",\n            \"踏破铁鞋无觅处，得来全不费工夫。\",\n            \"妙哉！这底牌正如吾意。\",\n            \"神来之笔，冲得漂亮！\",\n            \"这便是缘分，挡都挡不住。\"\n        ],\n        KAI_CHONG_FAIL: [\n            \"缘分未到，强求不得。\",\n            \"镜中花，水中月，空欢喜一场。\",\n            \"底牌无情，奈何奈何。\",\n            \"时机未到，且看下回分解。\",\n            \"罢了，得之我幸，失之我命。\"\n        ],\n        PLAY_HIGH_CARD: [\n            \"泰山压顶！谁能挡我？\",\n            \"此牌一出，乾坤定矣。\",\n            \"重剑无锋，大巧不工。\",\n            \"看这张‘尊’张，可有气势？\"\n        ],\n        WAITING: [\n            \"思考良久，莫非在推演天机？\",\n            \"兵贵神速，犹豫则败北。\",\n            \"莫让光阴虚度，速速出牌。\",\n            \"阁下可是在研读《马吊牌经》？快哉快哉。\"\n        ],\n        TEACH_VIOLATION: [\n            \"孺子不可教也！《牌经》有云：首发千万乃是大忌！你怎敢造次？\",\n            \"荒唐！非‘百老’而首发十字门，你这是自寻死路，还要连累旁人！\",\n            \"若是当年在苏州茶馆，你这般打法，是要被赶下桌的！\",\n            \"同门‘肩’未出，怎可妄动‘尊’张？新手切记：三防为上！\",\n            \"你这打法，毫无章法！这就是‘包赔’的下场，好好记着！\",\n            \"不懂规矩！趣张在手，岂可灭绝青牌？回去再读读规则吧！\"\n        ]\n    },\n    zh_TW: {\n        GAME_START: [\n            \"夫馬吊者，兵法也。四十張牌，變化無窮，諸君慎之。\",\n            \"馮夢龍先生有云：『知己知彼，百戰不殆』。今日且看誰是英雄。\",\n            \"明季士大夫皆好此道，吾輩今日重聚，定要以此會友。\",\n            \"這四十張紙牌，暗合梁山一百單八將之數，各位切莫輕視。\",\n            \"局以變生，制由機發。請諸位落座，共演此縱橫之術。\"\n        ],\n        TRICK_WIN: [\n            \"此乃順手牽羊之計。\",\n            \"笑納了。正所謂：取之有道。\",\n            \"這一墩，恰如探囊取物。\",\n            \"兵貴神速，此牌出得正是時候。\",\n            \"吾觀此局，運勢在我也。\"\n        ],\n        TRICK_WIN_BIG: [\n            \"一夫當關，萬夫莫開！\",\n            \"百萬軍中取上將首級，如探囊取物！\",\n            \"至尊在此，誰敢造次？\",\n            \"此乃定海神針，這分吾拿定了。\",\n            \"痛快！此局氣勢如虹，勢不可擋！\"\n        ],\n        TRICK_LOSS: [\n            \"大意了，竟被汝鑽了空子。\",\n            \"此乃誘敵深入之計，汝莫要高興太早。\",\n            \"好一招借刀殺人，佩服。\",\n            \"勝敗兵家常事，暫且讓你一回。\",\n            \"這牌路詭譎，頗有古風，吾竟未看破。\"\n        ],\n        PENALTY: [\n            \"哎呀！老夫竟犯了如此低級之錯，愧對先賢！\",\n            \"這...這是『包賠』？吾一世英名，毀於一旦！\",\n            \"一時眼花，誤打誤撞，罪過罪過。\",\n            \"此乃天亡我也，非戰之罪。\",\n            \"慘矣！觸犯天條，自食苦果。\"\n        ],\n        ROUND_WIN: [\n            \"運籌帷幄之中，決勝千里之外。\",\n            \"今日手氣，頗有當年馮夢龍之風。\",\n            \"承讓承讓。此局贏得驚險，全賴各位成全。\",\n            \"牌風順遂，如魚得水。再來一局？\",\n            \"吾之牌技，雖不及古人，亦足以在此桌稱雄矣。\"\n        ],\n        ROUND_LOSS: [\n            \"時運不濟，命途多舛...\",\n            \"捲土重來未可知，下局定要翻盤。\",\n            \"汝等牌技精進神速，老夫佩服。\",\n            \"這一局輸得蹊蹺，待老夫復盤一番。\",\n            \"勝負乃浮雲，唯博弈之樂長存。\"\n        ],\n        KAI_CHONG_SUCCESS: [\n            \"天作之合！此乃天意！\",\n            \"踏破鐵鞋無覓處，得來全不費工夫。\",\n            \"妙哉！這底牌正如吾意。\",\n            \"神來之筆，衝得漂亮！\",\n            \"這便是緣分，擋都擋不住。\"\n        ],\n        KAI_CHONG_FAIL: [\n            \"緣分未到，強求不得。\",\n            \"鏡中花，水中月，空歡喜一場。\",\n            \"底牌無情，奈何奈何。\",\n            \"時機未到，且看下回分解。\",\n            \"罷了，得之我幸，失之我命。\"\n        ],\n        PLAY_HIGH_CARD: [\n            \"泰山壓頂！誰能擋我？\",\n            \"此牌一出，乾坤定矣。\",\n            \"重劍無鋒，大巧不工。\",\n            \"看這張『尊』張，可有氣勢？\"\n        ],\n        WAITING: [\n            \"思考良久，莫非在推演天機？\",\n            \"兵貴神速，猶豫則敗北。\",\n            \"莫讓光陰虛度，速速出牌。\",\n            \"閣下可是在研讀《馬吊牌經》？快哉快哉。\"\n        ],\n        TEACH_VIOLATION: [\n            \"孺子不可教也！《牌經》有云：首發千萬乃是大忌！你怎敢造次？\",\n            \"荒唐！非『百老』而首發十字門，你這是自尋死路，還要連累旁人！\",\n            \"若是當年在蘇州茶館，你這般打法，是要被趕下桌的！\",\n            \"同門『肩』未出，怎可妄動『尊』張？新手切記：三防為上！\",\n            \"你這打法，毫無章法！這就是『包賠』的下場，好好記著！\",\n            \"不懂規矩！趣張在手，豈可滅絕青牌？回去再讀讀規則吧！\"\n        ]\n    },\n    en: {\n        GAME_START: [\"Ma Diao is akin to military strategy. Forty cards, infinite changes. Proceed with caution.\", \"As the ancient masters said: Know yourself and your enemy. Let us duel.\", \"In the Ming Dynasty, scholars adored this game. Let us honor their tradition.\"],\n        TRICK_WIN: [\"A strategic acquisition.\", \"I accept this tribute gratefully.\", \"Just as the manuals predicted.\", \"Swift as the wind, I take this trick.\"],\n        TRICK_WIN_BIG: [\"One man guards the pass, ten thousand cannot break through!\", \"The Supreme Card is here!\", \"Who dares to challenge my authority?\", \"Absolute dominance!\"],\n        TRICK_LOSS: [\"A momentary lapse in judgment...\", \"I let you have this one intentionally.\", \"A clever trap, I must admit.\", \"The ancients warned of such strategies.\"],\n        PENALTY: [\"Alas! I have brought shame upon my ancestors!\", \"A penalty? My reputation is ruined!\", \"I was momentarily blinded by greed.\", \"A painful lesson learned.\"],\n        ROUND_WIN: [\"Strategy woven within the tent determines victory a thousand miles away.\", \"My luck today rivals the masters of old.\", \"A narrow victory, thank you for the game.\", \"The flow of the cards was with me.\"],\n        ROUND_LOSS: [\"Fortune is fickle...\", \"I shall return stronger in the next hand.\", \"Your skills have improved, young one.\", \"I must meditate on this defeat.\"],\n        KAI_CHONG_SUCCESS: [\"A match made in heaven!\", \"It was destined to be.\", \"A stroke of genius!\", \"Fate is on my side.\"],\n        KAI_CHONG_FAIL: [\"Fate has not yet arrived.\", \"Like a flower in the mirror, an illusion.\", \"The pot is cruel today.\", \"Patience is a virtue.\"],\n        PLAY_HIGH_CARD: [\"Behold, the weight of Mount Tai!\", \"This card settles the universe.\", \"Power without flash.\", \"Can you withstand this?\"],\n        WAITING: [\"Are you calculating the movements of the stars?\", \"Hesitation leads to defeat.\", \"Time flows like a river, please play.\", \"Studying the ancient texts, are we?\"],\n        TEACH_VIOLATION: [\n            \"Foolish apprentice! Leading 'Qian Wan' is strictly forbidden by the ancients!\",\n            \"Absurd! Leading Cash without being a Millionaire? You court disaster!\",\n            \"In the old tea houses of Suzhou, such play would get you expelled!\",\n            \"Do not play the Reward (Zun) before the Shoulder appears! Remember the Three Preventions!\",\n            \"Chaos! This is why the 'Grand Penalty' exists. Learn from this!\",\n            \"You hold the Extreme (Ji) yet discard your Blacks? Amateur!\"\n        ]\n    },\n    ja: {\n        GAME_START: [\"馬吊は兵法の如し。四十枚の札、変化は無限なり。\", \"馮夢龍先生曰く『彼を知り己を知れば百戦殆うからず』。\", \"明代の文人たちも愛したこの遊戯、雅に参ろう。\"],\n        TRICK_WIN: [\"頂いた。\", \"兵は神速を貴ぶ。\", \"計算通りだ。\", \"この一手が戦局を変える。\"],\n        TRICK_WIN_BIG: [\"一夫当関、万夫莫開！\", \"至尊ここにあり！\", \"誰がこの勢いを止められようか？\", \"圧倒的ではないか！\"],\n        TRICK_LOSS: [\"不覚...\", \"敵を欺くにはまず味方からか。\", \"見事な策だ。\", \"次はこうはいかんぞ。\"],\n        PENALTY: [\"嗚呼！先人に顔向けできぬ...\", \"責任払いとは...一生の不覚！\", \"魔が差したとしか言いようがない。\", \"自業自得か...\"],\n        ROUND_WIN: [\"帷幄の中で謀り、千里の外で勝つ。\", \"今日の運勢は古の達人の如し。\", \"良い勝負であった。\", \"流れは我にあり。\"],\n        ROUND_LOSS: [\"運命とは非情なもの...\", \"次は必ず雪辱を果たす。\", \"若手にしてはやるな。\", \"この敗北を糧としよう。\"],\n        KAI_CHONG_SUCCESS: [\"天の配剤なり！\", \"待っていたぞ。\", \"妙手！\", \"運命の巡り合わせだ。\"],\n        KAI_CHONG_FAIL: [\"縁がなかったか。\", \"鏡花水月...\", \"無念。\", \"次機を待つのみ。\"],\n        PLAY_HIGH_CARD: [\"泰山の重みを知れ！\", \"乾坤一擲！\", \"この札で決める。\", \"これぞ王者の風格。\"],\n        WAITING: [\"天機を読んでいるのか？\", \"長考は敗北の元なり。\", \"時は金なり、早う。\", \"古文書でも読んでいるのか？\"],\n        TEACH_VIOLATION: [\n            \"愚か者め！『千万』の先発は古来よりの大禁忌ぞ！\",\n            \"なんと！『百老』でもないのに十字門を出すとは、自滅する気か！\",\n            \"昔の蘇州の茶館なら、叩き出されているところだぞ！\",\n            \"同門の『肩』が出ぬうちに『尊』を出すなど、言語道断！\",\n            \"無茶苦茶だ！それが『責任払い』の報いだ、よく覚えておけ！\",\n            \"『極』を持っているのに青牌を捨てるとは...素人め！\"\n        ]\n    },\n    ko: {\n        GAME_START: [\"마조는 병법과 같다. 40장의 패, 변화무쌍하니 신중하라.\", \"풍몽룡 선생 왈: 지피지기면 백전불태라 했다.\", \"명나라 선비들이 즐기던 이 놀이, 풍류를 즐겨보자.\"],\n        TRICK_WIN: [\"감사히 받겠소.\", \"병법은 신속을 귀하게 여긴다.\", \"계산대로군.\", \"이 한 수가 판세를 뒤집으리라.\"],\n        TRICK_WIN_BIG: [\"일당백의 기세로다!\", \"지존이 여기 있다!\", \"누가 감히 막을쏘냐?\", \"압도적이군!\"],\n        TRICK_LOSS: [\"방심했군...\", \"적을 속이려다 내가 당했소.\", \"훌륭한 계략이오.\", \"다음엔 어림없다.\"],\n        PENALTY: [\"오호 통재라! 선현들께 면목이 없구나...\", \"독박이라니... 일생일대의 실수로다!\", \"귀신에 홀렸나 보오.\", \"자업자득이로다.\"],\n        ROUND_WIN: [\"천리 밖의 승부를 앉아서 결정짓는군.\", \"오늘 운세가 옛 고수들과 같구려.\", \"좋은 승부였소.\", \"흐름이 나에게 왔소.\"],\n        ROUND_LOSS: [\"운명이 야속하군...\", \"다음 판엔 반드시 설욕하리라.\", \"젊은 친구가 제법이군.\", \"이 패배를 교훈 삼겠소.\"],\n        KAI_CHONG_SUCCESS: [\"하늘이 정해준 인연이로다!\", \"기다리고 있었소.\", \"묘수!\", \"운명의 장난이군.\"],\n        KAI_CHONG_FAIL: [\"인연이 아닌가 보오.\", \"신기루였군...\", \"아쉽구려.\", \"때를 기다려야지.\"],\n        PLAY_HIGH_CARD: [\"태산의 무게를 느껴보라!\", \"건곤일척의 승부수!\", \"이 패로 끝내겠소.\", \"왕의 품격이로다.\"],\n        WAITING: [\"천기를 읽고 계시오?\", \"망설임은 패배를 부를 뿐.\", \"시간이 금이오, 어서.\", \"고서라도 읽고 있는 게요?\"],\n        TEACH_VIOLATION: [\n            \"어리석은지고! '천만'을 먼저 내는 것은 옛부터 금기였거늘!\",\n            \"당치 않소! '백로'도 아니면서 십자문을 내다니, 자멸할 셈이오?\",\n            \"옛날 소주 찻집이었으면 쫓겨났을 플레이오!\",\n            \"같은 무늬 '견'이 나오기도 전에 '존'을 내다니, 언어도단이오!\",\n            \"무모하군! 그것이 바로 '독박'의 대가이니, 명심하시오!\",\n            \"'극'을 쥐고도 청패를 버리다니... 하수나 하는 짓이오!\"\n        ]\n    }\n};\n\nexport const getAIChatMessage = (context: ChatContext, language: SupportedLanguage, personality?: AILearningState): string => {\n    const langMessages = MESSAGES[language] || MESSAGES['en'];\n    const options = langMessages[context] || [];\n    \n    if (options.length === 0) return \"\";\n\n    // Simple random selection\n    const index = Math.floor(Math.random() * options.length);\n    return options[index];\n};\n","\nimport { useState, useEffect, useRef } from 'react';\nimport { Player, PlayerType, GamePhase, CardRank, SupportedLanguage } from '../types';\nimport { getAIMove, generateSpeech } from '../services/geminiService';\nimport { getAIChatMessage, ChatContext } from '../services/aiChatService';\nimport { getAIState } from '../services/aiLearningService';\n\ninterface UseAIAgentProps {\n    gameState: any; // Using explicit types in real code is better, but any for decoupling speed here\n    gameActions: any;\n    audioSystem: any;\n    isMuted: boolean;\n    language: SupportedLanguage;\n}\n\nexport const useAIAgent = ({ gameState, gameActions, audioSystem, isMuted, language }: UseAIAgentProps) => {\n    const [aiChatMessages, setAiChatMessages] = useState<Record<number, string | null>>({});\n    const processingRef = useRef(false);\n\n    const { \n        players, currentPlayerIndex, phase, trickNumber, tableCards, \n        recordedCards, bankerId, difficulty, gameHistory, openedSuits, \n        firstLeadInfo, mianZhangCard, lastGameEvent, trickWinnerId\n    } = gameState;\n\n    // 1. AI MOVEMENT LOGIC\n    useEffect(() => {\n        const currentPlayer = players[currentPlayerIndex];\n        \n        // Conditions for AI to move\n        const shouldMove = \n            phase === GamePhase.PLAYING && \n            trickNumber < 8 && \n            currentPlayer?.type === PlayerType.AI && \n            tableCards.length < 4 && \n            !trickWinnerId &&\n            !processingRef.current;\n\n        if (shouldMove) {\n            processingRef.current = true;\n            const timer = setTimeout(async () => {\n                const aiPlayer = currentPlayer;\n                const tableCardsForAI = tableCards.map((t: any) => ({card: t.card, playerId: t.playerId}));\n                \n                try {\n                    const move = await getAIMove(\n                        aiPlayer, tableCardsForAI, players, recordedCards, bankerId, \n                        difficulty, gameHistory, openedSuits, firstLeadInfo, trickNumber, mianZhangCard\n                    );\n                    \n                    if (move) { \n                        // Trigger speech for special moves\n                        if (move.rank === CardRank.ZUN || move.rank === CardRank.BAI) {\n                            triggerAIChat(aiPlayer.id, 'PLAY_HIGH_CARD');\n                        }\n                        await gameActions.executePlayCard(aiPlayer.id, move.id); \n                    }\n                } catch (e) {\n                    console.error(\"AI Move Error\", e);\n                } finally {\n                    processingRef.current = false;\n                }\n            }, 1000 + Math.random() * 500); // Natural delay\n            return () => clearTimeout(timer);\n        }\n    }, [currentPlayerIndex, phase, tableCards.length, trickWinnerId, trickNumber]);\n\n    // 2. AI REACTION LOGIC (Chat & Voice)\n    // Listens to the Event Stream from the Game Engine\n    useEffect(() => {\n        if (!lastGameEvent) return;\n\n        const handleEvent = async () => {\n            const { type, playerId, context } = lastGameEvent;\n            \n            // Filter: Only AI players talk (usually)\n            const player = players.find((p: Player) => p.id === playerId);\n            \n            // Reaction Logic\n            if (type === 'TRICK_WIN') {\n                // Winner talks\n                if (player?.type === PlayerType.AI) {\n                    triggerAIChat(playerId, context?.isBig ? 'TRICK_WIN_BIG' : 'TRICK_WIN');\n                }\n                // Losers lament (random chance)\n                players.forEach((p: Player) => {\n                    if (p.id !== playerId && p.type === PlayerType.AI && Math.random() > 0.7) {\n                        triggerAIChat(p.id, 'TRICK_LOSS');\n                    }\n                });\n            } else if (type === 'VIOLATION') {\n                // A teacher AI scolds the human\n                const teacherId = players.find((p: Player) => p.type === PlayerType.AI)?.id || 1;\n                triggerAIChat(teacherId, 'TEACH_VIOLATION');\n            } else if (type === 'KAI_CHONG_SUCCESS') {\n                if (player?.type === PlayerType.AI) triggerAIChat(playerId, 'KAI_CHONG_SUCCESS');\n            } else if (type === 'KAI_CHONG_FAIL') {\n                if (player?.type === PlayerType.AI) triggerAIChat(playerId, 'KAI_CHONG_FAIL');\n            } else if (type === 'ROUND_END') {\n                // handled in scoring usually, but can be here\n            }\n        };\n\n        handleEvent();\n\n    }, [lastGameEvent]);\n\n    const triggerAIChat = async (playerId: number, context: ChatContext) => {\n        const player = players.find((p: Player) => p.id === playerId);\n        if (!player) return;\n\n        const learningState = getAIState(playerId, gameHistory || {});\n        const message = getAIChatMessage(context, language, learningState);\n        \n        if (message) {\n            // Visual Chat Bubble\n            setAiChatMessages(prev => ({ ...prev, [playerId]: message }));\n            setTimeout(() => { setAiChatMessages(prev => ({ ...prev, [playerId]: null })); }, 4000);\n            \n            // Audio TTS\n            if (!isMuted) {\n                let voice = 'Puck';\n                if (playerId === 2) voice = 'Kore';\n                if (playerId === 3) voice = 'Fenrir';\n                const pcmData = await generateSpeech(message, voice);\n                if (pcmData) audioSystem.playPcmAudio(pcmData);\n            }\n        }\n    };\n\n    return {\n        aiChatMessages\n    };\n};\n","\nimport { useRef, useEffect, useCallback } from 'react';\n\n// Audio System Hook\n// Responsibilities: Manage AudioContext, Decode PCM, Play Buffers\nexport const useAudioSystem = (isMuted: boolean) => {\n    const audioContextRef = useRef<AudioContext | null>(null);\n\n    useEffect(() => {\n        const AudioCtx = window.AudioContext || (window as any).webkitAudioContext;\n        if (AudioCtx) {\n            audioContextRef.current = new AudioCtx({ sampleRate: 24000 });\n        }\n        return () => {\n            audioContextRef.current?.close();\n        };\n    }, []);\n\n    const decodeAudioData = async (data: Uint8Array, ctx: AudioContext, sampleRate: number, numChannels: number): Promise<AudioBuffer> => {\n        const dataInt16 = new Int16Array(data.buffer);\n        const frameCount = dataInt16.length / numChannels;\n        const buffer = ctx.createBuffer(numChannels, frameCount, sampleRate);\n        for (let channel = 0; channel < numChannels; channel++) {\n            const channelData = buffer.getChannelData(channel);\n            for (let i = 0; i < frameCount; i++) {\n                channelData[i] = dataInt16[i * numChannels + channel] / 32768.0;\n            }\n        }\n        return buffer;\n    };\n\n    const playPcmAudio = useCallback(async (pcmData: Uint8Array) => {\n        if (isMuted || !audioContextRef.current) return;\n        \n        try {\n            if (audioContextRef.current.state === 'suspended') {\n                await audioContextRef.current.resume();\n            }\n            const audioBuffer = await decodeAudioData(pcmData, audioContextRef.current, 24000, 1);\n            const source = audioContextRef.current.createBufferSource();\n            source.buffer = audioBuffer;\n            source.connect(audioContextRef.current.destination);\n            source.start();\n        } catch (e) {\n            console.error(\"Audio playback error\", e);\n        }\n    }, [isMuted]);\n\n    return {\n        playPcmAudio\n    };\n};\n","\nimport { useState, useEffect } from 'react';\nimport { Difficulty, SupportedLanguage } from '../types';\n\nexport interface GameSettings {\n    language: SupportedLanguage;\n    setLanguage: (lang: SupportedLanguage) => void;\n    difficulty: Difficulty;\n    setDifficulty: (diff: Difficulty) => void;\n    oneClickPlay: boolean;\n    setOneClickPlay: (enable: boolean) => void;\n    isMuted: boolean;\n    setIsMuted: (muted: boolean) => void;\n    isRiskAlertOn: boolean;\n    setIsRiskAlertOn: (on: boolean) => void;\n    showSuitHistory: boolean;\n    setShowSuitHistory: (show: boolean) => void;\n    graphicsQuality: 'HIGH' | 'LOW';\n    setGraphicsQuality: (quality: 'HIGH' | 'LOW') => void;\n    githubAutoSync: boolean;\n    setGithubAutoSync: (auto: boolean) => void;\n    showPaperDolls: boolean;\n    setShowPaperDolls: (show: boolean) => void;\n    isMobileDevice: boolean; // Exposed for UI to hide controls\n}\n\nexport const useGameSettings = (): GameSettings => {\n    // Default settings\n    const [language, setLanguage] = useState<SupportedLanguage>('zh_CN');\n    const [difficulty, setDifficulty] = useState<Difficulty>(Difficulty.MEDIUM);\n    const [oneClickPlay, setOneClickPlay] = useState<boolean>(true);\n    const [isMuted, setIsMuted] = useState<boolean>(true); \n    const [isRiskAlertOn, setIsRiskAlertOn] = useState<boolean>(true);\n    const [showSuitHistory, setShowSuitHistory] = useState<boolean>(true);\n    const [githubAutoSync, setGithubAutoSync] = useState<boolean>(true); \n    \n    // Robust Mobile Detection\n    const [isMobileDevice, setIsMobileDevice] = useState(false);\n\n    useEffect(() => {\n        const checkMobile = () => {\n            // Check both width and user agent for robustness\n            const isMobileWidth = window.innerWidth < 1024;\n            const isMobileUA = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n            setIsMobileDevice(isMobileWidth || isMobileUA);\n        };\n        checkMobile();\n        window.addEventListener('resize', checkMobile);\n        return () => window.removeEventListener('resize', checkMobile);\n    }, []);\n\n    const [graphicsQuality, setGraphicsQuality] = useState<'HIGH' | 'LOW'>('HIGH');\n    \n    // Internal state for Paper Dolls (for desktop users)\n    const [internalShowPaperDolls, setInternalShowPaperDolls] = useState<boolean>(true);\n\n    // Effect to enforce LOW quality on mobile automatically\n    useEffect(() => {\n        if (isMobileDevice) {\n            setGraphicsQuality('LOW');\n        }\n    }, [isMobileDevice]);\n\n    return {\n        language, setLanguage,\n        difficulty, setDifficulty,\n        oneClickPlay, setOneClickPlay,\n        isMuted, setIsMuted,\n        isRiskAlertOn, setIsRiskAlertOn,\n        showSuitHistory, setShowSuitHistory,\n        graphicsQuality, setGraphicsQuality,\n        githubAutoSync, setGithubAutoSync,\n        \n        // HARD OVERRIDE: If mobile, ALWAYS false. User preference is ignored.\n        showPaperDolls: isMobileDevice ? false : internalShowPaperDolls,\n        setShowPaperDolls: setInternalShowPaperDolls,\n        isMobileDevice\n    };\n};\n","\nimport { useState } from 'react';\n\nexport type SettingsTab = 'GENERAL' | 'RECORDER' | 'HISTORY';\n\nexport interface UIState {\n    showSettings: boolean;\n    setShowSettings: (show: boolean) => void;\n    activeSettingsTab: SettingsTab;\n    setActiveSettingsTab: (tab: SettingsTab) => void;\n    showSocialModal: boolean;\n    setShowSocialModal: (show: boolean) => void;\n}\n\nexport const useUIState = (): UIState => {\n    const [showSettings, setShowSettings] = useState(false);\n    const [activeSettingsTab, setActiveSettingsTab] = useState<SettingsTab>('GENERAL');\n    const [showSocialModal, setShowSocialModal] = useState(false);\n\n    return {\n        showSettings, setShowSettings,\n        activeSettingsTab, setActiveSettingsTab,\n        showSocialModal, setShowSocialModal\n    };\n};\n","\nimport { useMemo } from 'react';\nimport { Player, GamePhase, Card } from '../types';\nimport { getPriorityDiscardCards, getCaptureRequirement } from '../services/riskEngine';\n\ninterface GameState {\n    players: Player[];\n    phase: GamePhase;\n    trickNumber: number;\n    currentPlayerIndex: number;\n    tableCards: { card: Card, playerId: number }[];\n    recordedCards: Card[];\n    openedSuits: any[];\n    bankerId: number;\n    firstLeadInfo: any;\n    selectedCardId: string | null;\n}\n\ninterface GameSettings {\n    oneClickPlay: boolean;\n}\n\ninterface GameActions {\n    executePlayCard: (playerId: number, cardId: string, bypassRisk?: boolean) => void;\n}\n\nexport const useGameInteraction = (\n    state: GameState,\n    actions: GameActions,\n    humanPlayer: Player | undefined,\n    settings: GameSettings\n) => {\n    const {\n        players, phase, trickNumber, currentPlayerIndex, tableCards,\n        recordedCards, openedSuits, bankerId, firstLeadInfo, selectedCardId\n    } = state;\n\n    const interactionState = useMemo(() => {\n        // 1. Basic Validity Checks\n        if (!humanPlayer || phase !== GamePhase.PLAYING) {\n            return { label: '', disabled: true, highlightedCardIds: new Set<string>() };\n        }\n\n        const isMyTurn = players[currentPlayerIndex]?.id === 0;\n        // Interaction allowed if: It's my turn, NOT Bi Zhang (auto), and table isn't full\n        const canInteract = isMyTurn && trickNumber !== 8 && (tableCards ? tableCards.length < 4 : true);\n\n        let label = \"出牌\";\n        let highlightedCardIds = new Set<string>();\n        let disabled = !canInteract;\n\n        if (trickNumber === 8) {\n            disabled = true; // Bi Zhang is automatic animation\n            label = \"比张\";\n        } else if (canInteract) {\n            if (!tableCards || tableCards.length === 0) {\n                // Case A: Leading\n                label = \"发牌\";\n            } else {\n                // Case B: Following / Capturing\n                const leadSuit = tableCards[0].card.suit;\n                let currentBestVal = -1;\n                tableCards.forEach((tc: any) => {\n                    if (tc.card.suit === leadSuit && tc.card.value > currentBestVal) currentBestVal = tc.card.value;\n                });\n                \n                // Can I win?\n                const canWin = humanPlayer.hand.some((c: Card) => c.suit === leadSuit && c.value > currentBestVal);\n                label = canWin ? \"捉牌\" : \"灭牌\";\n\n                if (label === \"捉牌\") {\n                    // Logic: Suggest winning cards (Capture)\n                    const req = getCaptureRequirement(humanPlayer, tableCards, bankerId);\n                    if (req.isForced) req.winningCards.forEach((c: any) => highlightedCardIds.add(c.id));\n                } else {\n                    // Logic: Suggest discard cards (Melt)\n                    const priorityCards = getPriorityDiscardCards(humanPlayer, tableCards, recordedCards, openedSuits, bankerId, firstLeadInfo);\n                    priorityCards.forEach((c: any) => highlightedCardIds.add(c.id));\n                }\n            }\n\n            // Disable button if strict selection is required and nothing selected (unless 1-click mode)\n            // If 1-click mode is ON, button acts as \"Auto Play / Confirm Best\"\n            if (!settings.oneClickPlay && !selectedCardId) {\n                disabled = true;\n            }\n        } else {\n            disabled = true; // Not my turn\n            label = \"等待\";\n        }\n\n        return { label, disabled, highlightedCardIds };\n    }, [\n        players, currentPlayerIndex, phase, trickNumber, tableCards, humanPlayer,\n        settings.oneClickPlay, selectedCardId, recordedCards, openedSuits, bankerId, firstLeadInfo\n    ]);\n\n    const handle3DActionClick = () => {\n        if (interactionState.disabled) return;\n        \n        if (selectedCardId) {\n            // Priority 1: Play selected card\n            actions.executePlayCard(0, selectedCardId);\n        } else if (settings.oneClickPlay) {\n            // Priority 2: Auto-play heuristic (First highlighted or First available)\n            if (interactionState.highlightedCardIds.size > 0) {\n                actions.executePlayCard(0, Array.from(interactionState.highlightedCardIds)[0] as string);\n            } else if (humanPlayer && humanPlayer.hand.length > 0) {\n                actions.executePlayCard(0, humanPlayer.hand[0].id);\n            }\n        }\n    };\n\n    return {\n        interactionState,\n        handle3DActionClick\n    };\n};\n","\nimport React, { useMemo } from 'react';\nimport { GamePhase } from '../../types';\n\n// =============================================================================\n// STOVE LIGHTING (Ambient)\n// =============================================================================\nexport const StoveLighting = React.memo(({ activePlayerId, spotlightPos }: { activePlayerId: number, spotlightPos?: {x: string, y: string} | null }) => {\n    const styles = useMemo(() => {\n        if (spotlightPos) {\n            return {\n                background: `radial-gradient(circle at ${spotlightPos.x} ${spotlightPos.y}, \n                    rgba(255, 215, 0, 0.2) 0%, \n                    rgba(184, 134, 11, 0.05) 40%, \n                    transparent 70%)`,\n                transition: 'background 0.8s cubic-bezier(0.25, 1, 0.5, 1)',\n                mixBlendMode: 'plus-lighter' as any\n            };\n        }\n        return { background: 'transparent' }; \n    }, [spotlightPos]);\n\n    return (\n        <div className=\"absolute inset-0 z-[5] pointer-events-none transition-all duration-1000\" style={styles}></div>\n    );\n});\n\n// =============================================================================\n// COMPASS & TABLE FLOW\n// =============================================================================\n\n// V44: Widened Compass Shape (Height 350 -> 440). Increased ViewBox Height (550 -> 640).\n// Center aligned at Y=220 (Previously 175) to maintain wrapping.\nconst VIEWBOX_STR = \"-250 -100 900 640\"; \nconst PATH_FULL_SHAPE = \"M -100 0 L 500 0 A 220 220 0 0 1 500 440 L -100 440 A 220 220 0 0 1 -100 0 Z\";\n\nconst PATH_NORTH = \"M -100 0 L 500 0\"; \nconst PATH_SOUTH = \"M 500 440 L -100 440\"; \nconst PATH_EAST = \"M 500 0 A 220 220 0 0 1 500 440\"; \nconst PATH_WEST = \"M -100 440 A 220 220 0 0 1 -100 0\"; \n\nexport const TableBorderFlow = React.memo(({ activePlayerId, isVertical = false }: { activePlayerId: number, isVertical?: boolean }) => {\n    return (\n        <div className=\"absolute inset-0 pointer-events-none z-[12] overflow-visible mix-blend-screen\" style={{ transform: isVertical ? 'rotate(90deg)' : 'none', transition: 'transform 0.5s ease-out' }}>\n            <svg className=\"w-full h-full overflow-visible\" viewBox={VIEWBOX_STR} preserveAspectRatio=\"xMidYMid meet\">\n                <defs>\n                    {/* V2: Removed Blur for \"Sharp Brightness\". Hard liquid gold feel. */}\n                    <linearGradient id=\"teaFlowGrad\" gradientUnits=\"userSpaceOnUse\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n                        <stop offset=\"0%\" stopColor=\"#8c6239\" stopOpacity=\"0\" />\n                        <stop offset=\"20%\" stopColor=\"#d4af37\" stopOpacity=\"0.4\" />\n                        {/* Core is almost white-gold for maximum brightness without bloom */}\n                        <stop offset=\"50%\" stopColor=\"#fff8e1\" stopOpacity=\"1\" /> \n                        <stop offset=\"80%\" stopColor=\"#d4af37\" stopOpacity=\"0.4\" />\n                        <stop offset=\"100%\" stopColor=\"#8c6239\" stopOpacity=\"0\" />\n                    </linearGradient>\n                </defs>\n                <style>\n                    {`\n                        @keyframes borderFlowReverse {\n                            0% { stroke-dashoffset: 0; } \n                            100% { stroke-dashoffset: 2000; }\n                        }\n                    `}\n                </style>\n                <path \n                    d={PATH_FULL_SHAPE} \n                    stroke=\"url(#teaFlowGrad)\" \n                    strokeWidth=\"3\" \n                    fill=\"none\" \n                    strokeLinecap=\"round\" \n                    strokeDasharray=\"300 1700\" \n                    style={{ animation: 'borderFlowReverse 4s linear infinite' }}\n                />\n            </svg>\n        </div>\n    );\n});\n\nexport const Compass = React.memo(({ \n    activePlayerId, \n    bankerId, \n    revealedBaiLaoId, \n    suspectedBaiLaoId,\n    playedPlayerIds = [], \n    hasTableCards,\n    phase,\n    isVertical = false\n}: { \n    activePlayerId: number, \n    bankerId: number, \n    revealedBaiLaoId: number | null,\n    suspectedBaiLaoId: number | null,\n    playedPlayerIds?: number[],\n    hasTableCards?: boolean,\n    phase?: GamePhase,\n    isVertical?: boolean\n}) => {\n    \n    // Smooth Rotation\n    const rotation = useMemo(() => {\n        let deg = 0;\n        switch(activePlayerId) {\n            case 0: deg = 180; break; \n            case 1: deg = 90; break;  \n            case 2: deg = 0; break;   \n            case 3: deg = -90; break; \n        }\n        return deg;\n    }, [activePlayerId]);\n\n    const sectorMapping = useMemo(() => {\n        if (isVertical) return { 2: 3, 0: 1, 1: 2, 3: 0 }; \n        return { 0:0, 1:1, 2:2, 3:3 };\n    }, [isVertical]);\n\n    // Needle Logic\n    const isDualRole = (pid: number) => pid === bankerId && pid === revealedBaiLaoId;\n    const getPlayerColorValues = (pid: number) => {\n        if (isDualRole(pid)) return { main: '#ef4444', glow: '#ef4444', needle: '#dc2626' }; // Red (Banker+BaiLao)\n        if (pid === bankerId) return { main: '#b91c1c', glow: '#ff0000', needle: '#b91c1c' }; // Red (Banker)\n        if (pid === revealedBaiLaoId) return { main: '#0d9488', glow: '#2dd4bf', needle: '#0f766e' }; // Teal (BaiLao)\n        return { main: '#d4af37', glow: '#ffeebb', needle: '#b8860b' }; // Gold (Peasant)\n    };\n\n    const getIdentityLabel = (pid: number, defaultText: string) => {\n        if (pid === bankerId) return '庄';\n        if (pid === revealedBaiLaoId) return '百';\n        return defaultText;\n    };\n\n    const getTextClass = (pid: number) => {\n        const isActive = activePlayerId === pid;\n        const isTheBanker = pid === bankerId;\n        const isTheBaiLao = pid === revealedBaiLaoId;\n        \n        let colorClass = \"text-[#5c4025] opacity-60 mix-blend-overlay\"; // Default Bronze\n        let glowStyle = \"\";\n        let scaleClass = \"scale-100\";\n\n        // Identity Colors\n        if (isTheBanker) {\n            colorClass = \"text-[#ef4444] opacity-90 drop-shadow-[0_0_8px_rgba(220,38,38,0.8)]\"; // Red\n            glowStyle = \"animate-pulse-slow\";\n        } else if (isTheBaiLao) {\n            colorClass = \"text-[#34d399] opacity-90 drop-shadow-[0_0_8px_rgba(16,185,129,0.8)]\"; // Green\n            glowStyle = \"animate-pulse-slow\";\n        }\n\n        // Active State Overrides\n        if (isActive) {\n            scaleClass = \"scale-125 md:scale-150\";\n            if (!isTheBanker && !isTheBaiLao) {\n                // Normal player active: Gold\n                colorClass = \"text-[#ffdb7a] opacity-100 drop-shadow-[0_0_15px_rgba(255,215,0,0.8)]\"; \n            } else {\n                // Identity player active: Brighten Identity Color\n                colorClass = colorClass.replace(\"opacity-90\", \"opacity-100 brightness-150\");\n                glowStyle = \"\"; // Disable pulse when active to avoid conflicting with scale animation if any\n            }\n        }\n\n        // V45 Update: Base text size increased to text-sm (was text-xs) for better mobile visibility\n        return `absolute font-serif font-bold transition-all duration-700 transform -translate-x-1/2 -translate-y-1/2 z-[25] flex items-center justify-center text-sm md:text-xl ${colorClass} ${scaleClass} ${glowStyle}`;\n    };\n\n    // Glass Lid Animation Logic\n    const isKaiChong = phase === GamePhase.KAI_CHONG;\n    // When Kai Chong starts, glass slides open (Top goes Up, Bottom goes Down)\n    // We assume the Compass center is at Y=220.\n    const lidTranslateY = isKaiChong ? 300 : 0; \n\n    // CALCULATE ACTIVE NEEDLE COLOR\n    const activeColors = getPlayerColorValues(activePlayerId);\n\n    return (\n        <div className=\"relative w-full h-full pointer-events-none z-[0]\" style={{ transformStyle: 'preserve-3d' }}>\n            \n            {/* 1. GLASS LID (Split into Top/Bottom Halves for Opening Animation) */}\n            <div className=\"absolute inset-0 z-[10]\" style={{ transform: isVertical ? 'rotate(90deg) translateZ(0px)' : 'translateZ(0px)', transition: 'transform 0.5s ease-out' }}>\n                <svg className=\"w-full h-full overflow-visible\" viewBox={VIEWBOX_STR} preserveAspectRatio=\"xMidYMid meet\">\n                    <defs>\n                        <linearGradient id=\"glassReflection\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n                            <stop offset=\"0%\" stopColor=\"white\" stopOpacity=\"0.05\" />\n                            <stop offset=\"40%\" stopColor=\"white\" stopOpacity=\"0.0\" />\n                            <stop offset=\"60%\" stopColor=\"white\" stopOpacity=\"0.0\" />\n                            <stop offset=\"100%\" stopColor=\"white\" stopOpacity=\"0.1\" />\n                        </linearGradient>\n                        <filter id=\"rimGlow\">\n                            <feGaussianBlur stdDeviation=\"2\" result=\"blur\"/>\n                            <feComposite in=\"SourceGraphic\" in2=\"blur\" operator=\"over\"/>\n                        </filter>\n                        \n                        {/* Split Clips for Lid Opening */}\n                        <clipPath id=\"clipTopHalf\">\n                            <rect x=\"-250\" y=\"-100\" width=\"900\" height=\"320\" /> {/* Covers roughly top half to Y=220 */}\n                        </clipPath>\n                        <clipPath id=\"clipBottomHalf\">\n                            <rect x=\"-250\" y=\"220\" width=\"900\" height=\"420\" /> {/* Covers bottom half from Y=220 */}\n                        </clipPath>\n                    </defs>\n\n                    {/* Dark Background Plate (Always Static, The \"Pit\") */}\n                    <path d={PATH_FULL_SHAPE} fill=\"#050302\" stroke=\"none\" opacity=\"0.6\" />\n                    \n                    {/* Inner Rim (Gold/Bronze) - Static */}\n                    <path d={PATH_FULL_SHAPE} fill=\"none\" stroke=\"#3e2b22\" strokeWidth=\"2\" opacity=\"0.5\" />\n\n                    {/* TOP GLASS LID */}\n                    <g style={{ transition: 'transform 1.5s cubic-bezier(0.4, 0, 0.2, 1)', transform: `translateY(-${lidTranslateY}px)` }} clipPath=\"url(#clipTopHalf)\">\n                        <path d={PATH_FULL_SHAPE} fill=\"url(#glassReflection)\" stroke=\"none\" style={{ mixBlendMode: 'overlay' }} />\n                        {/* Top Rim Segment */}\n                        <path d=\"M -100 220 L 500 220\" stroke=\"#5c4025\" strokeWidth=\"1\" opacity=\"0.5\" /> \n                    </g>\n\n                    {/* BOTTOM GLASS LID */}\n                    <g style={{ transition: 'transform 1.5s cubic-bezier(0.4, 0, 0.2, 1)', transform: `translateY(${lidTranslateY}px)` }} clipPath=\"url(#clipBottomHalf)\">\n                        <path d={PATH_FULL_SHAPE} fill=\"url(#glassReflection)\" stroke=\"none\" style={{ mixBlendMode: 'overlay' }} />\n                        {/* Bottom Rim Segment */}\n                        <path d=\"M -100 220 L 500 220\" stroke=\"#5c4025\" strokeWidth=\"1\" opacity=\"0.5\" /> \n                    </g>\n\n                    {/* Crosshairs & Grid (Static on base) */}\n                    <g style={{ mixBlendMode: 'plus-lighter', opacity: isKaiChong ? 0.3 : 1, transition: 'opacity 1s' }}>\n                        <line x1=\"-80\" y1=\"220\" x2=\"480\" y2=\"220\" stroke=\"#8c6239\" strokeWidth=\"1.5\" opacity=\"0.5\" strokeDasharray=\"6 3\" />\n                        <line x1=\"200\" y1=\"20\" x2=\"200\" y2=\"420\" stroke=\"#8c6239\" strokeWidth=\"1.5\" opacity=\"0.5\" strokeDasharray=\"6 3\" />\n                        <circle cx=\"200\" cy=\"220\" r=\"120\" fill=\"none\" stroke=\"#5c4025\" strokeWidth=\"1\" opacity=\"0.2\" />\n                        <circle cx=\"200\" cy=\"220\" r=\"40\" fill=\"none\" stroke=\"#d4af37\" strokeWidth=\"1\" opacity=\"0.15\" />\n                        <circle cx=\"200\" cy=\"220\" r=\"3\" fill=\"#d4af37\" opacity=\"0.8\" />\n                    </g>\n\n                    {/* Sectors */}\n                    <g style={{ mixBlendMode: 'screen', opacity: isKaiChong ? 0.5 : 1, transition: 'opacity 1s' }}>\n                        {[\n                            { id: 2, path: PATH_NORTH }, \n                            { id: 1, path: PATH_EAST },  \n                            { id: 0, path: PATH_SOUTH }, \n                            { id: 3, path: PATH_WEST }   \n                        ].map(sector => {\n                            const pidStr = Object.keys(sectorMapping).find(k => (sectorMapping as any)[k] === sector.id);\n                            const pid = pidStr ? parseInt(pidStr) : -1;\n                            const isActive = pid === activePlayerId;\n                            const isLit = isActive || playedPlayerIds.includes(pid);\n                            const colors = getPlayerColorValues(pid);\n                            \n                            return (\n                                <g key={sector.id}>\n                                    <path \n                                        d={sector.path}\n                                        fill=\"none\"\n                                        stroke={colors.main}\n                                        strokeWidth={isActive ? 6 : (isLit ? 2 : 0)}\n                                        strokeLinecap=\"round\"\n                                        filter={isActive ? \"url(#rimGlow)\" : \"\"}\n                                        opacity={isLit ? 1 : 0}\n                                        style={{ transition: 'all 0.5s ease-out' }}\n                                    />\n                                    <path \n                                        d={sector.path}\n                                        fill=\"none\"\n                                        stroke=\"#2a1d15\"\n                                        strokeWidth=\"1\"\n                                        strokeLinecap=\"round\"\n                                    />\n                                </g>\n                            );\n                        })}\n                    </g>\n                </svg>\n            </div>\n\n            {/* 2. THE NEEDLE (Physical 3D Object) - UPDATED V2 (Exquisite Shape) */}\n            <div className=\"absolute inset-0 z-[100] flex items-center justify-center pointer-events-none\" \n                 style={{ \n                     transformStyle: 'preserve-3d', \n                     transform: 'translateZ(10px)' \n                 }}>\n                 \n                 <div className=\"relative transition-transform duration-1000 cubic-bezier(0.34, 1.56, 0.64, 1)\" \n                      style={{ transform: `rotate(${rotation}deg)` }}>\n                        \n                        {/* Needle Shadow */}\n                        <div className=\"absolute top-1/2 left-1/2 w-4 h-40 bg-black blur-sm opacity-60\"\n                             style={{ \n                                 transform: `translate(-50%, -50%) rotate(0deg) translateZ(-15px)`, \n                                 clipPath: 'polygon(50% 0%, 80% 40%, 50% 100%, 20% 40%)'\n                             }}>\n                        </div>\n\n                        {/* Needle Main Body (Diamond Shape) */}\n                        <div \n                            className=\"absolute top-1/2 left-1/2 w-6 h-48 -translate-x-1/2 -translate-y-[65%] transition-colors duration-700\"\n                            style={{ \n                                clipPath: 'polygon(50% 0%, 100% 85%, 50% 100%, 0% 85%)', // Diamond-like sword shape\n                                background: `linear-gradient(90deg, ${activeColors.needle} 40%, white 50%, ${activeColors.needle} 60%)`, // Metallic ridge effect\n                                boxShadow: '0 0 10px rgba(0,0,0,0.5)'\n                            }}\n                        >\n                        </div>\n\n                        {/* Needle Counterweight (Tail) */}\n                        <div \n                            className=\"absolute top-1/2 left-1/2 w-4 h-16 -translate-x-1/2 translate-y-[20%] transition-colors duration-700\"\n                            style={{ \n                                clipPath: 'polygon(50% 100%, 100% 15%, 50% 0%, 0% 15%)', \n                                background: `linear-gradient(90deg, #1a0505 40%, #3e2b22 50%, #1a0505 60%)` \n                            }}\n                        >\n                        </div>\n                        \n                        {/* Center Cap (Jewel) */}\n                        <div \n                            className=\"absolute top-[50%] left-[50%] -translate-x-1/2 -translate-y-1/2 w-8 h-8 rounded-full shadow-lg border-2 border-[#451a03] z-50 transition-colors duration-700 overflow-hidden\"\n                            style={{\n                                background: `radial-gradient(circle at 30% 30%, white, ${activeColors.glow}, ${activeColors.needle})`\n                            }}\n                        >\n                            <div className=\"absolute inset-0 bg-gradient-to-tr from-black/40 to-transparent pointer-events-none\"></div>\n                        </div>\n                 </div>\n            </div>\n\n            {/* 3. DIRECTION LABELS */}\n            <div className=\"absolute inset-0 z-[25] pointer-events-none\" style={{ transform: 'translateZ(15px)', opacity: isKaiChong ? 0.3 : 1, transition: 'opacity 1s' }}>\n                 <div className={getTextClass(2)} style={{ top: '25%', left: '50%' }}>{getIdentityLabel(2, '北')}</div>\n                 <div className={getTextClass(0)} style={{ top: '75%', left: '50%' }}>{getIdentityLabel(0, '南')}</div>\n                 <div className={getTextClass(3)} style={{ top: '50%', left: '32%' }}>{getIdentityLabel(3, '西')}</div>\n                 <div className={getTextClass(1)} style={{ top: '50%', left: '68%' }}>{getIdentityLabel(1, '東')}</div>\n            </div>\n        </div>\n    );\n});\n","\nimport React from 'react';\nimport { ISkin, CardStyleProps } from '../types/skin';\nimport { LeadingEffectType, Suit, CardColor } from '../types';\nimport { TableBorderFlow } from '../components/Visuals/TableEffects';\n\n// Suspended Gold Dust\nconst GOLD_DUST_PATTERN = \"radial-gradient(circle, rgba(255,215,0,0.3) 1px, transparent 1px)\"; \n\nconst ImperialAtmosphere: React.FC<{ quality?: 'HIGH' | 'LOW' }> = ({ quality }) => (\n    <div className=\"absolute inset-0 pointer-events-none z-0 overflow-hidden bg-[#020101]\">\n         <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_50%_30%,#150505_0%,#000000_100%)]\"></div>\n         {quality !== 'LOW' && (\n             <div className=\"absolute inset-0 opacity-20 animate-sway-slow mix-blend-screen\" style={{ backgroundImage: GOLD_DUST_PATTERN, backgroundSize: '150px 150px' }}></div>\n         )}\n         <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,transparent_30%,rgba(0,0,0,0.9)_100%)]\"></div>\n    </div>\n);\n\nconst ImperialCardBack: React.FC<{ isSmall?: boolean }> = ({ isSmall }) => (\n    <div className=\"absolute inset-0 w-full h-full rounded-[inherit] overflow-hidden bg-[#050202] shadow-inner border border-[#333]\">\n         <div className=\"absolute inset-0 opacity-30\" style={{ backgroundImage: GOLD_DUST_PATTERN, backgroundSize: '30px 30px' }}></div>\n         <div className=\"absolute inset-0 bg-gradient-to-br from-white/5 to-black/95\"></div>\n         <div className=\"absolute inset-1 border border-[#b8860b] rounded-[4px] opacity-40\"></div>\n         {!isSmall && (\n             <div className=\"absolute inset-0 flex items-center justify-center\">\n                 <div className=\"w-8 h-12 border border-[#b8860b] flex items-center justify-center bg-black/60 backdrop-blur-sm shadow-[0_0_15px_#b8860b] animate-pulse-slow\">\n                    <span className=\"text-[#b8860b] font-serif font-bold text-lg drop-shadow-[0_0_5px_#b8860b] writing-vertical-rl\">御</span>\n                 </div>\n             </div>\n         )}\n    </div>\n);\n\nconst ImperialEffectOverlay: React.FC<{ effect: LeadingEffectType }> = ({ effect }) => {\n    if (!effect) return null;\n    return (\n        <div className=\"absolute inset-0 z-30 rounded-[inherit] pointer-events-none overflow-hidden mix-blend-plus-lighter\">\n            <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(255,215,0,0.2)_0%,transparent_70%)] animate-pulse-slow\"></div>\n            <div className=\"absolute inset-[-1px] border-[1.5px] border-[#ffd700] opacity-90 rounded-[inherit] shadow-[0_0_15px_#ffd700]\"></div>\n        </div>\n    );\n};\n\n// --- DYNAMIC SHADOWS (THEATER/KABUKI) ---\nconst TheaterShadows: React.FC = () => (\n    <div className=\"absolute inset-0 pointer-events-none opacity-30 mix-blend-soft-light overflow-hidden\" style={{ zIndex: 1 }}>\n        <svg viewBox=\"0 0 500 500\" className=\"w-full h-full animate-actor-move\" style={{ filter: 'blur(8px)' }}>\n            {/* Abstract Dancer Silhouette */}\n            <path d=\"M250,450 C200,450 150,350 150,250 C150,150 220,100 250,100 C280,100 350,150 350,250 C350,350 300,450 250,450 Z\" fill=\"#000\" />\n            <circle cx=\"200\" cy=\"200\" r=\"40\" fill=\"#000\" /> {/* Fan or Sleeve */}\n            <rect x=\"300\" y=\"150\" width=\"20\" height=\"200\" transform=\"rotate(15)\" fill=\"#000\" /> {/* Staff/Sword */}\n        </svg>\n    </div>\n);\n\n// ... Characters ...\nconst BodyFront: React.FC = () => <div className=\"w-full h-full bg-[#0a0505] opacity-60 blur-xl rounded-full\"></div>; \nconst ChairStub: React.FC = () => <div className=\"w-full h-full border-b-4 border-[#3e1010] opacity-50\"></div>;\n\nexport const ImperialSkin: ISkin = {\n    id: 'imperial',\n    name: 'Imperial Court (Lacquer)',\n    description: 'Deep Urushi lacquer with suspended gold dust (Maki-e).',\n\n    layout: {\n        backgroundClass: \"bg-[#020101]\",\n        atmosphereComponent: ImperialAtmosphere,\n        EnvironmentalShadows: TheaterShadows, // ADDED SHADOWS\n        \n        tableSurfaceClass: \"rounded-[32px] shadow-[0_40px_100px_black] border border-[#3e1010]/60 overflow-hidden\",\n        \n        // 1. SOLID BASE (Deepest Black)\n        tableBaseColor: '#050202',\n        \n        // 2. TEXTURE (Gold Dust & Lacquer Depth)\n        tableTexture: `\n            radial-gradient(circle at 60% 30%, rgba(255,255,255,0.03) 0%, transparent 30%),\n            radial-gradient(circle at 40% 70%, rgba(184, 134, 11, 0.05) 0%, transparent 50%),\n            url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E\")\n        `,\n        tableTextureSize: 'auto',\n        tableReflectivity: true, // Enable Mirror Finish\n\n        tableBorderClass: \"bg-[#0f0505] border-t border-[#3e1010]/40\"\n    },\n\n    card: {\n        getContainerClass: (props: CardStyleProps) => {\n            let sizeClass = 'w-16 h-24 md:w-20 md:h-32';\n            if (props.isSmall) sizeClass = props.isRotated ? 'w-12 h-8' : 'w-8 h-12';\n            else if (props.isTrick) sizeClass = props.isRotated ? 'w-20 h-14 md:w-28 md:h-20' : 'w-14 h-20 md:w-20 md:h-28';\n            else if (props.isHand) sizeClass = props.isRotated ? 'w-24 h-16 md:w-28 md:h-20' : 'w-16 h-24 md:w-24 md:h-36'; \n            let bgClass = props.isInverted ? 'bg-[#080404] text-[#e6c278] border border-[#3e1010]' : 'bg-[#f7f2e6] text-[#1c1917]'; \n            if (props.isFaceDown) bgClass = 'bg-[#050202]';\n            if (props.isDisabled) bgClass = 'bg-[#1a1a1a] grayscale opacity-40';\n            let hoverClass = 'transition-all duration-300 cubic-bezier(0.2, 0.8, 0.2, 1)'; \n            if (!props.isFaceDown && !props.isHand && !props.isDisabled) { hoverClass += ' hover:-translate-y-2 hover:shadow-[0_15px_30px_rgba(0,0,0,0.8)] cursor-pointer hover:brightness-110'; }\n            let transformClass = ''; if (props.isSelected) transformClass = '-translate-y-4 scale-105 z-[100] shadow-[0_0_30px_rgba(218,165,32,0.6)] ring-1 ring-[#daa520]';\n            return `relative flex flex-col group rounded-[6px] ${sizeClass} ${bgClass} ${hoverClass} ${transformClass}`;\n        },\n        getMainColorClass: (color, isInverted) => {\n            if (isInverted) return 'text-[#d4af37] font-serif tracking-widest drop-shadow-[0_1px_2px_rgba(0,0,0,0.9)]'; \n            if (color === CardColor.RED) return 'text-[#9f1212] font-bold opacity-90 mix-blend-multiply'; \n            if (color === CardColor.GREEN) return 'text-[#0f5132] font-bold opacity-90 mix-blend-multiply'; \n            return 'text-[#0a0a0a] font-bold opacity-90 mix-blend-multiply'; \n        },\n        getPokerColorClass: (suit, isInverted) => {\n            if (isInverted) return 'text-[#b8860b]';\n            const isRedSuit = suit === Suit.STRINGS || suit === Suit.TEXTS;\n            return isRedSuit ? 'text-[#9f1212]' : 'text-[#0a0a0a]';\n        },\n        getBorderClass: (props: CardStyleProps) => {\n            if (props.isFaceDown) return 'border border-[#3e1010]';\n            if (props.isWinner) return 'border border-[#d4af37] shadow-[0_0_15px_rgba(212,175,55,0.6)]';\n            return 'border-[0.5px] border-[#ccc]/30'; \n        },\n        getShadowClass: (props: CardStyleProps) => {\n            if (props.isFaceDown) return 'shadow-[0_10px_20px_black]'; \n            return 'shadow-[0_2px_8px_rgba(0,0,0,0.3)]'; \n        },\n        BackComponent: ImperialCardBack,\n        EffectOverlay: ImperialEffectOverlay\n    },\n\n    hud: {\n        avatarContainerClass: (isMyTurn) => `\n            relative w-16 h-16 md:w-24 md:h-24 rounded-full flex items-center justify-center \n            transition-all duration-700\n            ${isMyTurn \n                ? 'bg-[#150505] border-2 border-[#FFD700] shadow-[0_0_50px_rgba(255,215,0,0.5)] scale-110 z-50 ring-1 ring-[#b8860b]' \n                : 'bg-[#0a0202] border border-[#3e1010] opacity-70 grayscale-[0.5] scale-90'}\n        `,\n        buttonClass: (disabled) => `\n            relative min-w-[140px] h-12 rounded-[4px] flex items-center justify-center transition-all duration-300 font-serif tracking-[0.3em] font-bold text-sm shadow-[0_10px_30px_rgba(0,0,0,0.9)]\n            ${!disabled \n                ? 'bg-gradient-to-br from-[#2b0d0d] via-[#4a1212] to-[#1a0505] text-[#ffdb7a] border border-[#d4af37] hover:brightness-125 hover:-translate-y-1 active:scale-95 shadow-[0_0_20px_rgba(212,175,55,0.2)] backdrop-blur-md' \n                : 'bg-[#0f0505] text-[#555] border border-[#333] cursor-not-allowed opacity-50'}\n        `,\n        modalOverlayClass: \"fixed inset-0 z-[300] flex items-center justify-center bg-[#000000]/98 backdrop-blur-xl p-4 animate-fade-in font-serif\",\n        modalContentClass: `relative w-full max-w-5xl bg-[#050202] border-[1px] border-[#3e1010] shadow-[0_0_150px_rgba(139,0,0,0.5)] text-[#e6c278] rounded-[4px]`\n    },\n\n    lighting: {\n        StoveLighting: () => null, \n        TableBorderFlow: TableBorderFlow\n    },\n\n    character: {\n        bodyFront: BodyFront,\n        bodySideLeft: BodyFront,\n        bodySideRight: BodyFront,\n        headOutline: '',\n        chairComponent: ChairStub\n    }\n};\n","\nimport React from 'react';\nimport { ISkin, CardStyleProps } from '../types/skin';\nimport { LeadingEffectType, Suit, CardColor } from '../types';\n\nconst FABRIC_PATTERN = \"radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px)\";\n\nconst SnowAtmosphere: React.FC = () => {\n    return (\n        <div className=\"absolute inset-0 pointer-events-none z-0 overflow-hidden bg-[#050a14]\">\n            <div className=\"absolute inset-0 bg-gradient-to-b from-[#050a14] via-[#0f0a0a] to-[#1a0505]\"></div>\n            <div className=\"absolute bottom-[-20%] left-[-10%] w-[80%] h-[80%] bg-[#ff4500] blur-[180px] opacity-15 animate-candleFlicker mix-blend-screen\"></div>\n            <div className=\"absolute top-[10%] right-[10%] w-[300px] h-[300px] bg-[#aaddff] blur-[120px] opacity-05 rounded-full\"></div>\n            <div className=\"absolute inset-0 opacity-10 mix-blend-overlay animate-sway-slow\" style={{ backgroundImage: FABRIC_PATTERN, backgroundSize: '10px 10px' }}></div>\n        </div>\n    );\n};\n\nconst ChristmasCardBack: React.FC<{ isSmall?: boolean }> = ({ isSmall }) => (\n    <div className=\"absolute inset-0 w-full h-full rounded-[inherit] overflow-hidden bg-[#0a2e18] flex items-center justify-center shadow-inner\">\n         <div className=\"absolute inset-0 opacity-40 mix-blend-overlay\" style={{ backgroundImage: FABRIC_PATTERN, backgroundSize: '4px 4px' }}></div>\n         <div className=\"absolute inset-0 bg-gradient-to-b from-white/5 to-black/60\"></div>\n         <div className=\"absolute inset-1.5 border-2 border-dashed border-[#c5a059] rounded-[4px] opacity-60\"></div>\n         {!isSmall && <div className=\"text-[#c5a059] opacity-80 text-4xl drop-shadow-md\">❄</div>}\n    </div>\n);\n\nconst ChristmasEffectOverlay: React.FC<{ effect: LeadingEffectType }> = ({ effect }) => {\n    if (!effect) return null;\n    return (\n        <div className=\"absolute inset-0 z-20 pointer-events-none rounded-[inherit] ring-4 ring-[#b91c1c] ring-opacity-60 animate-pulse shadow-[0_0_20px_#b91c1c]\"></div>\n    );\n};\n\n// ... Characters ...\nconst WoolBody: React.FC = () => (\n    <svg viewBox=\"0 0 100 100\" className=\"w-full h-full drop-shadow-xl\">\n        <path d=\"M20,100 C20,60 30,35 50,35 C70,35 80,60 80,100 Z\" fill=\"#8a1c1c\" stroke=\"#330000\" strokeWidth=\"1\" />\n        <path d=\"M50,35 L50,100\" stroke=\"rgba(0,0,0,0.2)\" strokeWidth=\"1\" strokeDasharray=\"2 2\" />\n    </svg>\n);\nconst PaddedChair: React.FC<{ position?: string }> = ({ position }) => {\n    return <svg viewBox=\"0 0 100 100\" className=\"w-full h-full\"><path d=\"M10,100 L10,30 Q50,20 90,30 L90,100\" fill=\"#3e2723\" /><rect x=\"15\" y=\"35\" width=\"70\" height=\"60\" fill=\"#143d22\" rx=\"5\" stroke=\"#0a2012\" strokeWidth=\"2\" /></svg>;\n};\n\nexport const ChristmasSkin: ISkin = {\n    id: 'christmas',\n    name: 'Victorian Parlor (Velvet)',\n    description: 'Aged green velvet, dark mahogany, warm firelight.',\n\n    layout: {\n        backgroundClass: \"bg-[#050a14]\",\n        atmosphereComponent: SnowAtmosphere,\n        \n        tableSurfaceClass: \"rounded-[30px] shadow-[inset_0_0_80px_black,0_30px_80px_black] border-[12px] border-[#2d1b1b] overflow-hidden\",\n        \n        // 1. SOLID BASE\n        tableBaseColor: '#0f2e1c',\n        \n        // 2. TEXTURE\n        tableTexture: FABRIC_PATTERN,\n        tableTextureSize: '4px 4px',\n        \n        tableBorderClass: \"bg-[#1a0f0f]\"\n    },\n\n    card: {\n        getContainerClass: (props: CardStyleProps) => {\n            let sizeClass = 'w-16 h-24 md:w-20 md:h-32';\n            if (props.isSmall) sizeClass = props.isRotated ? 'w-14 h-10' : 'w-10 h-14';\n            else if (props.isTrick) sizeClass = props.isRotated ? 'w-24 h-16 md:w-28 md:h-20' : 'w-16 h-24 md:w-20 md:h-28';\n            else if (props.isHand) sizeClass = props.isRotated ? 'w-20 h-12 md:w-24 md:h-16' : 'w-14 h-22 md:w-20 md:h-32';\n            let bgClass = props.isInverted ? 'bg-[#3e2723] text-[#e6c278]' : 'bg-[#fffaf0] text-[#1e293b]';\n            if (props.isFaceDown) bgClass = 'bg-[#0a2e18]';\n            if (props.isDisabled) bgClass = 'bg-gray-600 grayscale opacity-50';\n            let hoverClass = 'transition-transform duration-300';\n            if (!props.isFaceDown && !props.isHand && !props.isDisabled) { hoverClass += ' hover:-translate-y-2 hover:rotate-1 cursor-pointer hover:shadow-[0_10px_20px_rgba(0,0,0,0.5)]'; }\n            let transformClass = ''; if (props.isSelected) transformClass = '-translate-y-4 scale-105 z-[100] ring-2 ring-[#c52222] shadow-[0_20px_30px_rgba(0,0,0,0.6)]';\n            return `relative flex flex-col group rounded-[6px] ${sizeClass} ${bgClass} ${hoverClass} ${transformClass}`;\n        },\n        getMainColorClass: (color, isInverted) => {\n            if (isInverted) return 'text-[#f0e68c] font-serif';\n            if (color === CardColor.RED) return 'text-[#b91c1c] font-bold'; \n            if (color === CardColor.GREEN) return 'text-[#15803d] font-bold'; \n            return 'text-[#1e293b] font-bold'; \n        },\n        getPokerColorClass: (suit, isInverted) => {\n            if (isInverted) return 'text-[#f0e68c]';\n            const isRedSuit = suit === Suit.STRINGS || suit === Suit.TEXTS;\n            return isRedSuit ? 'text-[#b91c1c]' : 'text-[#1e293b]';\n        },\n        getBorderClass: (props) => {\n            if (props.isFaceDown) return 'border-2 border-[#051a0d]';\n            if (props.isWinner) return 'border-2 border-[#ffd700]';\n            if (props.isSelected) return 'border-2 border-[#c52222]';\n            return 'border border-gray-300';\n        },\n        getShadowClass: (props) => {\n            if (props.isFaceDown) return 'shadow-lg';\n            return 'shadow-[1px_2px_4px_rgba(0,0,0,0.3)]';\n        },\n        BackComponent: ChristmasCardBack,\n        EffectOverlay: ChristmasEffectOverlay\n    },\n\n    hud: {\n        avatarContainerClass: (isMyTurn) => `\n            relative w-20 h-20 md:w-24 md:h-24 rounded-full flex items-center justify-center \n            transition-all duration-500 border-4 border-[#3e2723]\n            ${isMyTurn \n                ? 'bg-[#4a0e0e] border-[#ffd700] shadow-[0_0_25px_rgba(255,215,0,0.4)] scale-105' \n                : 'bg-[#1e293b] opacity-90'}\n        `,\n        buttonClass: (disabled) => `\n            relative min-w-[150px] h-14 rounded-full flex items-center justify-center transition-all duration-300 font-bold tracking-wider text-sm shadow-xl\n            ${!disabled \n                ? 'bg-gradient-to-b from-[#c52222] to-[#7f1d1d] text-white border border-[#fecaca] hover:brightness-110 shadow-[0_5px_15px_rgba(185,28,28,0.4)]' \n                : 'bg-[#334155] text-gray-400 border border-[#475569] cursor-not-allowed'}\n        `,\n        modalOverlayClass: \"fixed inset-0 z-[300] flex items-center justify-center bg-[#050a14]/98 backdrop-blur-md p-4 animate-fade-in font-serif\",\n        modalContentClass: \"bg-[#1a0f0f] border-[6px] border-[#2d1b1b] p-8 w-full max-w-5xl rounded-[12px] shadow-2xl relative overflow-hidden text-[#fffaf0]\"\n    },\n\n    lighting: {\n        StoveLighting: () => null,\n        TableBorderFlow: () => null\n    },\n\n    character: {\n        bodyFront: WoolBody,\n        bodySideLeft: WoolBody,\n        bodySideRight: WoolBody,\n        headOutline: '',\n        chairComponent: PaddedChair\n    }\n};\n","\nimport React from 'react';\nimport { ISkin, CardStyleProps } from '../types/skin';\nimport { LeadingEffectType, Suit, CardColor } from '../types';\n\nconst MingAtmosphere: React.FC = () => {\n    return (\n        <div className=\"absolute inset-0 pointer-events-none z-[-1] overflow-hidden bg-[#0a0604]\">\n            {/* Dark, warm ambient enclosure */}\n            <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_50%_30%,#2d1a10_0%,#050202_90%)]\"></div>\n            {/* Subtle dust particles */}\n            <div className=\"absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/wood-pattern.png')] mix-blend-overlay\"></div>\n        </div>\n    );\n};\n\nconst MingCardBack: React.FC<{ isSmall?: boolean }> = ({ isSmall }) => (\n    <div className=\"absolute inset-0 w-full h-full rounded-[inherit] overflow-hidden bg-[#26140c] flex items-center justify-center shadow-inner border border-[#3e2b22]\">\n        {/* Wood Texture on Back */}\n        <div className=\"absolute inset-0 opacity-40\" \n             style={{ \n                 background: `\n                    repeating-radial-gradient(circle at 0 0, transparent 0, #26140c 10px),\n                    repeating-linear-gradient(45deg, #3e2b22, #26140c 10px, #3e2b22 20px)\n                 ` \n             }}>\n        </div>\n        <div className=\"absolute inset-0 bg-gradient-to-tr from-black/80 to-transparent\"></div>\n        {!isSmall && (\n            <div className=\"relative z-10 w-8 h-20 border-[1px] border-[#8c6239]/40 flex items-center justify-center rounded-[2px] bg-[#3d1e11]/90 backdrop-blur-sm shadow-[0_2px_10px_rgba(0,0,0,0.8)] animate-pulse-slow\">\n                <span className=\"text-[#e6c278] font-serif font-bold text-2xl writing-vertical-rl tracking-widest drop-shadow-[0_1px_2px_black] opacity-90 select-none\">明</span>\n            </div>\n        )}\n    </div>\n);\n\nconst MingEffectOverlay: React.FC<{ effect: LeadingEffectType }> = ({ effect }) => {\n    if (!effect) return null;\n    return (\n        <div className=\"absolute inset-[-4px] rounded-[inherit] pointer-events-none z-[50]\">\n            <div className=\"absolute inset-0 border-[1px] border-[#d4af37] rounded-[inherit] opacity-60 animate-pulse shadow-[0_0_15px_#d4af37,inset_0_0_10px_#d4af37]\"></div>\n        </div>\n    );\n};\n\n// --- DYNAMIC SHADOWS (BAMBOO/BANANA LEAVES) ---\nconst BambooShadows: React.FC = () => (\n    <div className=\"absolute inset-0 pointer-events-none opacity-40 mix-blend-multiply overflow-hidden\" style={{ zIndex: 1 }}>\n        <svg viewBox=\"0 0 500 500\" className=\"w-full h-full animate-shadow-sway origin-bottom-left\" style={{ filter: 'blur(4px)' }}>\n            <g transform=\"rotate(45) translate(100, -100)\">\n                {/* Bamboo Stalks */}\n                <rect x=\"50\" y=\"0\" width=\"10\" height=\"600\" fill=\"#1a0f0a\" />\n                <rect x=\"150\" y=\"0\" width=\"8\" height=\"600\" fill=\"#1a0f0a\" />\n                \n                {/* Leaves */}\n                <ellipse cx=\"60\" cy=\"100\" rx=\"60\" ry=\"10\" transform=\"rotate(30)\" fill=\"#1a0f0a\" />\n                <ellipse cx=\"160\" cy=\"200\" rx=\"70\" ry=\"12\" transform=\"rotate(-20)\" fill=\"#1a0f0a\" />\n                <ellipse cx=\"60\" cy=\"300\" rx=\"50\" ry=\"8\" transform=\"rotate(45)\" fill=\"#1a0f0a\" />\n                <ellipse cx=\"160\" cy=\"400\" rx=\"80\" ry=\"15\" transform=\"rotate(-10)\" fill=\"#1a0f0a\" />\n            </g>\n        </svg>\n        {/* Warm Sunset Projection Gradient */}\n        <div className=\"absolute inset-0 bg-gradient-to-tr from-transparent via-[#ff8c00]/10 to-transparent mix-blend-overlay\"></div>\n    </div>\n);\n\n// ... Characters ...\nconst BodyFront: React.FC = () => (\n    <svg viewBox=\"0 0 100 100\" className=\"w-full h-full drop-shadow-[0_10px_30px_rgba(0,0,0,0.9)] filter contrast-125 sepia-[0.3]\">\n        <defs>\n            <filter id=\"silkFlow\"><feTurbulence type=\"fractalNoise\" baseFrequency=\"0.01\" numOctaves=\"3\"/><feDisplacementMap in=\"SourceGraphic\" scale=\"5\"/></filter>\n        </defs>\n        <path d=\"M20,100 L20,50 Q50,40 80,50 L80,100 Z\" fill=\"#2d1a10\" stroke=\"none\" filter=\"url(#silkFlow)\" opacity=\"0.9\" />\n    </svg>\n);\nconst Chair: React.FC<{ position?: string }> = ({ position }) => {\n    return (\n        <svg viewBox=\"0 0 100 100\" className=\"w-full h-full drop-shadow-2xl\">\n            <path d=\"M15,100 L15,30 Q15,10 50,15 Q85,10 85,30 L85,100\" fill=\"none\" stroke=\"#3e2723\" strokeWidth=\"6\" strokeLinecap=\"round\" />\n            <path d=\"M20,100 L20,40 L80,40 L80,100\" fill=\"#26140c\" opacity=\"0.8\" />\n        </svg>\n    );\n};\n\nexport const MingSkin: ISkin = {\n    id: 'ming_scholar',\n    name: 'Ming Scholar (Huanghuali)',\n    description: 'Aged Huanghuali wood with ghost face grains and deep amber patina.',\n\n    layout: {\n        backgroundClass: \"bg-[#0a0604]\", \n        atmosphereComponent: MingAtmosphere,\n        EnvironmentalShadows: BambooShadows, // ADDED SHADOWS\n        \n        tableSurfaceClass: \"rounded-[12px] overflow-hidden shadow-[0_50px_120px_black] border border-[#5c3a21]/50\",\n        \n        // 1. SOLID BASE COLOR (Deep Reddish Brown)\n        tableBaseColor: '#2b1105', \n        \n        // 2. TEXTURE (Ghost Face Pattern & Grain)\n        tableTexture: `\n            radial-gradient(circle at 30% 40%, rgba(20, 10, 5, 0.4) 0%, transparent 60%),\n            repeating-linear-gradient(110deg, rgba(62, 39, 35, 0.1) 0px, rgba(62, 39, 35, 0.1) 1px, transparent 1px, transparent 8px),\n            radial-gradient(ellipse at 70% 60%, rgba(139, 69, 19, 0.15), transparent 40%),\n            conic-gradient(from 0deg at 50% 50%, transparent 0deg, rgba(0,0,0,0.2) 20deg, transparent 40deg)\n        `,\n        tableTextureSize: 'auto',\n        \n        // Enable Patina/Reflection layer in Scene3D\n        tableReflectivity: true, \n\n        tableBorderClass: \"bg-[#1a0a05] border-t border-[#3e2b22] brightness-75\"\n    },\n\n    card: {\n        getContainerClass: (props: CardStyleProps) => {\n            let sizeClass = 'w-16 h-24 md:w-20 md:h-32';\n            if (props.isSmall) sizeClass = props.isRotated ? 'w-14 h-10' : 'w-10 h-14';\n            else if (props.isTrick) sizeClass = props.isRotated ? 'w-24 h-14 md:w-32 md:h-20' : 'w-14 h-24 md:w-20 md:h-32';\n            else if (props.isHand) sizeClass = props.isRotated ? 'w-20 h-12 md:w-24 md:h-16' : 'w-14 h-24 md:w-20 md:h-32'; \n            \n            // Aged Paper / Woodblock Print Look\n            let bgClass = props.isInverted \n                ? 'bg-[#26140c] text-[#d9c7b0] border border-[#5c3a21]' \n                : 'bg-[#e8e4d9] text-[#2b1810]'; \n            \n            if (props.isFaceDown) bgClass = 'bg-[#26140c]';\n            if (props.isDisabled) bgClass = 'bg-[#1a1a1a] opacity-40 grayscale';\n            \n            let hoverClass = 'transition-all duration-300 ease-out';\n            if (!props.isFaceDown && !props.isHand && !props.isDisabled) { \n                hoverClass += ' hover:-translate-y-2 hover:shadow-[0_15px_30px_rgba(0,0,0,0.7)] cursor-pointer hover:brightness-110'; \n            }\n            \n            let transformClass = ''; \n            if (props.isSelected) transformClass = '-translate-y-4 scale-105 z-[100] shadow-[0_0_30px_rgba(217,199,176,0.4)]';\n            \n            return `relative flex flex-col group rounded-[4px] ${sizeClass} ${bgClass} ${hoverClass} ${transformClass}`;\n        },\n        getMainColorClass: (color, isInverted) => {\n            if (isInverted) return 'text-[#d9c7b0] font-serif tracking-widest opacity-90 drop-shadow-sm'; \n            if (color === CardColor.RED) return 'text-[#8c1c0b] font-bold font-calligraphy opacity-90 mix-blend-multiply'; \n            if (color === CardColor.GREEN) return 'text-[#2e4c2e] font-bold font-calligraphy opacity-95 mix-blend-multiply'; \n            return 'text-[#1a1a1a] font-bold font-calligraphy opacity-90 mix-blend-multiply'; \n        },\n        getPokerColorClass: (suit, isInverted) => {\n            if (isInverted) return 'text-[#c5a059]';\n            const isRedSuit = suit === Suit.STRINGS || suit === Suit.TEXTS;\n            return isRedSuit ? 'text-[#8c1c0b]' : 'text-[#1a1a1a]';\n        },\n        getBorderClass: (props) => {\n            if (props.isFaceDown) return 'border border-[#3e2b22]';\n            if (props.isWinner) return 'border-[2px] border-[#d4af37]';\n            if (props.isSelected) return 'border-[1px] border-[#8c6239]';\n            return 'border-[0.5px] border-[#a8a499]/50 shadow-[inset_0_0_10px_rgba(0,0,0,0.05)]';\n        },\n        getShadowClass: (props) => {\n            if (props.isFaceDown) return 'shadow-[0_4px_10px_rgba(0,0,0,0.8)]'; \n            return 'shadow-[1px_2px_6px_rgba(0,0,0,0.3)]';\n        },\n        BackComponent: MingCardBack,\n        EffectOverlay: MingEffectOverlay\n    },\n\n    hud: {\n        avatarContainerClass: (isMyTurn) => `\n            relative w-20 h-20 md:w-24 md:h-24 rounded-full flex items-center justify-center \n            transition-all duration-700 border-[3px] \n            ${isMyTurn \n                ? 'bg-[#2b1105] border-[#d4af37] shadow-[0_0_40px_rgba(212,175,55,0.3)] scale-105 z-50 ring-2 ring-[#5c3a21]/50' \n                : 'bg-[#1a0a05] border-[#3e2b22] opacity-80 sepia-[0.4]'}\n        `,\n        buttonClass: (disabled) => `\n            relative min-w-[150px] h-14 rounded-[2px] flex items-center justify-center transition-all duration-300 font-serif tracking-[0.25em] font-bold shadow-lg text-sm\n            ${!disabled \n                ? 'bg-gradient-to-b from-[#3e2b22] to-[#26140c] text-[#d9c7b0] border border-[#5c4025] hover:border-[#d4af37] hover:text-[#fff] shadow-[0_5px_15px_rgba(0,0,0,0.5)]' \n                : 'bg-[#1a1a1a] text-[#444] border border-[#333] cursor-not-allowed'}\n        `,\n        modalOverlayClass: \"fixed inset-0 z-[300] flex items-center justify-center bg-[#050302]/95 backdrop-blur-xl p-4 animate-fade-in font-serif\",\n        modalContentClass: \"bg-[#1a0d08] border border-[#3e2b22] p-8 w-full max-w-5xl rounded-[2px] shadow-[0_0_100px_black] relative overflow-hidden text-[#d9c7b0] bg-[url('https://www.transparenttextures.com/patterns/wood-pattern.png')]\"\n    },\n\n    lighting: {\n        StoveLighting: () => null,\n        TableBorderFlow: () => null\n    },\n\n    character: {\n        bodyFront: BodyFront,\n        bodySideLeft: BodyFront,\n        bodySideRight: BodyFront,\n        headOutline: '',\n        chairComponent: Chair\n    }\n};\n","\nimport React from 'react';\nimport { ISkin, CardStyleProps } from '../types/skin';\nimport { LeadingEffectType, Suit, CardColor } from '../types';\n\nconst INK_PATTERN = \"linear-gradient(45deg, rgba(255,255,255,0.02) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.02) 75%, rgba(255,255,255,0.02))\";\n\nconst TaoistAtmosphere: React.FC = () => {\n    return (\n        <div className=\"absolute inset-0 pointer-events-none z-[-1] overflow-hidden bg-[#e0e4e8]\">\n            <div className=\"absolute inset-0 bg-gradient-to-b from-[#f0f4f8] via-[#cfd8dc] to-[#b0bec5]\"></div>\n            {/* Ink drop diffusion */}\n            <div className=\"absolute top-[-20%] left-[-20%] w-[140%] h-[140%] bg-[radial-gradient(circle,rgba(0,0,0,0.03)_0%,transparent_70%)] blur-[80px]\"></div>\n            <div className=\"absolute inset-0 opacity-20 mix-blend-multiply animate-sway-slow\" style={{ backgroundImage: INK_PATTERN, backgroundSize: '40px 40px' }}></div>\n        </div>\n    );\n};\n\nconst TaoistCardBack: React.FC<{ isSmall?: boolean }> = ({ isSmall }) => (\n    <div className=\"absolute inset-0 w-full h-full rounded-[inherit] overflow-hidden bg-[#1a1a1a] flex items-center justify-center border border-[#444]\">\n        <div className=\"absolute inset-0 bg-[#0f0f0f]\"></div>\n        <div className=\"absolute inset-0 opacity-10\" style={{ backgroundImage: INK_PATTERN, backgroundSize: '4px 4px' }}></div>\n        {/* Tai Chi Symbol Abstract */}\n        <div className={`relative ${isSmall ? 'scale-50' : 'scale-75'} opacity-80 mix-blend-screen`}>\n            <div className=\"w-12 h-12 rounded-full border-2 border-white/40 flex items-center justify-center animate-[spin_20s_linear_infinite]\">\n                <div className=\"w-6 h-12 bg-white/90 rounded-l-full border-r border-black\"></div>\n                <div className=\"w-6 h-12 bg-black rounded-r-full border-l border-white/90\"></div>\n            </div>\n        </div>\n    </div>\n);\n\nconst TaoistEffectOverlay: React.FC<{ effect: LeadingEffectType }> = ({ effect }) => {\n    if (!effect) return null;\n    return (\n        <div className=\"absolute inset-[-12px] pointer-events-none z-[10]\">\n            <div className=\"absolute inset-0 rounded-full blur-xl bg-black/10 animate-pulse transform scale-90\"></div>\n            <div className=\"absolute inset-2 border border-black/30 rounded-[inherit] opacity-60\"></div>\n        </div>\n    );\n};\n\n// ... Characters ...\nconst InkBody: React.FC = () => (\n    <svg viewBox=\"0 0 100 100\" className=\"w-full h-full drop-shadow-2xl\">\n        <filter id=\"ink-blur\"><feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"1.0\" /></filter>\n        <path d=\"M20,100 C20,50 40,40 50,40 C60,40 80,50 80,100 Z\" fill=\"#111\" filter=\"url(#ink-blur)\" opacity=\"0.9\" />\n    </svg>\n);\nconst StoneChair: React.FC<{ position?: string }> = ({ position }) => {\n    return ( <svg viewBox=\"0 0 100 100\" className=\"w-full h-full\"> <rect x=\"20\" y=\"40\" width=\"60\" height=\"60\" fill=\"#2a2a2a\" rx=\"1\" /> <rect x=\"15\" y=\"35\" width=\"70\" height=\"5\" fill=\"#444\" /> </svg> );\n};\n\nexport const TaoistSkin: ISkin = {\n    id: 'taoist_mystery',\n    name: 'Taoist Void (Ink Stone)',\n    description: 'Cold inkstone slab, rice paper, ethereal mist.',\n\n    layout: {\n        backgroundClass: \"bg-[#cfd8dc]\",\n        atmosphereComponent: TaoistAtmosphere,\n        \n        tableSurfaceClass: \"shadow-[0_40px_120px_rgba(0,0,0,0.5)] border border-[#455a64] rounded-[40px] overflow-hidden\",\n        \n        // 1. SOLID BASE (Slate Grey)\n        tableBaseColor: '#263238',\n        \n        // 2. TEXTURE (Stone Noise)\n        tableTexture: `\n            url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.15'/%3E%3C/svg%3E\"),\n            linear-gradient(to bottom right, #37474f, #263238)\n        `,\n        tableTextureSize: 'auto',\n        \n        tableBorderClass: \"bg-[#1c2529] border-t border-[#455a64]\"\n    },\n\n    card: {\n        getContainerClass: (props: CardStyleProps) => {\n            let sizeClass = 'w-16 h-24 md:w-20 md:h-32';\n            if (props.isSmall) sizeClass = props.isRotated ? 'w-14 h-10' : 'w-10 h-14';\n            else if (props.isTrick) sizeClass = props.isRotated ? 'w-24 h-16 md:w-28 md:h-20' : 'w-16 h-24 md:w-20 md:h-28';\n            else if (props.isHand) sizeClass = props.isRotated ? 'w-20 h-12 md:w-24 md:h-16' : 'w-14 h-22 md:w-20 md:h-32';\n            \n            // Rice Paper look\n            let bgClass = props.isInverted ? 'bg-[#111] text-[#ddd]' : 'bg-[#fcfcfc] text-[#111]';\n            if (props.isFaceDown) bgClass = 'bg-[#0f0f0f]';\n            if (props.isDisabled) bgClass = 'bg-[#999] opacity-50 grayscale';\n            \n            let hoverClass = 'transition-all duration-500 ease-out';\n            if (!props.isFaceDown && !props.isHand && !props.isDisabled) { hoverClass += ' hover:-translate-y-2 hover:shadow-2xl cursor-pointer hover:scale-105'; }\n            let transformClass = ''; if (props.isSelected) transformClass = '-translate-y-4 z-[100] scale-105 shadow-[0_15px_30px_rgba(0,0,0,0.3)]';\n            return `relative flex flex-col group rounded-[2px] ${sizeClass} ${bgClass} ${hoverClass} ${transformClass}`;\n        },\n        getMainColorClass: (color, isInverted) => {\n            if (isInverted) return 'text-[#ccc] font-calligraphy tracking-widest'; \n            if (color === CardColor.RED) return 'text-[#b71c1c] font-bold font-calligraphy opacity-90'; \n            return 'text-[#212121] font-bold font-calligraphy opacity-95'; \n        },\n        getPokerColorClass: (suit, isInverted) => {\n            if (isInverted) return 'text-[#ccc]';\n            const isRedSuit = suit === Suit.STRINGS || suit === Suit.TEXTS;\n            return isRedSuit ? 'text-[#b71c1c]' : 'text-[#212121]';\n        },\n        getBorderClass: (props) => {\n            if (props.isFaceDown) return 'border border-[#333]';\n            if (props.isWinner) return 'border-[2px] border-black'; \n            if (props.isSelected) return 'border-[1px] border-black';\n            return 'border border-transparent';\n        },\n        getShadowClass: (props) => {\n            if (props.isFaceDown) return 'shadow-[0_5px_15px_rgba(0,0,0,0.8)]';\n            return 'shadow-[2px_2px_8px_rgba(0,0,0,0.1)]';\n        },\n        BackComponent: TaoistCardBack,\n        EffectOverlay: TaoistEffectOverlay\n    },\n\n    hud: {\n        avatarContainerClass: (isMyTurn) => `\n            relative w-20 h-20 md:w-24 md:h-24 rounded-full flex items-center justify-center \n            transition-all duration-1000 border\n            ${isMyTurn \n                ? 'bg-black border-white shadow-[0_0_50px_rgba(0,0,0,0.3)] scale-105 z-50' \n                : 'bg-white border-black opacity-80 grayscale'}\n        `,\n        buttonClass: (disabled) => `\n            relative min-w-[140px] h-14 flex items-center justify-center transition-all duration-500 font-calligraphy tracking-[0.3em] rounded-full text-sm font-bold shadow-lg\n            ${!disabled \n                ? 'bg-[#263238] text-white border border-transparent hover:bg-[#37474f]' \n                : 'bg-[#b0bec5] text-[#546e7a] cursor-not-allowed'}\n        `,\n        modalOverlayClass: \"fixed inset-0 z-[300] flex items-center justify-center bg-[#eceff1]/95 backdrop-blur-md p-4 animate-fade-in font-serif\",\n        modalContentClass: \"bg-[#fafafa] border border-[#cfd8dc] p-8 w-full max-w-5xl rounded-[2px] shadow-2xl relative overflow-hidden text-[#263238]\"\n    },\n\n    lighting: {\n        StoveLighting: () => null,\n        TableBorderFlow: () => null\n    },\n\n    character: {\n        bodyFront: InkBody,\n        bodySideLeft: InkBody,\n        bodySideRight: InkBody,\n        headOutline: '',\n        chairComponent: StoneChair\n    }\n};\n","\nimport React, { createContext, useContext, useState, ReactNode } from 'react';\nimport { ISkin } from '../types/skin';\nimport { ImperialSkin } from '../skins/imperialSkin';\nimport { ChristmasSkin } from '../skins/christmasSkin';\nimport { MingSkin } from '../skins/mingSkin';\nimport { TaoistSkin } from '../skins/taoistSkin';\n\ninterface SkinContextType {\n    skin: ISkin;\n    setSkinId: (id: string) => void;\n    availableSkins: ISkin[];\n}\n\nconst defaultContext: SkinContextType = {\n    skin: ImperialSkin,\n    setSkinId: () => {},\n    availableSkins: [ImperialSkin, ChristmasSkin, MingSkin, TaoistSkin]\n};\n\nconst SkinContext = createContext<SkinContextType>(defaultContext);\n\nexport const SkinProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\n    // Registry of available skins\n    const availableSkins = [ImperialSkin, ChristmasSkin, MingSkin, TaoistSkin];\n    \n    // State\n    const [currentSkin, setCurrentSkin] = useState<ISkin>(ImperialSkin);\n\n    const setSkinId = (id: string) => {\n        const found = availableSkins.find(s => s.id === id);\n        if (found) {\n            setCurrentSkin(found);\n            try {\n                localStorage.setItem('ma_diao_skin_id', id);\n            } catch (e) {\n                console.warn(\"Could not save skin preference\", e);\n            }\n        }\n    };\n\n    // Load from local storage on mount\n    React.useEffect(() => {\n        try {\n            const savedId = localStorage.getItem('ma_diao_skin_id');\n            if (savedId && savedId !== currentSkin.id) {\n                const found = availableSkins.find(s => s.id === savedId);\n                if (found) setCurrentSkin(found);\n            }\n        } catch (e) {\n            console.warn(\"Could not load skin preference\", e);\n        }\n    }, []);\n\n    return (\n        <SkinContext.Provider value={{ skin: currentSkin, setSkinId, availableSkins }}>\n            {children}\n        </SkinContext.Provider>\n    );\n};\n\nexport const useSkin = () => useContext(SkinContext);\n","\nimport React, { useMemo } from 'react';\nimport { Card as CardType, Suit, SuitStatus, LeadingEffectType, CardRank, CardColor } from '../types';\nimport { useSkin } from '../contexts/SkinContext';\n\nconst PAPER_URI = \"data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='paper'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.04' numOctaves='5'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23paper)' opacity='0.15'/%3E%3C/svg%3E\";\n\ninterface LanternGlowConfig {\n    color?: string;\n    secondaryColor?: string; \n    intensity?: number;\n}\n\ninterface CardProps {\n  card: CardType;\n  onClick?: (event: React.MouseEvent<HTMLDivElement>) => void;\n  onTouchStart?: (event: React.TouchEvent<HTMLDivElement>) => void;\n  isSelected?: boolean;\n  isSmall?: boolean;\n  isTrick?: boolean;\n  isHand?: boolean;\n  isFaceDown?: boolean;\n  isInverted?: boolean; \n  isRotated?: boolean; \n  isBanker?: boolean; \n  isBaiLao?: boolean; \n  isSuspectedBaiLao?: boolean;\n  isMature?: boolean; \n  isForbidden?: boolean; \n  isDraggable?: boolean;\n  isSuggested?: boolean; \n  isDisabled?: boolean;\n  isLocked?: boolean; // NEW: Disables interactive hover effects (lift/scale) without graying out\n  isWinner?: boolean; \n  leadingEffect?: LeadingEffectType; \n  domId?: string; \n  className?: string;\n  style?: React.CSSProperties;\n  suitStatus?: SuitStatus;\n  textLayout?: 'vertical' | 'horizontal'; \n  textRotation?: number; \n  lanternGlow?: LanternGlowConfig | null; \n}\n\nconst getPokerDisplay = (val: number) => val.toString();\n\nconst getModernSuit = (suit: Suit): string => {\n    switch (suit) {\n        case Suit.CASH: return '♠';\n        case Suit.STRINGS: return '♥';\n        case Suit.COINS: return '♣';\n        case Suit.TEXTS: return '♦';\n        default: return '';\n    }\n};\n\nconst CardBase: React.FC<CardProps> = (props) => {\n  const { card, onClick, onTouchStart, style, domId, textRotation = 0, isRotated = false, lanternGlow, isLocked } = props;\n  const { skin } = useSkin();\n\n  const isVerticalText = props.textLayout ? props.textLayout === 'vertical' : !isRotated; \n\n  if (!card) return null;\n\n  const containerClass = skin.card.getContainerClass(props);\n  const mainColorClass = skin.card.getMainColorClass(card.color, props.isInverted);\n  const cornerColorClass = skin.card.getMainColorClass(card.color, props.isInverted);\n\n  // TYPOGRAPHY TUNING\n  let mainFontSize = isVerticalText ? 'text-2xl md:text-4xl' : 'text-xl md:text-3xl';\n  if (props.isSmall) mainFontSize = 'text-[9px] leading-tight'; \n  if (props.isTrick) mainFontSize = isVerticalText ? 'text-3xl md:text-5xl font-black tracking-widest' : 'text-2xl md:text-4xl font-black'; \n\n  const indexFontSize = props.isSmall ? 'text-[7px]' : 'text-[10px] md:text-sm font-black'; \n  const suitFontSize = props.isSmall ? 'text-[7px]' : 'text-[9px] md:text-xs font-bold'; \n  \n  const rotationStyle = textRotation ? { transform: `rotate(${textRotation}deg)` } : {};\n\n  // LAYOUT\n  let contentLayoutClass = '';\n  if (props.isSmall) {\n      contentLayoutClass = 'absolute inset-0 flex flex-col items-center justify-center pt-3 pb-1';\n  } else if (isVerticalText) {\n      contentLayoutClass = 'absolute inset-0 flex flex-col items-center justify-center pt-5 pb-2 px-1 gap-0.5'; \n  } else {\n      contentLayoutClass = 'absolute inset-0 flex flex-row items-center justify-center px-4 py-2 gap-1';\n  }\n\n  let cornerPosClass = 'top-[3px] left-[3px]';\n  if (textRotation === 180) {\n      cornerPosClass = 'bottom-[3px] right-[3px] transform rotate-180';\n  }\n\n  // 3D THICKNESS & MATERIAL LOGIC\n  const THICKNESS_PX = props.isSmall ? 1 : 2; \n  \n  let edgeColor = '#dcdcdc'; \n  let invertedBg = '#1a1a1a'; \n\n  if (skin.id === 'imperial') {\n      edgeColor = '#b8860b'; \n      invertedBg = '#0a0505'; \n  } else if (skin.id === 'ming_scholar') {\n      edgeColor = '#a8a499';\n      invertedBg = '#26140c';\n  }\n\n  // Engraved Text Effect\n  const engravedTextStyle = {\n      ...rotationStyle,\n      // Simulate letterpress impression\n      textShadow: props.isInverted \n        ? '0 1px 1px rgba(0,0,0,0.8)' \n        : 'inset 0 1px 2px rgba(0,0,0,0.2), 0 1px 0 rgba(255,255,255,0.5)', \n      mixBlendMode: props.isInverted ? 'normal' : 'multiply'\n  };\n\n  const CardFaceContent = () => (\n      <div className=\"w-full h-full rounded-[inherit] overflow-hidden relative\">\n          \n          {/* Inner Glow (Lantern Effect) */}\n          {lanternGlow && (\n              <div \n                  className=\"absolute inset-0 z-[5] pointer-events-none rounded-[inherit] animate-pulse-fast\"\n                  style={{\n                      boxShadow: `inset 0 0 15px ${lanternGlow.color}`,\n                      mixBlendMode: 'plus-lighter', // Changed to plus-lighter for better visibility\n                      opacity: lanternGlow.intensity || 0.6\n                  }}\n              />\n          )}\n\n          {!props.isFaceDown && (\n              <>\n                  {/* BACKGROUND LAYER */}\n                  {!props.isInverted ? (\n                      <div className=\"absolute inset-0 bg-[#f0eee5] z-0\"></div>\n                  ) : (\n                      <div className=\"absolute inset-0 z-0\" style={{ backgroundColor: invertedBg }}></div>\n                  )}\n                  \n                  {/* Texture */}\n                  <div className=\"absolute inset-0 opacity-100 pointer-events-none mix-blend-multiply z-0\" style={{ backgroundImage: `url(\"${PAPER_URI}\")` }}></div>\n                  \n                  {/* Fine Hairline at edge */}\n                  <div className={`absolute inset-0 border-[1px] ${props.isInverted ? 'border-[#5c4025]' : 'border-[#2c1a12]'} rounded-[inherit] pointer-events-none z-50 opacity-40`}></div>\n\n                  {/* Main Text */}\n                  <div className={`z-10 ${contentLayoutClass}`}>\n                      <div className={`${mainColorClass} ${mainFontSize} font-calligraphy select-none whitespace-nowrap ${isVerticalText ? 'tategaki' : ''} transition-all overflow-visible`} \n                          style={engravedTextStyle as any}>\n                          {card.name}\n                      </div>\n                  </div>\n\n                  {/* Corner Index */}\n                  <div className={`absolute ${cornerPosClass} z-30 flex flex-col items-center justify-center pointer-events-none origin-center`}>\n                      <div className={`flex flex-col items-center leading-none opacity-80`}>\n                          <span className={`block ${indexFontSize} ${cornerColorClass} font-serif`}>{getPokerDisplay(card.value)}</span>\n                          <span className={`block ${suitFontSize} ${cornerColorClass}`}>{getModernSuit(card.suit)}</span>\n                      </div>\n                  </div>\n\n                  {/* Badges */}\n                  {props.isBanker && (\n                      <div className=\"absolute top-1.5 right-1.5 z-30\" style={rotationStyle}>\n                          <div className=\"w-3.5 h-3.5 rounded-full bg-[#8c1c0b] border border-[#f59e0b] flex items-center justify-center shadow-md\">\n                              <span className=\"text-[8px] text-[#fff] font-serif leading-none pt-[1px]\">庄</span>\n                          </div>\n                      </div>\n                  )}\n                  {/* V22 Update: Bai Lao Badge moved to Right-Bottom to clear space for Suit Status */}\n                  {(props.isBaiLao || props.isSuspectedBaiLao) && (\n                      <div className=\"absolute bottom-1.5 right-1.5 z-30\" style={rotationStyle}>\n                          <div className={`w-3.5 h-3.5 rounded-full ${props.isSuspectedBaiLao ? 'bg-amber-700' : 'bg-amber-600'} border border-[#3e2b22] flex items-center justify-center shadow-md`}>\n                              <span className=\"text-[8px] text-[#e8e4d9] font-serif leading-none pt-[1px]\">百</span>\n                          </div>\n                      </div>\n                  )}\n\n                  {/* V22 Update: Suit Status Indicator moved to Left-Bottom */}\n                  {props.suitStatus && props.suitStatus !== 'NEUTRAL' && (\n                      <div className=\"absolute bottom-1.5 left-1.5 z-30\" style={rotationStyle}>\n                          <div className={`w-2.5 h-2.5 rounded-full shadow-[0_1px_2px_rgba(0,0,0,0.6)] ${\n                              props.suitStatus === 'FORBIDDEN' \n                                ? 'bg-[#b91c1c] border border-[#ef4444] shadow-[0_0_5px_rgba(220,38,38,0.5)] animate-pulse-slow' \n                                : 'bg-[#15803d] border border-[#4ade80] shadow-[0_0_5px_rgba(74,222,128,0.5)]'\n                          }`} title={props.suitStatus === 'FORBIDDEN' ? 'Jin Men (Forbidden)' : 'Shu Men (Safe)'}></div>\n                      </div>\n                  )}\n\n                  <skin.card.EffectOverlay effect={props.leadingEffect || (props.isWinner ? 'GOLD' : null)} />\n                  \n                  {/* Selection Highlight */}\n                  {props.isSelected && (\n                      <div className=\"absolute inset-0 rounded-[inherit] z-50 pointer-events-none ring-2 ring-white/90 shadow-[0_0_20px_rgba(255,255,255,0.6)]\"></div>\n                  )}\n              </>\n          )}\n          \n          <div className=\"absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-black/20 opacity-30 pointer-events-none mix-blend-overlay rounded-[inherit] z-40\"></div>\n      </div>\n  );\n\n  return (\n    <div id={domId} \n         className={`${containerClass} relative aspect-[2/3] ${skin.card.getBorderClass(props)} ${skin.card.getShadowClass(props)} ${isLocked ? '!cursor-default !transform-none !transition-none pointer-events-none' : ''}`} \n         style={{ transformStyle: 'preserve-3d', ...style }} \n         onClick={props.isDisabled || isLocked ? undefined : onClick} \n         onTouchStart={props.isDisabled || isLocked ? undefined : onTouchStart}\n    >\n      {/* OUTER LANTERN GLOW (Backdrop Bloom) */}\n      {lanternGlow && (\n          <div \n              className=\"absolute inset-[-15px] z-0 rounded-[inherit] animate-pulse-slow pointer-events-none\"\n              style={{\n                  background: `radial-gradient(circle at 50% 50%, ${lanternGlow.color} 0%, transparent 70%)`,\n                  opacity: lanternGlow.intensity || 0.8,\n                  filter: 'blur(10px)',\n                  transform: 'translateZ(-5px)'\n              }}\n          />\n      )}\n\n      <div className=\"absolute inset-0 backface-hidden z-20 rounded-[inherit]\" \n           style={{ transform: `translateZ(${THICKNESS_PX}px)` }}>\n          <CardFaceContent />\n      </div>\n\n      {[1, 2].map(i => (\n          <div key={`edge-${i}`} \n               className=\"absolute inset-0 rounded-[inherit] pointer-events-none z-10\"\n               style={{ \n                   background: edgeColor, \n                   transform: `translateZ(${THICKNESS_PX - i * 0.5}px)`, \n                   boxShadow: `0 0 1px ${edgeColor}` \n               }}>\n          </div>\n      ))}\n      \n      <div className=\"absolute inset-0 backface-hidden z-20 rounded-[inherit]\" \n           style={{ transform: `rotateY(180deg) translateZ(${THICKNESS_PX}px)` }}>\n          <div className=\"w-full h-full rounded-[inherit] overflow-hidden relative bg-[#050303] p-[1px]\">\n              <skin.card.BackComponent isSmall={props.isSmall} />\n              <div className=\"absolute inset-0 bg-black/30 pointer-events-none\"></div>\n          </div>\n      </div>\n    </div>\n  );\n};\n\n// --- ARCHITECTURAL OPTIMIZATION ---\n// Use strict equality for props to avoid re-renders of static cards in the discard pile.\nexport default React.memo(CardBase, (prev, next) => {\n    return (\n        prev.card.id === next.card.id &&\n        prev.isSelected === next.isSelected &&\n        prev.isFaceDown === next.isFaceDown &&\n        prev.isDisabled === next.isDisabled &&\n        prev.isSuggested === next.isSuggested &&\n        prev.isWinner === next.isWinner &&\n        prev.isInverted === next.isInverted &&\n        prev.lanternGlow === next.lanternGlow &&\n        // Ignore style changes unless position changes significantly (optimization for small jitter)\n        prev.style?.transform === next.style?.transform\n    );\n});\n","\nimport React, { useMemo } from 'react';\nimport { Player } from '../../types';\nimport { useSkin } from '../../contexts/SkinContext';\nimport { useGameSettings } from '../../hooks/useGameSettings';\n\nconst PAPER_NOISE = \"data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.2'/%3E%3C/svg%3E\";\n\ninterface CharacterFigureProps {\n    player: Player;\n    position: 'Top' | 'Left' | 'Right'; \n    isActive: boolean;\n    isBanker: boolean;\n    isBaiLao: boolean;\n    statusText: string;\n}\n\nexport const CharacterFigure: React.FC<CharacterFigureProps> = React.memo(({ player, position, isActive, isBanker, isBaiLao, statusText }) => {\n    const { skin } = useSkin();\n    const { graphicsQuality } = useGameSettings();\n    const profile = player.profile;\n    \n    // Request a larger image if source allows\n    const avatarUrl = profile?.avatar_url || `https://api.dicebear.com/9.x/miniavs/svg?seed=${player.name}&backgroundColor=transparent`;\n\n    let BodyComponent = skin.character.bodyFront;\n    if (position === 'Left') BodyComponent = skin.character.bodySideLeft; \n    if (position === 'Right') BodyComponent = skin.character.bodySideRight;\n\n    const robeColors = ['#8c1c0b', '#2b3e5c', '#5c4025', '#3e2b22'];\n    let robeColor = robeColors[player.id % 4];\n\n    if (position === 'Left' || position === 'Right') {\n        robeColor = '#0F0F0F';\n    }\n\n    // --- VISUAL CORRECTION LOGIC ---\n    const imageTransform = useMemo(() => {\n        const gaze = profile?.gazeDirection || 'CENTER';\n        let transform = 'scale(1.05) translateY(2%)'; \n\n        if (position === 'Left') {\n            if (gaze === 'LEFT') return 'scaleX(-1) translateY(2%) scale(1.05)'; \n        }\n        \n        if (position === 'Right') {\n            if (gaze === 'RIGHT') return 'scaleX(-1) translateY(2%) scale(1.05)';\n        }\n\n        return transform;\n    }, [position, profile?.gazeDirection]);\n\n    // --- CONFIGURATION BASED ON POSITION ---\n    const config = useMemo(() => {\n        const base = {\n            chairScale: 'scale(1.1)',\n            chairY: '0%',\n            chairX: '0%', \n            bodyY: '8%',\n            headScale: 1.0,\n            headX: '50%',\n            headY: '2%', \n            headRotateY: 0, \n            headRotateZ: 0,\n            lightingGradient: 'radial-gradient(circle at 50% 30%, rgba(255,255,255,0.25), rgba(0,0,0,0) 70%)',\n            chinShadow: 'linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 25%)', \n        };\n\n        if (position === 'Top') {\n            return {\n                ...base,\n                headY: '-5%', \n                headScale: 1.15,\n                lightingGradient: 'linear-gradient(to bottom, rgba(255,255,255,0.2), rgba(0,0,0,0.5))',\n            };\n        }\n        \n        if (position === 'Left') {\n            return {\n                ...base,\n                chairX: '5%',\n                headX: '52%', \n                headY: '0%', \n                headScale: 1.08,\n                headRotateY: 0, \n                headRotateZ: 2, \n                lightingGradient: 'linear-gradient(90deg, rgba(0,0,0,0.7) 0%, rgba(255,255,255,0.2) 100%)',\n            };\n        }\n\n        if (position === 'Right') {\n            return {\n                ...base,\n                chairX: '-5%',\n                headX: '48%', \n                headY: '0%', \n                headScale: 1.08,\n                headRotateY: 0, \n                headRotateZ: -2,\n                lightingGradient: 'linear-gradient(-90deg, rgba(0,0,0,0.7) 0%, rgba(255,255,255,0.2) 100%)',\n            };\n        }\n\n        return base;\n    }, [position]);\n\n    const getStatusColor = (status: string) => {\n        if (status === '赤脚') return 'bg-[#5c0b00] border-red-400 text-white shadow-[0_0_8px_rgba(220,38,38,0.6)]';\n        if (status === '正本') return 'bg-[#1c1917] border-stone-400 text-stone-100 shadow-[0_0_8px_rgba(87,83,78,0.6)]';\n        if (status === '得吊') return 'bg-[#064e3b] border-emerald-400 text-emerald-50 shadow-[0_0_8px_rgba(16,185,129,0.6)]';\n        if (status === '双吊') return 'bg-[#065f46] border-[#34d399] text-white shadow-[0_0_10px_rgba(52,211,153,0.8)]';\n        return 'bg-black/90 border-stone-600';\n    };\n\n    const textFlipStyle = position === 'Top' ? { transform: 'rotateY(180deg)' } : undefined;\n\n    return (\n        <div \n            className={`\n                relative w-96 h-96 flex items-end justify-center pointer-events-none \n                transition-all duration-700 ease-out select-none\n                ${isActive ? 'z-50 filter brightness-110 drop-shadow-[0_0_25px_rgba(255,215,0,0.3)]' : 'opacity-95'}\n            `} \n            style={{ \n                transformStyle: 'preserve-3d',\n                transformOrigin: 'bottom center',\n                transform: isActive ? 'scale(1.08) translateY(-5px)' : 'scale(1.0)'\n            }}\n        >\n            <svg width=\"0\" height=\"0\" className=\"absolute\">\n                <defs>\n                    <clipPath id=\"head-contour-clip\" clipPathUnits=\"objectBoundingBox\">\n                        <path d=\"M 0.5, 0.02 C 0.85, 0.02, 1.0, 0.25, 1.0, 0.55 C 1.0, 0.75, 0.80, 0.92, 0.5, 0.98 C 0.20, 0.92, 0.0, 0.75, 0.0, 0.55 C 0.0, 0.25, 0.15, 0.02, 0.5, 0.02 Z\" />\n                    </clipPath>\n                </defs>\n            </svg>\n            \n            {/* LAYER 0: FLOOR SHADOW (Grounds the figure) */}\n            <div className=\"absolute bottom-0 w-[80%] h-[10%] bg-black/80 blur-xl rounded-[100%] transform scale-y-50 -z-10 translate-y-4\"></div>\n\n            {/* LAYER 1: CHAIR */}\n            <div \n                className=\"absolute bottom-[2%] z-0 origin-bottom filter brightness-[0.6] contrast-125 saturate-50 drop-shadow-2xl\"\n                style={{ \n                    transform: `translateZ(-20px) ${config.chairScale} translateX(${config.chairX}) translateY(${config.chairY})`,\n                    width: '100%',  \n                    height: '100%'  \n                }}\n            >\n                <skin.character.chairComponent position={position} quality={graphicsQuality} />\n            </div>\n\n            {/* LAYER 2: HEAD */}\n            <div \n                className=\"absolute z-[5] w-[35%] h-[35%]\"\n                style={{ \n                    left: config.headX,\n                    top: config.headY,\n                    transform: `translate(-50%, 0) scale(${config.headScale}) rotateY(${config.headRotateY}deg) rotateZ(${config.headRotateZ}deg)`,\n                    transformOrigin: 'bottom center',\n                    transformStyle: 'preserve-3d'\n                }}\n            >\n                <div className=\"relative w-full h-full group\">\n                    <div \n                        className=\"w-full h-full relative overflow-hidden bg-[#dcd0b8]\"\n                        style={{\n                            clipPath: 'url(#head-contour-clip)',\n                            boxShadow: 'inset 0 0 20px rgba(0,0,0,0.9)', \n                            maskImage: 'radial-gradient(circle at center, black 65%, transparent 100%)',\n                            WebkitMaskImage: 'radial-gradient(circle at center, black 65%, transparent 100%)' \n                        }}\n                    >\n                        <img \n                            src={avatarUrl} alt=\"face\" className=\"w-full h-full object-cover\"\n                            style={{ filter: 'sepia(0.2) contrast(1.15) saturate(1.1) brightness(0.95)', transform: imageTransform, imageRendering: '-webkit-optimize-contrast' }}\n                        />\n                        <div className=\"absolute inset-0 z-10 pointer-events-none mix-blend-overlay\" style={{ background: config.lightingGradient }}></div>\n                        <div className=\"absolute inset-0 z-20 pointer-events-none opacity-20 mix-blend-multiply\" style={{ backgroundImage: `url(\"${PAPER_NOISE}\")` }}></div>\n                        <div className=\"absolute bottom-0 left-0 w-full h-[40%] z-20 pointer-events-none mix-blend-multiply\" style={{ background: config.chinShadow }}></div>\n                    </div>\n                </div>\n            </div>\n\n            {/* LAYER 3: BODY */}\n            <div \n                className={`absolute bottom-3 z-10 w-full h-full flex items-end justify-center ${isActive && graphicsQuality === 'HIGH' ? 'animate-breathe-subtle' : ''}`} \n                style={{ transformOrigin: 'bottom center', transform: `translateY(${config.bodyY}) translateZ(5px)` }}\n            >\n                <div className=\"absolute bottom-2 w-[70%] h-4 bg-black/90 blur-md rounded-full transform scale-y-50\"></div>\n                <div className=\"relative w-full h-full drop-shadow-[0_20px_35px_rgba(0,0,0,0.9)] filter contrast-[1.15]\">\n                    <BodyComponent colorTheme={robeColor} quality={graphicsQuality} />\n                    {(position === 'Left' || position === 'Right') && (\n                        <div className=\"absolute inset-0 z-20 pointer-events-none mix-blend-multiply rounded-[30%]\"\n                             style={{ background: position === 'Left' ? 'linear-gradient(90deg, rgba(0,0,0,0.8) 0%, transparent 40%, rgba(0,0,0,0.4) 100%)' : 'linear-gradient(-90deg, rgba(0,0,0,0.8) 0%, transparent 40%, rgba(0,0,0,0.4) 100%)' }}>\n                        </div>\n                    )}\n                    \n                    {/* STATUS BADGES */}\n                    <div className=\"absolute top-[20%] w-full flex flex-col items-center justify-center z-40 pointer-events-none\" \n                        style={{ transform: 'translateZ(30px) scale(0.35)', transformOrigin: 'top center', width: '300%', left: '-100%' }}>\n                        <div className=\"flex flex-col gap-4 items-center justify-center w-full\" style={textFlipStyle}>\n                            {(isBanker || isBaiLao) && (\n                                <div className=\"flex gap-6 items-center justify-center\">\n                                    {isBanker && (\n                                        <div className=\"w-28 h-28 rounded-full bg-gradient-to-br from-[#aa1d1d] via-[#8c1c0b] to-[#450a0a] border-[6px] border-[#ffd700] shadow-[0_20px_40px_black] flex items-center justify-center text-[#fff] font-serif font-black text-7xl tracking-tighter ring-4 ring-black/40 z-10 animate-pulse-slow-opacity\">\n                                            <span className=\"drop-shadow-[0_4px_8px_rgba(0,0,0,0.9)] relative -top-1\">庄</span>\n                                        </div>\n                                    )}\n                                    {isBaiLao && (\n                                        <div className=\"w-28 h-28 rounded-full bg-gradient-to-br from-[#10b981] via-[#047857] to-[#064e3b] border-[6px] border-[#34d399] shadow-[0_20px_40px_black] flex items-center justify-center text-[#ecfdf5] font-serif font-black text-7xl tracking-tighter ring-4 ring-black/40 z-10\">\n                                            <span className=\"drop-shadow-[0_2px_0_rgba(255,255,255,0.4)] relative -top-1\">百</span>\n                                        </div>\n                                    )}\n                                </div>\n                            )}\n                            {statusText && statusText !== '-' && (\n                                <div className={`px-8 py-3 rounded-[12px] shadow-[0_15px_30px_rgba(0,0,0,0.9)] border-[4px] backdrop-blur-xl flex items-center h-24 mt-2 ${getStatusColor(statusText)}`}>\n                                    <span className=\"text-6xl font-serif font-black tracking-widest drop-shadow-md whitespace-nowrap\" style={{ textShadow: '0 4px 8px rgba(0,0,0,0.6)' }}>\n                                        {statusText}\n                                    </span>\n                                </div>\n                            )}\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {isActive && graphicsQuality === 'HIGH' && (\n                <div className=\"absolute inset-0 -z-10 bg-radial-gradient from-[#ffaa00]/15 to-transparent blur-3xl transform scale-125 translate-y-[-10%] mix-blend-screen animate-pulse-slow-opacity\"></div>\n            )}\n        </div>\n    );\n});\n","\nimport React, { useMemo, useEffect, useState } from 'react';\nimport CardComponent from '../Card';\nimport { Card, Player, GamePhase, KaiChongDetail, CardColor, CardRank } from '../../types';\nimport { useSkin } from '../../contexts/SkinContext';\nimport { Compass } from './TableEffects';\nimport { CharacterFigure } from './CharacterFigure';\nimport { useGameSettings } from '../../hooks/useGameSettings';\n\n// --- VISUAL COMPONENTS ---\n\nconst CinematicOverlay = React.memo(() => (\n    <div className=\"absolute inset-0 pointer-events-none z-[100]\">\n        <div className=\"absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] mix-blend-overlay\"></div>\n        <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_center,transparent_40%,rgba(0,0,0,0.6)_100%)]\"></div>\n        <div className=\"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] bg-orange-500/5 blur-[100px] mix-blend-screen pointer-events-none\"></div>\n    </div>\n));\n\nconst TopPaperScreen = React.memo(({ skinId }: { skinId: string }) => {\n    const lightColor = 'rgba(255, 160, 100, 0.5)'; \n    return (\n        <div className=\"absolute top-0 inset-x-0 h-[50vh] pointer-events-none z-[0] overflow-hidden\"\n             style={{ \n                 maskImage: 'linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,1) 40%, rgba(0,0,0,0) 100%)',\n                 WebkitMaskImage: 'linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,1) 40%, rgba(0,0,0,0) 100%)'\n             }}>\n            <div className=\"absolute top-[-20%] left-1/2 -translate-x-1/2 w-[120%] h-[120%] blur-[60px] opacity-60\"\n                 style={{ background: `radial-gradient(circle, ${lightColor} 0%, transparent 70%)` }}>\n            </div>\n            <div className=\"absolute inset-0 opacity-20 mix-blend-overlay\" \n                 style={{ \n                     backgroundImage: `url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E\")`,\n                     backgroundSize: '200px 200px'\n                 }}>\n            </div>\n            <div className=\"absolute inset-0 opacity-30 mix-blend-multiply filter blur-[4px]\">\n                 <div className=\"absolute top-0 right-[10%] w-[4px] h-full bg-black transform rotate-12\"></div>\n                 <div className=\"absolute top-[10%] right-[10%] w-[60px] h-[2px] bg-black transform rotate-12\"></div>\n                 <div className=\"absolute top-[30%] right-[8%] w-[40px] h-[2px] bg-black transform rotate-45\"></div>\n                 <div className=\"absolute top-[-10%] left-[15%] w-[6px] h-full bg-black transform -rotate-6\"></div>\n                 <div className=\"absolute top-[20%] left-[12%] w-[80px] h-[3px] bg-black transform -rotate-12\"></div>\n            </div>\n            <div className=\"absolute inset-0 opacity-10 mix-blend-multiply\" \n                 style={{ \n                     backgroundImage: `linear-gradient(90deg, #000 1px, transparent 1px), linear-gradient(180deg, #000 1px, transparent 1px)`,\n                     backgroundSize: '60px 100px',\n                     transform: 'perspective(500px) rotateX(10deg) scale(1.1)' \n                 }}>\n            </div>\n        </div>\n    );\n});\n\nconst PingFeng = React.memo(({ skinId }: { skinId: string }) => {\n    if (skinId === 'taoist_mystery') return null;\n    return (\n        <div className=\"absolute top-[-25%] left-1/2 -translate-x-1/2 w-[180%] h-[90%] z-[-10] opacity-30 pointer-events-none flex justify-center perspective-[1000px]\" style={{ transform: 'translateZ(-800px)', transformStyle: 'preserve-3d' }}>\n             <div className=\"flex w-full h-full\" style={{ transformStyle: 'preserve-3d' }}>\n                {[...Array(6)].map((_, i) => (\n                     <div key={i} className=\"flex-1 bg-gradient-to-b from-black to-transparent border-r border-white/5 relative overflow-hidden origin-bottom\" \n                          style={{ transform: `rotateY(${i % 2 === 0 ? 15 : -15}deg) scale(1.1)` }}>\n                         <div className=\"absolute inset-0 opacity-20\" \n                              style={{ \n                                  backgroundImage: 'linear-gradient(45deg, transparent 45%, rgba(255,255,255,0.05) 50%, transparent 55%)',\n                                  backgroundSize: '10px 10px' \n                              }}>\n                         </div>\n                     </div>\n                ))}\n             </div>\n        </div>\n    );\n});\n\n// --- LAYOUT ENGINE CONFIGURATION ---\ntype LayoutMode = 'mobile_portrait' | 'mobile_landscape' | 'tablet_portrait' | 'tablet_landscape' | 'desktop';\n\nconst DESKTOP_CONFIG = {\n    camera: { rotateX: 40, z: -350, perspective: '1400px' }, \n    table: { width: '130vh', height: '85vh' },\n    tableY: '55%', \n    isVertical: false, \n    hidePaperDolls: false, \n    hidePingFeng: false,\n    players: { \n        Top: { top: '-38%', left: '50%', scale: 0.8 }, \n        Left: { left: '-32%', top: '0%', scale: 0.8 }, \n        Right: { right: '-32%', top: '0%', scale: 0.8 }, \n        Bottom: { bottom: '10%', left: '50%', scale: 1.0 } \n    },\n    cardScale: 1.3, \n    pot: { x: 500, y: -280, scale: 0.8 }, \n    tableCardSpread: { x: 180, y: 120 }, \n    cardCenterOffset: { x: 0, y: 30 } \n};\n\nconst LAYOUT_CONFIGS: Record<LayoutMode, any> = {\n    mobile_portrait: {\n        camera: { rotateX: 35, z: -50, perspective: '1000px' }, \n        table: { width: '96vw', height: '135vh' },\n        tableY: '81%', \n        isVertical: true, \n        hidePaperDolls: true, \n        hidePingFeng: true,\n        players: {\n            Top: { top: '5%', left: '50%', scale: 0.7 },\n            Left: { left: '2%', top: '28%', scale: 0.7 }, \n            Right: { right: '2%', top: '28%', scale: 0.7 }, \n            Bottom: { bottom: '0%', left: '50%', scale: 0.9 } \n        },\n        cardScale: 0.95, \n        pot: { x: -120, y: -260, scale: 0.9 }, \n        tableCardSpread: { x: 45, y: 115 }, \n        cardCenterOffset: { x: 0, y: 0 } \n    },\n    mobile_landscape: {\n        camera: { rotateX: 35, z: -380, perspective: '1100px' }, \n        table: { width: '110vw', height: '80vh' },\n        tableY: '58%',\n        isVertical: false, \n        hidePaperDolls: false, \n        hidePingFeng: true,\n        players: {\n            Top: { top: '-45%', left: '50%', scale: 0.65 }, \n            Left: { left: '-35%', top: '0%', scale: 0.65 }, \n            Right: { right: '-35%', top: '0%', scale: 0.65 },\n            Bottom: { bottom: '5%', left: '50%', scale: 0.65 }\n        },\n        cardScale: 1.0,\n        pot: { x: 350, y: -180, scale: 0.65 }, \n        tableCardSpread: { x: 130, y: 80 },\n        cardCenterOffset: { x: 0, y: 10 }\n    },\n    tablet_portrait: {\n        camera: { rotateX: 45, z: -600, perspective: '1200px' }, \n        table: { width: '90vw', height: '70vh' },\n        tableY: '45%',\n        isVertical: false, \n        hidePaperDolls: false, \n        hidePingFeng: false,\n        players: { \n            Top: { top: '-45%', left: '50%', scale: 0.8 }, \n            Left: { left: '-25%', top: '0%', scale: 0.75 }, \n            Right: { right: '-25%', top: '0%', scale: 0.75 }, \n            Bottom: { bottom: '10%', left: '50%', scale: 0.75 } \n        },\n        cardScale: 1.1, \n        pot: { x: 320, y: -240, scale: 0.75 }, \n        tableCardSpread: { x: 140, y: 100 }, \n        cardCenterOffset: { x: 0, y: 20 }\n    },\n    desktop: DESKTOP_CONFIG,\n    tablet_landscape: DESKTOP_CONFIG\n};\n\nconst useLayoutMode = (): LayoutMode => {\n    const [mode, setMode] = useState<LayoutMode>('desktop');\n    useEffect(() => {\n        const handleResize = () => {\n            const w = window.innerWidth;\n            const h = window.innerHeight;\n            const aspect = w / h;\n            if (w >= 1024 && aspect >= 1.3) return setMode('desktop'); \n            if (Math.min(w, h) >= 600) return setMode(aspect < 1 ? 'tablet_portrait' : 'tablet_landscape'); \n            return setMode(aspect < 1 ? 'mobile_portrait' : 'mobile_landscape');\n        };\n        handleResize();\n        window.addEventListener('resize', handleResize);\n        return () => window.removeEventListener('resize', handleResize);\n    }, []);\n    return mode;\n};\n\nconst ActionPlate3D = React.memo(({ label, disabled, onClick, skin, isVertical }: { label: string, disabled: boolean, onClick: () => void, skin: any, isVertical?: boolean }) => {\n    const [pressed, setPressed] = useState(false);\n    const yPos = isVertical ? 350 : 320; \n    const zPos = 150; \n    let artifactColor = '#1a0b05';\n    let artifactBorder = '#d4af37';\n    let artifactText = '#ffdb7a';\n    if (skin.id === 'ming_scholar') { artifactColor = '#3d2616'; artifactBorder = '#5c3a21'; artifactText = '#d9c7b0'; }\n    \n    const handleClick = () => { if (disabled) return; setPressed(true); onClick(); setTimeout(() => setPressed(false), 200); };\n    if (disabled) return null;\n    return (\n        <div className=\"absolute z-[60]\" onClick={handleClick} style={{ transform: `translate3d(-50%, ${yPos}px, ${zPos}px) rotateX(20deg)`, left: '50%', top: '50%', transformStyle: 'preserve-3d', cursor: 'pointer', pointerEvents: 'auto', transition: 'opacity 0.3s' }}>\n            <div className={`relative w-40 h-16 transition-transform duration-100 ease-out ${pressed ? 'translate-y-2' : 'animate-float-slow'}`} style={{ transformStyle: 'preserve-3d' }}>\n                <div className=\"absolute inset-0 flex items-center justify-center rounded-[4px] transition-all duration-300\" \n                     style={{ \n                         background: `linear-gradient(135deg, ${artifactColor}, #050202)`, \n                         border: `1px solid ${artifactBorder}`, \n                         boxShadow: '0 10px 30px rgba(0,0,0,0.9), inset 0 1px 1px rgba(255,255,255,0.1)', \n                         transform: 'translateZ(10px)' \n                     }}>\n                    <span className=\"font-calligraphy text-2xl tracking-[0.4em] select-none drop-shadow-[0_2px_0_rgba(0,0,0,1)]\" style={{ color: artifactText }}>{label}</span>\n                    <div className=\"absolute inset-0 bg-gradient-to-tr from-transparent via-white/5 to-transparent pointer-events-none rounded-[3px]\"></div>\n                </div>\n                <div className=\"absolute top-0 left-0 w-full h-[15px] origin-top bg-black/80\" style={{ transform: 'rotateX(-90deg)' }}></div>\n                <div className=\"absolute bottom-0 left-0 w-full h-[15px] origin-bottom\" style={{ background: '#000', transform: 'rotateX(90deg)' }}></div>\n                <div className=\"absolute top-0 left-0 w-[15px] h-full origin-left bg-black/90\" style={{ transform: 'rotateY(90deg)' }}></div>\n                <div className=\"absolute top-0 right-0 w-[15px] h-full origin-right bg-black/90\" style={{ transform: 'rotateY(-90deg)' }}></div>\n            </div>\n        </div>\n    );\n});\n\nconst TableSlab = React.memo(({ skin, width, height, thickness = 40, visualYOffset = '0px', children }: any) => {\n    const borderStyle = { filter: 'brightness(0.15)' }; \n    const isMobile = typeof window !== 'undefined' && window.innerWidth < 768;\n\n    return (\n        <div className=\"relative w-full h-full group\" style={{ transformStyle: 'preserve-3d' }}>\n            <div className=\"absolute inset-0 pointer-events-none\" style={{ transform: `translateY(${visualYOffset})`, transformStyle: 'preserve-3d' }}>\n                <div className={`absolute inset-0 z-0 ${skin.layout.tableSurfaceClass}`} \n                     style={{ \n                         transform: `translateZ(${thickness / 2}px)`, \n                         transformStyle: isMobile ? 'flat' : 'preserve-3d' \n                     }}>\n                     <div className=\"absolute inset-0 w-full h-full rounded-[inherit]\" \n                          style={{ backgroundColor: skin.layout.tableBaseColor || '#1a1a1a' }}>\n                     </div>\n                     <div className=\"absolute inset-0 w-full h-full rounded-[inherit] mix-blend-normal\" \n                          style={{ \n                              backgroundImage: skin.layout.tableTexture || 'none',\n                              backgroundSize: skin.layout.tableTextureSize || 'auto',\n                              opacity: 1.0 \n                          }}>\n                     </div>\n                     {skin.layout.EnvironmentalShadows && <skin.layout.EnvironmentalShadows />}\n                     {skin.layout.tableReflectivity && (\n                         <div className=\"absolute inset-0 w-full h-full rounded-[inherit] mix-blend-overlay opacity-40 pointer-events-none\"\n                              style={{\n                                  background: 'linear-gradient(120deg, transparent 30%, rgba(255,255,255,0.15) 45%, rgba(255,255,255,0.05) 50%, transparent 60%)',\n                                  filter: 'blur(10px)'\n                              }}>\n                         </div>\n                     )}\n                     <div className=\"absolute inset-0 w-full h-full rounded-[inherit] pointer-events-none mix-blend-multiply bg-[radial-gradient(ellipse_at_center,transparent_40%,rgba(0,0,0,0.85)_100%)]\"></div>\n                     <div className=\"absolute inset-0 w-full h-full rounded-[inherit] pointer-events-none border border-white/10 shadow-[inset_0_0_20px_rgba(0,0,0,0.5)]\"></div>\n                </div>\n                <div className={`absolute bottom-0 left-0 w-full h-[${thickness}px] ${skin.layout.tableBorderClass}`} style={{ ...borderStyle, height: thickness, transformOrigin: 'bottom', transform: `rotateX(-90deg) translateZ(0px)` }}></div>\n                <div className={`absolute top-0 right-0 h-full w-[${thickness}px] ${skin.layout.tableBorderClass}`} style={{ ...borderStyle, width: thickness, transformOrigin: 'right', transform: `rotateY(90deg) translateZ(0px)` }}></div>\n                <div className={`absolute top-0 left-0 h-full w-[${thickness}px] ${skin.layout.tableBorderClass}`} style={{ ...borderStyle, width: thickness, transformOrigin: 'left', transform: `rotateY(-90deg) translateZ(0px)` }}></div>\n                <div className={`absolute top-0 left-0 w-full h-[${thickness}px] ${skin.layout.tableBorderClass}`} style={{ ...borderStyle, height: thickness, transformOrigin: 'top', transform: `rotateX(90deg) translateZ(0px)` }}></div>\n                <div className=\"absolute inset-4 bg-black blur-[80px] opacity-90 rounded-[50%]\" style={{ transform: `translateZ(-${thickness * 3}px) scale(0.9)` }}></div>\n            </div>\n            <div className=\"absolute inset-0 z-20 pointer-events-none\" style={{ transform: `translateZ(${thickness / 2}px)`, transformStyle: 'preserve-3d' }}>\n                {children}\n            </div>\n        </div>\n    );\n});\n\nconst getDiaoStatusText = (player: Player) => {\n    if (!player.trickPile) return \"-\";\n    const trickCount = player.trickPile.filter(t => t.round <= 8 && !t.isKaiChong && t.isFaceUp).length;\n    if (trickCount < 2) return \"赤脚\";\n    if (trickCount === 2) return \"正本\";\n    if (trickCount === 3) return \"得吊\";\n    return \"双吊\";\n};\n\nconst getPlayerGlow = (player: Player) => {\n    if (player.isDealer) return { color: '#ef4444', secondaryColor: '#b91c1c', intensity: 0.9 };\n    if (player.isBaiLaoRevealed) return { color: '#10b981', secondaryColor: '#047857', intensity: 0.9 };\n    if (player.isSuspectedBaiLao) return { color: '#f59e0b', secondaryColor: '#b45309', intensity: 0.7 };\n    return null;\n};\n\n// Helper for exact index matching to prevent \"flying\" old cards - MOVED UP TO FIX REFERENCE ERROR\nconst indexMatch = (i: number, target: number) => i === target;\n\nconst BulletCard = React.memo(({ card, playerPos, spread, centerOffset, isFaceDown, isWinner, isMobilePortrait }: any) => {\n    const animClass = useMemo(() => {\n        if (isWinner) return 'animate-card-smash'; \n        if (isFaceDown) return 'animate-card-wither'; \n        return 'animate-fade-in'; \n    }, [isWinner, isFaceDown]);\n\n    const [posStyle, setPosStyle] = useState<React.CSSProperties>({\n        transform: 'translate(-50%, -50%)', \n        opacity: 0\n    });\n\n    useEffect(() => {\n        let tx = 0, ty = 0;\n        const { x: spreadX, y: spreadY } = spread;\n        const { x: cx, y: cy } = centerOffset;\n\n        if (playerPos === 'Bottom') { tx = 0; ty = spreadY; }\n        else if (playerPos === 'Top') { tx = 0; ty = -spreadY; }\n        else if (playerPos === 'Left') { tx = -spreadX; ty = 0; }\n        else if (playerPos === 'Right') { tx = spreadX; ty = 0; }\n\n        tx += cx;\n        ty += cy;\n\n        const baseZ = isWinner ? 80 : 35; \n        \n        const raf = requestAnimationFrame(() => {\n            setPosStyle({\n                transform: `translate(-50%, -50%) translate(${tx}px, ${ty}px) translateZ(${baseZ}px) rotateX(-25deg)`,\n                opacity: 1,\n                transition: 'transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.3s ease-out'\n            });\n        });\n        return () => cancelAnimationFrame(raf);\n    }, [playerPos, spread, centerOffset, isWinner, isMobilePortrait]);\n\n    return (\n        <div className=\"absolute left-1/2 top-1/2 w-16 h-24\" style={{ ...posStyle, transformStyle: 'preserve-3d' }}>\n            <div className={`w-full h-full ${animClass}`} style={{ transformStyle: 'preserve-3d' }}>\n                <CardComponent card={card} isTrick isFaceDown={isFaceDown} isWinner={isWinner} isSmall={false} />\n                {isWinner && (\n                    <div className=\"absolute inset-[-50%] bg-white mix-blend-overlay animate-slash pointer-events-none z-50\"></div>\n                )}\n            </div>\n        </div>\n    );\n}, (prev, next) => {\n    return prev.card.id === next.card.id && \n           prev.isWinner === next.isWinner && \n           prev.isFaceDown === next.isFaceDown &&\n           prev.playerPos === next.playerPos;\n});\n\nconst TableCards = React.memo(({ cards, winnerId, layoutConfig, players }: any) => {\n    if (!cards || cards.length === 0) return null;\n    return (\n        <div style={{ position: 'absolute', inset: 0, pointerEvents: 'none', transformStyle: 'preserve-3d', zIndex: 10 }}>\n            {cards.map((tc: any) => {\n                const player = players.find((p: any) => p.id === tc.playerId);\n                const pos = player?.position || 'Bottom';\n                const isWinner = winnerId === tc.playerId;\n                return (\n                    <BulletCard \n                        key={`${tc.card.id}-${tc.playerId}`}\n                        card={tc.card}\n                        playerPos={pos}\n                        spread={layoutConfig.tableCardSpread}\n                        centerOffset={layoutConfig.cardCenterOffset}\n                        isFaceDown={tc.isFaceDown}\n                        isWinner={isWinner}\n                        isMobilePortrait={layoutConfig.isVertical} \n                    />\n                );\n            })}\n        </div>\n    );\n}, (prev, next) => {\n    if (prev.winnerId !== next.winnerId) return false;\n    if (prev.cards.length !== next.cards.length) return false;\n    for (let i = 0; i < prev.cards.length; i++) {\n        if (prev.cards[i].card.id !== next.cards[i].card.id) return false;\n    }\n    return true;\n});\n\nconst AIHandCompact = React.memo(({ count, baseRotation = 0, scale = 1, alignLeft = false, alignRight = false, skin }: { count: number, baseRotation: number, scale: number, alignLeft?: boolean, alignRight?: boolean, skin: any }) => {\n    if (count <= 0) return null;\n    return (\n        <div style={{ position: 'relative', width: `${64*scale}px`, height: `${96*scale}px`, transformStyle: 'preserve-3d' }}>\n            {[...Array(Math.min(count, 3))].map((_, i) => {\n                let xOff = -i;\n                if (alignLeft) xOff = i * 2;\n                if (alignRight) xOff = -i * 2;\n                return (\n                    <div key={i} className=\"absolute inset-0 shadow-sm rounded-[3px] border-white/10\"\n                        style={{ \n                            transform: `translateZ(${i * 1}px) translate(${xOff}px, -${i}px)`,\n                        }}>\n                        <skin.card.BackComponent isSmall={true} />\n                        <div className=\"absolute inset-0 bg-black/40 animate-pulse-slow pointer-events-none rounded-[inherit] border border-white/10 shadow-[inset_0_0_10px_rgba(0,0,0,0.8)]\"></div>\n                    </div>\n                );\n            })}\n            <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\"\n                 style={{ transform: `translateZ(${Math.min(count, 3) * 1 + 2}px) translate(${alignLeft ? Math.min(count,3)*2 : -Math.min(count,3)*2}px, -${Math.min(count, 3)}px)` }}>\n                 <div className=\"text-[#e6c278] font-serif font-bold text-lg drop-shadow-md bg-black/50 px-2 rounded-full border border-[#5c4025]\">{count}</div>\n            </div>\n        </div>\n    );\n});\n\nconst WonCardsGrid = React.memo(({ cards, baseRotation = 0, scale = 0.5, potCardIds, lanternGlow, playerId, forceVerticalLayout = false, align = 'center', isVertical = false, isFramed = false, hideBackground = false, hideLabel = false }: any) => {\n    if (!cards || cards.length === 0) return null;\n    const limit = 8; const gap = 4 * scale; const cw = 64 * scale; const ch = 96 * scale;\n    const isGridVertical = forceVerticalLayout || (baseRotation === 90 || baseRotation === -90);\n    const width = isGridVertical ? ch * Math.ceil(cards.length/limit) : cw * Math.min(cards.length, limit);\n    const height = isGridVertical ? cw * Math.min(cards.length, limit) : ch * Math.ceil(cards.length/limit);\n    const padding = 8 * scale; const realWidth = width + padding * 2; const realHeight = height + padding * 2;\n    let offsetX = -width / 2; if (align === 'left') offsetX = 0; if (align === 'right') offsetX = -width;\n    const offsetY = -height / 2; const textRot = isVertical ? 0 : (playerId === 2 ? 180 : 0);\n\n    return (\n        <div style={{ position: 'relative', width: 0, height: 0, transformStyle: 'preserve-3d' }}>\n            {!hideBackground && (\n                <div className=\"absolute rounded-[8px]\" style={{ width: realWidth, height: realHeight, left: offsetX - padding, top: offsetY - padding, transform: `translateZ(-2px)`, background: 'rgba(0, 0, 0, 0.25)', boxShadow: 'inset 0 0 15px rgba(0,0,0,0.6)' }}></div>\n            )}\n            {cards.map((card: any, i: number) => {\n                let col = i % limit; let row = Math.floor(i / limit); let x = col * (cw + gap); let y = row * (ch + gap);\n                if (isGridVertical) { x = row * (ch + gap); y = col * (cw + gap); }\n                const cardCenterX = x + cw/2 + offsetX; const cardCenterY = y + ch/2 + offsetY;\n                const isSignificant = card.rank === CardRank.ZUN || card.rank === CardRank.BAI || card.rank === CardRank.JIAN || card.isPot;\n                const activeGlow = isSignificant ? lanternGlow : null;\n\n                return (\n                    <div key={card.id} className=\"absolute w-16 h-24 transition-transform duration-500\" \n                         style={{ \n                             left: 0, top: 0, marginLeft: -32*scale, marginTop: -48*scale, \n                             transform: `translate(${cardCenterX}px, ${cardCenterY}px) translateZ(${i*0.05}px) rotateZ(${baseRotation}deg) scale(${scale * 0.9})`,\n                             filter: 'brightness(0.65)' \n                         }}>\n                        <div className=\"absolute inset-0 rounded-[4px] shadow-[inset_0_0_8px_rgba(0,0,0,0.8)] z-50 pointer-events-none\"></div>\n                        <CardComponent \n                            card={card} \n                            isSmall={false} \n                            isTrick={false} \n                            isFaceDown={false} \n                            isInverted={card.isPot || potCardIds?.has(card.id)} \n                            textRotation={textRot} \n                            className=\"border-black/50\" \n                            lanternGlow={activeGlow}\n                            isLocked={true} \n                        />\n                    </div>\n                );\n            })}\n        </div>\n    );\n}, (prev, next) => {\n    if (prev.cards.length === next.cards.length && prev.scale === next.scale) return true;\n    return false;\n});\n\nconst PlayerZone3D = React.memo(({ player, position, isMyTurn, potCardIds, layoutConfig, showPaperDolls }: any) => {\n    const { skin } = useSkin();\n    const isHuman = player.type === 'HUMAN'; const cfg = layoutConfig.players[position]; if (!cfg) return null;\n    let zoneRot = 0; let handPos: any = {}; let wonPos: any = {}; let forceVerticalWonGrid = false; let align: 'left' | 'right' | 'center' = 'center';\n    let hideWonBackground = false; let hideWonLabel = false;\n\n    if (position === 'Top') { zoneRot = 180; handPos = { top: '5%', left: '50%', transform: 'translateX(-50%)' }; wonPos = { top: '25%', left: '50%', transform: 'translateX(-50%)' }; } \n    else if (position === 'Left') { zoneRot = 90; handPos = { left: '5%', top: '50%', transform: 'translateY(-50%)' }; wonPos = { left: '20%', top: '50%', transform: 'translateY(-50%)' }; } \n    else if (position === 'Right') { zoneRot = -90; handPos = { right: '5%', top: '50%', transform: 'translateY(-50%)' }; wonPos = { right: '20%', top: '50%', transform: 'translateY(-50%)' }; } \n    else if (position === 'Bottom') { zoneRot = 0; wonPos = { bottom: '25%', left: '50%', transform: 'translateX(-50%)' }; }\n\n    if (layoutConfig.isVertical) {\n        if (position === 'Left' || position === 'Right') {\n            zoneRot = 0; forceVerticalWonGrid = true;\n            const wonCount = player.capturedCards.length;\n            let dynamicScale = layoutConfig.cardScale; if (wonCount > 5) dynamicScale *= 0.85; if (wonCount > 8) dynamicScale *= 0.85;\n            const shift = Math.min(wonCount, 8) * 1.0; \n            const baseHandTop = 42; const baseWonTop = 58; \n            const handTopVal = `${baseHandTop - shift}%`; const wonTopVal = `${baseWonTop - shift}%`;\n\n            if (position === 'Left') { align = 'left'; handPos = { left: '3%', top: handTopVal, transform: 'translate(0, -50%)' }; wonPos = { left: '3%', top: wonTopVal, transform: `translate(0, -50%)` }; } \n            else { align = 'right'; handPos = { right: '3%', top: handTopVal, transform: 'translate(0, -50%)' }; wonPos = { right: '-5%', top: wonTopVal, transform: `translate(0, -50%)` }; }\n            layoutConfig.tempWonScale = dynamicScale; \n        } \n        else if (position === 'Top') { \n            zoneRot = 0; \n            handPos = { top: '3%', left: '50%', transform: 'translateX(-50%)' }; \n            wonPos = { top: '23%', left: '50%', transform: 'translateX(-50%)', zIndex: 10 }; \n        }\n        else if (position === 'Bottom') { \n            const wonCount = player.capturedCards.length; \n            const isCrowded = wonCount > 10; \n            const wonScale = isCrowded ? layoutConfig.cardScale * 0.75 : layoutConfig.cardScale; \n            layoutConfig.tempWonScale = wonScale; \n            wonPos = { bottom: '19%', left: '50%', transform: 'translateX(-50%)', zIndex: 10 }; \n            hideWonBackground = true; hideWonLabel = true;\n        }\n    }\n    const lanternGlow = getPlayerGlow(player); const finalWonScale = layoutConfig.tempWonScale || layoutConfig.cardScale;\n    const charStyle: any = { position: 'absolute', top: cfg.top, left: cfg.left, right: cfg.right, bottom: cfg.bottom, transform: `translate(${position==='Top' || position==='Left' ? '-50%' : '50%'}, -50%) rotateX(-45deg) rotateY(${position==='Top'?180:(position==='Left'?-20:20)}deg) scale(${cfg.scale})`, zIndex: 0 };\n    if (layoutConfig.isVertical && (position === 'Left' || position === 'Right')) { charStyle.transform = `translateY(-50%) rotateX(-45deg) rotateY(${position==='Left' ? -15 : 15}deg) scale(${cfg.scale})`; }\n    const wonCardsPointerEvents = position === 'Bottom' ? 'pointer-events-none' : 'pointer-events-auto';\n\n    return (\n        <div className=\"absolute inset-0 pointer-events-none z-[20]\" style={{ transformStyle: 'preserve-3d' }}>\n            {!isHuman && !layoutConfig.hidePaperDolls && showPaperDolls && <div style={charStyle} className=\"pointer-events-auto origin-bottom\"><CharacterFigure player={player} position={position} isActive={isMyTurn} isBanker={player.isDealer} isBaiLao={player.isBaiLaoRevealed} statusText={getDiaoStatusText(player)} /></div>}\n            {!isHuman && <div className=\"absolute pointer-events-auto transition-all duration-500\" style={{ ...handPos, zIndex: 30 }}><AIHandCompact count={player.hand.length} baseRotation={zoneRot} scale={layoutConfig.cardScale} alignLeft={align==='left'} alignRight={align==='right'} skin={skin} /></div>}\n            {player.capturedCards?.length > 0 && <div className={`absolute ${wonCardsPointerEvents} transition-all duration-500 opacity-90`} style={{ ...wonPos }}><WonCardsGrid cards={player.capturedCards} baseRotation={zoneRot} scale={finalWonScale} potCardIds={potCardIds} lanternGlow={lanternGlow} playerId={player.id} forceVerticalLayout={forceVerticalWonGrid} align={align} isVertical={layoutConfig.isVertical} isFramed={true} hideBackground={hideWonBackground} hideLabel={hideWonLabel} /></div>}\n        </div>\n    );\n}, (prev, next) => {\n    const p1 = prev.player;\n    const p2 = next.player;\n    if (p1.id !== p2.id) return false;\n    if (prev.isMyTurn !== next.isMyTurn) return false;\n    if (p1.hand.length !== p2.hand.length) return false;\n    if (p1.capturedCards.length !== p2.capturedCards.length) return false;\n    if (p1.isBaiLaoRevealed !== p2.isBaiLaoRevealed) return false;\n    if (p1.isDealer !== p2.isDealer) return false;\n    if (prev.showPaperDolls !== next.showPaperDolls) return false;\n    if (prev.layoutConfig.isVertical !== next.layoutConfig.isVertical) return false;\n    return true;\n});\n\nconst PotStack = React.memo(({ pot, phase, kaiChongCardIndex, layoutConfig, lastGameEvent, kaiChongHistory }: any) => {\n    if (phase !== GamePhase.KAI_CHONG) return null;\n    const isKaiChong = phase === GamePhase.KAI_CHONG; \n    const visiblePot = pot; \n    const isVertical = layoutConfig.isVertical;\n    \n    let currentScale = layoutConfig.pot.scale;\n    if (isVertical) currentScale = 0.75; \n\n    const getCardGlow = (card: Card, index: number) => {\n        if (!isKaiChong) return null;\n        if (index === kaiChongCardIndex - 1 && lastGameEvent?.type === 'KAI_CHONG_SUCCESS') {\n            if (card.color === CardColor.GREEN) return { color: '#22c55e', secondaryColor: '#4ade80', intensity: 1.5 }; \n            if (card.color === CardColor.RED) return { color: '#ef4444', secondaryColor: '#f59e0b', intensity: 1.5 }; \n            return { color: '#60a5fa', secondaryColor: '#93c5fd', intensity: 1.5 }; \n        } return null;\n    };\n\n    let failedCardCount = 0;\n\n    return (\n        <div style={{ position: 'absolute', inset: 0, pointerEvents: 'none', transformStyle: 'preserve-3d', zIndex: 5 }}>\n            {visiblePot.map((c: Card, i: number) => {\n                const isRevealed = i < kaiChongCardIndex; \n                const isCurrent = i === kaiChongCardIndex; \n                const isFuture = i > kaiChongCardIndex;\n                const wasMatched = kaiChongHistory?.some((h:any) => h.matchedCard.id === c.id);\n                \n                let tx = 0; let ty = 0; let rot = 0; let s = currentScale; let z = i * 2; \n                \n                if (isKaiChong) {\n                    if (isRevealed && !wasMatched) {\n                        const startY = -150; \n                        const stepY = 30;\n                        tx = 0; \n                        ty = startY + (failedCardCount * stepY);\n                        rot = 90 + (Math.random() * 4 - 2); \n                        s = currentScale * 0.9; \n                        z = 20 + failedCardCount; \n                        failedCardCount++;\n                    } \n                    else if (isVertical) {\n                        const spacing = 50 * currentScale; \n                        const startY = -200; \n                        const spiralOffset = Math.sin(i * 0.6) * 30; \n                        tx = spiralOffset;\n                        ty = startY + (i * spacing);\n                        rot = i * 8; \n                    } else {\n                        const stepY = 40; \n                        const startY = -120; \n                        ty = startY + (i * stepY);\n                        rot = 0;\n                    }\n\n                    if (wasMatched && lastGameEvent?.type === 'KAI_CHONG_SUCCESS') {\n                        const winnerId = lastGameEvent.playerId;\n                        if (indexMatch(i, kaiChongCardIndex - 1)) { \n                             const flightDist = 600; \n                             if (winnerId === 0) { ty += flightDist; rot += 10; } \n                             else if (winnerId === 1) { tx += flightDist; rot += 90; } \n                             else if (winnerId === 2) { ty -= flightDist; rot -= 10; } \n                             else if (winnerId === 3) { tx -= flightDist; rot -= 90; } \n                             s = currentScale * 0.8; z = 200; \n                        } else {\n                             if (i < kaiChongCardIndex - 1) return null;\n                        }\n                    } else if (isCurrent) {\n                        z = 50;\n                        s = currentScale * 1.1;\n                    }\n                }\n                \n                const isFaceDown = isFuture; \n                const glow = getCardGlow(c, i);\n                \n                const flightStyle = (wasMatched && lastGameEvent?.type === 'KAI_CHONG_SUCCESS' && indexMatch(i, kaiChongCardIndex - 1))\n                    ? { transition: 'transform 0.4s cubic-bezier(0.5, 0, 0.2, 1), opacity 0.4s ease-in' }\n                    : { transition: 'all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1)' };\n\n                return ( \n                    <div key={c.id} className={`absolute left-1/2 top-1/2 w-16 h-24 ${isCurrent ? 'animate-breathe-subtle' : ''}`}\n                         style={{ \n                             transform: `translate(-50%, -50%) translate(${tx}px, ${ty}px) rotate(${rot}deg) scale(${s}) translateZ(${z}px)`,\n                             ...flightStyle\n                         }}> \n                        <CardComponent card={c} isFaceDown={isFaceDown} isSmall={false} isInverted={true} lanternGlow={glow} /> \n                    </div> \n                );\n            })}\n        </div>\n    );\n}, (prev, next) => {\n    if (prev.phase !== next.phase) return false;\n    if (prev.kaiChongCardIndex !== next.kaiChongCardIndex) return false;\n    if (prev.lastGameEvent !== next.lastGameEvent) return false;\n    if (prev.layoutConfig.isVertical !== next.layoutConfig.isVertical) return false;\n    return true;\n});\n\nexport const Scene3D = React.memo(({ state, interactionState }: any) => {\n    const { skin } = useSkin();\n    const mode = useLayoutMode();\n    const layoutConfig = LAYOUT_CONFIGS[mode] || LAYOUT_CONFIGS['desktop']; \n    const { graphicsQuality, showPaperDolls } = useGameSettings(); \n    const { phase, currentPlayerIndex, trickWinnerId, tableCards, players, bankerId, pot, mianZhangCard, gameMessage, violationNotification, kaiChongCardIndex, kaiChongHistory, lastGameEvent } = state;\n    const playedPlayerIds = useMemo(() => tableCards ? tableCards.map((tc: any) => tc.playerId) : [], [tableCards]);\n    const visualYOffset = '0px';\n\n    return (\n        <div className=\"absolute inset-0 w-full h-full overflow-hidden select-none bg-[#020101]\">\n            <skin.layout.atmosphereComponent quality={graphicsQuality} />\n            {layoutConfig.isVertical && <TopPaperScreen skinId={skin.id} />}\n            <CinematicOverlay />\n            \n            <div className=\"w-full h-full perspective-container\" style={{ perspective: layoutConfig.camera.perspective }}>\n                <div className=\"world-3d w-full h-full relative preserve-3d transition-transform duration-1000 ease-out\" style={{ transform: `rotateX(${layoutConfig.camera.rotateX}deg) translateY(-50%) translateZ(${layoutConfig.camera.z}px)`, transformStyle: 'preserve-3d' }}>\n                    <div className=\"absolute left-1/2 -translate-x-1/2 -translate-y-1/2 preserve-3d transition-all duration-1000\" style={{ top: layoutConfig.tableY, width: layoutConfig.table.width, height: layoutConfig.table.height, transformStyle: 'preserve-3d' }}>\n                        {!layoutConfig.hidePingFeng && <PingFeng skinId={skin.id} />}\n                        <TableSlab skin={skin} width={layoutConfig.table.width} height={layoutConfig.table.height} visualYOffset={visualYOffset}>\n                            <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none z-[10]\" style={{ transform: `translateY(0%) translateZ(1px)` }}>\n                                <div className=\"w-full max-w-[800px] relative opacity-90 transition-all duration-700\" style={{ aspectRatio: layoutConfig.isVertical ? '3/4' : '2/1' }}>\n                                    <Compass activePlayerId={currentPlayerIndex} bankerId={bankerId} revealedBaiLaoId={players.find((p:any)=>p.isBaiLaoRevealed)?.id??null} suspectedBaiLaoId={players.find((p:any)=>p.isSuspectedBaiLao)?.id??null} hasTableCards={tableCards?.length>0} playedPlayerIds={playedPlayerIds} phase={phase} isVertical={layoutConfig.isVertical}/>\n                                    <skin.lighting.TableBorderFlow activePlayerId={currentPlayerIndex} isVertical={layoutConfig.isVertical} />\n                                </div>\n                            </div>\n                            {phase !== GamePhase.DEALING && (\n                                <>\n                                    {players.map((p: Player) => {\n                                        const myKc = kaiChongHistory.filter((h:any) => h.playerId === p.id);\n                                        const potIds = new Set(myKc.map((m:any) => m.matchedCard.id));\n                                        return <PlayerZone3D key={p.id} player={p} position={p.position} isMyTurn={currentPlayerIndex === p.id} potCardIds={potIds} layoutConfig={layoutConfig} quality={graphicsQuality} showPaperDolls={showPaperDolls} />;\n                                    })}\n                                    <PotStack pot={pot} phase={phase} kaiChongCardIndex={kaiChongCardIndex} layoutConfig={layoutConfig} lastGameEvent={lastGameEvent} kaiChongHistory={kaiChongHistory} />\n                                    <TableCards cards={tableCards} winnerId={trickWinnerId} layoutConfig={layoutConfig} players={players} />\n                                </>\n                            )}\n                            <skin.lighting.StoveLighting activePlayerId={currentPlayerIndex} spotlightPos={phase === GamePhase.KAI_CHONG ? { x: `${50 + (kaiChongCardIndex - 3) * 8}%`, y: '50%' } : null} />\n                            {interactionState && !layoutConfig.isVertical && ( <ActionPlate3D label={interactionState.label} disabled={interactionState.disabled} onClick={interactionState.onActionClick} skin={skin} isVertical={layoutConfig.isVertical} /> )}\n                            {gameMessage && ( <div className=\"absolute top-[32%] left-1/2 z-[1000] flex items-center justify-center pointer-events-none\" style={{ transform: 'translate(-50%, -50%) translateZ(120px) rotateX(-45deg)', width: '100%', textAlign: 'center' }}> <div className=\"text-[#e6c278] font-calligraphy text-3xl md:text-4xl drop-shadow-[0_5px_15px_rgba(0,0,0,1)] bg-[#0f0a08]/90 px-10 py-4 rounded-sm border-y-2 border-[#8c6239] backdrop-blur-xl animate-fade-in-up tracking-[0.3em] shadow-lg\">{gameMessage}</div> </div> )}\n                            {violationNotification && ( <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[200]\" style={{ transform: 'translateZ(200px) rotateX(-45deg)' }}> <div className=\"bg-[#1a0505]/95 border-4 border-[#8c1c0b] p-10 text-center shadow-[0_0_150px_rgba(255,0,0,0.6)] rounded-sm animate-shake backdrop-blur-md\"> <h3 className=\"text-4xl text-[#ff4d4d] font-bold uppercase mb-4 tracking-[0.3em] drop-shadow-md\">{violationNotification.title}</h3> <p className=\"text-[#e8e4d9] text-xl font-serif leading-relaxed\">{violationNotification.message}</p> </div> </div> )}\n                        </TableSlab>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}, (prev, next) => {\n    if (prev.state.phase !== next.state.phase) return false;\n    if (prev.state.currentPlayerIndex !== next.state.currentPlayerIndex) return false;\n    if (prev.state.tableCards !== next.state.tableCards) return false;\n    if (prev.state.players !== next.state.players) return false;\n    return true; \n});\n","\nimport React, { useRef, useState, useEffect, useCallback, useMemo } from 'react';\nimport CardComponent from '../Card';\nimport { Player, Card, PlayerType } from '../../types';\nimport { useSkin } from '../../contexts/SkinContext';\n\n// --- HELPERS ---\n\nconst getDiaoStatus = (trickPile: any[]) => {\n    if (!trickPile || !Array.isArray(trickPile)) return { text: \"-\", color: \"bg-black/40\", textColor: \"text-white/40\" };\n    const trickCount = trickPile.filter(t => t.round <= 8 && !t.isKaiChong && t.isFaceUp).length;\n    \n    if (trickCount < 2) return { text: \"赤脚\", color: \"bg-red-900/90\", textColor: \"text-red-100\" }; \n    if (trickCount === 2) return { text: \"正本\", color: \"bg-stone-800/90\", textColor: \"text-stone-300\" }; \n    if (trickCount === 3) return { text: \"得吊\", color: \"bg-emerald-900/90\", textColor: \"text-emerald-200\" }; \n    return { text: \"双吊\", color: \"bg-emerald-600/90\", textColor: \"text-white\" }; \n};\n\nconst truncateName = (name: string) => {\n    if (!name) return \"Player\";\n    return name.length > 5 ? name.substring(0, 4) + '.' : name;\n};\n\nconst DEFAULT_AVATAR = \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23333'/%3E%3Ccircle cx='50' cy='40' r='20' fill='%23666'/%3E%3Cpath d='M20 90 Q50 60 80 90' fill='%23666'/%3E%3C/svg%3E\";\n\n// --- PLAYER HUD ---\n\nexport const PlayerListHUD = React.memo(({ players, bankerId, currentPlayerIndex, aiChatMessages }: { players: Player[], bankerId: number, currentPlayerIndex: number, aiChatMessages: Record<number, string | null> }) => {\n    const { skin } = useSkin();\n    const displayPlayers = players.filter(p => p.type !== PlayerType.HUMAN);\n\n    return (\n        <div className=\"fixed inset-0 pointer-events-none z-[200]\">\n            {displayPlayers.map((player) => {\n                const isMyTurn = players[currentPlayerIndex]?.id === player.id;\n                const isBanker = player.id === bankerId;\n                const isBaiLao = player.isBaiLaoRevealed || player.isSuspectedBaiLao;\n                const profile = player.profile;\n                const avatarUrl = profile?.avatar_url || `https://api.dicebear.com/9.x/miniavs/svg?seed=${player.name}&backgroundColor=transparent`;\n                const diaoStatus = getDiaoStatus(player.trickPile);\n                const chatMsg = aiChatMessages[player.id];\n\n                let posClass = 'hidden';\n                if (player.position === 'Top') {\n                    // Mobile: Pinned to absolute top edge\n                    posClass = 'top-[2%] landscape:top-[2%] left-1/2 -translate-x-1/2';\n                } else if (player.position === 'Left') {\n                    // Mobile V33: Updated to 28% to sit ABOVE the hand stack (which is at 42%)\n                    // Avatar (28%) -> Hand (42%) -> Won (56%)\n                    posClass = 'top-[28%] left-[2%] landscape:top-[35%] landscape:left-[1%]';\n                } else if (player.position === 'Right') {\n                    // Mobile V33: Updated to 28%\n                    posClass = 'top-[28%] right-[2%] landscape:top-[35%] landscape:right-[1%]';\n                }\n\n                return (\n                    <div key={player.id} className={`absolute flex flex-col items-center pointer-events-auto transition-all duration-500 ${posClass}`}>\n                        <div className={`overflow-hidden ${skin.hud.avatarContainerClass(isMyTurn)} relative group`}>\n                            <img \n                                src={avatarUrl} \n                                className=\"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700\" \n                                alt={player.name}\n                                onError={(e) => { (e.target as HTMLImageElement).src = DEFAULT_AVATAR; }}\n                            />\n                            <div className=\"absolute inset-0 bg-gradient-to-b from-black/30 via-transparent to-black/90 pointer-events-none\"></div>\n                            <div className=\"absolute top-1 left-1 z-10\">\n                                <span className=\"text-[8px] md:text-[10px] font-mono text-[#e6c278] bg-black/60 px-1.5 rounded-[2px] border border-[#3e2b22] backdrop-blur-[2px] shadow-sm\">\n                                    {player.hand.length}\n                                </span>\n                            </div>\n                            <div className=\"absolute top-1 right-1 flex flex-col gap-0.5 items-end z-10\">\n                                {isBanker && (\n                                    <div className=\"w-3.5 h-3.5 md:w-4 md:h-4 bg-[#8c1c0b] text-[#e8e4d9] rounded-full flex items-center justify-center text-[8px] md:text-[9px] font-bold border border-[#b8860b] shadow-md leading-none\">\n                                        庄\n                                    </div>\n                                )}\n                                {isBaiLao && (\n                                    <div className=\"w-3.5 h-3.5 md:w-4 md:h-4 bg-[#047857] text-[#e8e4d9] rounded-full flex items-center justify-center text-[8px] md:text-[9px] font-bold border border-[#34d399] shadow-md leading-none\">\n                                        百\n                                    </div>\n                                )}\n                            </div>\n                            <div className=\"absolute bottom-0 inset-x-0 flex flex-col z-10\">\n                                <div className=\"text-[8px] md:text-[10px] text-center text-[#e8e4d9] font-bold drop-shadow-[0_1px_2px_rgba(0,0,0,1)] truncate px-1 pb-[1px]\">\n                                    {truncateName(profile?.username || player.name)}\n                                </div>\n                                <div className={`h-3.5 md:h-4 w-full flex items-center justify-center ${diaoStatus.color} backdrop-blur-sm`}>\n                                    <span className={`text-[7px] md:text-[9px] font-serif font-bold ${diaoStatus.textColor} scale-90`}>{diaoStatus.text}</span>\n                                </div>\n                            </div>\n                        </div>\n                        {chatMsg && (\n                            <div className=\"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-28 md:w-36 z-[300] animate-fade-in-up\">\n                                <div className=\"bg-[#e8e4d9]/95 text-[#1a0505] p-2 rounded-sm text-[9px] md:text-[11px] font-serif shadow-xl border border-[#c5a059] text-center relative leading-tight\">\n                                    <div className=\"absolute -top-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-[#e8e4d9] transform rotate-45 border-l border-t border-[#c5a059]\"></div>\n                                    {chatMsg}\n                                </div>\n                            </div>\n                        )}\n                    </div>\n                );\n            })}\n        </div>\n    );\n});\n\n// --- HUMAN HAND HUD ---\n\nexport const HumanHandHUD = React.memo(({ player, isMyTurn, onCardClick, onDragPlay, onPlayConfirm, selectedCardId, highlightedCardIds, cardMarkers, oneClickPlay, canInteract, actionLabel, mianZhangCard }: any) => {\n    const { skin } = useSkin();\n    const dragStateRef = useRef<{id: string, startX: number, startY: number, currentX: number, currentY: number} | null>(null);\n    const [draggingId, setDraggingId] = useState<string | null>(null); \n    const [dragTransform, setDragTransform] = useState<{x: number, y: number} | null>(null);\n    const [hoveredCardId, setHoveredCardId] = useState<string | null>(null);\n    \n    const [windowWidth, setWindowWidth] = useState(typeof window !== 'undefined' ? window.innerWidth : 375);\n    const [isPortrait, setIsPortrait] = useState(typeof window !== 'undefined' ? window.innerHeight > window.innerWidth : true);\n\n    useEffect(() => {\n        const handleResize = () => {\n            setWindowWidth(window.innerWidth);\n            setIsPortrait(window.innerHeight > window.innerWidth);\n        };\n        window.addEventListener('resize', handleResize);\n        return () => window.removeEventListener('resize', handleResize);\n    }, []);\n\n    if (!player || player.type !== PlayerType.HUMAN) return null;\n\n    const profile = player.profile;\n    const avatarUrl = profile?.avatar_url || `https://api.dicebear.com/9.x/miniavs/svg?seed=Me&backgroundColor=transparent`;\n    const diaoStatus = getDiaoStatus(player.trickPile);\n    const isBanker = player.isDealer;\n    const isBaiLao = player.isBaiLaoRevealed || player.isSuspectedBaiLao;\n\n    const handleLocalCardClick = useCallback((id: string) => { \n        if (!canInteract) return; \n        if (oneClickPlay) onPlayConfirm(id); else onCardClick(id); \n    }, [canInteract, oneClickPlay, onPlayConfirm, onCardClick]);\n\n    const handleActionClick = () => {\n        if (!canInteract) return;\n        if (selectedCardId) onPlayConfirm(selectedCardId);\n        else if (highlightedCardIds && highlightedCardIds.size > 0) {\n            const firstId = Array.from(highlightedCardIds)[0];\n            onPlayConfirm(firstId);\n        } else if (player.hand.length > 0) {\n            onPlayConfirm(player.hand[0].id);\n        }\n    };\n\n    const handleStart = (clientX: number, clientY: number, cardId: string) => {\n        if (!canInteract) return;\n        dragStateRef.current = { id: cardId, startX: clientX, startY: clientY, currentX: clientX, currentY: clientY };\n        setDraggingId(cardId);\n        setDragTransform({ x: 0, y: 0 });\n    };\n\n    useEffect(() => {\n        const handleMove = (e: MouseEvent | TouchEvent) => {\n            if (!dragStateRef.current) return;\n            const clientX = 'touches' in e ? e.touches[0].clientX : (e as MouseEvent).clientX;\n            const clientY = 'touches' in e ? e.touches[0].clientY : (e as MouseEvent).clientY;\n            dragStateRef.current.currentX = clientX;\n            dragStateRef.current.currentY = clientY;\n            setDragTransform({ x: clientX - dragStateRef.current.startX, y: clientY - dragStateRef.current.startY });\n        };\n        const handleEnd = () => {\n            if (dragStateRef.current) {\n                const { id, startY, currentY, startX, currentX } = dragStateRef.current;\n                if (currentY - startY < -80) onDragPlay(id);\n                else if (Math.abs(currentX - startX) < 10 && Math.abs(currentY - startY) < 10) handleLocalCardClick(id);\n                dragStateRef.current = null; setDraggingId(null); setDragTransform(null);\n            }\n        };\n        window.addEventListener('mousemove', handleMove);\n        window.addEventListener('touchmove', handleMove, { passive: false });\n        window.addEventListener('mouseup', handleEnd);\n        window.addEventListener('touchend', handleEnd);\n        return () => {\n            window.removeEventListener('mousemove', handleMove);\n            window.removeEventListener('touchmove', handleMove);\n            window.removeEventListener('mouseup', handleEnd);\n            window.removeEventListener('touchend', handleEnd);\n        };\n    }, [handleLocalCardClick, onDragPlay]);\n\n    const handSize = player.hand.length;\n    const isMobile = windowWidth < 768; \n\n    // V45 Update: Slightly wider cards (5.8rem) and minimal padding (2px) to better fill mobile screen width\n    const CARD_WIDTH_REM = isMobile ? 5.8 : 7.5; \n    const PIXELS_PER_REM = 16;\n    const CARD_WIDTH_PX = CARD_WIDTH_REM * PIXELS_PER_REM;\n    const SCREEN_PADDING = isMobile ? 2 : 100; \n    const AVAILABLE_WIDTH = windowWidth - SCREEN_PADDING;\n\n    const getBasePosition = (i: number) => {\n        if (isMobile) {\n            let xOffset = 0;\n            const totalWidthNoOverlap = handSize * CARD_WIDTH_PX;\n            if (totalWidthNoOverlap <= AVAILABLE_WIDTH) {\n                const gap = 5; \n                const totalSetWidth = totalWidthNoOverlap + ((handSize - 1) * gap);\n                const startX = -(totalSetWidth / 2) + (CARD_WIDTH_PX / 2);\n                xOffset = startX + i * (CARD_WIDTH_PX + gap);\n            } else {\n                const step = (AVAILABLE_WIDTH - CARD_WIDTH_PX) / (handSize - 1);\n                const startX = -(AVAILABLE_WIDTH / 2) + (CARD_WIDTH_PX / 2);\n                xOffset = startX + i * step;\n            }\n\n            return {\n                x: xOffset, y: 0, rot: 0, scale: 1.0, zIndex: 100 + i,\n                width: `${CARD_WIDTH_REM}rem`, marginLeft: `-${CARD_WIDTH_REM/2}rem`, \n                bottom: '10px', transformOrigin: `center bottom`\n            };\n        } else {\n            const dArcRadius = 800; \n            const dMaxFanAngle = 40; \n            let dFanAngle = Math.min(dMaxFanAngle, handSize * 5);\n            const dStartAngle = -dFanAngle / 2;\n            const dAngleStep = handSize > 1 ? dFanAngle / (handSize - 1) : 0;\n            const angleDeg = dStartAngle + (i * dAngleStep);\n            \n            return {\n                x: 0, y: 0, rot: angleDeg, scale: 1.0, zIndex: 100 + i,\n                width: '7.5rem', marginLeft: '-3.75rem', \n                bottom: '30px', transformOrigin: `50% ${dArcRadius}px`\n            };\n        }\n    };\n\n    // --- MOBILE PORTRAIT CONTROLS ---\n    const MobilePortraitControls = () => {\n        const isActive = canInteract;\n        \n        // V11 Update: Added more padding and specific separator class to fix fused text\n        const baseClasses = \"flex items-center gap-6 px-6 py-2 rounded-full transition-all duration-500 backdrop-blur-md border shadow-lg min-w-[240px] justify-between relative overflow-hidden\";\n        \n        const activeClasses = \"bg-gradient-to-r from-[#3e2b22] to-[#1a0b05] border-[#d4af37] cursor-pointer animate-pulse-slow ring-1 ring-[#d4af37]/50 shadow-[0_0_15px_rgba(212,175,55,0.3)] transform scale-110\";\n        const passiveClasses = \"bg-[#0a0605]/80 border-[#3e2b22] shadow-[inset_0_1px_4px_rgba(0,0,0,0.8)] grayscale-[0.3]\";\n\n        return (\n            <div \n                // V21 Update: Dropped to 15% (from 18%) to clear the table loot view\n                className={`absolute bottom-[15%] left-1/2 -translate-x-1/2 z-[90] transition-all duration-500 ease-out flex items-center justify-center`}\n                onClick={isActive ? handleActionClick : undefined}\n            >\n                <div className={`${baseClasses} ${isActive ? activeClasses : passiveClasses}`}>\n                     \n                     {/* Avatar (Left Side) */}\n                     <div className={`relative w-8 h-8 rounded-full border-2 ${isActive ? 'border-[#ffdb7a] ring-2 ring-[#5c4025]' : 'border-[#5c4025]'} overflow-hidden shrink-0 transition-colors duration-500`}>\n                         <img src={avatarUrl} className=\"w-full h-full object-cover\" alt=\"Me\" onError={(e) => { (e.target as HTMLImageElement).src = DEFAULT_AVATAR; }}/>\n                     </div>\n                     \n                     {/* Vertical Separator - V11: Explicit Divider with Margin */}\n                     <div className={`absolute left-[3.5rem] top-1/2 -translate-y-1/2 w-[1px] h-6 ${isActive ? 'bg-[#ffdb7a]/50' : 'bg-[#3e2b22]'}`}></div>\n\n                     {/* Content (Center/Right Side) */}\n                     <div className=\"flex items-center flex-1 justify-center transition-all duration-300 pl-4\">\n                         {isActive ? (\n                             <span className=\"text-[#ffdb7a] font-calligraphy text-2xl font-bold tracking-widest drop-shadow-md whitespace-nowrap px-2\">\n                                 {actionLabel || \"出牌\"}\n                             </span>\n                         ) : (\n                             <div className=\"flex items-center gap-3 px-1\">\n                                 <div className=\"text-[10px] text-[#8c6239] font-serif font-bold tracking-wider uppercase\">\n                                     {isBanker ? 'Banker' : (isBaiLao ? 'Million' : 'Wait')}\n                                 </div>\n                                 <div className=\"w-[1px] h-3 bg-[#3e2b22]\"></div>\n                                 <div className={`text-[10px] font-mono font-bold ${player.score >= 0 ? 'text-[#4ade80]' : 'text-[#ff6b6b]'}`}>\n                                     {player.score}\n                                 </div>\n                             </div>\n                         )}\n                     </div>\n                </div>\n            </div>\n        );\n    };\n\n    return (\n        <div className=\"fixed inset-0 pointer-events-none z-[100] perspective-container overflow-visible\" style={{ perspective: '1200px' }}>\n            \n            {/* MIAN ZHANG INDICATOR (Top Left 2D) */}\n            {mianZhangCard && (\n                <div className=\"absolute top-[2%] left-4 z-[200] flex flex-col items-center gap-1 animate-fade-in pointer-events-auto\">\n                    <div className=\"relative w-8 h-12\">\n                        {[...Array(7)].map((_, i) => (\n                            <div key={i} className=\"absolute inset-0 border border-[#3e2b22] bg-[#0a0505] rounded-[2px]\" \n                                 style={{ \n                                     transform: `translate(${i * 2}px, ${i * 2}px)`, \n                                     zIndex: -i \n                                 }}>\n                            </div>\n                        ))}\n                        <div className=\"absolute inset-0 transform scale-75 origin-top-left z-10\" style={{ transform: 'translate(4px, 4px)' }}>\n                            <CardComponent card={mianZhangCard} isSmall isInverted={true} isFaceDown={false} />\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {isMobile && isPortrait ? (\n                <MobilePortraitControls />\n            ) : (\n                /* Desktop/Landscape Avatar */\n                <div className=\"absolute bottom-[40px] right-[5%] pointer-events-auto flex flex-col items-center z-[150] animate-fade-in-up\">\n                    <div className={`overflow-hidden ${skin.hud.avatarContainerClass(isMyTurn)} relative group`}>\n                        <img src={avatarUrl} className=\"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700\" alt=\"Me\" onError={(e) => { (e.target as HTMLImageElement).src = DEFAULT_AVATAR; }}/>\n                        <div className=\"absolute inset-0 bg-gradient-to-b from-black/30 via-transparent to-black/90 pointer-events-none\"></div>\n                        <div className=\"absolute top-1 right-1 flex flex-col gap-0.5 items-end z-10\">\n                            {isBanker && <div className=\"w-3.5 h-3.5 md:w-4 md:h-4 bg-[#8c1c0b] text-[#e8e4d9] rounded-full flex items-center justify-center text-[8px] md:text-[9px] font-bold border border-[#b8860b] shadow-sm leading-none\">庄</div>}\n                            {isBaiLao && <div className=\"w-3.5 h-3.5 md:w-4 md:h-4 bg-[#047857] text-[#e8e4d9] rounded-full flex items-center justify-center text-[8px] md:text-[9px] font-bold border border-[#34d399] shadow-sm leading-none\">百</div>}\n                        </div>\n                        <div className=\"absolute bottom-0 inset-x-0 flex flex-col z-10\">\n                            <div className=\"text-[8px] md:text-[10px] text-center text-[#e8e4d9] font-bold drop-shadow-[0_1px_2px_rgba(0,0,0,0.1)] truncate px-1 pb-[1px]\">\n                                {truncateName(\"You\")}\n                            </div>\n                            <div className={`h-3.5 md:h-4 w-full flex items-center justify-center ${diaoStatus.color} backdrop-blur-sm`}>\n                                <span className={`text-[7px] md:text-[9px] font-serif font-bold ${diaoStatus.textColor} scale-90`}>{diaoStatus.text}</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div className={`mt-1 text-lg font-bold font-serif ${player.score >= 0 ? 'text-[#4ade80]' : 'text-[#ff6b6b]'} drop-shadow-md bg-black/60 px-2 rounded-full border border-white/10`}>\n                        {player.score}\n                    </div>\n                </div>\n            )}\n\n            {/* HAND CONTAINER */}\n            <div className=\"absolute left-1/2 w-full flex justify-center items-end pointer-events-none\" style={{ transformStyle: 'preserve-3d', transform: 'translateX(-50%)', bottom: '0px', height: '0px', zIndex: 200 }}>\n                {player.hand.map((card: Card, i: number) => {\n                    const pos = getBasePosition(i);\n                    const isDragging = draggingId === card.id;\n                    if (isDragging) return null;\n\n                    const style: React.CSSProperties = isMobile ? {\n                        position: 'absolute', left: '50%', bottom: pos.bottom,\n                        width: pos.width, marginLeft: pos.marginLeft,\n                        transform: `translate3d(${pos.x}px, ${pos.y}px, ${i}px)`, \n                        zIndex: 300 \n                    } : {\n                        position: 'absolute', left: '50%', bottom: pos.bottom,\n                        width: pos.width, marginLeft: pos.marginLeft,\n                        transformOrigin: pos.transformOrigin,\n                        transform: `rotateZ(${pos.rot}deg) translateZ(${i}px)`,\n                        zIndex: 300\n                    };\n\n                    return (\n                        <div key={`hit-${card.id}`}\n                             className=\"pointer-events-auto opacity-0 cursor-pointer\"\n                             style={{ ...style, height: isMobile ? '8rem' : '10rem' }} \n                             onMouseDown={(e) => handleStart(e.clientX, e.clientY, card.id)} \n                             onTouchStart={(e) => handleStart(e.touches[0].clientX, e.touches[0].clientY, card.id)} \n                             onMouseEnter={() => setHoveredCardId(card.id)} \n                             onMouseLeave={() => setHoveredCardId(null)}\n                        />\n                    );\n                })}\n\n                {player.hand.map((card: Card, i: number) => {\n                    const pos = getBasePosition(i);\n                    const isDragging = draggingId === card.id;\n                    const isHovered = hoveredCardId === card.id;\n                    const isVisuallySelected = canInteract && (selectedCardId === card.id || isHovered);\n                    const isHighlighted = highlightedCardIds && highlightedCardIds.has(card.id);\n                    const markers = cardMarkers ? cardMarkers[card.id] : { isMature: false, isForbidden: false };\n\n                    let style: React.CSSProperties = {};\n\n                    if (isDragging && dragTransform) {\n                        style = {\n                            position: 'absolute', left: '50%', bottom: isMobile ? '100px' : '150px',\n                            transform: `translate(${dragTransform.x}px, ${dragTransform.y}px) scale(1.1) rotateZ(0deg)`,\n                            width: isMobile ? '5.5rem' : '7.5rem',\n                            transformOrigin: 'center center', zIndex: 1000,\n                        };\n                    } else if (isMobile) {\n                        const liftY = isVisuallySelected ? -30 : 0;\n                        const liftZ = isVisuallySelected ? 50 : 0;\n                        const scale = isVisuallySelected ? 1.15 : 1.0;\n                        \n                        style = {\n                            position: 'absolute', left: '50%', bottom: pos.bottom,\n                            marginLeft: pos.marginLeft, width: pos.width,\n                            transformOrigin: 'center bottom',\n                            transform: `translate3d(${pos.x}px, ${pos.y + liftY}px, ${i + liftZ}px) scale(${scale})`, \n                            zIndex: isVisuallySelected ? 200 : pos.zIndex,\n                            transition: 'transform 0.1s cubic-bezier(0.2, 0.8, 0.2, 1)',\n                        };\n                    } else {\n                        let liftY = 0; let liftZ = 0; let scale = 1.0; \n                        const rotZ = pos.rot;\n                        if (isVisuallySelected) { liftY = -30; liftZ = 50; scale = 1.15; }\n                        \n                        style = {\n                            position: 'absolute', left: '50%', bottom: pos.bottom,\n                            marginLeft: pos.marginLeft, width: pos.width,\n                            transformOrigin: pos.transformOrigin,\n                            transform: `rotateZ(${rotZ}deg) translateY(${liftY}px) translateZ(${i + liftZ}px) scale(${scale})`,\n                            zIndex: isVisuallySelected ? 200 : pos.zIndex,\n                            transition: 'transform 0.1s cubic-bezier(0.2, 0.8, 0.2, 1)',\n                        };\n                    }\n\n                    return (\n                        <div key={`vis-${card.id}`} className=\"pointer-events-none\" style={style}>\n                            <div className=\"w-full h-full rounded-[4px]\">\n                                <CardComponent \n                                    card={card} isHand isDisabled={false} isSelected={isVisuallySelected} \n                                    suitStatus={markers.isMature ? 'SAFE' : (markers.isForbidden ? 'FORBIDDEN' : 'NEUTRAL')} \n                                    isDraggable={false} isSuggested={isHighlighted} \n                                    isSuspectedBaiLao={player.isSuspectedBaiLao} isBaiLao={false} isBanker={false} isFaceDown={false}\n                                />\n                            </div>\n                        </div>\n                    );\n                })}\n            </div>\n        </div>\n    );\n});\n","\nimport React, { useMemo } from 'react';\n\ninterface AppIconProps {\n    className?: string;\n    size?: number;\n    id?: string; // Added ID prop for export targeting\n}\n\nexport const AppIcon: React.FC<AppIconProps> = ({ className = \"\", size = 200, id }) => {\n    // Generate a unique ID suffix for this instance to prevent filter collision\n    const uid = useMemo(() => Math.random().toString(36).substr(2, 9), []);\n    \n    return (\n        <div id={id} className={`relative overflow-hidden rounded-[22%] shadow-2xl ${className}`} style={{ width: size, height: size }}>\n            <svg \n                viewBox=\"0 0 512 512\" \n                xmlns=\"http://www.w3.org/2000/svg\" \n                className=\"w-full h-full\"\n                preserveAspectRatio=\"xMidYMid slice\"\n            >\n                <defs>\n                    {/* 1. Ancient Rubbing Text Filter */}\n                    <filter id={`ancientRubbing-${uid}`}>\n                        <feMorphology operator=\"dilate\" radius=\"1.5\" in=\"SourceAlpha\" result=\"thick\" />\n                        <feTurbulence type=\"fractalNoise\" baseFrequency=\"0.8\" numOctaves=\"3\" result=\"noise\" />\n                        <feComposite operator=\"in\" in=\"noise\" in2=\"thick\" result=\"texturedText\" />\n                        <feComposite operator=\"in\" in=\"SourceGraphic\" in2=\"thick\" />\n                        <feGaussianBlur stdDeviation=\"0.3\" />\n                    </filter>\n\n                    {/* 2. Leaf Vein Texture */}\n                    <filter id={`crispVeins-${uid}`}>\n                        <feTurbulence type=\"fractalNoise\" baseFrequency=\"0.015\" numOctaves=\"5\" result=\"noise\" />\n                        <feDisplacementMap in=\"SourceGraphic\" in2=\"noise\" scale=\"5\" />\n                        <feComposite operator=\"in\" in2=\"SourceGraphic\" />\n                    </filter>\n\n                    {/* 3. Moonlight Glow */}\n                    <filter id={`moonGlow-${uid}`}>\n                        <feGaussianBlur stdDeviation=\"2.5\" result=\"coloredBlur\"/>\n                        <feMerge>\n                            <feMergeNode in=\"coloredBlur\"/>\n                            <feMergeNode in=\"SourceGraphic\"/>\n                        </feMerge>\n                    </filter>\n\n                    {/* 4. Background Grain */}\n                    <filter id={`nightGrain-${uid}`}>\n                        <feTurbulence type=\"fractalNoise\" baseFrequency=\"0.9\" numOctaves=\"3\" result=\"noise\" />\n                        <feColorMatrix type=\"matrix\" values=\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.08 0\" />\n                        <feComposite operator=\"in\" in2=\"SourceGraphic\" />\n                    </filter>\n\n                    {/* --- GRADIENTS --- */}\n                    <radialGradient id={`nightGrad-${uid}`} cx=\"50%\" cy=\"30%\" r=\"90%\" fx=\"50%\" fy=\"30%\">\n                        <stop offset=\"0%\" stopColor=\"#1a1e24\" />\n                        <stop offset=\"60%\" stopColor=\"#08090c\" />\n                        <stop offset=\"100%\" stopColor=\"#000000\" />\n                    </radialGradient>\n\n                    <linearGradient id={`leafGreen-${uid}`} x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                        <stop offset=\"0%\" stopColor=\"#3d5c3d\" />\n                        <stop offset=\"60%\" stopColor=\"#223822\" />\n                        <stop offset=\"100%\" stopColor=\"#0f1a0f\" />\n                    </linearGradient>\n\n                    <linearGradient id={`leafMixed-${uid}`} x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                        <stop offset=\"0%\" stopColor=\"#9c8c74\" />\n                        <stop offset=\"50%\" stopColor=\"#807050\" />\n                        <stop offset=\"100%\" stopColor=\"#4a4030\" />\n                    </linearGradient>\n\n                    <linearGradient id={`leafRed-${uid}`} x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                        <stop offset=\"0%\" stopColor=\"#8a3324\" />\n                        <stop offset=\"50%\" stopColor=\"#5e2121\" />\n                        <stop offset=\"100%\" stopColor=\"#2e0f0f\" />\n                    </linearGradient>\n\n                    <linearGradient id={`veinLight-${uid}`} x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n                        <stop offset=\"0%\" stopColor=\"transparent\" />\n                        <stop offset=\"50%\" stopColor=\"#b0c4de\" stopOpacity=\"0.2\" />\n                        <stop offset=\"100%\" stopColor=\"transparent\" />\n                    </linearGradient>\n                    \n                    <radialGradient id={`heavyVignette-${uid}`} cx=\"50%\" cy=\"50%\" r=\"55%\">\n                        <stop offset=\"70%\" stopColor=\"transparent\" />\n                        <stop offset=\"100%\" stopColor=\"#000\" stopOpacity=\"0.9\" />\n                    </radialGradient>\n                </defs>\n\n                {/* --- BACKGROUND --- */}\n                <rect width=\"512\" height=\"512\" fill={`url(#nightGrad-${uid})`} />\n                <rect width=\"512\" height=\"512\" fill=\"white\" filter={`url(#nightGrain-${uid})`} opacity=\"0.15\" style={{ mixBlendMode: 'overlay' }} />\n\n                {/* --- THE HANGING STRING --- */}\n                <path d=\"M-10,90 C150,120 362,120 522,90\" stroke=\"#5c4025\" strokeWidth=\"2\" fill=\"none\" opacity=\"0.7\" filter={`url(#moonGlow-${uid})`} />\n\n                {/* --- LEAF GROUP --- */}\n                <g transform=\"translate(256, 90)\">\n                    \n                    {/* 1. LEFT LEAF: \"馬\" (Green) */}\n                    <g transform=\"translate(-140, 20) rotate(8)\">\n                        <path \n                            d=\"M0,0 C -110,60 -90,260 0,360 C 90,260 110,60 0,0 Z\" \n                            fill={`url(#leafGreen-${uid})`} \n                            filter={`url(#crispVeins-${uid})`}\n                        />\n                        <path d=\"M0,0 L0,350\" stroke=\"#000\" strokeWidth=\"1\" opacity=\"0.4\" />\n                        <path d=\"M0,0 L0,350\" stroke={`url(#veinLight-${uid})`} strokeWidth=\"1\" opacity=\"0.4\" />\n                        <text \n                            x=\"0\" y=\"200\" \n                            textAnchor=\"middle\" \n                            fontFamily=\"'Ma Shan Zheng', serif\" \n                            fontSize=\"130\" \n                            fill=\"#0a1a0a\" \n                            stroke=\"#0a1a0a\"\n                            strokeWidth=\"3\"\n                            opacity=\"0.9\" \n                            filter={`url(#ancientRubbing-${uid})`}\n                            style={{ mixBlendMode: 'multiply' }}\n                        >\n                            馬\n                        </text>\n                        <circle cx=\"0\" cy=\"5\" r=\"3\" fill=\"#221\" />\n                    </g>\n\n                    {/* 2. MIDDLE LEAF: \"弔\" (Mixed) */}\n                    <g transform=\"translate(0, 30) rotate(0)\">\n                        <path \n                            d=\"M0,0 C -115,70 -95,280 0,380 C 95,280 115,70 0,0 Z\" \n                            fill={`url(#leafMixed-${uid})`} \n                            filter={`url(#crispVeins-${uid})`}\n                        />\n                        <path d=\"M0,0 L0,370\" stroke=\"#000\" strokeWidth=\"1\" opacity=\"0.4\" />\n                        <path d=\"M0,0 L0,370\" stroke={`url(#veinLight-${uid})`} strokeWidth=\"1\" opacity=\"0.5\" />\n                        <text \n                            x=\"0\" y=\"210\" \n                            textAnchor=\"middle\" \n                            fontFamily=\"'Ma Shan Zheng', serif\" \n                            fontSize=\"140\" \n                            fill=\"#2e2618\" \n                            stroke=\"#2e2618\"\n                            strokeWidth=\"3\"\n                            opacity=\"0.95\" \n                            filter={`url(#ancientRubbing-${uid})`}\n                            style={{ mixBlendMode: 'multiply' }}\n                        >\n                            弔\n                        </text>\n                        <circle cx=\"0\" cy=\"5\" r=\"3\" fill=\"#221\" />\n                    </g>\n\n                    {/* 3. RIGHT LEAF: \"牌\" (Red) */}\n                    <g transform=\"translate(140, 20) rotate(-8)\">\n                        <path \n                            d=\"M0,0 C -110,60 -90,260 0,360 C 90,260 110,60 0,0 Z\" \n                            fill={`url(#leafRed-${uid})`} \n                            filter={`url(#crispVeins-${uid})`}\n                        />\n                        <path d=\"M0,0 L0,350\" stroke=\"#000\" strokeWidth=\"1\" opacity=\"0.4\" />\n                        <path d=\"M0,0 L0,350\" stroke={`url(#veinLight-${uid})`} strokeWidth=\"1\" opacity=\"0.4\" />\n                        <text \n                            x=\"0\" y=\"200\" \n                            textAnchor=\"middle\" \n                            fontFamily=\"'Ma Shan Zheng', serif\" \n                            fontSize=\"130\" \n                            fill=\"#1f0a0a\" \n                            stroke=\"#1f0a0a\"\n                            strokeWidth=\"3\"\n                            opacity=\"0.9\" \n                            filter={`url(#ancientRubbing-${uid})`}\n                            style={{ mixBlendMode: 'multiply' }}\n                        >\n                            牌\n                        </text>\n                        <circle cx=\"0\" cy=\"5\" r=\"3\" fill=\"#221\" />\n                    </g>\n\n                </g>\n\n                {/* --- ATMOSPHERE --- */}\n                <rect x=\"0\" y=\"380\" width=\"512\" height=\"132\" fill={`url(#nightGrad-${uid})`} opacity=\"0.4\" filter={`url(#moonGlow-${uid})`} />\n                <rect width=\"512\" height=\"512\" fill={`url(#heavyVignette-${uid})`} style={{ mixBlendMode: 'multiply' }} />\n\n            </svg>\n        </div>\n    );\n};\n","\nimport React, { useState, useRef, useEffect, useMemo } from 'react';\nimport { Card, GameHistory, Suit, ScoreResult, SupportedLanguage, Player, PatternDetail, KaiChongDetail } from '../../types';\nimport CardComponent from '../Card';\nimport { initSupabase, uploadAvatar, getSupabaseConfig, clearSupabaseConfig } from '../../services/cloudService';\nimport { useSkin } from '../../contexts/SkinContext';\nimport { AppIcon } from '../Visuals/AppIcon';\nimport { SettingsTab } from '../../hooks/useUIState';\nimport { TRANSLATIONS } from '../../constants';\n\n// --- SCORE MODAL HELPERS (Moved from Modals_Score.tsx) ---\n\nconst truncateName = (name: string) => {\n    return name.length > 8 ? name.substring(0, 8) + '...' : name;\n};\n\nconst getFlagUrl = (countryCode: string | undefined) => {\n    const code = countryCode ? countryCode.toLowerCase() : 'cn'; \n    return `https://flagcdn.com/w40/${code}.png`;\n};\n\nconst getScoreColor = (val: number) => {\n    if (val < 0) return 'text-[#f87171] font-bold'; \n    if (val > 0) return 'text-[#4ade80] font-bold'; \n    return 'text-[#555]'; \n};\n\nconst getDiaoBadge = (trickCount: number) => {\n    if (trickCount < 2) return { text: \"赤脚\", color: \"text-[#f87171] border-[#f87171]\" };\n    if (trickCount === 2) return { text: \"正本\", color: \"text-[#888] border-[#888]\" };\n    if (trickCount === 3) return { text: \"得吊\", color: \"text-[#4ade80] border-[#4ade80]\" };\n    return { text: \"双吊\", color: \"text-emerald-400 border-emerald-400\" };\n};\n\nconst CardZoomOverlay = ({ card, onClose }: { card: Card | null, onClose: () => void }) => {\n    if (!card) return null;\n    return (\n        <div className=\"fixed inset-0 z-[1000] flex items-center justify-center bg-black/90 backdrop-blur-lg animate-fade-in cursor-zoom-out\" onClick={onClose}>\n            <div className=\"relative transform scale-[1.5] md:scale-[2.0] transition-transform duration-300 shadow-[0_0_50px_rgba(0,0,0,1)] rounded-xl\" onClick={(e) => e.stopPropagation()}>\n                <div className=\"w-40 h-64 pointer-events-none\">\n                    <CardComponent card={card} isTrick={false} isHand={false} isSmall={false} isFaceDown={false} isInverted={card.isPot} />\n                </div>\n            </div>\n            <div className=\"absolute bottom-10 text-white/50 text-xs md:text-sm font-serif tracking-[0.3em] animate-pulse\">\n                TAP TO CLOSE\n            </div>\n        </div>\n    );\n};\n\ninterface ScoreRowProps {\n    label: string;\n    score: number;\n    cards: Card[];\n    highlightInverted?: boolean; \n    onCardClick: (card: Card) => void;\n}\n\nconst ScoreRow: React.FC<ScoreRowProps> = ({ label, score, cards, highlightInverted, onCardClick }) => (\n    <div className=\"flex flex-col md:flex-row items-start md:items-center justify-between border-b border-white/5 p-3 hover:bg-white/5 transition-colors gap-2 md:gap-4 font-serif\">\n        <div className=\"w-full md:w-1/3\">\n            <span className=\"text-[#a0a0a0] text-sm tracking-wide leading-tight font-bold\">{label}</span>\n        </div>\n        <div className=\"flex flex-wrap gap-2 md:justify-center w-full md:w-1/3\">\n            {cards.map((c, i) => {\n                const isInverted = c.isPot || (highlightInverted && i === cards.length - 1);\n                return (\n                    <div key={i} className=\"relative group cursor-zoom-in z-10 mx-1\" onClick={(e) => { e.stopPropagation(); onCardClick(c); }}>\n                        <div className=\"transition-transform duration-200 group-hover:scale-125 group-hover:z-50 origin-center\">\n                            <CardComponent card={c} isSmall isInverted={isInverted} isFaceDown={false} isLocked={true} />\n                        </div>\n                    </div>\n                );\n            })}\n        </div>\n        <div className=\"w-full md:w-1/3 text-right\">\n            <span className={`font-bold text-lg ${score > 0 ? 'text-[#4ade80]' : 'text-[#f87171]'}`}>\n                {score > 0 ? '+' : ''}{score}\n            </span>\n        </div>\n    </div>\n);\n\nexport const ScoreModal = ({ \n    results, onClose, onNextRound, onHome, onQuit, bankerId, language, players \n}: { \n    results: ScoreResult[], \n    onClose: () => void, \n    onNextRound: () => void, \n    onHome: () => void,\n    onQuit: () => void,\n    bankerId: number, \n    language: SupportedLanguage, \n    players: Player[] \n}) => {\n    const { skin } = useSkin(); \n    const [expandedIds, setExpandedIds] = useState<number[]>([]);\n    const [zoomedCard, setZoomedCard] = useState<Card | null>(null);\n\n    const toggleExpand = (id: number) => { setExpandedIds(prev => prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id]); };\n    const t = (key: string) => TRANSLATIONS[language][key] || TRANSLATIONS['en'][key];\n    const getKcLabel = (type: string) => { const map: Record<string, string> = { 'TONG': 'kc_single', 'BROTHER': 'kc_brother', 'SHUANG_LIN': 'kc_double', 'SHUN_LING': 'kc_seq', 'JIAN_LING': 'kc_gap' }; const key = map[type]; return key ? t(key) : type; };\n\n    const RenderVisuals = ({ res }: { res: ScoreResult }) => {\n        return (\n            <div className=\"bg-black/40 p-4 md:p-6 animate-fade-in shadow-inner text-sm border-t border-white/10 backdrop-contrast-125\">\n                <div className=\"grid grid-cols-5 gap-2 mb-6 md:hidden text-center bg-white/5 p-3 rounded-sm border border-white/5\">\n                    <div>\n                        <div className=\"text-[8px] text-[#5c4025] uppercase\">Diao</div>\n                        <div className={getScoreColor(res.diaoPointChange)}>{res.diaoPointChange}</div>\n                    </div>\n                    <div>\n                        <div className=\"text-[8px] text-[#5c4025] uppercase\">Pot</div>\n                        <div className={getScoreColor(res.kaiZhuPointChange)}>{res.kaiZhuPointChange}</div>\n                    </div>\n                    <div>\n                        <div className=\"text-[8px] text-[#5c4025] uppercase\">Knock</div>\n                        <div className={getScoreColor(res.qiaoMenPointChange)}>{res.qiaoMenPointChange}</div>\n                    </div>\n                    <div>\n                        <div className=\"text-[8px] text-[#5c4025] uppercase\">Meld</div>\n                        <div className={getScoreColor(res.seYangPointChange)}>{res.seYangPointChange}</div>\n                    </div>\n                    <div>\n                        <div className=\"text-[8px] text-[#5c4025] uppercase\">Break</div>\n                        <div className={getScoreColor(res.kaiChongPointChange)}>{res.kaiChongPointChange}</div>\n                    </div>\n                </div>\n\n                {res.allCapturedCards && res.allCapturedCards.length > 0 && (\n                    <div className=\"mb-4\">\n                        <div className=\"text-[10px] text-[#8c6239] font-serif uppercase tracking-[0.2em] mb-2 border-b border-white/5 pb-1\">\n                            {t('visibleCards')} ({res.cardsWonCount})\n                        </div>\n                        <div className=\"flex flex-wrap gap-2\">\n                            {res.allCapturedCards.map((c, i) => (\n                                <div key={i} className=\"relative group cursor-zoom-in z-10 mx-1\" onClick={(e) => { e.stopPropagation(); setZoomedCard(c); }}>\n                                    <div className=\"transition-transform duration-200 group-hover:scale-125 group-hover:z-50 origin-center\">\n                                        <CardComponent card={c} isSmall isInverted={c.isPot} isFaceDown={false} isLocked={true} />\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                )}\n                \n                <div className=\"space-y-2\">\n                    {[...res.kaiChongDetails.map(k => ({\n                        name: getKcLabel(k.matchType), \n                        cards: [...k.sourceCards, k.matchedCard],\n                        score: k.score,\n                        isInverted: true \n                    })), ...res.patternDetails.map(p => ({\n                        name: p.name,\n                        cards: p.cards,\n                        score: p.score,\n                        isInverted: false\n                    }))].map((pd: any, i) => (\n                         <ScoreRow key={i} label={pd.name} score={pd.score} cards={pd.cards || []} highlightInverted={pd.isInverted} onCardClick={setZoomedCard} />\n                    ))}\n                    {res.patternDetails.length === 0 && res.kaiChongDetails.length === 0 && <div className=\"text-center text-[#555] italic py-2\">No special patterns</div>}\n                </div>\n            </div>\n        );\n    };\n\n    return (\n        <div className={skin.hud.modalOverlayClass}>\n            <CardZoomOverlay card={zoomedCard} onClose={() => setZoomedCard(null)} />\n\n            <div className={`w-full max-w-4xl flex flex-col max-h-[90vh] ${skin.hud.modalContentClass}`}>\n                <div className=\"absolute inset-0 pointer-events-none opacity-30 mix-blend-overlay bg-gradient-to-tr from-transparent via-white/5 to-transparent animate-shimmer-slow\" style={{ backgroundSize: '200% 200%' }}></div>\n\n                <div className=\"relative z-50 flex items-center justify-between px-6 py-5 border-b border-white/10 shrink-0 bg-black/40 backdrop-blur-md\">\n                    <h2 className=\"text-2xl md:text-3xl tracking-[0.2em] font-bold uppercase font-calligraphy text-[#c5a059] drop-shadow-md\">\n                        {t('tab_summary')}\n                    </h2>\n                    <div className=\"flex items-center gap-3\">\n                        <button onClick={onHome} className=\"text-[10px] md:text-xs uppercase tracking-widest text-[#8c6239] hover:text-[#c5a059] transition-colors border border-[#3e2b22] px-3 py-2 rounded-sm hover:border-[#c5a059]\">HOME</button>\n                        <button onClick={onNextRound} className={skin.hud.buttonClass(false)}>NEXT</button>\n                    </div>\n                </div>\n\n                <div className=\"p-2 md:p-8 relative z-20 overflow-y-auto custom-scrollbar flex-1 space-y-2\">\n                    <div className=\"grid grid-cols-12 gap-2 text-[10px] uppercase tracking-widest text-[#8c6239] mb-2 px-4 font-bold border-b border-[#3e2b22] pb-2\">\n                        <div className=\"col-span-8 md:col-span-4\">Player</div>\n                        <div className=\"hidden md:block col-span-1 text-center\">Diao</div>\n                        <div className=\"hidden md:block col-span-1 text-center\">Pot</div>\n                        <div className=\"hidden md:block col-span-1 text-center\">Knock</div>\n                        <div className=\"hidden md:block col-span-1 text-center\">Meld</div>\n                        <div className=\"hidden md:block col-span-1 text-center\">Break</div>\n                        <div className=\"col-span-4 md:col-span-3 text-right\">Total</div>\n                    </div>\n\n                    {results.map(res => {\n                        const isBanker = res.playerId === bankerId;\n                        const isMe = res.playerId === 0;\n                        const isExpanded = expandedIds.includes(res.playerId);\n                        const playerObj = players.find(p => p.id === res.playerId);\n                        const profile = playerObj?.profile;\n                        const avatarUrl = profile?.avatar_url || `https://api.dicebear.com/9.x/miniavs/svg?seed=${playerObj?.name || 'Player'}&backgroundColor=b6e3f4,c0aede,d1d4f9`;\n                        const flagUrl = getFlagUrl(profile?.country || 'cn');\n\n                        return (\n                            <div key={res.playerId} className={`group transition-all duration-300 border border-transparent rounded-sm ${isExpanded ? 'bg-white/5 border-white/5' : 'hover:bg-white/5'}`}>\n                                <div onClick={() => toggleExpand(res.playerId)} className=\"grid grid-cols-12 gap-2 items-center p-3 md:p-4 cursor-pointer\">\n                                    <div className=\"col-span-8 md:col-span-4 flex items-center gap-3\">\n                                        <div className={`w-5 h-5 md:w-6 md:h-6 flex items-center justify-center border text-[9px] md:text-[10px] font-serif rounded-sm ${isBanker ? 'border-red-800 text-red-500 bg-red-900/20' : 'border-[#333] text-[#666]'}`}>\n                                            {isBanker ? '庄' : '闲'}\n                                        </div>\n                                        <div className=\"relative\">\n                                            <div className=\"relative w-8 h-8 rounded-full border border-[#3e2b22] overflow-hidden shrink-0 shadow-lg\">\n                                                <img src={avatarUrl} alt=\"\" className=\"w-full h-full object-cover filter brightness-90\" />\n                                            </div>\n                                            <div className=\"absolute -bottom-2 -right-2 w-5 h-4 bg-[#1a0505] border border-[#5c4025] shadow-md transform rotate-12 z-10 flex items-center justify-center p-[1px]\">\n                                                <img src={flagUrl} alt={profile?.country} className=\"w-full h-full object-cover opacity-90\" />\n                                                <div className=\"absolute inset-0 bg-gradient-to-tr from-transparent to-white/20 pointer-events-none\"></div>\n                                            </div>\n                                        </div>\n                                        <div className=\"flex flex-col overflow-hidden\">\n                                            <div className=\"flex items-center gap-1\">\n                                                <span className={`text-sm font-bold tracking-wider truncate ${isMe ? 'text-[#e6c278]' : 'text-[#a0a0a0]'}`}>\n                                                    {truncateName(profile?.username || playerObj?.name || '')}\n                                                </span>\n                                            </div>\n                                            {!isBanker && (\n                                                <span className={`text-[8px] border px-1 w-max mt-0.5 opacity-80 ${getDiaoBadge(res.trickCount).color}`}>\n                                                    {getDiaoBadge(res.trickCount).text}\n                                                </span>\n                                            )}\n                                        </div>\n                                    </div>\n\n                                    <div className={`hidden md:block col-span-1 text-center ${getScoreColor(res.diaoPointChange)}`}>{res.diaoPointChange}</div>\n                                    <div className={`hidden md:block col-span-1 text-center ${getScoreColor(res.kaiZhuPointChange)}`}>{res.kaiZhuPointChange}</div>\n                                    <div className={`hidden md:block col-span-1 text-center ${getScoreColor(res.qiaoMenPointChange)}`}>{res.qiaoMenPointChange}</div>\n                                    <div className={`hidden md:block col-span-1 text-center ${getScoreColor(res.seYangPointChange)}`}>{res.seYangPointChange}</div>\n                                    <div className={`hidden md:block col-span-1 text-center ${getScoreColor(res.kaiChongPointChange)}`}>{res.kaiChongPointChange}</div>\n                                    \n                                    <div className=\"col-span-4 md:col-span-3 text-right\">\n                                        <span className={`text-2xl font-serif font-bold ${res.totalRoundChange > 0 ? 'text-[#e6c278]' : (res.totalRoundChange < 0 ? 'text-[#f87171]' : 'text-[#555]')}`}>\n                                            {res.totalRoundChange > 0 ? '+' : ''}{res.totalRoundChange}\n                                        </span>\n                                        <div className=\"md:hidden text-[9px] text-[#5c4025] uppercase tracking-widest mt-1\">Tap for Details</div>\n                                    </div>\n                                </div>\n                                {isExpanded && <RenderVisuals res={res} />}\n                            </div>\n                        );\n                    })}\n                </div>\n            </div>\n        </div>\n    );\n};\n\n// --- SETTINGS COMPONENTS ---\n\nconst RecorderView = ({ recordedCards, faceUpPlayedCardIds }: { recordedCards: Card[], faceUpPlayedCardIds: Set<string> }) => {\n    const visibleCards = useMemo(() => recordedCards.filter(c => faceUpPlayedCardIds.has(c.id)), [recordedCards, faceUpPlayedCardIds]);\n    const grouped = useMemo(() => {\n        const groups: Record<string, Card[]> = { [Suit.CASH]: [], [Suit.STRINGS]: [], [Suit.COINS]: [], [Suit.TEXTS]: [] };\n        visibleCards.forEach(c => { if (groups[c.suit]) groups[c.suit].push(c); });\n        Object.keys(groups).forEach(key => { groups[key].sort((a, b) => b.value - a.value); });\n        return groups;\n    }, [visibleCards]);\n    const suitsOrder = [Suit.CASH, Suit.STRINGS, Suit.COINS, Suit.TEXTS];\n    const suitLabels: Record<string, string> = { [Suit.CASH]: 'Cash / 十', [Suit.STRINGS]: 'Strings / 貫', [Suit.COINS]: 'Coins / 索', [Suit.TEXTS]: 'Texts / 文' };\n\n    return (\n        <div className=\"flex flex-col h-full overflow-hidden\">\n            <div className=\"flex justify-between items-center mb-4 px-2 shrink-0\">\n                <h4 className=\"text-[#c5a059] text-sm uppercase tracking-widest font-bold\">Public Knowledge</h4>\n                <span className=\"text-xs text-[#5c4025]\">Face-Up: {visibleCards.length} / {recordedCards.length}</span>\n            </div>\n            <div className=\"flex-1 overflow-y-auto custom-scrollbar space-y-6 pr-2\">\n                {suitsOrder.map(suit => (\n                    <div key={suit} className=\"bg-[#0a0806] border border-[#2a1d15] rounded-sm p-3 relative\">\n                        <div className=\"absolute -top-2 left-3 bg-[#15100e] px-2 text-[10px] text-[#8c6239] uppercase tracking-widest font-bold border border-[#2a1d15]\">{suitLabels[suit]}</div>\n                        <div className=\"flex flex-wrap gap-2 mt-2\">\n                            {grouped[suit].length > 0 ? (grouped[suit].map((card, i) => (<div key={`${card.id}-${i}`} className=\"transform hover:scale-110 transition-transform origin-bottom duration-200\"><CardComponent card={card} isSmall className=\"shadow-md border-white/5\" /></div>))) : (<span className=\"text-[10px] text-[#3e2b22] italic w-full text-center py-2\">No visible cards</span>)}\n                        </div>\n                    </div>\n                ))}\n            </div>\n        </div>\n    );\n};\n\nconst HistoryView = ({ history }: { history: GameHistory }) => (\n    <div className=\"flex flex-col h-full overflow-y-auto custom-scrollbar\">\n        <div className=\"grid grid-cols-2 gap-4 mb-6 text-[#a0a0a0] shrink-0\">\n            <div className=\"bg-[#0a0806] p-4 border border-[#2a1d15] text-center rounded-sm\"><div className=\"text-[10px] text-[#5c4025] uppercase tracking-widest mb-1\">Total Rounds</div><div className=\"text-2xl text-[#e6c278] font-bold font-serif\">{history.totalRounds}</div></div>\n            <div className=\"bg-[#0a0806] p-4 border border-[#2a1d15] text-center rounded-sm\"><div className=\"text-[10px] text-[#5c4025] uppercase tracking-widest mb-1\">Banker vs Peasant</div><div className=\"text-xl text-[#e6c278] font-serif\">{history.bankerWins} : {history.peasantWins}</div></div>\n        </div>\n        <div className=\"space-y-3\">\n            <h4 className=\"text-[#8c6239] text-[10px] uppercase tracking-widest sticky top-0 bg-[#15100e] py-2 border-b border-[#2a1d15] mb-2\">Opponent Intelligence</h4>\n            {Object.entries(history.aiLearningStates || {}).map(([pid, state]: [string, any]) => (\n                <div key={pid} className=\"bg-[#0a0806] p-3 border border-[#2a1d15] flex justify-between items-center rounded-sm hover:border-[#3e2b22] transition-colors\">\n                    <span className=\"text-[#c5a059] text-xs font-bold\">Seat {pid}</span>\n                    <div className=\"text-[10px] text-[#5c4025] flex gap-3 font-mono\"><span>AGR: <span className=\"text-[#a0a0a0]\">{state.aggression.toFixed(2)}</span></span><span>RSK: <span className=\"text-[#a0a0a0]\">{state.riskTolerance.toFixed(2)}</span></span></div>\n                </div>\n            ))}\n        </div>\n    </div>\n);\n\nconst GeneralSettingsView = ({ settings, onOpenAdmin }: any) => {\n    const { language, setLanguage, oneClickPlay, setOneClickPlay, isRiskAlertOn, setIsRiskAlertOn, isMuted, setIsMuted, graphicsQuality, setGraphicsQuality, githubAutoSync, setGithubAutoSync, showPaperDolls, setShowPaperDolls, isMobileDevice } = settings;\n    const { skin, setSkinId, availableSkins } = useSkin(); \n    const [sbUrl, setSbUrl] = useState(''); const [sbKey, setSbKey] = useState(''); const [isConnected, setIsConnected] = useState(false); const [uploadStatus, setUploadStatus] = useState(''); const fileInputRef = useRef<HTMLInputElement>(null);\n    useEffect(() => { const config = getSupabaseConfig(); if (config.url && config.key) { setSbUrl(config.url); setSbKey(config.key); setIsConnected(initSupabase(config.url, config.key)); } }, []);\n    const handleConnect = () => { if (initSupabase(sbUrl, sbKey)) { setIsConnected(true); setUploadStatus(\"Connected.\"); } else { setUploadStatus(\"Failed.\"); } };\n    const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => { if (e.target.files && e.target.files[0]) { setUploadStatus(\"Uploading...\"); const url = await uploadAvatar(e.target.files[0]); if (url) { localStorage.setItem('ma_diao_avatar_url', url); setUploadStatus(\"Avatar updated!\"); } } };\n    const Row = ({ label, children }: any) => ( <div className=\"flex justify-between items-center text-[#a0a0a0] py-2 border-b border-[#2a1d15]/50\"> <span className=\"text-xs uppercase tracking-wide text-[#8c6239] font-bold\">{label}</span> {children} </div> );\n    const Toggle = ({ active, onClick, labelOn = \"ON\", labelOff = \"OFF\" }: any) => ( <button onClick={onClick} className={`px-3 py-1 text-[10px] border transition-all duration-300 font-bold tracking-wider rounded-sm ${active ? 'border-[#c5a059] text-[#15100e] bg-[#c5a059]' : 'border-[#3e2b22] text-[#5c4025] hover:text-[#8c6239]'}`}> {active ? labelOn : labelOff} </button> );\n\n    return (\n        <div className=\"space-y-4 h-full overflow-y-auto custom-scrollbar pr-2\">\n            <div className=\"space-y-1\">\n                <div className=\"text-[10px] text-[#5c4025] uppercase tracking-[0.3em] mb-2 font-bold\">Gameplay</div>\n                <Row label=\"Visual Theme\"> <select value={skin.id} onChange={(e) => setSkinId(e.target.value)} className=\"bg-[#0a0806] border border-[#3e2b22] text-[#c5a059] px-2 py-1 text-[10px] outline-none rounded-sm\"> {availableSkins.map((s:any) => <option key={s.id} value={s.id}>{s.name}</option>)} </select> </Row>\n                <Row label=\"Graphics\"> <div className=\"flex gap-1\"> <button onClick={() => setGraphicsQuality('LOW')} className={`px-2 py-1 text-[10px] border ${graphicsQuality === 'LOW' ? 'border-[#c5a059] text-[#c5a059]' : 'border-[#3e2b22] text-[#5c4025]'}`}>Low</button> <button onClick={() => setGraphicsQuality('HIGH')} className={`px-2 py-1 text-[10px] border ${graphicsQuality === 'HIGH' ? 'border-[#c5a059] text-[#c5a059]' : 'border-[#3e2b22] text-[#5c4025]'}`}>High</button> </div> </Row>\n                \n                {!isMobileDevice && (\n                    <Row label=\"3D Avatars\"> <Toggle active={showPaperDolls} onClick={() => setShowPaperDolls(!showPaperDolls)} labelOn=\"Show\" labelOff=\"Hide\" /> </Row>\n                )}\n                \n                <Row label=\"Language\"> <select value={language} onChange={(e:any) => setLanguage(e.target.value)} className=\"bg-[#0a0806] border border-[#3e2b22] text-[#c5a059] px-2 py-1 text-[10px] outline-none rounded-sm\"> {['en', 'zh_CN', 'zh_TW', 'ja', 'ko'].map(l => <option key={l} value={l}>{l}</option>)} </select> </Row>\n                <Row label=\"Control Mode\"> <Toggle active={oneClickPlay} onClick={() => setOneClickPlay(!oneClickPlay)} labelOn=\"1-Click\" labelOff=\"Confirm\" /> </Row>\n                <Row label=\"Strategy Hints\"> <Toggle active={isRiskAlertOn} onClick={() => setIsRiskAlertOn(!isRiskAlertOn)} /> </Row>\n                <Row label=\"Sound (TTS)\"> <Toggle active={!isMuted} onClick={() => setIsMuted(!isMuted)} /> </Row>\n            </div>\n            <div className=\"space-y-3 pt-4 border-t border-[#2a1d15]\">\n                <div className=\"text-[10px] text-[#5c4025] uppercase tracking-[0.3em] font-bold\">System</div>\n                <div className=\"bg-[#0a0806] p-3 border border-[#2a1d15] rounded-sm relative overflow-hidden\">\n                    <div className=\"flex justify-between items-center mb-3\"> <span className=\"text-[10px] text-[#8c6239] font-bold\">GitHub Sync</span> <Toggle active={githubAutoSync} onClick={() => setGithubAutoSync(!githubAutoSync)} labelOn=\"Auto\" labelOff=\"Manual\" /> </div>\n                </div>\n                <div className=\"bg-[#0a0806] p-3 border border-[#2a1d15] rounded-sm\">\n                    <div className=\"flex justify-between items-center mb-2\"> <span className=\"text-[10px] text-[#8c6239]\">Cloud Save</span> <div className={`w-1.5 h-1.5 rounded-full ${isConnected ? 'bg-green-500 shadow-[0_0_5px_lime]' : 'bg-red-900'}`}></div> </div>\n                    {isConnected ? ( <div className=\"flex gap-2\"> <button onClick={() => fileInputRef.current?.click()} className=\"flex-1 py-1.5 bg-[#3e2b22]/50 text-[#a0a0a0] text-[10px] border border-[#3e2b22] hover:border-[#c5a059] transition-colors\">Upload Avatar</button> <input type=\"file\" ref={fileInputRef} onChange={handleFileUpload} accept=\"image/*\" className=\"hidden\" /> <button onClick={() => { clearSupabaseConfig(); setIsConnected(false); }} className=\"px-3 text-[10px] text-red-500 border border-red-900/30 hover:bg-red-900/10\">Unlink</button> </div> ) : ( <div className=\"flex gap-2\"> <input type=\"password\" placeholder=\"MemFire/Supabase URL\" value={sbUrl} onChange={e => setSbUrl(e.target.value)} className=\"flex-1 bg-black border border-[#3e2b22] px-2 text-[10px] text-[#c5a059]\" /> <input type=\"password\" placeholder=\"Key\" value={sbKey} onChange={e => setSbKey(e.target.value)} className=\"w-16 bg-black border border-[#3e2b22] px-2 text-[10px] text-[#c5a059]\" /> <button onClick={handleConnect} className=\"px-2 text-[10px] bg-[#3e2b22] text-[#c5a059]\">Link</button> </div> )}\n                    {uploadStatus && <div className=\"text-[9px] text-[#c5a059] mt-1 text-right italic\">{uploadStatus}</div>}\n                </div>\n                <button onClick={onOpenAdmin} className=\"w-full py-2 bg-[#1a1a1a] text-[#333] border border-[#222] text-[10px] uppercase tracking-widest hover:text-[#555] transition-colors\"> Admin Portal </button>\n            </div>\n        </div>\n    );\n};\n\nexport interface SettingsModalProps { onClose: () => void; onOpenAdmin: () => void; settings: any; initialTab?: SettingsTab; gameData?: { recordedCards: Card[]; faceUpPlayedCardIds: Set<string>; gameHistory: GameHistory; }; }\n\nexport const SettingsModal = ({ onClose, onOpenAdmin, settings, initialTab = 'GENERAL', gameData }: SettingsModalProps) => {\n    const { skin } = useSkin();\n    const [activeTab, setActiveTab] = useState<SettingsTab>(initialTab);\n    const IconExportTarget = () => ( <div className=\"absolute top-0 left-0 -z-50 opacity-0 pointer-events-none\" style={{ width: '1024px', height: '1024px' }}> <AppIcon id=\"app-icon-export-target\" size={1024} /> </div> );\n    const TabButton = ({ id, label, icon }: { id: SettingsTab, label: string, icon: string }) => ( <button onClick={() => setActiveTab(id)} className={`flex-1 py-3 text-xs uppercase tracking-widest font-bold transition-all duration-300 flex flex-col items-center gap-1 border-b-2 ${activeTab === id ? 'text-[#c5a059] border-[#c5a059] bg-[#c5a059]/10' : 'text-[#5c4025] border-transparent hover:text-[#8c6239] hover:bg-white/5'}`}> <span className=\"text-lg opacity-80\">{icon}</span> <span className=\"scale-90\">{label}</span> </button> );\n\n    return (\n        <div className={skin.hud.modalOverlayClass}>\n            <IconExportTarget />\n            <div className={`w-full max-w-lg flex flex-col relative overflow-hidden ${skin.hud.modalContentClass}`} style={{ height: '85vh', maxHeight: '700px' }}>\n                <div className=\"absolute inset-0 bg-gradient-to-tr from-transparent via-white/5 to-transparent opacity-30 pointer-events-none\"></div>\n                <button onClick={onClose} className=\"absolute top-4 right-4 text-[#5c4025] hover:text-[#c5a059] z-50 text-xl font-bold\">✕</button>\n                <div className=\"flex border-b border-white/10 bg-black/20 shrink-0 z-20 relative\"> <TabButton id=\"RECORDER\" label=\"Recorder\" icon=\"👁\" /> <TabButton id=\"GENERAL\" label=\"Settings\" icon=\"⚙\" /> <TabButton id=\"HISTORY\" label=\"History\" icon=\"📜\" /> </div>\n                <div className=\"flex-1 p-6 relative z-10 overflow-hidden\">\n                    {activeTab === 'RECORDER' && gameData && ( <RecorderView recordedCards={gameData.recordedCards} faceUpPlayedCardIds={gameData.faceUpPlayedCardIds} /> )}\n                    {activeTab === 'GENERAL' && ( <GeneralSettingsView settings={settings} onOpenAdmin={onOpenAdmin} /> )}\n                    {activeTab === 'HISTORY' && gameData && ( <HistoryView history={gameData.gameHistory} /> )}\n                    {((activeTab === 'RECORDER' || activeTab === 'HISTORY') && !gameData) && ( <div className=\"flex h-full items-center justify-center text-[#5c4025] italic text-xs\"> Game data not available. </div> )}\n                </div>\n            </div>\n        </div>\n    );\n};\n","\nimport { IPlatformAdapter, IAuthService, IAdService, IIAPService, ISocialService, AuthResult, Product } from '../../types/platform';\nimport { UserProfile, SocialProvider } from '../../types';\nimport { getCurrentUser, getUserProfile, signInWithProvider, loginAsGuest, signOut, upsertUserProfile, getFriends } from '../cloudService';\n\n// --- WEB AUTH ---\nclass WebAuth implements IAuthService {\n    getSupportedProviders(): SocialProvider[] {\n        return [SocialProvider.GOOGLE, SocialProvider.FACEBOOK, SocialProvider.WECHAT, SocialProvider.DOUYIN];\n    }\n\n    async checkSession(): Promise<AuthResult> {\n        const user = await getCurrentUser();\n        if (user) {\n            const profile = await getUserProfile(user.id);\n            if (profile) return { success: true, user: profile };\n        }\n        return { success: false };\n    }\n\n    async login(provider?: SocialProvider): Promise<AuthResult> {\n        if (!provider) return { success: false, error: \"Provider required for Web\" };\n\n        // Handle Guest/Mock flows (WeChat/Douyin in browser)\n        if (provider === SocialProvider.WECHAT || provider === SocialProvider.DOUYIN) {\n            const { user } = await loginAsGuest(provider);\n            const profile = await getUserProfile(user.id);\n            return { success: true, user: profile || undefined };\n        }\n\n        // Handle Standard OAuth\n        const { data, error } = await signInWithProvider(provider);\n        if (error) return { success: false, error: JSON.stringify(error) };\n        \n        // Note: OAuth usually redirects, so this might not complete in-page unless using popup flow\n        return { success: true };\n    }\n\n    async logout(): Promise<void> {\n        await signOut();\n    }\n}\n\n// --- WEB ADS (Mock / Google AdSense placeholders) ---\nclass WebAds implements IAdService {\n    init() { console.log(\"Web Ads Initialized\"); }\n    showBanner() { console.log(\"Show Web Banner\"); }\n    hideBanner() { console.log(\"Hide Web Banner\"); }\n    async showInterstitial() { \n        console.log(\"Show Web Interstitial\"); \n        alert(\"This is a simulated Interstitial Ad.\");\n    }\n    async showRewarded() { \n        console.log(\"Show Web Rewarded Video\");\n        return confirm(\"Watch video for rewards? (Simulated)\");\n    }\n}\n\n// --- WEB IAP (Stripe / Mock) ---\nclass WebIAP implements IIAPService {\n    async getProducts(ids: string[]): Promise<Product[]> {\n        return ids.map(id => ({\n            productId: id,\n            title: \"Test Item\",\n            description: \"A test item for web\",\n            price: \"$0.99\",\n            currencyCode: \"USD\"\n        }));\n    }\n    async purchase(productId: string) {\n        console.log(`Purchased ${productId} on Web`);\n        return { success: true, transactionId: `web_tx_${Date.now()}` };\n    }\n    async restorePurchases() {}\n}\n\n// --- WEB SOCIAL ---\nclass WebSocial implements ISocialService {\n    async share(title: string) {\n        if (navigator.share) {\n            navigator.share({ title, url: window.location.href });\n        } else {\n            prompt(\"Copy this link to share:\", window.location.href);\n        }\n    }\n    async inviteFriends() { alert(\"Invite link copied to clipboard!\"); }\n    async getFriendList() { return getFriends(); }\n}\n\nexport const WebAdapter: IPlatformAdapter = {\n    id: 'WEB',\n    auth: new WebAuth(),\n    ads: new WebAds(),\n    iap: new WebIAP(),\n    social: new WebSocial(),\n    initialize: async () => {\n        // Any web-specific init (e.g. loading Analytics)\n        console.log(\"Web Platform Adapter Initialized\");\n    }\n};\n","import { IPlatformAdapter, IAuthService, IAdService, IIAPService, ISocialService, AuthResult } from '../../types/platform';\nimport { SocialProvider } from '../../types';\n\n// Mock WeChat SDK global variable\ndeclare const wx: any;\n\nclass WeChatAuth implements IAuthService {\n    getSupportedProviders() { return [SocialProvider.WECHAT]; } // Only WeChat login allowed\n    \n    async checkSession(): Promise<AuthResult> {\n        // Logic: wx.checkSession() -> success -> return user\n        return { success: false };\n    }\n\n    async login(): Promise<AuthResult> {\n        console.log(\"Calling wx.login()...\");\n        // In real impl: \n        // 1. wx.login() get code\n        // 2. Send code to game server\n        // 3. Game server calls WeChat API to get session_key & openid\n        // 4. Return user profile\n        return { success: false, error: \"Not implemented in browser environment\" };\n    }\n\n    async logout() {}\n}\n\nclass WeChatAds implements IAdService {\n    init() {}\n    showBanner(id: string) { /* wx.createBannerAd(...) */ }\n    hideBanner() {}\n    async showInterstitial(id: string) { /* wx.createInterstitialAd(...) */ }\n    async showRewarded(id: string) { \n        // wx.createRewardedVideoAd(...)\n        return true; \n    }\n}\n\nclass WeChatIAP implements IIAPService {\n    async getProducts(ids: string[]) { return []; }\n    async purchase(id: string) { \n        // wx.requestMidasPayment(...)\n        return { success: false }; \n    }\n    async restorePurchases() {}\n}\n\nclass WeChatSocial implements ISocialService {\n    async share(title: string, img: string) { /* wx.shareAppMessage(...) */ }\n    async inviteFriends() {}\n    async getFriendList() { return []; }\n}\n\nexport const WeChatAdapter: IPlatformAdapter = {\n    id: 'WECHAT',\n    auth: new WeChatAuth(),\n    ads: new WeChatAds(),\n    iap: new WeChatIAP(),\n    social: new WeChatSocial(),\n    initialize: async () => {\n        console.log(\"WeChat Platform Initialized\");\n    }\n};","\nimport { IPlatformAdapter } from '../types/platform';\nimport { WebAdapter } from './platforms/webAdapter';\nimport { WeChatAdapter } from './platforms/wechatAdapter';\n// import { FacebookAdapter } from './platforms/facebookAdapter'; // Import when needed\n\nclass PlatformService {\n    private adapter: IPlatformAdapter;\n\n    constructor() {\n        // DETECT ENVIRONMENT AUTOMATICALLY\n        // This is where you switch logic based on build targets\n        \n        // @ts-ignore\n        if (typeof wx !== 'undefined' && typeof wx.getSystemInfo === 'function') {\n             // We are in WeChat Mini Game\n             this.adapter = WeChatAdapter;\n        } \n        // @ts-ignore\n        else if (typeof FBInstant !== 'undefined') {\n             // We are in Facebook Instant Games\n             // this.adapter = FacebookAdapter;\n             this.adapter = WebAdapter; // Fallback for now until FB adapter is built\n        } \n        else {\n             // Standard Web Browser\n             this.adapter = WebAdapter;\n        }\n    }\n\n    get auth() { return this.adapter.auth; }\n    get ads() { return this.adapter.ads; }\n    get iap() { return this.adapter.iap; }\n    get social() { return this.adapter.social; }\n    get id() { return this.adapter.id; }\n\n    async init() {\n        await this.adapter.initialize();\n        // Global pre-checks (e.g., auto-login if session valid)\n        const session = await this.auth.checkSession();\n        if (session.success && session.user) {\n            console.log(`[Platform] Auto-logged in as ${session.user.username} on ${this.adapter.id}`);\n        }\n    }\n}\n\nexport const platformService = new PlatformService();\n","\nimport React, { useState, useEffect } from 'react';\nimport { UserProfile, SocialProvider, Gender } from '../../types';\nimport { platformService } from '../../services/platformService';\nimport { upsertUserProfile, findMatch, addFriend, getFriends } from '../../services/cloudService';\n\ninterface SocialLoginModalProps {\n    onClose: () => void;\n    onLoginSuccess: (profile: UserProfile) => void;\n}\n\nexport const SocialLoginModal: React.FC<SocialLoginModalProps> = ({ onClose, onLoginSuccess }) => {\n    const [step, setStep] = useState<'LOGIN' | 'QR_SCAN' | 'PROFILE' | 'MATCHING'>('LOGIN');\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState('');\n    \n    // QR State (Only relevant for Web Adapter simulating Mobile)\n    const [activeProvider, setActiveProvider] = useState<SocialProvider | null>(null);\n    const [qrStatus, setQrStatus] = useState<'GENERATING' | 'WAITING' | 'SCANNED' | 'SUCCESS'>('GENERATING');\n    \n    // Profile State\n    const [username, setUsername] = useState('');\n    const [gender, setGender] = useState<Gender>('OTHER');\n    const [age, setAge] = useState<number>(25);\n    const [country, setCountry] = useState<string>('cn');\n    const [avatarPreview, setAvatarPreview] = useState<string>('');\n    const [matches, setMatches] = useState<UserProfile[]>([]);\n    const [friends, setFriends] = useState<UserProfile[]>([]);\n\n    const supportedProviders = platformService.auth.getSupportedProviders();\n\n    const handleLogin = async (provider: SocialProvider) => {\n        setError('');\n        setLoading(true);\n\n        // SPECIAL CASE: Web Adapter Mocks for Douyin/WeChat still use the QR flow visual\n        // In a REAL Native/MiniGame adapter, platformService.auth.login() would trigger system UI immediately.\n        if (platformService.id === 'WEB' && (provider === SocialProvider.WECHAT || provider === SocialProvider.DOUYIN)) {\n             setActiveProvider(provider);\n             setStep('QR_SCAN');\n             setQrStatus('GENERATING');\n             setTimeout(() => setQrStatus('WAITING'), 800);\n             setTimeout(() => setQrStatus('SCANNED'), 3500);\n             setTimeout(async () => {\n                 setQrStatus('SUCCESS');\n                 const result = await platformService.auth.login(provider);\n                 handleAuthResult(result);\n             }, 5500);\n             return;\n        }\n\n        // Standard Flow\n        const result = await platformService.auth.login(provider);\n        handleAuthResult(result);\n        setLoading(false);\n    };\n\n    const handleAuthResult = async (result: any) => {\n        if (!result.success) {\n            setError(result.error || \"Login Failed\");\n            return;\n        }\n        \n        if (result.user) {\n            // Check if profile needs completion\n            if (result.user.username && result.user.age) {\n                // Profile exists\n                setUsername(result.user.username);\n                setAvatarPreview(result.user.avatar_url || '');\n                setStep('MATCHING');\n                const f = await getFriends();\n                setFriends(f);\n                const candidates = await findMatch(result.user);\n                setMatches(candidates);\n            } else {\n                setStep('PROFILE');\n                setUsername(result.user.username || 'Player');\n            }\n        } else {\n            setStep('PROFILE');\n        }\n    };\n\n    const handleSaveProfile = async () => {\n        setLoading(true);\n        const updates: Partial<UserProfile> = {\n            username, gender, age, country, \n            avatar_url: avatarPreview,\n            is_looking_for_match: true\n        };\n        const saved = await upsertUserProfile(updates);\n        if (saved) {\n            setStep('MATCHING');\n            const candidates = await findMatch(saved as UserProfile);\n            setMatches(candidates);\n        }\n        setLoading(false);\n    };\n\n    // --- RENDERERS ---\n\n    const renderQR = () => (\n        <div className=\"flex flex-col items-center justify-center py-6 animate-fade-in\">\n             <div className=\"text-[#c5a059] mb-4\">Scan with {activeProvider}</div>\n             <div className={`w-48 h-48 bg-white p-2 ${qrStatus==='SUCCESS'?'border-4 border-[#c5a059]':''}`}>\n                 {qrStatus === 'GENERATING' ? 'Generating...' : \n                  <img src={`https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=login_${activeProvider}`} className=\"w-full h-full\"/>}\n             </div>\n             <div className=\"mt-4 text-[#a0a0a0] text-xs\">{qrStatus === 'WAITING' ? 'Waiting for scan...' : qrStatus}</div>\n             {qrStatus === 'SUCCESS' && <div className=\"text-green-500 font-bold mt-2\">Success! Redirecting...</div>}\n        </div>\n    );\n\n    const renderLoginButtons = () => (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 w-full px-8\">\n            {supportedProviders.map(p => (\n                <button key={p} onClick={() => handleLogin(p)} className=\"flex items-center justify-center gap-2 py-4 border border-[#3e2b22] hover:border-[#c5a059] hover:bg-[#1a1a1a] transition-all bg-[#0a0806]\">\n                    <span className=\"text-[#c5a059] uppercase text-xs tracking-widest\">{p} Login</span>\n                </button>\n            ))}\n        </div>\n    );\n\n    return (\n        <div className=\"fixed inset-0 z-[400] flex items-center justify-center bg-black/95 backdrop-blur-md animate-fade-in font-serif\">\n             <div className=\"bg-[#15100e] border border-[#3e2b22] w-full max-w-lg p-8 rounded-sm shadow-lacquer-deep relative overflow-hidden flex flex-col max-h-[90vh]\">\n                <button onClick={onClose} className=\"absolute top-4 right-4 text-[#5c4025] hover:text-[#c5a059] z-20\">✕</button>\n\n                {step === 'LOGIN' && (\n                    <div className=\"flex flex-col items-center gap-8 py-8\">\n                        <h2 className=\"text-2xl text-[#c5a059] font-bold tracking-[0.2em] uppercase text-center\">Login via {platformService.id}</h2>\n                        {renderLoginButtons()}\n                        {error && <div className=\"text-red-500 text-xs mt-4\">{error}</div>}\n                        {loading && <div className=\"text-[#c5a059] text-xs animate-pulse\">Processing...</div>}\n                    </div>\n                )}\n\n                {step === 'QR_SCAN' && renderQR()}\n\n                {step === 'PROFILE' && (\n                    <div className=\"flex flex-col gap-4 py-4 overflow-y-auto\">\n                        <h2 className=\"text-xl text-[#c5a059] text-center\">Create Persona</h2>\n                        <input type=\"text\" value={username} onChange={e => setUsername(e.target.value)} placeholder=\"Username\" className=\"bg-[#0a0806] border border-[#3e2b22] px-3 py-2 text-[#e6c278]\"/>\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <input type=\"number\" value={age} onChange={e => setAge(parseInt(e.target.value))} className=\"bg-[#0a0806] border border-[#3e2b22] px-3 py-2 text-[#e6c278]\"/>\n                            <select value={gender} onChange={e => setGender(e.target.value as Gender)} className=\"bg-[#0a0806] border border-[#3e2b22] px-3 py-2 text-[#e6c278]\">\n                                <option value=\"MALE\">Male</option><option value=\"FEMALE\">Female</option><option value=\"OTHER\">Other</option>\n                            </select>\n                        </div>\n                        <button onClick={handleSaveProfile} className=\"mt-4 py-3 bg-[#3d0e0e] text-[#a0a0a0] border border-[#5c1010] hover:text-white\">Enter World</button>\n                    </div>\n                )}\n\n                {step === 'MATCHING' && (\n                    <div className=\"flex flex-col gap-4 h-full\">\n                        <h2 className=\"text-xl text-[#c5a059] text-center border-b border-[#3e2b22] pb-2\">Lobby</h2>\n                        <div className=\"flex-1 overflow-y-auto space-y-2\">\n                             {matches.map(m => (\n                                 <div key={m.id} className=\"p-2 border border-[#3e2b22] flex justify-between items-center text-xs text-[#a0a0a0]\">\n                                     <span>{m.username}</span>\n                                     <button onClick={() => addFriend(m.id)} className=\"text-[#c5a059] hover:underline\">+ Friend</button>\n                                 </div>\n                             ))}\n                        </div>\n                        <button onClick={() => { onClose(); onLoginSuccess({ id: 'me', username, gender, age, country } as UserProfile); }} className=\"w-full py-3 bg-[#1a1a1a] border border-[#c5a059] text-[#c5a059]\">START GAME</button>\n                    </div>\n                )}\n             </div>\n        </div>\n    );\n};\n","\nimport React, { useState, useEffect, useRef } from 'react';\nimport { sendMessageToTutor, initializeChat, isAIEnabled } from '../services/geminiService';\nimport { ChatMessage, SupportedLanguage } from '../types';\nimport { TRANSLATIONS } from '../constants';\n\ninterface ChatProps {\n  language: SupportedLanguage;\n}\n\nconst Chat: React.FC<ChatProps> = ({ language }) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\n  const [input, setInput] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const chatEndRef = useRef<HTMLDivElement>(null);\n  const [hasKey, setHasKey] = useState(false);\n  \n  const t = (key: string) => TRANSLATIONS[language][key] || TRANSLATIONS['en'][key];\n\n  useEffect(() => {\n    setHasKey(isAIEnabled());\n    if (isAIEnabled()) {\n      const init = async () => {\n        const welcome = await initializeChat();\n        setMessages(prev => prev.length === 0 ? [{ role: 'model', text: welcome, timestamp: Date.now() }] : prev);\n      };\n      init();\n    } else {\n      setMessages(prev => prev.length === 0 ? [{ role: 'system', text: t('aiDisabled'), timestamp: Date.now() }] : prev);\n    }\n  }, [language]);\n\n  useEffect(() => {\n    chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages, isOpen]);\n\n  const handleSend = async () => {\n    if (!input.trim() || !hasKey) return;\n    \n    const userMsg: ChatMessage = { role: 'user', text: input, timestamp: Date.now() };\n    setMessages(prev => [...prev, userMsg]);\n    setInput('');\n    setIsLoading(true);\n\n    const response = await sendMessageToTutor(input);\n    \n    const aiMsg: ChatMessage = { role: 'model', text: response, timestamp: Date.now() };\n    setMessages(prev => [...prev, aiMsg]);\n    setIsLoading(false);\n  };\n\n  return (\n    <div className={`fixed bottom-2 right-2 z-50 flex flex-col items-end transition-all duration-300 ${isOpen ? 'w-[90vw] md:w-80 h-[60vh] md:h-96' : 'w-auto h-auto'}`}>\n      \n      {/* Toggle Button */}\n      <button \n        onClick={() => setIsOpen(!isOpen)}\n        className=\"bg-black text-imperial-gold border-2 border-imperial-gold/50 p-3 rounded-full shadow-lg hover:bg-stone-900 transition-colors flex items-center gap-2 mb-2\"\n      >\n        {isOpen ? (\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n          </svg>\n        ) : (\n          <div className=\"flex items-center gap-2\">\n            <span className=\"font-serif font-bold hidden md:inline text-imperial-gold\">{t('masterTitle')}</span>\n            <div className=\"w-6 h-6 bg-aged-paper rounded-full flex items-center justify-center text-ink-black font-bold font-serif\">?</div>\n          </div>\n        )}\n      </button>\n\n      {/* Chat Window */}\n      {isOpen && (\n        <div className=\"bg-stone-900 w-full h-full rounded-lg shadow-2xl border-4 border-stone-800 flex flex-col overflow-hidden\">\n          {/* Header */}\n          <div className=\"bg-stone-950 text-imperial-gold p-2 font-serif text-center border-b border-stone-800 font-bold tracking-widest\">\n            {t('masterName')}\n          </div>\n\n          {/* Messages */}\n          <div className=\"flex-1 overflow-y-auto p-4 space-y-3 bg-stone-900/95\">\n            {messages.map((msg, idx) => (\n              <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>\n                <div className={`max-w-[85%] p-2 rounded-md text-sm font-serif shadow-sm ${\n                  msg.role === 'user' \n                    ? 'bg-urushi-red text-aged-paper border border-stone-700' \n                    : 'bg-aged-paper text-ink-black border border-gray-400'\n                }`}>\n                  {msg.text}\n                </div>\n              </div>\n            ))}\n            {isLoading && (\n               <div className=\"flex justify-start\">\n                 <div className=\"text-xs text-stone-500 italic animate-pulse pl-2\">\n                   {t('meditating')}\n                 </div>\n               </div>\n            )}\n            <div ref={chatEndRef} />\n          </div>\n\n          {/* Input */}\n          <div className=\"p-2 bg-stone-950 border-t border-stone-800 flex gap-2\">\n            <input\n              type=\"text\"\n              value={input}\n              onChange={(e) => setInput(e.target.value)}\n              onKeyDown={(e) => e.key === 'Enter' && handleSend()}\n              disabled={!hasKey}\n              placeholder={hasKey ? t('chatPlaceholder') : t('chatPlaceholderDisabled')}\n              className=\"flex-1 bg-stone-800 text-aged-paper px-3 py-1 rounded-sm focus:outline-none focus:ring-2 focus:ring-imperial-gold font-serif placeholder-stone-400\"\n            />\n            <button \n              onClick={handleSend}\n              disabled={isLoading || !hasKey}\n              className=\"text-imperial-gold hover:text-white transition-colors\"\n            >\n              ➤\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Chat;\n","\nimport React, { useState, useEffect } from 'react';\nimport { fetchAllMatchLogs, deleteMatchLog, getSupabaseConfig, initSupabase, AdminLogEntry } from '../../services/cloudService';\n\ninterface AdminGateProps {\n    onExit: () => void;\n}\n\nexport const AdminGate: React.FC<AdminGateProps> = ({ onExit }) => {\n    const [isAuthenticated, setIsAuthenticated] = useState(false);\n    const [username, setUsername] = useState('');\n    const [password, setPassword] = useState('');\n    const [errorMsg, setErrorMsg] = useState('');\n\n    // Dashboard State\n    const [logs, setLogs] = useState<AdminLogEntry[]>([]);\n    const [loading, setLoading] = useState(false);\n    const [dbUrl, setDbUrl] = useState('');\n    const [dbKey, setDbKey] = useState('');\n    const [configStatus, setConfigStatus] = useState('');\n\n    useEffect(() => {\n        const config = getSupabaseConfig();\n        setDbUrl(config.url);\n        setDbKey(config.key);\n    }, []);\n\n    const handleLogin = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (username === 'Lhy' && password === 'Lhy147258') {\n            setIsAuthenticated(true);\n            setErrorMsg('');\n            loadData();\n        } else {\n            setErrorMsg(\"Invalid Administrator Credentials\");\n        }\n    };\n\n    const handleConfigSave = () => {\n        if (initSupabase(dbUrl, dbKey)) {\n            setConfigStatus(\"Connection Successful (MemFire/Supabase)\");\n            loadData();\n        } else {\n            setConfigStatus(\"Connection Failed\");\n        }\n    };\n\n    const loadData = async () => {\n        setLoading(true);\n        const data = await fetchAllMatchLogs();\n        setLogs(data);\n        setLoading(false);\n    };\n\n    const handleDelete = async (id: string) => {\n        if (confirm(\"Are you sure you want to delete this record? This cannot be undone.\")) {\n            const success = await deleteMatchLog(id);\n            if (success) {\n                setLogs(prev => prev.filter(l => l.id !== id));\n            } else {\n                alert(\"Delete failed. Check database permissions.\");\n            }\n        }\n    };\n\n    if (!isAuthenticated) {\n        return (\n            <div className=\"fixed inset-0 z-[999] bg-[#050202] flex items-center justify-center font-serif text-[#c5a059]\">\n                <div className=\"absolute inset-0 bg-noise opacity-10 pointer-events-none\"></div>\n                <div className=\"w-full max-w-md p-8 border border-[#3e2b22] bg-[#15100e] rounded-sm shadow-lacquer-deep relative\">\n                    <button onClick={onExit} className=\"absolute top-4 right-4 text-[#5c4025] hover:text-[#c5a059]\">✕</button>\n                    <h2 className=\"text-3xl text-center mb-8 font-bold tracking-[0.2em] border-b border-[#2a1d15] pb-4\">ADMIN PORTAL</h2>\n                    \n                    <form onSubmit={handleLogin} className=\"space-y-6\">\n                        <div>\n                            <label className=\"block text-xs uppercase tracking-widest text-[#8c6239] mb-2\">Admin ID</label>\n                            <input \n                                type=\"text\" \n                                value={username}\n                                onChange={e => setUsername(e.target.value)}\n                                className=\"w-full bg-[#0a0806] border border-[#3e2b22] text-[#e6c278] px-4 py-3 focus:border-[#c5a059] outline-none transition-colors\"\n                            />\n                        </div>\n                        <div>\n                            <label className=\"block text-xs uppercase tracking-widest text-[#8c6239] mb-2\">Passkey</label>\n                            <input \n                                type=\"password\" \n                                value={password}\n                                onChange={e => setPassword(e.target.value)}\n                                className=\"w-full bg-[#0a0806] border border-[#3e2b22] text-[#e6c278] px-4 py-3 focus:border-[#c5a059] outline-none transition-colors\"\n                            />\n                        </div>\n                        {errorMsg && <div className=\"text-red-500 text-xs text-center\">{errorMsg}</div>}\n                        <button type=\"submit\" className=\"w-full py-4 bg-[#3d0e0e] border border-[#5c1010] text-[#a0a0a0] hover:text-white hover:bg-[#5c1010] transition-colors font-bold tracking-[0.2em]\">\n                            AUTHENTICATE\n                        </button>\n                    </form>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"fixed inset-0 z-[999] bg-[#0c0c0c] text-[#a0a0a0] font-sans flex flex-col overflow-hidden\">\n            {/* Header */}\n            <div className=\"h-16 bg-[#15100e] border-b border-[#3e2b22] flex items-center justify-between px-6 shrink-0\">\n                <div className=\"flex items-center gap-4\">\n                    <h1 className=\"text-xl text-[#c5a059] font-serif tracking-widest font-bold\">MA DIAO ADMIN</h1>\n                    <span className=\"text-xs bg-[#3e2b22] text-[#e6c278] px-2 py-0.5 rounded\">Superuser: Lhy</span>\n                </div>\n                <div className=\"flex gap-4\">\n                     <button onClick={loadData} className=\"text-xs uppercase hover:text-white flex items-center gap-1\">\n                        <span>↻</span> Refresh\n                    </button>\n                    <button onClick={onExit} className=\"text-xs uppercase hover:text-white border border-[#3e2b22] px-3 py-1 rounded hover:bg-[#2a1d15]\">\n                        Exit to Game\n                    </button>\n                </div>\n            </div>\n\n            <div className=\"flex flex-1 overflow-hidden\">\n                {/* Sidebar Config */}\n                <div className=\"w-80 bg-[#111] border-r border-[#222] p-6 flex flex-col gap-6 overflow-y-auto\">\n                    <div>\n                        <h3 className=\"text-xs uppercase tracking-widest text-[#8c6239] mb-4 font-bold\">Database Connection</h3>\n                        <p className=\"text-[10px] text-gray-500 mb-4 leading-relaxed\">\n                            Recommended for China: <strong>MemFire Cloud</strong>. \n                            It is Supabase-compatible. Enter MemFire API URL & Key below.\n                        </p>\n                        <div className=\"space-y-3\">\n                            <input \n                                type=\"text\" \n                                placeholder=\"API URL (e.g., https://xyz.memfiredb.com)\"\n                                value={dbUrl}\n                                onChange={e => setDbUrl(e.target.value)}\n                                className=\"w-full bg-black border border-[#333] px-3 py-2 text-xs rounded focus:border-[#c5a059] outline-none\"\n                            />\n                            <input \n                                type=\"password\" \n                                placeholder=\"Anon Key\"\n                                value={dbKey}\n                                onChange={e => setDbKey(e.target.value)}\n                                className=\"w-full bg-black border border-[#333] px-3 py-2 text-xs rounded focus:border-[#c5a059] outline-none\"\n                            />\n                            <button onClick={handleConfigSave} className=\"w-full py-2 bg-[#222] hover:bg-[#333] text-xs border border-[#444] text-[#ccc]\">Update Connection</button>\n                            {configStatus && <div className=\"text-[10px] text-green-500 mt-2\">{configStatus}</div>}\n                        </div>\n                    </div>\n                    \n                    <div className=\"mt-auto\">\n                        <h3 className=\"text-xs uppercase tracking-widest text-[#8c6239] mb-2 font-bold\">Storage Stats</h3>\n                        <div className=\"text-xs text-gray-500\">\n                            Logs Loaded: {logs.length}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Main Content */}\n                <div className=\"flex-1 bg-[#050505] p-8 overflow-y-auto\">\n                    <h2 className=\"text-2xl text-white mb-6 font-thin\">Game Match Logs</h2>\n                    \n                    {loading ? (\n                        <div className=\"text-center py-20 text-[#555] animate-pulse\">Fetching remote data...</div>\n                    ) : (\n                        <div className=\"border border-[#222] rounded overflow-hidden\">\n                            <table className=\"w-full text-left text-sm\">\n                                <thead className=\"bg-[#1a1a1a] text-[#888]\">\n                                    <tr>\n                                        <th className=\"p-4 font-normal\">Timestamp</th>\n                                        <th className=\"p-4 font-normal\">Match ID</th>\n                                        <th className=\"p-4 font-normal\">Winner</th>\n                                        <th className=\"p-4 font-normal\">Rounds</th>\n                                        <th className=\"p-4 font-normal text-right\">Actions</th>\n                                    </tr>\n                                </thead>\n                                <tbody className=\"divide-y divide-[#222]\">\n                                    {logs.map(log => {\n                                        const date = new Date(log.timestamp).toLocaleString();\n                                        const winner = log.data.results.find((r: any) => r.isWinner);\n                                        const winnerText = winner ? `Player ${winner.playerId}` : 'Draw';\n                                        \n                                        return (\n                                            <tr key={log.id} className=\"hover:bg-[#111] transition-colors\">\n                                                <td className=\"p-4 text-[#ccc]\">{date}</td>\n                                                <td className=\"p-4 font-mono text-xs text-[#666]\">{log.id.substring(0, 8)}...</td>\n                                                <td className=\"p-4 text-[#c5a059]\">{winnerText}</td>\n                                                <td className=\"p-4 text-[#888]\">{log.data.results.length} Player Stats</td>\n                                                <td className=\"p-4 text-right\">\n                                                    <button \n                                                        onClick={() => handleDelete(log.id)}\n                                                        className=\"text-red-900 hover:text-red-500 text-xs px-2 py-1 border border-red-900/30 rounded hover:bg-red-900/10 transition-colors\"\n                                                    >\n                                                        Delete\n                                                    </button>\n                                                </td>\n                                            </tr>\n                                        );\n                                    })}\n                                    {logs.length === 0 && (\n                                        <tr>\n                                            <td colSpan={5} className=\"p-8 text-center text-[#444] italic\">\n                                                No match logs found in database.\n                                            </td>\n                                        </tr>\n                                    )}\n                                </tbody>\n                            </table>\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n","\nimport React, { useMemo, useState, useEffect } from 'react';\nimport { useMaDiaoGame } from './hooks/useMaDiaoLogic';\nimport { useAIAgent } from './hooks/useAIAgent';\nimport { useAudioSystem } from './hooks/useAudioSystem';\nimport { useGameSettings } from './hooks/useGameSettings';\nimport { useUIState } from './hooks/useUIState';\nimport { useGameInteraction } from './hooks/useGameInteraction';\nimport { Scene3D } from './components/Visuals/Scene3D';\nimport { PlayerListHUD, HumanHandHUD } from './components/UI/GameInterface';\nimport { SettingsModal, ScoreModal } from './components/UI/Modals'; \nimport { SocialLoginModal } from './components/UI/SocialLoginModal'; \nimport { GamePhase, PlayerType, RiskLevel, UserProfile } from './types';\nimport Chat from './components/Chat';\nimport { getSuitStatusContext } from './services/riskEngine';\nimport { AdminGate } from './components/Admin/AdminGate';\nimport { platformService } from './services/platformService'; \nimport { SkinProvider, useSkin } from './contexts/SkinContext';\nimport { AppIcon } from './components/Visuals/AppIcon'; \n\n// Internal Logger Wrapper\nconst logApp = (msg: string) => {\n    if ((window as any).logToScreen) (window as any).logToScreen(`[App] ${msg}`);\n};\n\nconst GameContent: React.FC = () => {\n  logApp(\"Rendering GameContent...\");\n  \n  const { skin, setSkinId, availableSkins } = useSkin(); \n  const [view, setView] = useState<'GAME' | 'ADMIN'>('GAME');\n  const [userProfile, setUserProfile] = useState<UserProfile | undefined>(undefined);\n\n  // 1. Settings & UI State\n  const settings = useGameSettings();\n  const ui = useUIState();\n\n  // 2. Core Game Logic\n  // logApp(\"Initializing Game Logic Hook...\");\n  const { state, actions } = useMaDiaoGame({\n      difficulty: settings.difficulty,\n      isRiskAlertOn: settings.isRiskAlertOn,\n      language: settings.language\n  });\n  \n  // 3. Systems\n  const audioSystem = useAudioSystem(settings.isMuted);\n  \n  // 4. AI Agent\n  const { aiChatMessages } = useAIAgent({\n      gameState: state,\n      gameActions: actions,\n      audioSystem: audioSystem,\n      isMuted: settings.isMuted,\n      language: settings.language\n  });\n\n  // 5. Derived State & Interaction Logic\n  const humanPlayer = state.players.find(p => p.type === PlayerType.HUMAN);\n  \n  const { interactionState, handle3DActionClick } = useGameInteraction(\n      state, \n      actions, \n      humanPlayer, \n      settings\n  );\n\n  // 6. Platform Init\n  useEffect(() => {\n      const initPlatform = async () => {\n          logApp(\"Initializing Platform Service...\");\n          await platformService.init();\n          const session = await platformService.auth.checkSession();\n          if (session.success && session.user) {\n              setUserProfile(session.user);\n          }\n      };\n      initPlatform();\n  }, []);\n\n  // 7. Visual Markers Logic\n  const humanCardMarkers = useMemo(() => { \n      if (!humanPlayer) return {}; \n      const markers: any = {};\n      const { bankerId, openedSuits, recordedCards, firstLeadInfo, faceUpPlayedCardIds, bankerFirstLeadCard } = state;\n      \n      humanPlayer.hand.forEach(card => {\n          const status = getSuitStatusContext(humanPlayer, card, bankerId, openedSuits, recordedCards, firstLeadInfo, faceUpPlayedCardIds, bankerFirstLeadCard);\n          markers[card.id] = { isMature: status === 'SAFE', isForbidden: status === 'FORBIDDEN' };\n      });\n      return markers;\n  }, [humanPlayer, state.openedSuits, state.recordedCards, state.bankerId, state.firstLeadInfo, state.faceUpPlayedCardIds, state.bankerFirstLeadCard]);\n\n  // --- Handlers ---\n  const handleStartGame = () => actions.startGame(userProfile);\n  \n  const handleQuitGame = () => {\n      if (confirm(settings.language === 'zh_CN' ? \"确定要关闭游戏吗？\" : \"Are you sure you want to quit?\")) {\n          actions.exitToTitle();\n      }\n  };\n\n  const openRecorder = () => {\n      ui.setActiveSettingsTab('RECORDER');\n      ui.setShowSettings(true);\n  };\n\n  const openSettings = () => {\n      ui.setActiveSettingsTab('GENERAL');\n      ui.setShowSettings(true);\n  };\n\n  if (view === 'ADMIN') return <AdminGate onExit={() => setView('GAME')} />;\n\n  const { phase, currentPlayerIndex, bankerId, selectedCardId, trickNumber, mianZhangCard } = state;\n\n  // IMPORTANT FIX: Use `fixed inset-0` to guarantee fullscreen coverage regardless of parent\n  return (\n    <div className={`fixed inset-0 perspective-container overflow-hidden ${skin.layout.backgroundClass} transition-colors duration-1000`}> \n      <Scene3D \n          state={state} \n          interactionState={{\n              ...interactionState,\n              onActionClick: handle3DActionClick\n          }}\n      />\n\n      {phase !== GamePhase.DEALING && phase !== GamePhase.SHUFFLING && (\n          <>\n            <PlayerListHUD \n                players={state.players} \n                bankerId={bankerId} \n                currentPlayerIndex={currentPlayerIndex} \n                aiChatMessages={aiChatMessages}\n            />\n            {humanPlayer && (\n                <HumanHandHUD \n                    player={humanPlayer} \n                    isMyTurn={state.players[currentPlayerIndex]?.id === 0 && phase === GamePhase.PLAYING} \n                    onCardClick={(id: string) => { \n                        if (settings.oneClickPlay) actions.executePlayCard(0, id);\n                        else actions.setSelectedCardId(id === selectedCardId ? null : id);\n                    }}\n                    onDragPlay={(id: string) => actions.executePlayCard(0, id)} \n                    onPlayConfirm={(id: string) => actions.executePlayCard(0, id)} \n                    selectedCardId={selectedCardId} \n                    highlightedCardIds={interactionState.highlightedCardIds}\n                    cardMarkers={humanCardMarkers}\n                    oneClickPlay={settings.oneClickPlay}\n                    canInteract={!interactionState.disabled}\n                    actionLabel={interactionState.label}\n                    mianZhangCard={mianZhangCard}\n                />\n            )}\n            <div className=\"fixed top-4 right-4 z-[200] flex gap-3\">\n                <button \n                    onClick={openRecorder} \n                    className=\"text-[#e6c278] bg-black/40 p-2 rounded-full border border-[#5c4025] hover:bg-[#1a0f0a] hover:border-[#c5a059] backdrop-blur-md transition-all shadow-gem-btn w-12 h-12 flex items-center justify-center group\" \n                    title=\"Recorder\"\n                >\n                    <span className=\"text-xl group-hover:scale-110 transition-transform\">👁</span>\n                </button>\n                <button \n                    onClick={openSettings} \n                    className=\"text-[#8c6239] bg-black/40 p-2 rounded-full border border-[#3e2b22] hover:bg-[#1a0f0a] hover:border-[#c5a059] hover:text-[#c5a059] backdrop-blur-md transition-all shadow-gem-btn w-12 h-12 flex items-center justify-center group\" \n                    title=\"Menu\"\n                >\n                    <span className=\"text-xl group-hover:rotate-90 transition-transform duration-500\">⚙</span>\n                </button>\n            </div>\n          </>\n      )}\n\n      {state.pendingRisk && (\n          <div className=\"fixed inset-0 z-[400] flex items-center justify-center p-4 bg-black/95 backdrop-blur-md animate-fade-in\">\n              <div className=\"bg-[#0f0a08] border border-[#5c1010] p-12 max-w-lg w-full rounded-sm shadow-[0_0_50px_rgba(0,0,0,0.9)] flex flex-col items-center text-center relative overflow-hidden\">\n                  <div className=\"w-24 h-24 rounded-full bg-[#1a0505] text-[#8c1c0b] flex items-center justify-center text-5xl mb-8 border border-[#3d0e0e] shadow-inner\">!</div>\n                  <h3 className=\"text-4xl text-[#8c1c0b] font-serif font-bold tracking-[0.2em] mb-4 drop-shadow-md\">{state.pendingRisk.assessment.riskLevel === RiskLevel.PENALTY ? \"严重违例\" : \"战术警示\"}</h3>\n                  <div className=\"text-[#5c4025] text-xs uppercase tracking-[0.4em] mb-10 border-b border-[#2a1d15] pb-4 w-full\">{state.pendingRisk.assessment.ruleId}</div>\n                  <p className=\"text-[#a0a0a0] mb-12 leading-relaxed font-serif text-xl\">{state.pendingRisk.assessment.message}</p>\n                  <div className=\"flex gap-8 w-full\">\n                      <button onClick={() => actions.setPendingRisk(null)} className=\"flex-1 py-4 border border-[#2a1d15] text-[#5c4025] hover:text-[#8c6239] hover:border-[#3e2b22] transition-colors uppercase text-xs tracking-[0.3em] font-serif rounded-sm\">取消</button>\n                      <button onClick={() => actions.executePlayCard(0, state.pendingRisk!.cardId, true)} className=\"flex-1 py-4 bg-[#3d0e0e] text-[#a0a0a0] border border-[#5c1010] hover:bg-[#5c1010] hover:text-white transition-colors uppercase text-xs tracking-[0.3em] font-bold shadow-lg rounded-sm\">强行出牌</button>\n                  </div>\n              </div>\n          </div>\n      )}\n\n      {phase === GamePhase.DEALING && (\n          <div className={`fixed inset-0 z-[300] flex flex-col items-center justify-center text-[#c5a059] font-serif overflow-hidden transition-all duration-1000 ${skin.layout.backgroundClass}`}>\n                <div className=\"absolute inset-0 bg-gradient-to-b from-[#1a0505] via-transparent to-black opacity-80 pointer-events-none\"></div>\n                <div className=\"relative z-10 flex flex-col items-center animate-fade-in-up w-full max-w-md px-6\">\n                    <div className=\"mb-8 transform hover:scale-105 transition-transform duration-700\">\n                        <AppIcon size={120} className=\"border border-[#5c4025] shadow-[0_0_50px_rgba(197,160,89,0.2)]\" />\n                    </div>\n                    <h1 className=\"text-6xl md:text-8xl font-bold tracking-[0.2em] mb-2 text-transparent bg-clip-text bg-gradient-to-b from-[#e6c278] to-[#8c6239] drop-shadow-lg font-calligraphy whitespace-nowrap\">馬吊大師</h1>\n                    <div className=\"relative w-64 mb-12 mt-8 group\">\n                        <select \n                            value={skin.id} \n                            onChange={(e) => setSkinId(e.target.value)} \n                            className=\"w-full bg-[#15100e] text-[#c5a059] border border-[#3e2b22] py-3 px-8 text-center font-serif text-lg tracking-widest outline-none rounded-[2px] shadow-lg appearance-none cursor-pointer hover:border-[#5c4025] transition-colors focus:border-[#8c6239]\"\n                        >\n                            {availableSkins.map((s:any) => (\n                                <option key={s.id} value={s.id}>{s.name}</option>\n                            ))}\n                        </select>\n                        <div className=\"absolute right-3 top-1/2 -translate-y-1/2 text-[#5c4025] pointer-events-none group-hover:text-[#8c6239] transition-colors text-xs\">▼</div>\n                    </div>\n                    <div className=\"flex flex-col gap-4 w-full\">\n                        <button \n                            onClick={handleStartGame} \n                            className=\"w-full py-4 bg-[#0a0503] border border-[#3e2b22] text-[#8c6239] hover:text-[#c5a059] hover:border-[#c5a059] transition-all duration-700 text-xl font-bold tracking-[0.3em] rounded-[1px] shadow-[0_0_20px_rgba(0,0,0,0.8)] animate-breathe-subtle relative overflow-hidden group\"\n                        >\n                            <span className=\"relative z-10\">{userProfile ? \"CONTINUE\" : \"ENTER GAME\"}</span>\n                            <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-[#c5a059]/5 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000\"></div>\n                        </button>\n                        {!userProfile && (\n                            <button onClick={() => ui.setShowSocialModal(true)} className=\"w-full py-3 bg-transparent border border-[#2a1d15] text-[#5c4025] text-sm font-bold tracking-[0.3em] rounded-[1px] hover:border-[#3e2b22] hover:text-[#8c6239] transition-all\">\n                                NETWORK BATTLE\n                            </button>\n                        )}\n                        {userProfile && (\n                            <button onClick={async () => { await platformService.auth.logout(); setUserProfile(undefined); actions.exitToTitle(); }} className=\"text-xs text-[#5c4025] hover:text-[#8c6239] mt-2 underline decoration-[#3e2b22]\">Sign Out</button>\n                        )}\n                    </div>\n                </div>\n          </div>\n      )}\n\n      {phase === GamePhase.SCORING && (\n          <ScoreModal \n              results={state.roundResults} \n              onClose={() => {}} \n              onNextRound={actions.startNextRound}\n              onHome={actions.exitToTitle}\n              onQuit={handleQuitGame}\n              bankerId={bankerId} \n              language={settings.language} \n              players={state.players} \n          />\n      )}\n      \n      {ui.showSettings && (\n          <SettingsModal \n            onClose={() => ui.setShowSettings(false)} \n            onOpenAdmin={() => { ui.setShowSettings(false); setView('ADMIN'); }}\n            settings={settings} \n            initialTab={ui.activeSettingsTab}\n            gameData={{\n                recordedCards: state.recordedCards,\n                faceUpPlayedCardIds: state.faceUpPlayedCardIds,\n                gameHistory: state.gameHistory\n            }}\n          />\n      )}\n      \n      {ui.showSocialModal && (\n          <SocialLoginModal \n            onClose={() => ui.setShowSocialModal(false)}\n            onLoginSuccess={(profile: any) => {\n                ui.setShowSocialModal(false);\n                setUserProfile(profile);\n                actions.startGame(profile);\n            }}\n          />\n      )}\n\n      <Chat language={settings.language} />\n    </div>\n  );\n};\n\nexport const App: React.FC = () => {\n    logApp(\"App Root Mounted.\");\n    return (\n        <SkinProvider>\n            <GameContent />\n        </SkinProvider>\n    );\n};\n","\nexport function register() {\n  if ('serviceWorker' in navigator) {\n    window.addEventListener('load', () => {\n      let swUrl = ''; \n      \n      try {\n        // Attempt 1: Resolve sw.js relative to window.location.href.\n        // This usually overrides <base> tags.\n        if (window.location.href) {\n             swUrl = new URL('./sw.js', window.location.href).toString();\n        }\n      } catch (error) {\n        console.warn('SW URL construction failed:', error);\n      }\n\n      // Attempt 2: Fallback manual construction if URL() failed or href was invalid.\n      // This ensures we don't fall back to a bare './sw.js' which is susceptible to <base href=\"...\"> \n      // pointing to a different domain (like ai.studio).\n      if (!swUrl && window.location.origin && window.location.pathname) {\n          const path = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);\n          swUrl = `${window.location.origin}${path}sw.js`;\n      }\n\n      // If we still don't have a URL (e.g. weird iframe state), default to relative but expect issues.\n      if (!swUrl) swUrl = './sw.js';\n      \n      navigator.serviceWorker\n        .register(swUrl)\n        .then((registration) => {\n          console.log('SW registered: ', registration);\n          \n          registration.onupdatefound = () => {\n            const installingWorker = registration.installing;\n            if (installingWorker == null) {\n              return;\n            }\n            installingWorker.onstatechange = () => {\n              if (installingWorker.state === 'installed') {\n                if (navigator.serviceWorker.controller) {\n                  console.log('New content is available; please refresh.');\n                } else {\n                  console.log('Content is cached for offline use.');\n                }\n              }\n            };\n          };\n        })\n        .catch((error) => {\n          // Suppress specific origin mismatch errors common in cloud preview environments\n          if (error.message && (error.message.includes('origin') || error.message.includes('scriptURL'))) {\n              console.warn('Service Worker registration skipped due to environment mismatch (ignoring).');\n          } else {\n              console.error('Error during service worker registration:', error);\n          }\n        });\n    });\n  }\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","\nimport React, { ErrorInfo, ReactNode } from 'react';\nimport { createRoot } from 'react-dom/client';\nimport { App } from './App';\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\n\n// Helper to access the global logger safely\nconst safeLog = (msg: string, type: 'info' | 'error' = 'info') => {\n    const w = window as any;\n    if (w.logToScreen) w.logToScreen(msg, type);\n    else console[type](msg);\n};\n\nsafeLog(\"index.tsx: Script execution started.\");\n\n// CLEAR WATCHDOG IMMEDIATELY ON SCRIPT LOAD to prevent false positives if render takes time\nconst w = window as any;\nif (w.bootTimeout) {\n    clearTimeout(w.bootTimeout);\n    w.bootTimeout = null;\n    safeLog(\"Watchdog cleared. Starting React mount...\");\n}\n\ninterface ErrorBoundaryProps {\n    children?: ReactNode;\n}\n\ninterface ErrorBoundaryState {\n    hasError: boolean;\n    error: Error | null;\n}\n\nclass ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\n    public state: ErrorBoundaryState = { hasError: false, error: null };\n    public readonly props: Readonly<ErrorBoundaryProps>;\n\n    constructor(props: ErrorBoundaryProps) {\n        super(props);\n        this.props = props;\n    }\n\n    static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n        return { hasError: true, error };\n    }\n\n    componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n        safeLog(\"React Boundary Caught: \" + error.message, 'error');\n        console.error(errorInfo);\n    }\n\n    render() {\n        if (this.state.hasError) {\n            return (\n                <div style={{ \n                    padding: '40px', \n                    color: '#ff6b6b', \n                    fontFamily: 'monospace', \n                    background: '#1a0505', \n                    height: '100vh', \n                    display: 'flex', \n                    flexDirection: 'column', \n                    alignItems: 'center', \n                    justifyContent: 'center' \n                }}>\n                    <h1 style={{ fontSize: '24px', marginBottom: '20px' }}>Application Error</h1>\n                    <pre style={{ background: 'rgba(0,0,0,0.3)', padding: '20px', borderRadius: '4px', maxWidth: '80vw', overflow: 'auto' }}>\n                        {this.state.error?.message}\n                    </pre>\n                    <button \n                        onClick={() => window.location.reload()} \n                        style={{ \n                            marginTop: '20px', \n                            padding: '10px 20px', \n                            background: '#8c1c0b', \n                            color: 'white', \n                            border: '1px solid #ff6b6b', \n                            cursor: 'pointer' \n                        }}\n                    >\n                        Reload\n                    </button>\n                </div>\n            );\n        }\n        return this.props.children;\n    }\n}\n\nconst mount = () => {\n    const rootEl = document.getElementById('root');\n    if (!rootEl) {\n        safeLog(\"FATAL: #root element not found!\", 'error');\n        return;\n    }\n\n    try {\n        const root = createRoot(rootEl);\n        root.render(\n            <ErrorBoundary>\n                <App />\n            </ErrorBoundary>\n        );\n        safeLog(\"React Root Rendered.\");\n\n        // Cleanup loader visuals after a slight delay to allow React to paint\n        setTimeout(() => {\n            const loader = document.getElementById('app-loader');\n            if (loader) {\n                loader.style.opacity = '0';\n                setTimeout(() => {\n                    if (loader.parentNode) loader.parentNode.removeChild(loader);\n                }, 500);\n            }\n        }, 500);\n\n        serviceWorkerRegistration.register();\n\n    } catch (e: any) {\n        safeLog(\"Mount Exception: \" + (e.message || String(e)), 'error');\n    }\n};\n\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', mount);\n} else {\n    mount();\n}\n"],"names":["Suit","CardColor","CardRank","PlayerType","SocialProvider","GamePhase","Difficulty","RiskLevel","TacticalPriority","createCard","suit","name","val","color","rank","desc","id","ID_WAN_WAN","ID_QIAN_WAN","ID_BAI_WAN","ID_90_WAN","ID_20_WAN","ID_9_GUAN","ID_8_GUAN","ID_6_GUAN","ID_5_GUAN","ID_1_GUAN","ID_9_SUO","ID_1_SUO","ID_KONG_WEN","ID_BAN_WEN","ID_1_WEN","ID_9_WEN","MA_DIAO_TUTOR_PROMPT","generateDeck","deck","TRANSLATIONS","SUIT_CONFIG","isBigFourCash","value","isJinZhang","card","isNeighbor","val1","val2","isRestrictedQing","config","min","max","checkConnectivity","startVal","targetVal","unionSet","visited","queue","current","uVal","connected","hasRoot","uSet","getCaptureMultiplier","flags","evaluateKaiChong","player","potCard","history","specialCaptures","setB_Ids","h","c","sourceCards","totalScore","validCards","descriptions","minLinearDistance","baiCard","card80","score","multiplier","sVal","pVal","zunVal","isOne90","isOneQing","sRank","pRank","isRestricted","canMatch","isValidSequence","maxVal","minVal","connectsTo90","connectsTo30","finalScore","finalDesc","dist","matchType","sourceCard","isSpecial90","uniqueDescs","getLabel","type","isRed","isGreen","identifyPatterns","cards","identifyKaiChongSeYang","uCards","details","redCards","redCount","pts","calculateRoundScores","players","bankerId","lang","kaiChongHistory","violationLog","results","p","mainTricks","t","diaoRaw","diaoChange","myKcMatches","potCardIds","m","mainCapturedCards","seYangDetails","seYangScore","kcSeYangDetails","kcScore","kaiChongPoints","myViolations","patternDetails","d","banker","r","bankerDiaoTotal","scorer","generatedPoints","peasants","count","splitCost","remainder","idx","deduction","violator","v","others","compensation","o","findBestKaiChongMatch","currentAttempterId","result","PenaltyType","isZhenZhang","hand","recordedCards","tableCards","mianZhangCard","W","tc","isQing","is90Wan","isDaZhang","getSequenceWinners","winningCard","checkBuLiShang","hasWan","hasQian","hasBai","suits","suitCards","shang","jian","isPlayingShangOrJian","isPlayingSequence","checkBuBaoBai","openedSuits","openedNonCash","s","bankerLed","uniqueSuits","hasShang","checkJinMenCiXu","openedNonCashSuits","jinMenCards","bankerLedWan","checkCashLeadingRules","playerLedCash","checkPriorityOne","winningPlayerId","firstLeadInfo","isBanker","winners","a","b","canWin","isXCash","capturedCount","holdsWanOrQian","nonCashShangCount","isQinWangEligible","bankerPlayed","isCapturing","winningIsBig","playingIsBig","isTrue","isMax","isSeq","checkPriorityZero","evaluatePlayRisk","allPlayers","roundNumber","bankerFirstLeadCard","buLiShang","buBaoBai","jinMen","cashRules","leadSuit","currentBest","p0","p1","getSuitStatusContext","faceUpCardIds","nonCashOpened","peasantLedSuits","forbiddenSuit","isLocked","bankerLeadEntry","pSuits","allNonCash","familiar","remaining","getPriorityDiscardCards","DEFAULT_STATE","STORAGE_KEY","loadAIMemory","stored","getAIState","playerId","updateAILearning","currentState","difficulty","newState","isWin","prevWins","hasAggressiveViolation","hasCarelessViolation","adjustmentRate","supabase","STORAGE_KEY_URL","STORAGE_KEY_KEY","BUCKET_NAME","TABLE_HISTORY","TABLE_PROFILES","TABLE_FRIENDS","MOCK_USER_KEY","MOCK_PROFILE_KEY","MOCK_FRIENDS_KEY","range","start","end","_","i","CULTURAL_POOLS","generateRandomProfile","preferredRegion","regionKey","rand","pool","isFemale","gender","title","country","idList","photoId","avatarUrl","gazeRand","gazeDirection","MOCK_PLAYERS","initSupabase","url","key","supabaseUrl","supabaseKey","globalSupabase","e","getSupabaseConfig","clearSupabaseConfig","getCurrentUser","user","mock","signInWithProvider","provider","data","error","loginAsGuest","mockUser","gen","updates","signOut","isGuest","upsertUserProfile","profile","final","friends","profileData","getUserProfile","userId","u","local","parsed","localFriends","uploadAvatar","file","fileExt","filePath","uploadError","findMatch","myProfile","candidates","fiveMinutesAgo","freshMocks","addFriend","friendId","getFriends","friendIds","friendships","ids","f","syncGameStats","fetchAllMatchLogs","deleteMatchLog","STATS_KEY","loadGameStats","defaults","saveGameStats","aiLearningStates","stats","shuffle","array","newArray","j","sortHand","getSuitWeight","weightA","weightB","generateEntertainingDeck","fullDeck","useMaDiaoGame","setDeck","useState","setPlayers","pot","setPot","setTableCards","currentPlayerIndex","setCurrentPlayerIndex","phase","setPhase","setBankerId","roundResults","setRoundResults","trickNumber","setTrickNumber","gameMessage","setGameMessage","setRecordedCards","faceUpPlayedCardIds","setFaceUpPlayedCardIds","setViolationLog","setOpenedSuits","setFirstLeadInfo","setBankerFirstLeadCard","gameHistory","setGameHistory","setSpecialCaptures","trickWinnerId","setTrickWinnerId","kaiChongCardIndex","setKaiChongCardIndex","setKaiChongHistory","setMianZhangCard","selectedCardId","setSelectedCardId","pendingRisk","setPendingRisk","violationNotification","setViolationNotification","lastGameEvent","setLastGameEvent","emitEvent","context","resetRoundState","startGame","userProfile","existingPlayers","newDeck","hands","potCards","mianZhang","newPlayers","newBankerId","availableProfiles","findAndPop","gaze","found","rightBot","leftBot","topBot","createFallbackProfile","safeRight","safeTop","safeLeft","offset","starterId","startNextRound","exitToTitle","advanceTurn","nextPlayerId","resolveTrick","currentPlayers","winnerId","winningCardRef","winnerVal","prev","next","isBigWin","updatedPlayers","newTrickPile","newCapturedCards","executePlayCard","cardId","bypassRisk","tableCardsForRisk","risk","isFaceDown","currentMax","isMillion","isWanWan","isCashLead","isMillionFaceUp","alreadyRevealed","newHand","newP","newTableCards","nextPlayersState","useEffect","currentTable","tempPlayers","turnOrder","pid","pl","newEntry","timer","currentPotCard","possibleMatches","match","flipperId","distA","distB","winningMatch","prevPlayers","duplicateSourceIds","sc","scores","newHistory","bankerScore","pScore","humanScore","newLearningStates","ai","globalAIFailure","apiKey","define_process_env_default","GoogleGenAI","isAIEnabled","chatSession","initializeChat","sendMessageToTutor","message","generateSpeech","text","voiceName","base64Audio","Modality","binaryString","len","bytes","getAIMove","aiPlayer","estimatedRound","getHeuristicMove","learningState","analyzedMoves","validMoves","noWarnings","purelySafe","isBaiLao","sortLowToHigh","sortHighToLow","followCards","currentBestVal","winningMoves","aIsRed","bIsRed","MESSAGES","getAIChatMessage","language","personality","options","index","useAIAgent","gameState","gameActions","audioSystem","isMuted","aiChatMessages","setAiChatMessages","processingRef","useRef","currentPlayer","tableCardsForAI","move","triggerAIChat","teacherId","voice","pcmData","useAudioSystem","audioContextRef","AudioCtx","decodeAudioData","ctx","sampleRate","numChannels","dataInt16","frameCount","buffer","channel","channelData","useCallback","audioBuffer","source","useGameSettings","setLanguage","setDifficulty","oneClickPlay","setOneClickPlay","setIsMuted","isRiskAlertOn","setIsRiskAlertOn","showSuitHistory","setShowSuitHistory","githubAutoSync","setGithubAutoSync","isMobileDevice","setIsMobileDevice","checkMobile","isMobileWidth","isMobileUA","graphicsQuality","setGraphicsQuality","internalShowPaperDolls","setInternalShowPaperDolls","useUIState","showSettings","setShowSettings","activeSettingsTab","setActiveSettingsTab","showSocialModal","setShowSocialModal","useGameInteraction","state","actions","humanPlayer","settings","interactionState","useMemo","canInteract","label","highlightedCardIds","disabled","React","activePlayerId","spotlightPos","styles","jsx","VIEWBOX_STR","PATH_FULL_SHAPE","PATH_NORTH","PATH_SOUTH","PATH_EAST","PATH_WEST","TableBorderFlow","isVertical","jsxs","Compass","revealedBaiLaoId","suspectedBaiLaoId","playedPlayerIds","hasTableCards","rotation","deg","sectorMapping","isDualRole","getPlayerColorValues","getIdentityLabel","defaultText","getTextClass","isActive","isTheBanker","isTheBaiLao","colorClass","glowStyle","scaleClass","isKaiChong","lidTranslateY","activeColors","sector","pidStr","k","isLit","colors","GOLD_DUST_PATTERN","ImperialAtmosphere","quality","ImperialCardBack","isSmall","ImperialEffectOverlay","effect","TheaterShadows","BodyFront","ChairStub","ImperialSkin","props","sizeClass","bgClass","hoverClass","transformClass","isInverted","isMyTurn","FABRIC_PATTERN","SnowAtmosphere","ChristmasCardBack","ChristmasEffectOverlay","WoolBody","PaddedChair","position","ChristmasSkin","MingAtmosphere","MingCardBack","MingEffectOverlay","BambooShadows","Chair","MingSkin","INK_PATTERN","TaoistAtmosphere","TaoistCardBack","TaoistEffectOverlay","InkBody","StoneChair","TaoistSkin","defaultContext","SkinContext","createContext","SkinProvider","children","availableSkins","currentSkin","setCurrentSkin","setSkinId","savedId","useSkin","useContext","PAPER_URI","getPokerDisplay","getModernSuit","CardBase","onClick","onTouchStart","style","domId","textRotation","isRotated","lanternGlow","skin","isVerticalText","containerClass","mainColorClass","cornerColorClass","mainFontSize","indexFontSize","suitFontSize","rotationStyle","contentLayoutClass","cornerPosClass","THICKNESS_PX","edgeColor","invertedBg","engravedTextStyle","CardFaceContent","Fragment","CardComponent","PAPER_NOISE","CharacterFigure","statusText","BodyComponent","robeColor","imageTransform","transform","base","getStatusColor","status","textFlipStyle","CinematicOverlay","TopPaperScreen","skinId","PingFeng","DESKTOP_CONFIG","LAYOUT_CONFIGS","useLayoutMode","mode","setMode","handleResize","w","aspect","ActionPlate3D","pressed","setPressed","yPos","zPos","artifactColor","artifactBorder","artifactText","handleClick","TableSlab","width","height","thickness","visualYOffset","borderStyle","isMobile","getDiaoStatusText","trickCount","getPlayerGlow","indexMatch","target","BulletCard","playerPos","spread","centerOffset","isWinner","isMobilePortrait","animClass","posStyle","setPosStyle","tx","ty","spreadX","spreadY","cx","cy","baseZ","raf","TableCards","layoutConfig","pos","AIHandCompact","baseRotation","scale","alignLeft","alignRight","xOff","WonCardsGrid","forceVerticalLayout","align","isFramed","hideBackground","hideLabel","limit","gap","cw","ch","isGridVertical","padding","realWidth","realHeight","offsetX","offsetY","textRot","col","row","x","y","cardCenterX","cardCenterY","activeGlow","PlayerZone3D","showPaperDolls","isHuman","cfg","zoneRot","handPos","wonPos","forceVerticalWonGrid","hideWonBackground","hideWonLabel","wonCount","dynamicScale","shift","baseHandTop","baseWonTop","handTopVal","wonTopVal","wonScale","finalWonScale","charStyle","wonCardsPointerEvents","p2","PotStack","visiblePot","currentScale","getCardGlow","failedCardCount","isRevealed","isCurrent","isFuture","wasMatched","rot","z","spacing","startY","glow","flightStyle","Scene3D","myKc","potIds","getDiaoStatus","trickPile","truncateName","DEFAULT_AVATAR","PlayerListHUD","displayPlayers","diaoStatus","chatMsg","posClass","HumanHandHUD","onCardClick","onDragPlay","onPlayConfirm","cardMarkers","actionLabel","dragStateRef","draggingId","setDraggingId","dragTransform","setDragTransform","hoveredCardId","setHoveredCardId","windowWidth","setWindowWidth","isPortrait","setIsPortrait","handleLocalCardClick","handleActionClick","firstId","handleStart","clientX","clientY","handleMove","handleEnd","currentY","startX","currentX","handSize","CARD_WIDTH_REM","CARD_WIDTH_PX","AVAILABLE_WIDTH","getBasePosition","xOffset","totalWidthNoOverlap","step","dFanAngle","dStartAngle","dAngleStep","MobilePortraitControls","isDragging","isHovered","isVisuallySelected","isHighlighted","markers","liftY","liftZ","rotZ","AppIcon","className","size","uid","getFlagUrl","countryCode","getScoreColor","getDiaoBadge","CardZoomOverlay","onClose","ScoreRow","highlightInverted","ScoreModal","onNextRound","onHome","onQuit","expandedIds","setExpandedIds","zoomedCard","setZoomedCard","toggleExpand","getKcLabel","RenderVisuals","res","pd","isMe","isExpanded","playerObj","flagUrl","RecorderView","visibleCards","grouped","groups","suitsOrder","suitLabels","HistoryView","GeneralSettingsView","onOpenAdmin","setShowPaperDolls","sbUrl","setSbUrl","sbKey","setSbKey","isConnected","setIsConnected","uploadStatus","setUploadStatus","fileInputRef","handleConnect","handleFileUpload","Row","Toggle","active","labelOn","labelOff","l","SettingsModal","initialTab","gameData","activeTab","setActiveTab","IconExportTarget","TabButton","icon","WebAuth","WebAds","WebIAP","productId","WebSocial","WebAdapter","WeChatAuth","WeChatAds","WeChatIAP","WeChatSocial","img","WeChatAdapter","PlatformService","session","platformService","SocialLoginModal","onLoginSuccess","setStep","loading","setLoading","setError","activeProvider","setActiveProvider","qrStatus","setQrStatus","username","setUsername","setGender","age","setAge","setCountry","avatarPreview","setAvatarPreview","matches","setMatches","setFriends","supportedProviders","handleLogin","handleAuthResult","handleSaveProfile","saved","renderQR","renderLoginButtons","Chat","isOpen","setIsOpen","messages","setMessages","input","setInput","isLoading","setIsLoading","chatEndRef","hasKey","setHasKey","welcome","handleSend","userMsg","aiMsg","msg","AdminGate","onExit","isAuthenticated","setIsAuthenticated","password","setPassword","errorMsg","setErrorMsg","logs","setLogs","dbUrl","setDbUrl","dbKey","setDbKey","configStatus","setConfigStatus","loadData","handleConfigSave","handleDelete","log","date","winner","winnerText","logApp","GameContent","view","setView","setUserProfile","ui","handle3DActionClick","humanCardMarkers","handleStartGame","handleQuitGame","openRecorder","openSettings","App","register","swUrl","path","registration","installingWorker","safeLog","ErrorBoundary","errorInfo","mount","rootEl","createRoot","loader","serviceWorkerRegistration.register"],"mappings":"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"}